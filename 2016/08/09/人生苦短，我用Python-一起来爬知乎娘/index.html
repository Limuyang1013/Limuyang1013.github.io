<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="人生苦短，我用Python--一起来爬知乎娘"><meta name="keywords" content="知乎,爬虫,网络"><meta name="author" content="李牧羊,lin794653318@gmail.com"><meta name="copyright" content="李牧羊"><title>人生苦短，我用Python--一起来爬知乎娘 | Atlantis</title><link rel="shortcut icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css?version=1.5.3"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  localSearch: undefined
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="http://oasusatoz.bkt.clouddn.com/3-15052H1035cF.jpg"></div><div class="author-info__name text-center">李牧羊</div><div class="author-info__description text-center">碌碌无为，打马而过</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">22</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">39</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">4</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" href="http://litten.me/" target="_blank">litten</a><a class="author-info-links__name text-center" href="https://developer.android.com/index.html" target="_blank">Android Developer</a><a class="author-info-links__name text-center" href="http://blog.csdn.net/wei_smile" target="_blank">CSDN</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://ws1.sinaimg.cn/large/8700af19ly1fnp7q2phkzj21hc0xc0yl)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Atlantis</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">主页</a><a class="site-page" href="/categories/Android/">移动开发</a><a class="site-page" href="/categories/Python/">爬虫</a><a class="site-page" href="/categories/旧事/">旧事</a><a class="site-page" href="/categories/前端开发/">前端开发</a></span></div><div id="post-info"><div id="post-title">人生苦短，我用Python--一起来爬知乎娘</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2016-08-09</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Python/">Python</a><span class="post-meta__separator">|</span><i class="fa fa-comment-o post-meta__icon" aria-hidden="true"></i><a href="/2016/08/09/人生苦短，我用Python-一起来爬知乎娘/#disqus_thread"><span class="disqus-comment-count" data-disqus-identifier="2016/08/09/人生苦短，我用Python-一起来爬知乎娘/"></span></a><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">2,792</span><span class="post-meta__separator">|</span><span>阅读时长: 12 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div id="post-content"><p>上次爬了教务处的成绩，接下来想去爬一爬知乎娘，好像大家都很喜欢爬知乎娘，GitHub上貌似已经有人把获取各种知乎数据的操作封装好了：<a href="https://github.com/egrcc/zhihu-python" target="_blank" rel="external"><strong>zhihu-python</strong></a> ，但是良辰表示还是想自己试一试，我就爬点简单的，难度大的我也不会，我瞄准的是我自己关注的人的数据，差不多就这些东西：</p>
<blockquote>
<p>关注者 /  提问 /  回答 /  赞同</p>
</blockquote>
<p>那么下面开始分析，要拿到这个数据肯定是要先登陆的，那么先找到登陆界面：<br><a id="more"></a></p>
<p><img src="https://www.tuchuang001.com/images/2018/04/27/zhihu.png" alt="登陆界面"></p>
<p>这算是比较正常的界面，不知道为什么有的时候会出现新的验证码形式：</p>
<p><img src="https://www.tuchuang001.com/images/2018/04/27/f901919ea50f9a61.png" alt="输入倒立的文字"></p>
<p>这种形式登陆的话我看传递的表单数据是你鼠标点击的坐标，这种情况暂时不知道怎么办，留给高手，我们分析上面那种，知乎登陆分为手机号登陆或者邮箱登陆，先试试邮箱登陆，查看Post数据：</p>
<p><img src="https://www.tuchuang001.com/images/2018/04/27/9177639cd14f1f5e.png" alt="邮箱登陆"></p>
<p>然后是手机号登陆的:</p>
<p><img src="https://www.tuchuang001.com/images/2018/04/27/8d5d00b9d5f07eda.png" alt="手机号登陆"></p>
<p>现在理一下思路，我们要登录知乎要传递的数据如下：</p>
<ul>
<li>_xsrf() 用于防伪登陆</li>
<li>password</li>
<li>captcha 验证码</li>
<li>phone_num/email  不同登陆方式传递的东西不同</li>
</ul>
<p>phone_num/email以及passsword都需要自己输入，这个好办，我们需要解决如何获取 _xsrf和captcha 的问题，先解决 _xsrf，这个更简单一点，我们在知乎<a href="http://www.zhihu.com/#signin" target="_blank" rel="external"><strong>登陆页面</strong></a> 右键查看网页源代码，直接搜_xsrf：</p>
<figure class="highlight vbscript-html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;div class="view view-signin" data-za-module="SignInForm"&gt;</div><div class="line">&lt;form&gt;</div><div class="line">&lt;input type="hidden" name="_xsrf" value="cf1ee28f15cea5dba3243a1c31a1b284"/&gt;</div><div class="line">&lt;div class="group-inputs"&gt;</div></pre></td></tr></table></figure>
<p>我们要做的就是解析出这个元素，直接上代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">logn_url = <span class="string">'http://www.zhihu.com/#signin'</span></div><div class="line">session = requests.session()</div><div class="line">headers = &#123;</div><div class="line">    <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.82 Safari/537.36'</span>,</div><div class="line">&#125;</div><div class="line">content = session.get(logn_url, headers=headers).content</div><div class="line">soup = BeautifulSoup(content, <span class="string">'html.parser'</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">getxsrf</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">return</span> soup.find(<span class="string">'input'</span>, attrs=&#123;<span class="string">'name'</span>: <span class="string">"_xsrf"</span>&#125;)[<span class="string">'value'</span>]</div></pre></td></tr></table></figure>
<p>下面获取验证码， 我发现无论是使用哪一种登陆方式，Chrome的开发者面板都会有这么一行：</p>
<p><img src="https://www.tuchuang001.com/images/2018/04/27/7aed5998a5101cfe.png" alt="验证码请求"></p>
<p>当我把这个Request URL输入浏览器中就会转到这个验证码图片的界面，说明这个验证码是我们加载这个页面时候，浏览器向服务器发出请求然后下载下来的，那么现在我们有了URL地址：</p>
<p><img src="https://www.tuchuang001.com/images/2018/04/27/GET.png" alt="获取验证码"></p>
<p>这还是一个GET请求，这里注意这个传递的r参数是会不断变化的，这是一个当前Unix的时间戳，知道了这些可以着手获取验证码然后让用户自己输入：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">try</span>:</div><div class="line">    <span class="keyword">from</span> PIL <span class="keyword">import</span> Image</div><div class="line"><span class="keyword">except</span>:</div><div class="line">    <span class="keyword">pass</span></div><div class="line"><span class="comment"># 获取验证码</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_captcha</span><span class="params">()</span>:</span></div><div class="line">    t = str(int(time.time() * <span class="number">1000</span>))</div><div class="line">    captcha_url = <span class="string">'http://www.zhihu.com/captcha.gif?r='</span> + t + <span class="string">"&amp;type=login"</span></div><div class="line">    r = session.get(captcha_url, headers=headers)</div><div class="line">    <span class="keyword">with</span> open(<span class="string">'captcha.jpg'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</div><div class="line">        f.write(r.content)</div><div class="line">        f.close()</div><div class="line">    <span class="comment"># 用pillow 的 Image 显示验证码</span></div><div class="line">    <span class="comment"># 如果没有安装 pillow 到源代码所在的目录去找到验证码然后手动输入</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        im = Image.open(<span class="string">'captcha.jpg'</span>)</div><div class="line">        im.show()</div><div class="line">        im.close()</div><div class="line">    <span class="keyword">except</span>:</div><div class="line">        print(<span class="string">u'请到 %s 目录找到captcha.jpg 手动输入'</span> % os.path.abspath(<span class="string">'captcha.jpg'</span>))</div><div class="line">    captcha = input(<span class="string">"please input the captcha\n&gt;"</span>)</div><div class="line">    <span class="keyword">return</span> captcha</div></pre></td></tr></table></figure>
<p>这里获取验证码的代码来自GitHub上的<a href="https://github.com/xchaoinfo/fuck-login" target="_blank" rel="external"><strong>fuck-login</strong></a>项目，在此表示感谢，接下里就是写一个方法判断用户是使用了哪一种登陆方式，然后传递相应的数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">def login(secret, account):</div><div class="line">    # 通过输入的用户名判断是否是手机号</div><div class="line">    if re.match(r&quot;^1\d&#123;10&#125;$&quot;, account):</div><div class="line">        print(&quot;手机号登录 \n&quot;)</div><div class="line">        post_url = &apos;http://www.zhihu.com/login/phone_num&apos;</div><div class="line">        postdata = &#123;</div><div class="line">            &apos;_xsrf&apos;: getxsrf(),</div><div class="line">            &apos;password&apos;: secret,</div><div class="line">            &apos;remember_me&apos;: &apos;true&apos;,</div><div class="line">            &apos;phone_num&apos;: account,</div><div class="line">        &#125;</div><div class="line">    else:</div><div class="line">        print(&quot;邮箱登录 \n&quot;)</div><div class="line">        post_url = &apos;http://www.zhihu.com/login/email&apos;</div><div class="line">        postdata = &#123;</div><div class="line">            &apos;_xsrf&apos;: getxsrf(),</div><div class="line">            &apos;password&apos;: secret,</div><div class="line">            &apos;remember_me&apos;: &apos;true&apos;,</div><div class="line">            &apos;email&apos;: account,</div><div class="line">        &#125;</div><div class="line">    try:</div><div class="line">        # 不需要验证码直接登录成功</div><div class="line">        login_page = session.post(post_url, data=postdata, headers=headers)</div><div class="line">        login_code = login_page.text</div><div class="line">        print(login_page.status)</div><div class="line">        print(login_code)</div><div class="line">    except:</div><div class="line">        # 需要输入验证码后才能登录成功</div><div class="line">        postdata[&quot;captcha&quot;] = get_captcha()</div><div class="line">        login_page = session.post(post_url, data=postdata, headers=headers)</div><div class="line">        login_code = eval(login_page.text)</div><div class="line">        print(login_code[&apos;msg&apos;])</div><div class="line"></div><div class="line"># 这部分代码同样来自[**fuck-login**](https://github.com/xchaoinfo/fuck-login)项目,我偷了很多懒,囧</div></pre></td></tr></table></figure>
<p>这个时候判断是否登陆成功可以随便查看一个页面发送GET请求看是否返回200，这里就不多说，接下来才是关键，为了获取我关注的人的信息，先打开开发者面板，这个地方打钩：</p>
<p><img src="https://www.tuchuang001.com/images/2018/04/27/dce7be5950c5523b.png" alt="记得打钩"></p>
<p>因为网页有时候会跳转，这里打钩之后新跳转的页面的信息就不会覆盖之前接受到的信息，然后找到我关注的人，URL地址是：</p>
<blockquote>
<p><a href="https://www.zhihu.com/people/GitSmile/followees" target="_blank" rel="external">https://www.zhihu.com/people/GitSmile/followees</a></p>
</blockquote>
<p>最开始我走了弯路，我以为直接在这个页面解析出我关注的人的信息就行，所以一开始我是这么做的，查看网页源代码，这里随便找一个我关注的人的信息：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">title</span>=<span class="string">"死者代言人"</span></span></div><div class="line"><span class="attr">data-hovercard</span>=<span class="string">"p$t$forensic"</span></div><div class="line"><span class="attr">class</span>=<span class="string">"zm-item-link-avatar"</span></div><div class="line"><span class="attr">href</span>=<span class="string">"/people/forensic"</span>&gt;</div><div class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"https://pic1.zhimg.com/be39d110759e68f389b7d2934d7353bc_m.jpg"</span> <span class="attr">class</span>=<span class="string">"zm-item-img-avatar"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"zm-list-content-medium"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">"zm-list-content-title"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">data-hovercard</span>=<span class="string">"p$t$forensic"</span> <span class="attr">href</span>=<span class="string">"https://www.zhihu.com/people/forensic"</span> <span class="attr">class</span>=<span class="string">"zg-link author-link"</span> <span class="attr">title</span>=<span class="string">"死者代言人"</span></span></div><div class="line">&gt;死者代言人<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon icon-badge-best_answerer icon-badge"</span> <span class="attr">data-tooltip</span>=<span class="string">"s$b$优秀回答者"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"ellipsis"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"badge-summary"</span>&gt;</span>优秀回答者<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"bio"</span>&gt;</span>不养喵的爱喵法医。<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"details zg-gray"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">"_blank"</span> <span class="attr">href</span>=<span class="string">"/people/forensic/followers"</span> <span class="attr">class</span>=<span class="string">"zg-link-gray-normal"</span>&gt;</span>35968 关注者<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">/</div><div class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">"_blank"</span> <span class="attr">href</span>=<span class="string">"/people/forensic/asks"</span> <span class="attr">class</span>=<span class="string">"zg-link-gray-normal"</span>&gt;</span>2 提问<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">/</div><div class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">"_blank"</span> <span class="attr">href</span>=<span class="string">"/people/forensic/answers"</span> <span class="attr">class</span>=<span class="string">"zg-link-gray-normal"</span>&gt;</span>305 回答<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">/</div><div class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">"_blank"</span> <span class="attr">href</span>=<span class="string">"/people/forensic"</span> <span class="attr">class</span>=<span class="string">"zg-link-gray-normal"</span>&gt;</span>51278 赞同<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>然后在对比另一条：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">title</span>=<span class="string">"陈亦飘"</span></span></div><div class="line"><span class="attr">data-hovercard</span>=<span class="string">"p$t$chen-yi-piao"</span></div><div class="line"><span class="attr">class</span>=<span class="string">"zm-item-link-avatar"</span></div><div class="line"><span class="attr">href</span>=<span class="string">"/people/chen-yi-piao"</span>&gt;</div><div class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"https://pic2.zhimg.com/d495751efbf837b1b5b08571add7df3d_m.jpg"</span> <span class="attr">class</span>=<span class="string">"zm-item-img-avatar"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"zm-list-content-medium"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">"zm-list-content-title"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">data-hovercard</span>=<span class="string">"p$t$chen-yi-piao"</span> <span class="attr">href</span>=<span class="string">"https://www.zhihu.com/people/chen-yi-piao"</span> <span class="attr">class</span>=<span class="string">"zg-link author-link"</span> <span class="attr">title</span>=<span class="string">"陈亦飘"</span></span></div><div class="line">&gt;陈亦飘<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"ellipsis"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"bio"</span>&gt;</span>音乐和电影是我的爱与慈悲<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"details zg-gray"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">"_blank"</span> <span class="attr">href</span>=<span class="string">"/people/chen-yi-piao/followers"</span> <span class="attr">class</span>=<span class="string">"zg-link-gray-normal"</span>&gt;</span>74469 关注者<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">/</div><div class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">"_blank"</span> <span class="attr">href</span>=<span class="string">"/people/chen-yi-piao/asks"</span> <span class="attr">class</span>=<span class="string">"zg-link-gray-normal"</span>&gt;</span>0 提问<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">/</div><div class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">"_blank"</span> <span class="attr">href</span>=<span class="string">"/people/chen-yi-piao/answers"</span> <span class="attr">class</span>=<span class="string">"zg-link-gray-normal"</span>&gt;</span>80 回答<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">/</div><div class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">"_blank"</span> <span class="attr">href</span>=<span class="string">"/people/chen-yi-piao"</span> <span class="attr">class</span>=<span class="string">"zg-link-gray-normal"</span>&gt;</span>315971 赞同<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>要分解出这些元素，只要找出他们的共同点，当时机智如我一眼就发现每一个我关注的人的名字都有这么一行元素：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">class=&quot;zm-item-link-avatar&quot;</div></pre></td></tr></table></figure>
<p>而且都包含在一个<code>&lt;a&gt;&lt;/a&gt;</code>标签里面，这就好办了，使用<code>BeautifulSoup</code>先分解出每一个我关注的人的名字：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">def getdetial():</div><div class="line">    followees_url = &apos;https://www.zhihu.com/people/GitSmile/followees&apos;</div><div class="line">    followees_headers = &#123;</div><div class="line">        &apos;User-Agent&apos;: &apos;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.82 Safari/537.36&apos;,</div><div class="line">        &apos;Referer&apos;: &apos;https://www.zhihu.com/people/GitSmile/about&apos;,</div><div class="line">        &apos;Upgrade-Insecure-Requests&apos;: &apos;1&apos;,</div><div class="line">        &apos;Accept-Encoding&apos;: &apos;gzip, deflate, sdch, br&apos;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    myfollowees = session.get(followees_url, headers=followees_headers)</div><div class="line">    mysoup = BeautifulSoup(myfollowees.content, &apos;html.parser&apos;)</div><div class="line">    print(mysoup.find(&apos;span&apos;, attrs=&#123;&apos;class&apos;: &apos;zm-profile-section-name&apos;&#125;).text)</div></pre></td></tr></table></figure>
<p>然后继续观察，突破点依然在这个<code>&lt;a&gt;&lt;/a&gt;</code>标签，拿”陈亦飘”的信息做个例子，看官们看这里面是不是有个<code>href=&quot;/people/chen-yi-piao</code>，然后看一下她的相关信息：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">"_blank"</span> <span class="attr">href</span>=<span class="string">"/people/chen-yi-piao/followers"</span> <span class="attr">class</span>=<span class="string">"zg-link-gray-normal"</span>&gt;</span>74469 关注者<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">/</div><div class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">"_blank"</span> <span class="attr">href</span>=<span class="string">"/people/chen-yi-piao/asks"</span> <span class="attr">class</span>=<span class="string">"zg-link-gray-normal"</span>&gt;</span>0 提问<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">/</div><div class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">"_blank"</span> <span class="attr">href</span>=<span class="string">"/people/chen-yi-piao/answers"</span> <span class="attr">class</span>=<span class="string">"zg-link-gray-normal"</span>&gt;</span>80 回答<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">/</div><div class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">"_blank"</span> <span class="attr">href</span>=<span class="string">"/people/chen-yi-piao"</span> <span class="attr">class</span>=<span class="string">"zg-link-gray-normal"</span>&gt;</span>315971 赞同<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div></pre></td></tr></table></figure>
<p>发现没有，每一个信息里面的href元素都是我们最开始看到的<code>/people/chen-yi-piao</code>元素加上一些字符串组成的，那么我就可以在这上面做点文章：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">获取详细信息</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">getdetial</span><span class="params">()</span>:</span></div><div class="line">    followees_url = <span class="string">'https://www.zhihu.com/people/GitSmile/followees'</span></div><div class="line">    followees_headers = &#123;</div><div class="line">        <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.82 Safari/537.36'</span>,</div><div class="line">        <span class="string">'Referer'</span>: <span class="string">'https://www.zhihu.com/people/GitSmile/about'</span>,</div><div class="line">        <span class="string">'Upgrade-Insecure-Requests'</span>: <span class="string">'1'</span>,</div><div class="line">        <span class="string">'Accept-Encoding'</span>: <span class="string">'gzip, deflate, sdch, br'</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    myfollowees = session.get(followees_url, headers=followees_headers)</div><div class="line">    mysoup = BeautifulSoup(myfollowees.content, <span class="string">'html.parser'</span>)</div><div class="line">    print(mysoup.find(<span class="string">'span'</span>, attrs=&#123;<span class="string">'class'</span>: <span class="string">'zm-profile-section-name'</span>&#125;).text)</div><div class="line">    <span class="keyword">for</span> result <span class="keyword">in</span> mysoup.findAll(<span class="string">'a'</span>, attrs=&#123;<span class="string">'class'</span>: <span class="string">'zm-item-link-avatar'</span>&#125;):</div><div class="line">        print(result.get(<span class="string">'title'</span>))</div><div class="line">        <span class="comment"># 解析出href元素信息</span></div><div class="line">        href = str(result.get(<span class="string">'href'</span>))</div><div class="line">        <span class="comment"># 关注者</span></div><div class="line">        print(mysoup.find(<span class="string">'a'</span>, attrs=&#123;<span class="string">'href'</span>: href + <span class="string">'/followers'</span>&#125;).text)</div><div class="line">        <span class="comment"># 提问</span></div><div class="line">        print(mysoup.find(<span class="string">'a'</span>, attrs=&#123;<span class="string">'href'</span>: href + <span class="string">'/asks'</span>&#125;).text)</div><div class="line">        <span class="comment"># 回答</span></div><div class="line">        print(mysoup.find(<span class="string">'a'</span>, attrs=&#123;<span class="string">'href'</span>: href + <span class="string">'/answers'</span>&#125;).text)</div><div class="line">        <span class="comment"># 赞同</span></div><div class="line">        print(mysoup.find(<span class="string">'a'</span>, attrs=&#123;<span class="string">'href'</span>: href, <span class="string">'class'</span>: <span class="string">'zg-link-gray-normal'</span>&#125;).text + <span class="string">'\n'</span>)</div></pre></td></tr></table></figure>
<p>上面的代码应该很简单了，看一看就能看懂，然后就我信心满满地在PyCharm上输出的时候，发现来来回回只输出20条信息，也就是说，我关注了26人，但是控制台只输出了20个人的信息，然后我就上网查，发现不止一个人有我这样的疑问，当然也多亏了前人踩坑，网上给出来的答案是知乎获取关注的人的时候使用了AJAX技术，也就是动态加载，但是这一部分代码不会再网页Html代码中显示出来，所以为了获取其他关注的人的信息我这里要另辟蹊径。</p>
<p>然后我翻看我关注的人的信息的时候，在开发者面板抓到这么一条POST信息：</p>
<p><img src="https://www.tuchuang001.com/images/2018/04/27/efba534dce691fe8.png" alt="抓取到的Post信息"></p>
<p>这条POST之后下面刷出来的图片是我关注的人的头像并且这些头像在我之前看到的20条数据里面是没有的，加上我总共就关注了27个人，所以我有理由相信这个Post就是浏览器向服务器发送请求的Post，看一下Post的信息：</p>
<p><img src="https://www.tuchuang001.com/images/2018/04/27/ajax.png" alt="查看Post信息"></p>
<p>一个偏移量(offset)，一个哈希值(hash_id)外加一个”order_by”:”created”的键值对，这里偏移量很好理解，这个”hash_id”据我多次登陆发现是一个不变的值，或者说每一台电脑或许精确一点每一个浏览器都会有这么一个给定的值，照抄，那么改进后的代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"># 获取所有关注的人的信息</div><div class="line">def getallview():</div><div class="line">    nums = 27  # 这个是我关注的人数</div><div class="line">    followees_headers = &#123;</div><div class="line">        &apos;User-Agent&apos;: &apos;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.82 Safari/537.36&apos;,</div><div class="line">        &apos;Referer&apos;: &apos;https://www.zhihu.com/people/GitSmile/followees&apos;,</div><div class="line">        &apos;Origin&apos;: &apos;https://www.zhihu.com&apos;,</div><div class="line">        &apos;Accept-Encoding&apos;: &apos;gzip, deflate, br&apos;,</div><div class="line">        &apos;CG - Sid&apos;: &apos;57226ad5 - 793b - 4a9d - 9791 - 2a9a17e682ef&apos;,</div><div class="line">        &apos;Accept&apos;: &apos;* / *&apos;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    # 序号</div><div class="line">    count = 0</div><div class="line">    for index in range(0, nums):</div><div class="line">        fo_url = &apos;https://www.zhihu.com/node/ProfileFolloweesListV2&apos;</div><div class="line">        m_data = &#123;</div><div class="line">            &apos;method&apos;: &apos;next&apos;,</div><div class="line">            &apos;params&apos;: &apos;&#123;&quot;offset&quot;:&apos; + str(</div><div class="line">                index) + &apos;,&quot;order_by&quot;:&quot;created&quot;,&quot;hash_id&quot;:&quot;de2cb64bc1afe59cf8a6e456ee5eaebc&quot;&#125;&apos;,</div><div class="line">            &apos;_xsrf&apos;: str(getxsrf())</div><div class="line">        &#125;</div><div class="line">        result = session.post(fo_url, data=m_data, headers=followees_headers)</div><div class="line">        dic = json.loads(result.content.decode(&apos;utf-8&apos;))</div><div class="line">        li = dic[&apos;msg&apos;][0]</div><div class="line">        mysoup = BeautifulSoup(li, &apos;html.parser&apos;)</div><div class="line">        for result in mysoup.findAll(&apos;a&apos;, attrs=&#123;&apos;class&apos;: &apos;zm-item-link-avatar&apos;&#125;):</div><div class="line">            print(index + 1)</div><div class="line">            print(result.get(&apos;title&apos;))</div><div class="line">            href = str(result.get(&apos;href&apos;))</div><div class="line">            print(mysoup.find(&apos;a&apos;, attrs=&#123;&apos;href&apos;: href + &apos;/followers&apos;&#125;).text)</div><div class="line">            print(mysoup.find(&apos;a&apos;, attrs=&#123;&apos;href&apos;: href + &apos;/asks&apos;&#125;).text)</div><div class="line">            print(mysoup.find(&apos;a&apos;, attrs=&#123;&apos;href&apos;: href + &apos;/answers&apos;&#125;).text)</div><div class="line">            print(mysoup.find(&apos;a&apos;, attrs=&#123;&apos;href&apos;: href, &apos;class&apos;: &apos;zg-link-gray-normal&apos;&#125;).text + &apos;\n&apos;)</div><div class="line">            count += 1</div><div class="line">    print(&apos;一共关注了 %d人&apos; % count)</div></pre></td></tr></table></figure>
<p>放上程序的入口：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">if __name__ == &apos;__main__&apos;:</div><div class="line"></div><div class="line">    if isLogin():</div><div class="line">        print(&apos;您已经登录&apos;)</div><div class="line">    else:</div><div class="line">        account = input(&apos;请输入你的用户名\n&gt;  &apos;)</div><div class="line">        secret = input(&quot;请输入你的密码\n&gt;  &quot;)</div><div class="line">        login(secret, account)</div><div class="line">    getallview()</div></pre></td></tr></table></figure>
<p>看一下实际效果：</p>
<p><img src="https://www.tuchuang001.com/images/2018/04/27/9f021a71a9c4d305.gif" alt="结果"></p>
<p><strong>写在结尾</strong></p>
<p>虽然简单，但是提供了一些初学者的思路，下一次准备爬一些知乎上的图片，好像很多人都热衷于这种事，嘻嘻，荆轲刺秦王。</p>
<p><a href="https://github.com/GiitSmile/loginzhihu.py/blob/master/loginzhihu.py" target="_blank" rel="external">源码</a></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:lin794653318@gmail.com">李牧羊</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https:///www.limuyang.cc/2016/08/09/人生苦短，我用Python-一起来爬知乎娘/">https:///www.limuyang.cc/2016/08/09/人生苦短，我用Python-一起来爬知乎娘/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https:///www.limuyang.cc" target="_blank">Atlantis</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/知乎/">知乎</a><a class="post-meta__tags" href="/tags/爬虫/">爬虫</a><a class="post-meta__tags" href="/tags/网络/">网络</a></div><div class="post-qr-code"><div class="post-qr-code-item"><img class="post-qr-code__img"><div class="post-qr-code__desc"></div></div></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2016/08/11/人生苦短，我用Python-分分钟下载知乎美图给你看/"><i class="fa fa-chevron-left">  </i><span>人生苦短，我用Python--分分钟下载知乎美图给你看</span></a></div><div class="next-post pull-right"><a href="/2016/08/04/人生苦短，我用Python-爬虫模拟登陆教务处并且保存数据到本地/"><span>人生苦短，我用Python--爬虫模拟登陆教务处并且保存数据到本地</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'https:///www.limuyang.cc/2016/08/09/人生苦短，我用Python-一起来爬知乎娘/';
  this.page.identifier = '2016/08/09/人生苦短，我用Python-一起来爬知乎娘/';
  this.page.title = '人生苦短，我用Python--一起来爬知乎娘';
}
var d = document, s = d.createElement('script');
s.src = "https://" + 'Limuyang' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script><script id="dsq-count-src" src="https://Limuyang.disqus.com/count.js" async></script></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2018 By 李牧羊</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.5.3"></script><script src="/js/fancybox.js?version=1.5.3"></script><script src="/js/sidebar.js?version=1.5.3"></script><script src="/js/copy.js?version=1.5.3"></script><script src="/js/fireworks.js?version=1.5.3"></script><script src="/js/transition.js?version=1.5.3"></script><script src="/js/scroll.js?version=1.5.3"></script><script src="/js/head.js?version=1.5.3"></script></body></html>