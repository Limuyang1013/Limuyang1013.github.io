<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="人生苦短，我用Python--爬虫模拟登陆教务处并且保存数据到本地"><meta name="keywords" content="Python,爬虫,模拟登陆,保存数据"><meta name="author" content="李牧羊,lin794653318@gmail.com"><meta name="copyright" content="李牧羊"><title>人生苦短，我用Python--爬虫模拟登陆教务处并且保存数据到本地 | 李牧羊</title><link rel="shortcut icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css?version=1.5.3"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  localSearch: undefined
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="http://oasusatoz.bkt.clouddn.com/3-15052H1035cF.jpg"></div><div class="author-info__name text-center">李牧羊</div><div class="author-info__description text-center">碌碌无为，打马而过</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">22</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">39</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">4</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" href="http://litten.me/" target="_blank">litten</a><a class="author-info-links__name text-center" href="https://developer.android.com/index.html" target="_blank">Android Developer</a><a class="author-info-links__name text-center" href="http://blog.csdn.net/wei_smile" target="_blank">CSDN</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://ws1.sinaimg.cn/large/8700af19ly1fnp7q2phkzj21hc0xc0yl)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">李牧羊</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">主页</a><a class="site-page" href="/categories/Android/">移动开发</a><a class="site-page" href="/categories/Python/">爬虫</a><a class="site-page" href="/categories/旧事/">旧事</a><a class="site-page" href="/categories/前端开发/">前端开发</a></span></div><div id="post-info"><div id="post-title">人生苦短，我用Python--爬虫模拟登陆教务处并且保存数据到本地</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2016-08-04</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Python/">Python</a><span class="post-meta__separator">|</span><i class="fa fa-comment-o post-meta__icon" aria-hidden="true"></i><a href="/2016/08/04/人生苦短，我用Python-爬虫模拟登陆教务处并且保存数据到本地/#disqus_thread"><span class="disqus-comment-count" data-disqus-identifier="2016/08/04/人生苦短，我用Python-爬虫模拟登陆教务处并且保存数据到本地/"></span></a></div></div></div><div class="layout" id="content-inner"><article id="post"><div id="post-content"><p>刚开始接触Python，看很多人玩爬虫我也想玩，找来找去发现很多人用网络爬虫干的第一件事就是模拟登陆，增加点难度就是模拟登陆后在获取数据，但是网上好少有Python 3.x的模拟登陆Demo可以参考，加上自己也不怎么懂HTML，所以这第一个Python爬虫写的异常艰难，不过最终结果还是尽如人意的，下面把这次学习的过程整理一下。<br><a id="more"></a><br><strong>工具</strong></p>
<ul>
<li>系统：win7  64位系统</li>
<li>浏览器：Chrome</li>
<li>Python版本：Python 3.5 64-bit</li>
<li>IDE：JetBrains PyCharm (貌似很多人都用这个)</li>
</ul>
<p>我把目标瞄准了我们的教务处，这次爬虫的目的是从教务处获取成绩并且把成绩输入Excel表格中保存起来，</p>
<p>我们学校教务处的地址是：<a href="http://jwc.ecjtu.jx.cn/" target="_blank" rel="external">http://jwc.ecjtu.jx.cn/</a> ，往常每次我们获取成绩都需要先进入教务处，然后点击成绩查询，输入公共的账号密码进入，最后输入相关信息获取成绩表格，这里登陆不需要验证码省了我一番功夫，这样我们先进入成绩查询系统登陆界面，先看看怎么模拟登陆这个过程，在Chrome浏览器下按F12打开开发者面板：</p>
<p><img src="http://oasusatoz.bkt.clouddn.com/%E7%99%BB%E9%99%86%E7%95%8C%E9%9D%A2%E6%89%93%E5%BC%80%E5%BC%80%E5%8F%91%E8%80%85%E9%9D%A2%E6%9D%BF.png" alt="开发者面板"></p>
<p>这里我们学校的教务处查询系统的密码是公共的jwc也就是拼音缩写，我们输入用户名和密码点击登陆，这时候注意POST请求：</p>
<p><img src="http://oasusatoz.bkt.clouddn.com/%E7%99%BB%E9%99%86%E6%8A%93%E5%8F%96%E5%8A%A8%E7%94%BB.gif" alt="注意post请求"></p>
<p>发现了什么，好像Chrome并没有把Post提交的表单信息保留下来直接跳转到了另一个界面然后展示另一个界面的数据，这里就需要我们自己动手操作一下，注意开发者面板左上角的小红点表示这时候正在抓取数据，如果点击一下就会变成灰色，就可以变相地保存下当时抓取到的包，我在点击登陆后新界面未刷新出来之前点击了这个小红点，如愿以偿的得到了Post的表单数据：</p>
<p><img src="http://oasusatoz.bkt.clouddn.com/%E6%8A%93%E5%8F%96%E7%99%BB%E9%99%86%E8%A1%A8%E5%8D%95.gif" alt="得到post表单数据"></p>
<p>这样就获取了浏览器在登陆时候向服务器传递的表单数据，看一下这个表单都有些什么：</p>
<p><img src="http://oasusatoz.bkt.clouddn.com/%E7%99%BB%E9%99%86%E8%A1%A8%E5%8D%95.png" alt="查看表单数据"></p>
<p>这里看到我们需要传递三个参数，分别是：user、pass、Submit，可以很容易的理解这几个单词的字面意思，这样有了思路，我们就可以写出这次代码的第一步：<strong>模拟登陆教务处</strong></p>
<p>直接上代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python3</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"><span class="keyword">import</span> requests</div><div class="line">url = <span class="string">'http://jwc.ecjtu.jx.cn/mis_o/login.php'</span></div><div class="line">datas = &#123;<span class="string">'user'</span>: <span class="string">'jwc'</span>,</div><div class="line">         <span class="string">'pass'</span>: <span class="string">'jwc'</span>,</div><div class="line">         <span class="string">'Submit'</span>: <span class="string">'%CC%E1%BD%BB'</span></div><div class="line">         &#125;</div><div class="line">headers = &#123;<span class="string">'Referer'</span>: <span class="string">'http://jwc.ecjtu.jx.cn/mis_o/login.htm'</span>,</div><div class="line">           <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 '</span></div><div class="line">                         <span class="string">'(KHTML, like Gecko) Chrome/52.0.2743.82 Safari/537.36'</span>,</div><div class="line">           <span class="string">'Accept'</span>: <span class="string">'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8'</span>,</div><div class="line">           <span class="string">'Accept-Language'</span>: <span class="string">'zh-CN,zh;q=0.8'</span>,</div><div class="line">           &#125;</div><div class="line">sessions = requests.session()</div><div class="line">response = sessions.post(url, headers=headers, data=datas)</div><div class="line">print(response.status_code)</div></pre></td></tr></table></figure>
<p>代码输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">200</div></pre></td></tr></table></figure>
<p>说明我们模拟登陆成功了，这里用到了Requests模块，还不会使用的可以查看<a href="http://docs.python-requests.org/zh_CN/latest/user/quickstart.html#cookie" target="_blank" rel="external">中文文档</a> ，它给自己的定义是：HTTP for Humans，因为简单易用易上手，我们只需要传入Url地址，构造请求头，传入post方法需要的数据，就可以模拟浏览器登陆了，这里因为有进一步获取成绩的操作所以使用了session来保持连接，这里单看最后的返回码的话我们是成功了的，具体如何还要看下一步操作，接下来：</p>
<p><img src="http://oasusatoz.bkt.clouddn.com/search.png" alt="抓包"></p>
<p>这里为了简便代码我们设定输入学号查询所有成绩，减少其他判断，同样对Post数据进行抓包：</p>
<p><img src="http://oasusatoz.bkt.clouddn.com/%E6%88%90%E7%BB%A9%E6%9F%A5%E8%AF%A2.png" alt="对post数据抓包"></p>
<p>同样查看Post的数据：</p>
<p><img src="http://oasusatoz.bkt.clouddn.com/querrypos.png" alt="查看post数据"></p>
<p>因为这里就分析输入学号的情况所以其他都为空，这样我们就可以写出查询成绩的代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">score_healders = &#123;<span class="string">'Connection'</span>: <span class="string">'keep-alive'</span>,</div><div class="line">                  <span class="string">'User - Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 6.1; WOW64) '</span></div><div class="line">                                  <span class="string">'AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.82 Safari/537.36'</span>,</div><div class="line">                  <span class="string">'Content - Type'</span>: <span class="string">'application / x - www - form - urlencoded'</span>,</div><div class="line">                  <span class="string">'Accept'</span>: <span class="string">'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8'</span>,</div><div class="line">                  <span class="string">'Content - Length'</span>: <span class="string">'69'</span>,</div><div class="line">                  <span class="string">'Host'</span>: <span class="string">'jwc.ecjtu.jx.cn'</span>,</div><div class="line">                  <span class="string">'Referer'</span>: <span class="string">'http: // jwc.ecjtu.jx.cn / mis_o / main.php'</span>,</div><div class="line">                  <span class="string">'Upgrade - Insecure - Requests'</span>: <span class="string">'1'</span>,</div><div class="line">                  <span class="string">'Accept - Language'</span>: <span class="string">'zh - CN, zh;q = 0.8'</span></div><div class="line">                  &#125;</div><div class="line">score_url = <span class="string">'http://jwc.ecjtu.jx.cn/mis_o/query.php?start='</span> + str(</div><div class="line">    pagenum) + <span class="string">'&amp;job=see&amp;=&amp;Name=&amp;Course=&amp;ClassID=&amp;Term=&amp;StuID='</span> + num</div><div class="line">score_data = &#123;<span class="string">'Name'</span>: <span class="string">''</span>,</div><div class="line">              <span class="string">'StuID'</span>: num,</div><div class="line">              <span class="string">'Course'</span>: <span class="string">''</span>,</div><div class="line">              <span class="string">'Term'</span>: <span class="string">''</span>,</div><div class="line">              <span class="string">'ClassID'</span>: <span class="string">''</span>,</div><div class="line">              <span class="string">'Submit'</span>: <span class="string">'%B2%E9%D1%AF'</span></div><div class="line">              &#125;</div><div class="line"></div><div class="line">score_response = sessions.post(score_url, data=score_data, headers=score_healders)</div><div class="line">content = score_response.content</div></pre></td></tr></table></figure>
<p>这里解释一下上面的代码，上面的<code>score_url</code> 并不是浏览器上显示的地址，我们要获取真正的地址，在Chrome下右键–查看网页源代码，找到这么一行：</p>
<figure class="highlight vbscript-html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="xml">a href=query.php?start=1&amp;job=see&amp;=&amp;Name=&amp;Course=&amp;ClassID=&amp;Term=&amp;StuID=xxxxxxx</span></div></pre></td></tr></table></figure>
<p>这个才是真正的地址，点击这个地址转入的才是真正的界面，因为这里成绩数据较多，所以这里采用了分页显示，这个<code>start=1</code>说明是第一页，这个参数是可变的需要我们传入，还有<code>StuID</code>后面的是我们输入的学号，这样我们就可以拼接出Url地址：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">score_url = &apos;http://jwc.ecjtu.jx.cn/mis_o/query.php?start=&apos; + str(pagenum) + &apos;&amp;job=see&amp;=&amp;Name=&amp;Course=&amp;ClassID=&amp;Term=&amp;StuID=&apos; + num</div></pre></td></tr></table></figure>
<p>同样使用Post方法传递数据并获取响应的内容：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">score_response = sessions.post(score_url, data=score_data,headers=score_healders)</div><div class="line">content = score_response.content</div></pre></td></tr></table></figure>
<p>这里采用<a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/index.zh.html" target="_blank" rel="external">Beautiful Soup 4.2.0</a>来解析返回的响应内容，因为我们要获取的是成绩，这里到教务处成绩查询界面，查看获取到的成绩在网页中是以表格的形式存在：</p>
<p><img src="http://oasusatoz.bkt.clouddn.com/qr.png" alt="网页源代码"><br>观察表格的网页源代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">align</span>=<span class="string">center</span> <span class="attr">border</span>=<span class="string">1</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">009999</span>&gt;</span>学期<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">009999</span>&gt;</span>学号<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">009999</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">009999</span>&gt;</span>课程<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">009999</span>&gt;</span>课程要求<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">009999</span>&gt;</span>学分<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">009999</span>&gt;</span>成绩<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">009999</span>&gt;</span>重考一<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">009999</span>&gt;</span>重考二<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">...</div><div class="line">...</div><div class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></div></pre></td></tr></table></figure>
<p>这里拿出第一行举例，虽然我不太懂Html但是从这里可以看出来<code>&lt;tr&gt;</code> 代表的是一行，而<code>&lt;td&gt;</code>应该是代表这一行中的每一列，这样就好办了，取出每一行然后分解出每一列，打印输出就可以得到我们要的结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</div><div class="line">soup = BeautifulSoup(content, <span class="string">'html.parser'</span>)</div><div class="line"><span class="comment"># 找到每一行</span></div><div class="line">target = soup.findAll(<span class="string">'tr'</span>)</div></pre></td></tr></table></figure>
<p>这里分解每一列的时候要小心，因为这里表格分成了三页显示，每页最多显示30条数据，这里因为只是收集已经毕业的学生的成绩数据所以不对其他数据量不足的学生成绩的情况做统计，默认收集的都是大四毕业的学生成绩数据。这里采用两个变量<code>i</code>和<code>j</code>分别代表行和列：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 注:这里的print单纯是我为了验证结果打印在PyCharm的控制台上而已</span></div><div class="line">i=<span class="number">0</span>, j=<span class="number">0</span></div><div class="line"><span class="keyword">for</span> tag <span class="keyword">in</span> target[<span class="number">1</span>:]:</div><div class="line">            tds = tag.findAll(<span class="string">'td'</span>)</div><div class="line">            <span class="comment"># 每一次都是从列头开始获取</span></div><div class="line">            j = <span class="number">0</span></div><div class="line">            <span class="comment"># 学期</span></div><div class="line">            semester = str(tds[<span class="number">0</span>].string)</div><div class="line">            <span class="keyword">if</span> semester == <span class="string">'None'</span>:</div><div class="line">                <span class="keyword">break</span></div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                print(semester.ljust(<span class="number">6</span>) + <span class="string">'\t\t\t'</span>, end=<span class="string">''</span>)</div><div class="line">            <span class="comment"># 学号</span></div><div class="line">            studentid = tds[<span class="number">1</span>].string</div><div class="line">            print(studentid.ljust(<span class="number">14</span>) + <span class="string">'\t\t\t'</span>, end=<span class="string">''</span>)</div><div class="line">            j += <span class="number">1</span></div><div class="line">            <span class="comment"># 姓名</span></div><div class="line">            name = tds[<span class="number">2</span>].string</div><div class="line">            print(name.ljust(<span class="number">3</span>) + <span class="string">'\t\t\t'</span>, end=<span class="string">''</span>)</div><div class="line">            j += <span class="number">1</span></div><div class="line">            <span class="comment"># 课程</span></div><div class="line">            course = tds[<span class="number">3</span>].string</div><div class="line">            print(course.ljust(<span class="number">20</span>, <span class="string">' '</span>) + <span class="string">'\t\t\t'</span>, end=<span class="string">''</span>)</div><div class="line">            j += <span class="number">1</span></div><div class="line">            <span class="comment"># 课程要求</span></div><div class="line">            requirments = tds[<span class="number">4</span>].string</div><div class="line">            print(requirments.ljust(<span class="number">10</span>, <span class="string">' '</span>) + <span class="string">'\t\t'</span>, end=<span class="string">''</span>)</div><div class="line">            j += <span class="number">1</span></div><div class="line">            <span class="comment"># 学分</span></div><div class="line">            scredit = tds[<span class="number">5</span>].string</div><div class="line">            print(scredit.ljust(<span class="number">2</span>, <span class="string">' '</span>) + <span class="string">'\t\t'</span>, end=<span class="string">''</span>)</div><div class="line">            j += <span class="number">1</span></div><div class="line">            <span class="comment"># 成绩</span></div><div class="line">            achievement = tds[<span class="number">6</span>].string</div><div class="line">            print(achievement.ljust(<span class="number">2</span>) + <span class="string">'\t\t'</span>, end=<span class="string">''</span>)</div><div class="line">            j += <span class="number">1</span></div><div class="line">            <span class="comment"># 重考一</span></div><div class="line">            reexaminef = tds[<span class="number">7</span>].string</div><div class="line">            print(reexaminef.ljust(<span class="number">2</span>) + <span class="string">'\t\t'</span>, end=<span class="string">''</span>)</div><div class="line">            j += <span class="number">1</span></div><div class="line">            <span class="comment"># 重考二</span></div><div class="line">            reexamines = tds[<span class="number">8</span>].string</div><div class="line">            print(reexamines.ljust(<span class="number">2</span>) + <span class="string">'\t\t'</span>)</div><div class="line">            j += <span class="number">1</span></div><div class="line">            i += <span class="number">1</span></div></pre></td></tr></table></figure>
<p>这里查了很多别人的博客都是用正则表达式来分解数据，表示自己的正则写的并不好也尝试了但是没成功，所以无奈选择这种方式，如果有人有测试成功的正则欢迎跟我说一声，我也学习学习。</p>
<p><strong>把数据保存到Excel</strong></p>
<p>因为已经清楚了这个网页保存成绩的具体结构，所以顺着每次循环解析将数据不断加以保存就是了，这里使用<code>xlwt</code>写入数据到Excel，因为<code>xlwt</code>模块打印输出到Excel中的样式宽度偏小，影响观看，所以这里还加入了一个方法去控制打印到Excel表格中的样式:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">file = xlwt.Workbook(encoding=<span class="string">'utf-8'</span>)</div><div class="line">table = file.add_sheet(<span class="string">'achieve'</span>)</div><div class="line"><span class="comment"># 设置Excel样式</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">set_style</span><span class="params">(name, height, bold=False)</span>:</span></div><div class="line">    style = xlwt.XFStyle()  <span class="comment"># 初始化样式</span></div><div class="line">    font = xlwt.Font()  <span class="comment"># 为样式创建字体</span></div><div class="line">    font.name = name  <span class="comment"># 'Times New Roman'</span></div><div class="line">    font.bold = bold</div><div class="line">    font.color_index = <span class="number">4</span></div><div class="line">    font.height = height</div><div class="line">    style.font = font</div><div class="line">    <span class="keyword">return</span> style</div></pre></td></tr></table></figure>
<p>运用到代码中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">for tag in target[1:]:</div><div class="line">            tds = tag.findAll(&apos;td&apos;)</div><div class="line">            j = 0</div><div class="line">            # 学期</div><div class="line">            semester = str(tds[0].string)</div><div class="line">            if semester == &apos;None&apos;:</div><div class="line">                break</div><div class="line">            else:</div><div class="line">                print(semester.ljust(6) + &apos;\t\t\t&apos;, end=&apos;&apos;)</div><div class="line">                table.write(i, j, semester, set_style(&apos;Arial&apos;, 220))</div><div class="line">            # 学号</div><div class="line">            studentid = tds[1].string</div><div class="line">            print(studentid.ljust(14) + &apos;\t\t\t&apos;, end=&apos;&apos;)</div><div class="line">            j += 1</div><div class="line">            table.write(i, j, studentid, set_style(&apos;Arial&apos;, 220))</div><div class="line">            table.col(i).width = 256 * 16</div><div class="line">            # 姓名</div><div class="line">            name = tds[2].string</div><div class="line">            print(name.ljust(3) + &apos;\t\t\t&apos;, end=&apos;&apos;)</div><div class="line">            j += 1</div><div class="line">            table.write(i, j, name, set_style(&apos;Arial&apos;, 220))</div><div class="line">            # 课程</div><div class="line">            course = tds[3].string</div><div class="line">            print(course.ljust(20, &apos; &apos;) + &apos;\t\t\t&apos;, end=&apos;&apos;)</div><div class="line">            j += 1</div><div class="line">            table.write(i, j, course, set_style(&apos;Arial&apos;, 220))</div><div class="line">            # 课程要求</div><div class="line">            requirments = tds[4].string</div><div class="line">            print(requirments.ljust(10, &apos; &apos;) + &apos;\t\t&apos;, end=&apos;&apos;)</div><div class="line">            j += 1</div><div class="line">            table.write(i, j, requirments, set_style(&apos;Arial&apos;, 220))</div><div class="line">            # 学分</div><div class="line">            scredit = tds[5].string</div><div class="line">            print(scredit.ljust(2, &apos; &apos;) + &apos;\t\t&apos;, end=&apos;&apos;)</div><div class="line">            j += 1</div><div class="line">            table.write(i, j, scredit, set_style(&apos;Arial&apos;, 220))</div><div class="line">            # 成绩</div><div class="line">            achievement = tds[6].string</div><div class="line">            print(achievement.ljust(2) + &apos;\t\t&apos;, end=&apos;&apos;)</div><div class="line">            j += 1</div><div class="line">            table.write(i, j, achievement, set_style(&apos;Arial&apos;, 220))</div><div class="line">            # 重考一</div><div class="line">            reexaminef = tds[7].string</div><div class="line">            print(reexaminef.ljust(2) + &apos;\t\t&apos;, end=&apos;&apos;)</div><div class="line">            j += 1</div><div class="line">            table.write(i, j, reexaminef, set_style(&apos;Arial&apos;, 220))</div><div class="line">            # 重考二</div><div class="line">            reexamines = tds[8].string</div><div class="line">            print(reexamines.ljust(2) + &apos;\t\t&apos;)</div><div class="line">            j += 1</div><div class="line">            table.write(i, j, reexamines, set_style(&apos;Arial&apos;, 220))</div><div class="line">            i += 1</div><div class="line"></div><div class="line">file.save(&apos;demo.xls&apos;)</div></pre></td></tr></table></figure>
<p>最后稍加整合，写成一个方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div></pre></td><td class="code"><pre><div class="line"># 获取成绩</div><div class="line"># 这里num代表输入的学号，pagenum代表页数，总共76条数据，一页30条所以总共有三页</div><div class="line">def getScore(num, pagenum, i, j):</div><div class="line">    score_healders = &#123;&apos;Connection&apos;: &apos;keep-alive&apos;,</div><div class="line">                      &apos;User - Agent&apos;: &apos;Mozilla/5.0 (Windows NT 6.1; WOW64) &apos;</div><div class="line">                                      &apos;AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.82 Safari/537.36&apos;,</div><div class="line">                      &apos;Content - Type&apos;: &apos;application / x - www - form - urlencoded&apos;,</div><div class="line">                      &apos;Accept&apos;: &apos;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&apos;,</div><div class="line">                      &apos;Content - Length&apos;: &apos;69&apos;,</div><div class="line">                      &apos;Host&apos;: &apos;jwc.ecjtu.jx.cn&apos;,</div><div class="line">                      &apos;Referer&apos;: &apos;http: // jwc.ecjtu.jx.cn / mis_o / main.php&apos;,</div><div class="line">                      &apos;Upgrade - Insecure - Requests&apos;: &apos;1&apos;,</div><div class="line">                      &apos;Accept - Language&apos;: &apos;zh - CN, zh;q = 0.8&apos;</div><div class="line">                      &#125;</div><div class="line">    score_url = &apos;http://jwc.ecjtu.jx.cn/mis_o/query.php?start=&apos; + str(</div><div class="line">        pagenum) + &apos;&amp;job=see&amp;=&amp;Name=&amp;Course=&amp;ClassID=&amp;Term=&amp;StuID=&apos; + num</div><div class="line">    score_data = &#123;&apos;Name&apos;: &apos;&apos;,</div><div class="line">                  &apos;StuID&apos;: num,</div><div class="line">                  &apos;Course&apos;: &apos;&apos;,</div><div class="line">                  &apos;Term&apos;: &apos;&apos;,</div><div class="line">                  &apos;ClassID&apos;: &apos;&apos;,</div><div class="line">                  &apos;Submit&apos;: &apos;%B2%E9%D1%AF&apos;</div><div class="line">                  &#125;</div><div class="line"></div><div class="line">    score_response = sessions.post(score_url, data=score_data, headers=score_healders)</div><div class="line">    # 输出到文本</div><div class="line">    with open(&apos;text.txt&apos;, &apos;wb&apos;) as f:</div><div class="line">        f.write(score_response.content)</div><div class="line">    content = score_response.content</div><div class="line">    soup = BeautifulSoup(content, &apos;html.parser&apos;)</div><div class="line">    target = soup.findAll(&apos;tr&apos;)</div><div class="line">    try:</div><div class="line">        for tag in target[1:]:</div><div class="line">            tds = tag.findAll(&apos;td&apos;)</div><div class="line">            j = 0</div><div class="line">            # 学期</div><div class="line">            semester = str(tds[0].string)</div><div class="line">            if semester == &apos;None&apos;:</div><div class="line">                break</div><div class="line">            else:</div><div class="line">                print(semester.ljust(6) + &apos;\t\t\t&apos;, end=&apos;&apos;)</div><div class="line">                table.write(i, j, semester, set_style(&apos;Arial&apos;, 220))</div><div class="line">            # 学号</div><div class="line">            studentid = tds[1].string</div><div class="line">            print(studentid.ljust(14) + &apos;\t\t\t&apos;, end=&apos;&apos;)</div><div class="line">            j += 1</div><div class="line">            table.write(i, j, studentid, set_style(&apos;Arial&apos;, 220))</div><div class="line">            table.col(i).width = 256 * 16</div><div class="line">            # 姓名</div><div class="line">            name = tds[2].string</div><div class="line">            print(name.ljust(3) + &apos;\t\t\t&apos;, end=&apos;&apos;)</div><div class="line">            j += 1</div><div class="line">            table.write(i, j, name, set_style(&apos;Arial&apos;, 220))</div><div class="line">            # 课程</div><div class="line">            course = tds[3].string</div><div class="line">            print(course.ljust(20, &apos; &apos;) + &apos;\t\t\t&apos;, end=&apos;&apos;)</div><div class="line">            j += 1</div><div class="line">            table.write(i, j, course, set_style(&apos;Arial&apos;, 220))</div><div class="line">            # 课程要求</div><div class="line">            requirments = tds[4].string</div><div class="line">            print(requirments.ljust(10, &apos; &apos;) + &apos;\t\t&apos;, end=&apos;&apos;)</div><div class="line">            j += 1</div><div class="line">            table.write(i, j, requirments, set_style(&apos;Arial&apos;, 220))</div><div class="line">            # 学分</div><div class="line">            scredit = tds[5].string</div><div class="line">            print(scredit.ljust(2, &apos; &apos;) + &apos;\t\t&apos;, end=&apos;&apos;)</div><div class="line">            j += 1</div><div class="line">            table.write(i, j, scredit, set_style(&apos;Arial&apos;, 220))</div><div class="line">            # 成绩</div><div class="line">            achievement = tds[6].string</div><div class="line">            print(achievement.ljust(2) + &apos;\t\t&apos;, end=&apos;&apos;)</div><div class="line">            j += 1</div><div class="line">            table.write(i, j, achievement, set_style(&apos;Arial&apos;, 220))</div><div class="line">            # 重考一</div><div class="line">            reexaminef = tds[7].string</div><div class="line">            print(reexaminef.ljust(2) + &apos;\t\t&apos;, end=&apos;&apos;)</div><div class="line">            j += 1</div><div class="line">            table.write(i, j, reexaminef, set_style(&apos;Arial&apos;, 220))</div><div class="line">            # 重考二</div><div class="line">            reexamines = tds[8].string</div><div class="line">            print(reexamines.ljust(2) + &apos;\t\t&apos;)</div><div class="line">            j += 1</div><div class="line">            table.write(i, j, reexamines, set_style(&apos;Arial&apos;, 220))</div><div class="line">            i += 1</div><div class="line">    except:</div><div class="line">        print(&apos;出了一点小Bug&apos;)</div><div class="line">    file.save(&apos;demo.xls&apos;)</div></pre></td></tr></table></figure>
<p>在模拟登陆操作后增加一个判断：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"># 判断是否登陆</div><div class="line">def isLogin(num):</div><div class="line">    return_code = response.status_code</div><div class="line">    if return_code == 200:</div><div class="line">        if re.match(r&quot;^\d&#123;14&#125;$&quot;, num):</div><div class="line">            print(&apos;请稍等&apos;)</div><div class="line">        else:</div><div class="line">            print(&apos;请输入正确的学号&apos;)</div><div class="line">        return True</div><div class="line">    else:</div><div class="line">        return False</div></pre></td></tr></table></figure>
<p>最后在<code>__main__</code>中这么调用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">if __name__ == &apos;__main__&apos;:</div><div class="line">    num = input(&apos;请输入你的学号：&apos;)</div><div class="line">    if isLogin(num):</div><div class="line">        getScore(num, pagenum=0, i=0, j=0)</div><div class="line">        getScore(num, pagenum=1, i=31, j=0)</div><div class="line">        getScore(num, pagenum=2, i=61, j=0)</div></pre></td></tr></table></figure>
<p>在PyCharm下按<code>alt</code>+<code>shift</code>+<code>x</code>快捷键运行程序：</p>
<p><img src="http://oasusatoz.bkt.clouddn.com/inputnum.png" alt="控制台输出"></p>
<p>控制台会有如下输出(这里只截取部分，不要吐槽没有对齐，这里我也用了格式化输出还是不太行，不过最起码出来了结果，而且我们的目的是输出到Excel中不是吗)</p>
<p><img src="http://oasusatoz.bkt.clouddn.com/achievre.png" alt="控制台输出"></p>
<p>然后去程序根目录找看看有没有生成一个叫<code>demo.xls</code>的文件，我的程序就放在桌面，所以去桌面找：</p>
<p><img src="http://oasusatoz.bkt.clouddn.com/rexls.png" alt="桌面图标"></p>
<p>点开查看是否成功获取：</p>
<p><img src="http://oasusatoz.bkt.clouddn.com/finalresult.png" alt="最终获取结果"></p>
<p>至此，大功告成</p>
<p><strong>小结</strong><br>刚开始接触Python一个星期的样子，这次写了这么一个简单的网络爬虫检验一下学习成果，虽然程序还有些许Bug，不过总归得到了一定收获，当然也为下一步学习打下了基础，嗯哼，为了接下来批量获取网络上美女图片并分类保存我会继续自学Python，荆轲刺秦王~</p>
<p><a href="https://github.com/GiitSmile/login/blob/master/login.py" target="_blank" rel="external">源码</a></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:lin794653318@gmail.com">李牧羊</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https:///www.limuyang.cc/2016/08/04/人生苦短，我用Python-爬虫模拟登陆教务处并且保存数据到本地/">https:///www.limuyang.cc/2016/08/04/人生苦短，我用Python-爬虫模拟登陆教务处并且保存数据到本地/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https:///www.limuyang.cc" target="_blank">李牧羊</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Python/">Python</a><a class="post-meta__tags" href="/tags/爬虫/">爬虫</a><a class="post-meta__tags" href="/tags/模拟登陆/">模拟登陆</a><a class="post-meta__tags" href="/tags/保存数据/">保存数据</a></div><div class="post-qr-code"><div class="post-qr-code-item"><img class="post-qr-code__img" src="http://oasusatoz.bkt.clouddn.com/weixin.png"><div class="post-qr-code__desc">谢谢你请我吃糖果</div></div></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2016/08/09/人生苦短，我用Python-一起来爬知乎娘/"><i class="fa fa-chevron-left">  </i><span>人生苦短，我用Python--一起来爬知乎娘</span></a></div><div class="next-post pull-right"><a href="/2016/07/25/Python网络编程基础/"><span>Python网络编程基础</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'https:///www.limuyang.cc/2016/08/04/人生苦短，我用Python-爬虫模拟登陆教务处并且保存数据到本地/';
  this.page.identifier = '2016/08/04/人生苦短，我用Python-爬虫模拟登陆教务处并且保存数据到本地/';
  this.page.title = '人生苦短，我用Python--爬虫模拟登陆教务处并且保存数据到本地';
}
var d = document, s = d.createElement('script');
s.src = "https://" + 'Limuyang' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script><script id="dsq-count-src" src="https://Limuyang.disqus.com/count.js" async></script></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2018 By 李牧羊</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.5.3"></script><script src="/js/fancybox.js?version=1.5.3"></script><script src="/js/sidebar.js?version=1.5.3"></script><script src="/js/copy.js?version=1.5.3"></script><script src="/js/fireworks.js?version=1.5.3"></script><script src="/js/transition.js?version=1.5.3"></script><script src="/js/scroll.js?version=1.5.3"></script><script src="/js/head.js?version=1.5.3"></script></body></html>