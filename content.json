[{"title":"é˜…è¯»åˆ†æReact-Reduxæºç ","date":"2019-06-19T16:57:44.000Z","path":"2019/06/19/é˜…è¯»åˆ†æReact-Reduxæºç /","text":"reduxä½œä¸ºå¤§å‹åº”ç”¨çš„çŠ¶æ€ç®¡ç†å·¥å…·ï¼Œå¦‚æœæƒ³é…åˆreactä½¿ç”¨ï¼Œéœ€è¦å€ŸåŠ©react-reduxã€‚ reduxä¸»è¦å®Œæˆä¸¤ä»¶äº‹æƒ…ï¼š é€šè¿‡contextä»rootå‘ä¸‹ä¼ å…¥storeï¼Œä¿è¯æ•°æ®çš„å•é¡¹æµåŠ¨çš„åŒæ—¶ä¹Ÿæ–¹ä¾¿äº†å­ç»„ä»¶ä»storeä¸Šè·å–æ•°æ® å½“åº”ç”¨çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œè§¦å‘subscribeæ–¹æ³•è¿›è¡Œç›‘å¬ï¼Œå®ç°ç›¸å…³é€»è¾‘ åœ¨React 16.4.0ä¹‹å‰ï¼ŒReactå®˜æ–¹æ˜¯ä¸æ¨èä½¿ç”¨contextçš„ï¼ŒåŸå› åœ¨äºï¼Œå½“contextä¸­çš„å€¼åˆ·æ–°çš„æ—¶å€™ï¼Œæ˜¯ä»ä¸Šåˆ°ä¸‹åˆ·æ–°çš„ï¼Œå¦‚æœä¸­é—´æœ‰ç»„ä»¶çš„shouldComponentUpdateè¿”å›äº†falseï¼Œè¿™ä¸ªç»„ä»¶ä¸‹é¢çš„ç»„ä»¶å°±æ”¶ä¸åˆ°æ›´æ–°åçš„å€¼ï¼›è€ŒReact-Reduxå®ç°äº†è®¢é˜…å‘å¸ƒçš„æ¨¡å¼ï¼Œä¿è¯ä½¿ç”¨äº†storeçš„ç»„ä»¶åœ¨æ•°æ®æ›´æ–°çš„æ—¶å€™å¯ä»¥å¾—åˆ°é€šçŸ¥ã€‚åœ¨React 16.4.0ä¹‹åå®˜æ–¹å°†createContextæš´éœ²å‡ºæ¥äº†ï¼Œä»¥ä¸Šçš„é—®é¢˜ä¸ä¼šå‡ºç°ï¼Œä½†æ˜¯æ˜¯ä¸æ˜¯æ„å‘³ç€ï¼Œå¯ä»¥ç”¨contextæ¥æ›¿ä»£reduxå‘¢ï¼Ÿç†è®ºä¸Šæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯å¹¶ä¸æ¨èè¿™æ ·åšï¼Œå› ä¸ºåœ¨reduxçš„å‘å±•ä¸­ï¼Œå…¶ç”Ÿæ€ç³»ç»Ÿæ˜¯éå¸¸ç¹è£çš„ï¼Œç”¨Reduxèƒ½é¿å…é‡å¤é€ è½®å­çš„çª˜å¢ƒã€‚å¼•è‡ªï¼šhttp://cuteshilina.com/2019/01/19/HowReactReduxWorks/#æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦react-reduxçœ‹ä¸€çœ¼React-Reduxçš„ç›®å½•ç»“æ„ï¼š 1234567891011121314151617â”œâ”€â”€ componentsâ”‚ â”œâ”€â”€ Context.jsâ”‚ â”œâ”€â”€ Provider.jsâ”‚ â””â”€â”€ connectAdvanced.jsâ”œâ”€â”€ connectâ”‚ â”œâ”€â”€ connect.jsâ”‚ â”œâ”€â”€ mapDispatchToProps.jsâ”‚ â”œâ”€â”€ mapStateToProps.jsâ”‚ â”œâ”€â”€ mergeProps.jsâ”‚ â”œâ”€â”€ selectorFactory.jsâ”‚ â”œâ”€â”€ verifySubselectors.jsâ”‚ â””â”€â”€ wrapMapToProps.jsâ”œâ”€â”€ index.jsâ””â”€â”€ utils â”œâ”€â”€ isPlainObject.js â”œâ”€â”€ shallowEqual.js â”œâ”€â”€ verifyPlainObject.js å…¥å£åœ¨index.jsï¼š Index123456import Provider from './components/Provider'import connectAdvanced from './components/connectAdvanced'import &#123; ReactReduxContext &#125; from './components/Context'import connect from './connect/connect'export &#123; Provider, connectAdvanced, ReactReduxContext, connect &#125; å¯ä»¥çœ‹åˆ°å…¥å£åªæ˜¯å¯¹å¤–è¾“å‡ºäº†Providerã€connenctã€connectedAdvancedä¸‰ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„æ˜¯å‰é¢ä¸¤ç§æ–¹æ³•ã€‚ å…ˆçœ‹Providerã€‚ Provider1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586import React, &#123; Component &#125; from 'react'import PropTypes from 'prop-types'import &#123; ReactReduxContext &#125; from './Context'class Provider extends Component &#123; constructor(props) &#123; super(props) // è·å–store const &#123; store &#125; = props this.state = &#123; storeState: store.getState(), store &#125; &#125; componentDidMount() &#123; // åˆ¤æ–­æ˜¯å¦æŒ‚è½½çš„flag this._isMounted = true this.subscribe() &#125; componentWillUnmount() &#123; if (this.unsubscribe) this.unsubscribe() this._isMounted = false &#125; componentDidUpdate(prevProps) &#123; if (this.props.store !== prevProps.store) &#123; if (this.unsubscribe) this.unsubscribe() this.subscribe() &#125; &#125; subscribe() &#123; const &#123; store &#125; = this.props this.unsubscribe = store.subscribe(() =&gt; &#123; // è·å–æœ€æ–°çš„state const newStoreState = store.getState() if (!this._isMounted) &#123; return &#125; // æ›´æ–°storeState this.setState(providerState =&gt; &#123; // If the value is the same, skip the unnecessary state update. if (providerState.storeState === newStoreState) &#123; return null &#125; return &#123; storeState: newStoreState &#125; &#125;) &#125;) // Actions might have been dispatched between render and mount - handle those const postMountStoreState = store.getState() if (postMountStoreState !== this.state.storeState) &#123; this.setState(&#123; storeState: postMountStoreState &#125;) &#125; &#125; render() &#123; const Context = this.props.context || ReactReduxContext return ( &lt;Context.Provider value=&#123;this.state&#125;&gt; &#123;this.props.children&#125; &lt;/Context.Provider&gt; ) &#125;&#125;Provider.propTypes = &#123; store: PropTypes.shape(&#123; subscribe: PropTypes.func.isRequired, dispatch: PropTypes.func.isRequired, getState: PropTypes.func.isRequired &#125;), context: PropTypes.object, children: PropTypes.any&#125;export default Provider æˆ‘ä»¬åœ¨ä½¿ç”¨Providerçš„æ—¶å€™åªéœ€è¦æŠŠStoreä¼ å…¥ï¼Œé€šè¿‡Contextè¿™ä¸ªAPIæ¥å®ç°å…¨å±€æ³¨å…¥Storeï¼Œé™¤äº†ä½¿ç”¨é»˜è®¤çš„Contextä¹‹å¤–æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„Contextï¼Œçœ‹ä¸€ä¸‹é»˜è®¤çš„å®ç°ï¼š12345import React from 'react'export const ReactReduxContext = React.createContext(null)export default ReactReduxContext å›åˆ°Provider.jsï¼Œåœ¨åˆå§‹åŒ–é˜¶æ®µåˆ©ç”¨stateå»å­˜å‚¨storeåŠå…¶å¯¹åº”çš„stateä¿¡æ¯ï¼Œåœ¨componentDidMountå‘¨æœŸè°ƒç”¨subscribeæ–¹æ³•æ·»åŠ è®¢é˜…ä»¥ä¾¿äºåœ¨æ¯æ¬¡dispatch actionçš„æ—¶å€™å¯ä»¥æ›´æ–°å½“å‰stateé‡Œé¢çš„storeStateï¼ŒåŒæ—¶è¿™ä¸ªæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªç”¨äºå–æ¶ˆå½“å‰è®¢é˜…çš„å‡½æ•°ï¼Œåœ¨componentWillUnmountæ—¶å€™æ‰§è¡Œã€‚å¯ä»¥çœ‹åˆ°Provideråšçš„å·¥ä½œå…¶å®æ¯”è¾ƒç®€å•ï¼Œäº‹å®ä¸Šä¹Ÿæ˜¯å¦‚æ­¤ï¼Œä¸»è¦çš„å·¥ä½œåœ¨connect.jsã€‚ Connect123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107import connectAdvanced from '../components/connectAdvanced'import shallowEqual from '../utils/shallowEqual'import defaultMapDispatchToPropsFactories from './mapDispatchToProps'import defaultMapStateToPropsFactories from './mapStateToProps'import defaultMergePropsFactories from './mergeProps'import defaultSelectorFactory from './selectorFactory'/* connect is a facade over connectAdvanced. It turns its args into a compatible selectorFactory, which has the signature: (dispatch, options) =&gt; (nextState, nextOwnProps) =&gt; nextFinalProps connect passes its args to connectAdvanced as options, which will in turn pass them to selectorFactory each time a Connect component instance is instantiated or hot reloaded. selectorFactory returns a final props selector from its mapStateToProps, mapStateToPropsFactories, mapDispatchToProps, mapDispatchToPropsFactories, mergeProps, mergePropsFactories, and pure args. The resulting final props selector is called by the Connect component instance whenever it receives new props or store state. */function match(arg, factories, name) &#123; for (let i = factories.length - 1; i &gt;= 0; i--) &#123; const result = factories[i](arg) if (result) return result &#125; return (dispatch, options) =&gt; &#123; throw new Error( `Invalid value of type $&#123;typeof arg&#125; for $&#123;name&#125; argument when connecting component $&#123; options.wrappedComponentName &#125;.` ) &#125;&#125;function strictEqual(a, b) &#123; return a === b&#125;// createConnect with default args builds the 'official' connect behavior. Calling it with// different options opens up some testing and extensibility scenariosexport function createConnect(&#123; connectHOC = connectAdvanced, mapStateToPropsFactories = defaultMapStateToPropsFactories, // æ ¹æ®ä¼ å…¥çš„mapStateToPropå‚æ•°ç±»å‹æ¥å†³å®šè°ƒç”¨ä»€ä¹ˆæ–¹æ³• mapDispatchToPropsFactories = defaultMapDispatchToPropsFactories, // æ ¹æ®ä¼ å…¥çš„mapDispatchToPropså‚æ•°ç±»å‹æ¥å†³å®šè°ƒç”¨ä»€ä¹ˆæ–¹æ³• mergePropsFactories = defaultMergePropsFactories, // å¦‚æœä¸ä¼ è°ƒç”¨é»˜è®¤çš„mergePropsæ–¹æ³•ï¼Œå¦åˆ™ä½¿ç”¨è‡ªå®šä¹‰çš„mergePropsæ–¹æ³• selectorFactory = defaultSelectorFactory // è®¡ç®—mapStateToPropsï¼ŒmapDispatchToProps, ownPropsçš„ç»“æœ&#125; = &#123;&#125;) &#123; return function connect( mapStateToProps, mapDispatchToProps, mergeProps, &#123; pure = true, // è®¾ä¸ºtrueè¡¨ç¤ºæˆ‘ä»¬å‡è®¾è¿™ä¸ªç»„ä»¶çš„çŠ¶æ€é™¤äº†ä»propsä¼ å…¥ä¹‹å¤–ä¸ä¾èµ–äºå¤–ç•Œè¾“å…¥ä»¥åŠè‡ªèº«çš„stateï¼Œæ­¤æ—¶connectåªä¼šå¯¹ç›¸å…³çš„state/propsè¿›è¡Œæµ…æ¯”è¾ƒä»¥é¿å…é‡æ–°æ¸²æŸ“ areStatesEqual = strictEqual, areOwnPropsEqual = shallowEqual, areStatePropsEqual = shallowEqual, areMergedPropsEqual = shallowEqual, ...extraOptions &#125; = &#123;&#125; ) &#123; // æ ¹æ®ä¼ å…¥çš„å‚æ•°çš„ç±»å‹ä¸åŒObject/Functionè°ƒç”¨å¯¹åº”çš„factoryæ–¹æ³•æ¥è¿”å›å¯¹åº”çš„å‡½æ•° const initMapStateToProps = match( mapStateToProps, mapStateToPropsFactories, 'mapStateToProps' ) const initMapDispatchToProps = match( mapDispatchToProps, mapDispatchToPropsFactories, 'mapDispatchToProps' ) const initMergeProps = match(mergeProps, mergePropsFactories, 'mergeProps') return connectHOC(selectorFactory, &#123; // used in error messages methodName: 'connect', // used to compute Connect's displayName from the wrapped component's displayName. getDisplayName: name =&gt; `Connect($&#123;name&#125;)`, // if mapStateToProps is falsy, the Connect component doesn't subscribe to store state changes // å¦‚æœæ²¡æœ‰ä¼ mapStateToPropså°†ä¸ä¼šç›‘å¬stateçš„å˜åŒ– shouldHandleStateChanges: Boolean(mapStateToProps), // passed through to selectorFactory // ä¼ é€’ç»™selectFactoryçš„å‚æ•° initMapStateToProps, initMapDispatchToProps, initMergeProps, pure, areStatesEqual, areOwnPropsEqual, areStatePropsEqual, areMergedPropsEqual, // any extra options args can override defaults of connect or connectAdvanced ...extraOptions &#125;) &#125;&#125;export default createConnect() è¦çœ‹æ‡‚connect.jséœ€è¦ç»“åˆconnectAdvanced.jsä¸€èµ·ï¼Œå› ä¸ºåè€…æ˜¯å‰è€…çš„åŸºç¡€ï¼Œè¿™ä¸ªå‡½æ•°ä¼šå°†Reactç»„ä»¶å’ŒRedux Storeé“¾æ¥åœ¨ä¸€èµ·ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¸ä¼šå»å¤„ç†å¦‚ä½•å°†stateã€ownPropsç­‰ç»„åˆåˆ°propsé‡Œé¢ï¼Œå†³å®šå…¶è¡Œä¸ºçš„è¿˜æ˜¯connect.jsã€‚ é€šè¿‡export default createConnect()å¯ä»¥çŸ¥é“connect.jså¯¹å¤–è¾“å‡ºçš„æ˜¯æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨çš„connectæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ¥å—mapStateToPropsã€mapDispatchToPropsã€mergePropsç­‰ä¸»è¦å‚æ•°ä»¥åŠä¸€äº›å¯é€‰å‚æ•°ã€‚ ç´§æ¥ç€ï¼Œé€šè¿‡matchæ–¹æ³•ï¼Œæ ¹æ®æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°ç±»å‹ä¸åŒï¼Œè°ƒç”¨ä¸åŒçš„xxfactoryæ–¹æ³•ï¼Œä»¥mapStateToPropsä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¼ å…¥ä¸€ä¸ªå‡½æ•°æˆ–è€…ä¸ä¼ ï¼Œä¼šå¾—åˆ°ä¸åŒçš„è°ƒç”¨ç»“æœï¼š 12345678910111213import &#123; wrapMapToPropsConstant, wrapMapToPropsFunc &#125; from './wrapMapToProps'export function whenMapStateToPropsIsFunction(mapStateToProps) &#123; return typeof mapStateToProps === 'function' ? wrapMapToPropsFunc(mapStateToProps, 'mapStateToProps') : undefined&#125;export function whenMapStateToPropsIsMissing(mapStateToProps) &#123; return !mapStateToProps ? wrapMapToPropsConstant(() =&gt; (&#123;&#125;)) : undefined&#125;export default [whenMapStateToPropsIsFunction, whenMapStateToPropsIsMissing] å¦‚æœä¸ä¼ mapStateToPropsä¼šè°ƒç”¨wrapMapToPropsConstantæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä»¥ä¸€ä¸ªè¿”å›ç©ºå¯¹è±¡çš„å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œæœ€åå…¶å®è¿˜æ˜¯è¿”å›ä¸€ä¸ªç©ºå¯¹è±¡ï¼š 1234567891011export function wrapMapToPropsConstant(getConstant) &#123; return function initConstantSelector(dispatch, options) &#123; const constant = getConstant(dispatch, options) function constantSelector() &#123; return constant &#125; constantSelector.dependsOnOwnProps = false return constantSelector &#125;&#125; å¦åˆ™çš„è¯å°±è°ƒç”¨wrapMapToPropsFuncæ–¹æ³•ï¼š 1234567891011121314151617181920212223242526272829303132333435export function wrapMapToPropsFunc(mapToProps, methodName) &#123; return function initProxySelector(dispatch, &#123; displayName &#125;) &#123; const proxy = function mapToPropsProxy(stateOrDispatch, ownProps) &#123; return proxy.dependsOnOwnProps ? proxy.mapToProps(stateOrDispatch, ownProps) : proxy.mapToProps(stateOrDispatch) &#125; // allow detectFactoryAndVerify to get ownProps proxy.dependsOnOwnProps = true proxy.mapToProps = function detectFactoryAndVerify( stateOrDispatch, ownProps ) &#123; proxy.mapToProps = mapToProps // æ£€æŸ¥æ˜¯å¦è®¢é˜…äº†ownProps proxy.dependsOnOwnProps = getDependsOnOwnProps(mapToProps) let props = proxy(stateOrDispatch, ownProps) if (typeof props === 'function') &#123; proxy.mapToProps = props proxy.dependsOnOwnProps = getDependsOnOwnProps(props) props = proxy(stateOrDispatch, ownProps) &#125; if (process.env.NODE_ENV !== 'production') verifyPlainObject(props, displayName, methodName) return props &#125; return proxy &#125;&#125; è¿™é‡Œä¼šè¿”å›ä¸€ä¸ªåä¸ºinitProxySelectorçš„æ¥å—dispatchä½œä¸ºå‚æ•°çš„å‡½æ•°ï¼Œå…³äºè¿™ä¸ªå‡½æ•°ç»†èŠ‚å¾…ä¼šå›æ¥çœ‹ï¼Œå…ˆå›åˆ°connect.jsï¼Œæ¥ç€å¾€ä¸‹çœ‹ã€‚ åœ¨åšå®Œä¸Šè¿°å·¥ä½œåï¼Œç›´æ¥å°†æ‰€æœ‰å‚æ•°ä¼ å…¥connectHOCï¼Œæ‰€ä»¥æˆ‘ä»¬è¦çœ‹ä¸€ä¸‹connectHOCåšäº†ä»€ä¹ˆï¼š connectAdvanced123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285import hoistStatics from 'hoist-non-react-statics'import invariant from 'invariant'import React, &#123; Component, PureComponent &#125; from 'react'import &#123; isValidElementType, isContextConsumer &#125; from 'react-is'import &#123; ReactReduxContext &#125; from './Context'const stringifyComponent = Comp =&gt; &#123; try &#123; return JSON.stringify(Comp) &#125; catch (err) &#123; return String(Comp) &#125;&#125;export default function connectAdvanced( /* selectorFactory is a func that is responsible for returning the selector function used to compute new props from state, props, and dispatch. For example: export default connectAdvanced((dispatch, options) =&gt; (state, props) =&gt; (&#123; thing: state.things[props.thingId], saveThing: fields =&gt; dispatch(actionCreators.saveThing(props.thingId, fields)), &#125;))(YourComponent) Access to dispatch is provided to the factory so selectorFactories can bind actionCreators outside of their selector as an optimization. Options passed to connectAdvanced are passed to the selectorFactory, along with displayName and WrappedComponent, as the second argument. Note that selectorFactory is responsible for all caching/memoization of inbound and outbound props. Do not use connectAdvanced directly without memoizing results between calls to your selector, otherwise the Connect component will re-render on every state or props change. */ selectorFactory, // options object: &#123; // the func used to compute this HOC's displayName from the wrapped component's displayName. // probably overridden by wrapper functions such as connect() getDisplayName = name =&gt; `ConnectAdvanced($&#123;name&#125;)`, // shown in error messages // probably overridden by wrapper functions such as connect() methodName = 'connectAdvanced', // REMOVED: if defined, the name of the property passed to the wrapped element indicating the number of // calls to render. useful for watching in react devtools for unnecessary re-renders. renderCountProp = undefined, // determines whether this HOC subscribes to store changes shouldHandleStateChanges = true, // REMOVED: the key of props/context to get the store storeKey = 'store', // REMOVED: expose the wrapped component via refs withRef = false, // use React's forwardRef to expose a ref of the wrapped component forwardRef = false, // the context consumer to use context = ReactReduxContext, // additional options are passed through to the selectorFactory ...connectOptions &#125; = &#123;&#125;) &#123; invariant( renderCountProp === undefined, `renderCountProp is removed. render counting is built into the latest React dev tools profiling extension` ) invariant( !withRef, 'withRef is removed. To access the wrapped instance, use a ref on the connected component' ) const customStoreWarningMessage = 'To use a custom Redux store for specific components, create a custom React context with ' + \"React.createContext(), and pass the context object to React Redux's Provider and specific components\" + ' like: &lt;Provider context=&#123;MyContext&#125;&gt;&lt;ConnectedComponent context=&#123;MyContext&#125; /&gt;&lt;/Provider&gt;. ' + 'You may also pass a &#123;context : MyContext&#125; option to connect' invariant( storeKey === 'store', 'storeKey has been removed and does not do anything. ' + customStoreWarningMessage ) // å­˜å‚¨context const Context = context return function wrapWithConnect(WrappedComponent) &#123; if (process.env.NODE_ENV !== 'production') &#123; invariant( isValidElementType(WrappedComponent), `You must pass a component to the function returned by ` + `$&#123;methodName&#125;. Instead received $&#123;stringifyComponent( WrappedComponent )&#125;` ) &#125; const wrappedComponentName = WrappedComponent.displayName || WrappedComponent.name || 'Component' const displayName = getDisplayName(wrappedComponentName) const selectorFactoryOptions = &#123; ...connectOptions, getDisplayName, methodName, renderCountProp, shouldHandleStateChanges, storeKey, displayName, wrappedComponentName, WrappedComponent &#125; const &#123; pure &#125; = connectOptions // pureå‚æ•°å†³å®šæ˜¯ç»§æ‰¿Componentè¿˜æ˜¯PureComponent let OuterBaseComponent = Component if (pure) &#123; OuterBaseComponent = PureComponent &#125; function makeDerivedPropsSelector() &#123; let lastProps let lastState let lastDerivedProps let lastStore let lastSelectorFactoryOptions let sourceSelector return function selectDerivedProps( state, props, store, selectorFactoryOptions ) &#123; if (pure &amp;&amp; lastProps === props &amp;&amp; lastState === state) &#123; // ç›´æ¥è¿”å›ä¸Šä¸€æ¬¡ç”Ÿæˆçš„propsï¼Œé¿å…ä¸å¿…è¦çš„æ¸²æŸ“å·¥ä½œ return lastDerivedProps &#125; if ( store !== lastStore || lastSelectorFactoryOptions !== selectorFactoryOptions ) &#123; // æ›´æ–°æ•°æ® lastStore = store lastSelectorFactoryOptions = selectorFactoryOptions sourceSelector = selectorFactory( store.dispatch, selectorFactoryOptions ) &#125; lastProps = props lastState = state // ç”Ÿæˆæ–°çš„éœ€è¦æ³¨å…¥çš„propsï¼Œè¿™é‡Œä¼ å…¥çš„propsæ˜¯ownProps const nextProps = sourceSelector(state, props) lastDerivedProps = nextProps return lastDerivedProps &#125; &#125; function makeChildElementSelector() &#123; let lastChildProps, lastForwardRef, lastChildElement, lastComponent return function selectChildElement( WrappedComponent, childProps, forwardRef ) &#123; if ( childProps !== lastChildProps || forwardRef !== lastForwardRef || lastComponent !== WrappedComponent ) &#123; lastChildProps = childProps lastForwardRef = forwardRef lastComponent = WrappedComponent lastChildElement = ( &lt;WrappedComponent &#123;...childProps&#125; ref=&#123;forwardRef&#125; /&gt; ) &#125; return lastChildElement &#125; &#125; class Connect extends OuterBaseComponent &#123; constructor(props) &#123; super(props) invariant( forwardRef ? !props.wrapperProps[storeKey] : !props[storeKey], 'Passing redux store in props has been removed and does not do anything. ' + customStoreWarningMessage ) this.selectDerivedProps = makeDerivedPropsSelector() this.selectChildElement = makeChildElementSelector() this.indirectRenderWrappedComponent = this.indirectRenderWrappedComponent.bind( this ) &#125; indirectRenderWrappedComponent(value) &#123; // calling renderWrappedComponent on prototype from indirectRenderWrappedComponent bound to `this` return this.renderWrappedComponent(value) &#125; renderWrappedComponent(value) &#123; // è¿™é‡Œçš„valueå°±æ˜¯æœ€å¼€å§‹åœ¨Provideré‡Œé¢å®šä¹‰çš„state invariant( value, `Could not find \"store\" in the context of ` + `\"$&#123;displayName&#125;\". Either wrap the root component in a &lt;Provider&gt;, ` + `or pass a custom React context provider to &lt;Provider&gt; and the corresponding ` + `React context consumer to $&#123;displayName&#125; in connect options.` ) const &#123; storeState, store &#125; = value let wrapperProps = this.props let forwardedRef if (forwardRef) &#123; wrapperProps = this.props.wrapperProps forwardedRef = this.props.forwardedRef &#125; // ç”Ÿæˆè¦å°†storeä¸­å“ªäº›æ•°æ®æ³¨å…¥propsçš„æ–¹æ³• let derivedProps = this.selectDerivedProps( storeState, wrapperProps, store, selectorFactoryOptions ) // æ‹¼è£…æœ€åéœ€è¦è¿”å›ç»™connectAdvancedçš„ç»„ä»¶ return this.selectChildElement( WrappedComponent, derivedProps, forwardedRef ) &#125; render() &#123; // è·å–contextä»¥ä¾¿ä½¿ç”¨context.consumerè·å–storeçš„å˜æ›´ const ContextToUse = this.props.context &amp;&amp; this.props.context.Consumer &amp;&amp; isContextConsumer(&lt;this.props.context.Consumer /&gt;) ? this.props.context : Context return ( &lt;ContextToUse.Consumer&gt; &#123;this.indirectRenderWrappedComponent&#125; &lt;/ContextToUse.Consumer&gt; ) &#125; &#125; Connect.WrappedComponent = WrappedComponent Connect.displayName = displayName if (forwardRef) &#123; // å°†refè½¬å‘ç»™å­ç»„ä»¶ const forwarded = React.forwardRef(function forwardConnectRef( props, ref ) &#123; return &lt;Connect wrapperProps=&#123;props&#125; forwardedRef=&#123;ref&#125; /&gt; &#125;) forwarded.displayName = displayName forwarded.WrappedComponent = WrappedComponent // hoistStaticsç”¨äºcopyé™æ€æ–¹æ³•ï¼Œé¿å…åœ¨ä½¿ç”¨HOCçš„æ—¶å€™ç±»çš„é™æ€æ–¹æ³•ä¸¢å¤± return hoistStatics(forwarded, WrappedComponent) &#125; return hoistStatics(Connect, WrappedComponent) &#125;&#125; ç•¥è¿‡å‰é¢çš„ä¸€å †è­¦å‘Šåˆ¤æ–­ä¸çœ‹ï¼Œç›´æ¥çœ‹è¿”å›ï¼ŒconnectAdvancedä¼šè¿”å›ä¸€ä¸ªå«wrapWithConnectçš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä»¥ä¸€ä¸ªReact Componentä½œä¸ºå‚æ•°ï¼Œå›æƒ³æˆ‘ä»¬å¹³å¸¸è°ƒç”¨connectçš„æ—¶å€™ï¼š 1connect(mapStateToProps,mapDispatchToProps,mergeProps,options)(App); å°±æ˜¯åœ¨è¿™é‡Œï¼Œè¿™ä¸ªå‡½æ•°ä¼šå…ˆè·å–åˆ°wrappedComponentNameï¼Œç„¶åå°†é™¤äº†connectæ–¹æ³•å‰ä¸‰ä¸ªå‚æ•°ä¹‹å¤–çš„å…¶ä»–å‚æ•°éƒ½åŒ…è£¹åˆ°äº†selectorFactoryOptionsé‡Œé¢ï¼ŒwrapWithConnectè¿™ä¸ªHOCä¼šè¿”å›ä¸€ä¸ªæ–°çš„ç»„ä»¶ç»™æˆ‘ä»¬ï¼Œè‡³äºæ–°ç»„ä»¶æ˜¯ç»§æ‰¿Componentè¿˜æ˜¯PureComponentå–å†³äºæˆ‘ä»¬é…ç½®çš„pureå‚æ•°ï¼Œè¿™é‡Œè·³è¿‡æ¥ä¸‹æ¥çš„ä¸¤ä¸ªæ–¹æ³•ç›´æ¥çœ‹returnï¼Œå› ä¸ºç”¨åˆ°äº†HOCè¿™é‡Œæœ‰ä¸¤ä¸ªéœ€è¦æ³¨æ„çš„é—®é¢˜ï¼Œä¸€ä¸ªæ˜¯refè½¬å‘ï¼Œè¿™é‡Œä»£ç é‡Œé¢æœ‰ç›¸å…³ä½“ç°ï¼Œå¦ä¸€ä¸ªå°±æ˜¯åœ¨ä½¿ç”¨HOCçš„æ—¶å€™ä¼šé€ æˆstaticä¸¢å¤±çš„é—®é¢˜ï¼Œè¿™é‡Œé€šè¿‡hoist-non-react-staticsè¿›è¡Œäº†å¤„ç†ï¼Œå…·ä½“çš„æè¿°å¯ä»¥çœ‹react docã€‚ renderçš„æ—¶å€™ä¼šè°ƒç”¨this.indirectRenderWrappedComponentæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ¥æ”¶å½“å‰çš„contextå€¼ï¼Œä¹Ÿå°±æ˜¯Provideré‡Œé¢æä¾›çš„stateï¼Œçœ‹ä¸€çœ¼è¿™ä¸ªæ–¹æ³•ï¼š 1234567891011121314151617181920212223242526272829303132renderWrappedComponent(value) &#123; // è¿™é‡Œçš„valueå°±æ˜¯æœ€å¼€å§‹åœ¨Provideré‡Œé¢å®šä¹‰çš„state invariant( value, `Could not find \"store\" in the context of ` + `\"$&#123;displayName&#125;\". Either wrap the root component in a &lt;Provider&gt;, ` + `or pass a custom React context provider to &lt;Provider&gt; and the corresponding ` + `React context consumer to $&#123;displayName&#125; in connect options.` ) const &#123; storeState, store &#125; = value let wrapperProps = this.props let forwardedRef if (forwardRef) &#123; wrapperProps = this.props.wrapperProps forwardedRef = this.props.forwardedRef &#125; // ç”Ÿæˆè¦å°†storeä¸­å“ªäº›æ•°æ®æ³¨å…¥propsçš„æ–¹æ³• let derivedProps = this.selectDerivedProps( storeState, wrapperProps, store, selectorFactoryOptions ) // æ‹¼è£…æœ€åéœ€è¦è¿”å›ç»™connectAdvancedçš„ç»„ä»¶ return this.selectChildElement( WrappedComponent, derivedProps, forwardedRef ) &#125; å‰é¢çš„ä¸çœ‹ï¼Œç›´æ¥çœ‹selectDerivedPropsï¼Œå…¶å®æ˜¯è°ƒç”¨äº†makeDerivedPropsSelectorï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041function makeDerivedPropsSelector() &#123; let lastProps let lastState let lastDerivedProps let lastStore let lastSelectorFactoryOptions let sourceSelector return function selectDerivedProps( state, props, store, selectorFactoryOptions ) &#123; if (pure &amp;&amp; lastProps === props &amp;&amp; lastState === state) &#123; // ç›´æ¥è¿”å›ä¸Šä¸€æ¬¡ç”Ÿæˆçš„propsï¼Œé¿å…ä¸å¿…è¦çš„æ¸²æŸ“å·¥ä½œ return lastDerivedProps &#125; if ( store !== lastStore || lastSelectorFactoryOptions !== selectorFactoryOptions ) &#123; // æ›´æ–°æ•°æ® lastStore = store lastSelectorFactoryOptions = selectorFactoryOptions sourceSelector = selectorFactory( store.dispatch, selectorFactoryOptions ) &#125; lastProps = props lastState = state // ç”Ÿæˆæ–°çš„éœ€è¦æ³¨å…¥çš„propsï¼Œè¿™é‡Œä¼ å…¥çš„propsæ˜¯ownProps const nextProps = sourceSelector(state, props) lastDerivedProps = nextProps return lastDerivedProps &#125; &#125; é¦–å…ˆä¼šå¯¹stateå’Œpropsåšä¸€æ¬¡æµ…æ¯”è¾ƒï¼Œå¦‚æœæ²¡æœ‰å˜åŒ–ç›´æ¥è¿”å›ä¸Šä¸€æ¬¡è®¡ç®—å¾—åˆ°çš„ç»“æœï¼Œå¦åˆ™å°†dispatchå’ŒselectorFactoryOptionsä¼ å…¥selectorFactoryå¾—åˆ°sourceSelectorï¼ŒsourceSelectorç”±connectä¼ å…¥ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨äºè®¡ç®—mapStateToPropsã€mapDispatchToPropsã€ ownPropsçš„ç»“æœï¼š 1234567891011121314151617181920212223242526272829export default function finalPropsSelectorFactory( dispatch, &#123; initMapStateToProps, initMapDispatchToProps, initMergeProps, ...options &#125;) &#123; const mapStateToProps = initMapStateToProps(dispatch, options) const mapDispatchToProps = initMapDispatchToProps(dispatch, options) const mergeProps = initMergeProps(dispatch, options) if (process.env.NODE_ENV !== 'production') &#123; verifySubselectors( mapStateToProps, mapDispatchToProps, mergeProps, options.displayName ) &#125; const selectorFactory = options.pure ? pureFinalPropsSelectorFactory : impureFinalPropsSelectorFactory return selectorFactory( mapStateToProps, mapDispatchToProps, mergeProps, dispatch, options )&#125; è¿™é‡Œçš„initMapStateToPropsä¹‹æµå°±æ˜¯æˆ‘ä»¬ä¹‹å‰wrapMapToPropsFuncå‡½æ•°è¿”å›çš„ç»“æœï¼Œæˆ‘æŠŠä»£ç è´´ä¸‹é¢æ–¹ä¾¿å¯¹ç…§ï¼š 1234567891011121314151617181920212223242526272829303132333435export function wrapMapToPropsFunc(mapToProps, methodName) &#123; return function initProxySelector(dispatch, &#123; displayName &#125;) &#123; const proxy = function mapToPropsProxy(stateOrDispatch, ownProps) &#123; return proxy.dependsOnOwnProps ? proxy.mapToProps(stateOrDispatch, ownProps) : proxy.mapToProps(stateOrDispatch) &#125; // allow detectFactoryAndVerify to get ownProps proxy.dependsOnOwnProps = true proxy.mapToProps = function detectFactoryAndVerify( stateOrDispatch, ownProps ) &#123; proxy.mapToProps = mapToProps // æ£€æŸ¥æ˜¯å¦è®¢é˜…äº†ownProps proxy.dependsOnOwnProps = getDependsOnOwnProps(mapToProps) let props = proxy(stateOrDispatch, ownProps) if (typeof props === 'function') &#123; proxy.mapToProps = props proxy.dependsOnOwnProps = getDependsOnOwnProps(props) props = proxy(stateOrDispatch, ownProps) &#125; if (process.env.NODE_ENV !== 'production') verifyPlainObject(props, displayName, methodName) return props &#125; return proxy &#125;&#125; è¿˜æ˜¯ç”¨mapStateToPropsä¸ºä¾‹ï¼Œå…ˆçœ‹finalPropsSelectorFactoryï¼Œå¦‚æœæˆ‘ä»¬åœ¨å‚æ•°é‡Œé¢è®¾ç½®äº†pureï¼Œå°±ä¼šè°ƒç”¨pureFinalPropsSelectorFactoryå»æ„é€ æœ€åçš„selectorFactoryå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475export function pureFinalPropsSelectorFactory( mapStateToProps, mapDispatchToProps, mergeProps, dispatch, &#123; areStatesEqual, areOwnPropsEqual, areStatePropsEqual &#125;) &#123; let hasRunAtLeastOnce = false let state let ownProps let stateProps let dispatchProps let mergedProps // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è¿è¡Œæ‰§è¡Œè¯¥æ–¹æ³• function handleFirstCall(firstState, firstOwnProps) &#123; state = firstState ownProps = firstOwnProps stateProps = mapStateToProps(state, ownProps) dispatchProps = mapDispatchToProps(dispatch, ownProps) mergedProps = mergeProps(stateProps, dispatchProps, ownProps) hasRunAtLeastOnce = true return mergedProps &#125; function handleNewPropsAndNewState() &#123; stateProps = mapStateToProps(state, ownProps) if (mapDispatchToProps.dependsOnOwnProps) dispatchProps = mapDispatchToProps(dispatch, ownProps) mergedProps = mergeProps(stateProps, dispatchProps, ownProps) return mergedProps &#125; function handleNewProps() &#123; if (mapStateToProps.dependsOnOwnProps) stateProps = mapStateToProps(state, ownProps) if (mapDispatchToProps.dependsOnOwnProps) dispatchProps = mapDispatchToProps(dispatch, ownProps) mergedProps = mergeProps(stateProps, dispatchProps, ownProps) return mergedProps &#125; function handleNewState() &#123; const nextStateProps = mapStateToProps(state, ownProps) const statePropsChanged = !areStatePropsEqual(nextStateProps, stateProps) stateProps = nextStateProps if (statePropsChanged) mergedProps = mergeProps(stateProps, dispatchProps, ownProps) return mergedProps &#125; // å¤„ç†åç»­è°ƒç”¨ function handleSubsequentCalls(nextState, nextOwnProps) &#123; const propsChanged = !areOwnPropsEqual(nextOwnProps, ownProps) const stateChanged = !areStatesEqual(nextState, state) state = nextState ownProps = nextOwnProps // æ ¹æ®propså’Œstateçš„å˜åŠ¨æƒ…å†µæ‰§è¡Œä¸åŒçš„æ–¹æ³•ï¼Œæœ¬è´¨ä¸Šæœ€åéƒ½æ˜¯è°ƒç”¨mergedPropsåˆå¹¶props if (propsChanged &amp;&amp; stateChanged) return handleNewPropsAndNewState() if (propsChanged) return handleNewProps() if (stateChanged) return handleNewState() return mergedProps &#125; return function pureFinalPropsSelector(nextState, nextOwnProps) &#123; return hasRunAtLeastOnce ? handleSubsequentCalls(nextState, nextOwnProps) : handleFirstCall(nextState, nextOwnProps) &#125;&#125; æ•´ä½“æµç¨‹æ¯”è¾ƒç®€å•ï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è¿è¡Œï¼Œè°ƒç”¨handleFirstCallæ–¹æ³•ï¼Œå®ƒä¼šæ ¹æ®ä¼ å…¥çš„stateå’ŒownPropsæ¥è¿”å›mergeåçš„propsï¼Œè¿™ä¸ªæ–¹æ³•é‡Œé¢è°ƒç”¨äº†mapStateToProps(state, ownProps)ï¼Œç­‰åŒäºè°ƒç”¨äº†mapToPropsProxy(state, ownProps)ï¼Œç„¶ååœ¨åˆ¤æ–­æ˜¯mapStateToPropsè¿˜æ˜¯mapDispatchToPropsæ¥è¿”å›å¤„ç†åçš„propsï¼Œåç»­è¿è¡Œä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œå¤§è‡´çš„æµç¨‹éƒ½æ²¡æœ‰ä»€ä¹ˆå¤§çš„åŒºåˆ«ï¼Œæœ€åå¯ä»¥çœ‹ä¸€ä¸‹é»˜è®¤çš„mergePropsæ˜¯æ€ä¹ˆå¤„ç†çš„ï¼š 1234export function defaultMergeProps(stateProps, dispatchProps, ownProps) &#123; // ç®€å•çš„ä½¿ç”¨å±•å¼€è¿ç®—ç¬¦åˆå¹¶å¯¹è±¡ return &#123; ...ownProps, ...stateProps, ...dispatchProps &#125;&#125; å¯ä»¥çœ‹åˆ°å°±æ˜¯ç›´æ¥å±•å¼€ï¼Œç®€æ˜æ˜“æ‡‚ã€‚","tags":[{"name":"javascript","slug":"javascript","permalink":"https://www.limuyang.cc/tags/javascript/"},{"name":"æºç é˜…è¯»","slug":"æºç é˜…è¯»","permalink":"https://www.limuyang.cc/tags/æºç é˜…è¯»/"},{"name":"react-redux","slug":"react-redux","permalink":"https://www.limuyang.cc/tags/react-redux/"}]},{"title":"é˜…è¯»åˆ†æVue-Routeræºç ","date":"2019-05-09T17:05:05.000Z","path":"2019/05/09/é˜…è¯»åˆ†æVue-Routeræºç /","text":"è·¯ç”±çš„æ¦‚å¿µè·¯ç”±è¿™ä¸ªæ¦‚å¿µæœ€å¼€å§‹æ˜¯åœ¨åç«¯å‡ºç°çš„ï¼Œä»¥å‰ä½¿ç”¨æ¨¡æ¿å¼•æ“å¼€å‘é¡µé¢çš„æ—¶å€™ç»å¸¸ä¼šçœ‹åˆ°è¿™æ ·çš„è·¯å¾„ï¼š1http://hometown.xxx.edu.cn/bbs/forum.php æœ‰æ—¶è¿˜ä¼šæœ‰å¸¦.aspæˆ–.htmlçš„è·¯å¾„ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„SSR(Server Side Render)ï¼Œé€šè¿‡æœåŠ¡ç«¯æ¸²æŸ“ï¼Œç›´æ¥è¿”å›é¡µé¢ã€‚å…¶å“åº”è¿‡ç¨‹æ˜¯è¿™æ ·çš„ 1.æµè§ˆå™¨å‘å‡ºè¯·æ±‚ 2.æœåŠ¡å™¨ç›‘å¬åˆ°80ç«¯å£ï¼ˆæˆ–443ï¼‰æœ‰è¯·æ±‚è¿‡æ¥ï¼Œå¹¶è§£æurlè·¯å¾„ 3.æ ¹æ®æœåŠ¡å™¨çš„è·¯ç”±é…ç½®ï¼Œè¿”å›ç›¸åº”ä¿¡æ¯ï¼ˆå¯ä»¥æ˜¯ html å­—ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯ json æ•°æ®ï¼Œå›¾ç‰‡ç­‰ï¼‰ 4.æµè§ˆå™¨æ ¹æ®æ•°æ®åŒ…çš„Content-Typeæ¥å†³å®šå¦‚ä½•è§£ææ•°æ® ç®€å•æ¥è¯´è·¯ç”±å°±æ˜¯ç”¨æ¥è·Ÿåç«¯æœåŠ¡å™¨è¿›è¡Œäº¤äº’çš„ä¸€ç§æ–¹å¼ï¼Œé€šè¿‡ä¸åŒçš„è·¯å¾„ï¼Œæ¥è¯·æ±‚ä¸åŒçš„èµ„æºï¼Œè¯·æ±‚ä¸åŒçš„é¡µé¢æ˜¯è·¯ç”±çš„å…¶ä¸­ä¸€ç§åŠŸèƒ½ã€‚å°±åƒè·¯ç”±å™¨åœ¨ç½‘ç»œå±‚ä¸­æ‰®æ¼”çš„è§’è‰²ä¸€æ ·ï¼Œè‚©è´Ÿç€å°†æ•°æ®åŒ…æ­£ç¡®å¯¼å‘ç›®çš„åœ°å€çš„é‡ä»»ï¼Œåªä¸è¿‡åœ¨è¿™é‡Œå˜æˆäº†å®¢æˆ·ç«¯æµè§ˆå™¨çš„æŒ‡è·¯äººï¼Œæ‰€è°“çš„å‰ç«¯è·¯ç”±ï¼ŒæŒ‡çš„æ˜¯ä¸€ç§èƒ½åŠ›ï¼Œå³ï¼š ä¸ä¾èµ–äºæœåŠ¡å™¨ï¼Œæ ¹æ®ä¸åŒçš„URLæ¸²æŸ“ä¸åŒçš„é¡µé¢ å‰ç«¯è·¯ç”±ä¸åç«¯è·¯ç”±åœ¨Ajaxè¿˜æ²¡æœ‰è¯ç”Ÿçš„æ—¶å€™ï¼Œè·¯ç”±çš„å·¥ä½œæ˜¯äº¤ç»™åç«¯æ¥å®Œæˆçš„ï¼Œå½“è¿›è¡Œé¡µé¢åˆ‡æ¢çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šå‘é€ä¸åŒçš„URLè¯·æ±‚ï¼ŒæœåŠ¡å™¨æ¥æ”¶åˆ°æµè§ˆå™¨çš„è¯·æ±‚æ—¶ï¼Œé€šè¿‡è§£æä¸åŒçš„URLå»æ‹¼æ¥éœ€è¦çš„Htmlæˆ–æ¨¡æ¿ï¼Œç„¶åå°†ç»“æœè¿”å›åˆ°æµè§ˆå™¨ç«¯è¿›è¡Œæ¸²æŸ“ã€‚ æœåŠ¡å™¨ç«¯è·¯ç”±åŒæ ·æ˜¯æœ‰åˆ©äº¦æœ‰å¼Šã€‚å®ƒçš„å¥½å¤„æ˜¯å®‰å…¨æ€§æ›´é«˜ï¼Œæ›´ä¸¥æ ¼å¾—æ§åˆ¶é¡µé¢çš„å±•ç°ã€‚è¿™åœ¨æŸäº›åœºæ™¯ä¸­æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œè­¬å¦‚ä¸‹å•æ”¯ä»˜æµç¨‹ï¼Œæ¯ä¸€æ­¥åªæœ‰åœ¨ä¸Šä¸€æ­¥æˆåŠŸæ‰§è¡Œä¹‹åæ‰èƒ½æŠµè¾¾ã€‚è¿™åœ¨æœåŠ¡å™¨ç«¯å¯ä»¥ä¸ºæ¯ä¸€æ­¥æµç¨‹æ·»åŠ éªŒè¯æœºåˆ¶ï¼Œåªæœ‰éªŒè¯é€šè¿‡æ‰è¿”å›æ­£ç¡®çš„é¡µé¢ã€‚é‚£ä¹ˆå‰ç«¯è·¯ç”±ä¸èƒ½å®ç°æ¯ä¸€æ­¥çš„éªŒè¯ï¼Ÿè‡ªç„¶ä¸æ˜¯ï¼Œå§‘ä¸”ç›¸ä¿¡ä½ çš„ä»£ç å¯ä»¥å†™çš„å¾ˆä¸¥è°¨ï¼Œä¿è¯æ­£å¸¸æƒ…å†µä¸‹æµç¨‹ä¸ä¼šé”™ï¼Œä½†æ˜¯å¦ä¸€ä¸ªä¸å¾—ä¸é¢å¯¹çš„äº‹å®æ˜¯ï¼šå‰ç«¯æ˜¯æ¯«æ— å®‰å…¨æ€§å¯è¨€çš„ã€‚ç”¨æˆ·å¯ä»¥è‚†æ„ä¿®æ”¹ä»£ç æ¥è¿›å…¥ä¸åŒçš„æµç¨‹ï¼Œä½ å¯èƒ½ä¼šä¸ºæ­¤æ·»åŠ ä¸å°‘çš„å¤„ç†é€»è¾‘ã€‚ç›¸è¾ƒä¹‹ä¸‹ï¼Œå½“ç„¶æ˜¯åç«¯æ§åˆ¶é¡µé¢çš„è¿›å…¥æƒé™æ›´ä¸ºå®‰å…¨å’Œç®€ä¾¿ã€‚ å¦ä¸€æ–¹é¢ï¼Œåç«¯è·¯ç”±æ— ç–‘å¢åŠ äº†æœåŠ¡å™¨ç«¯çš„è´Ÿè·ï¼Œå¹¶ä¸”éœ€è¦reloadé¡µé¢ï¼Œç”¨æˆ·ä½“éªŒå…¶å®ä¸ä½³ã€‚ å‰ç«¯è·¯ç”±çš„å‡ºç°åœ¨ 90s å¹´ä»£åˆï¼Œå¤§å¤šæ•°çš„ç½‘é¡µéƒ½æ˜¯é€šè¿‡ç›´æ¥è¿”å›HTMLçš„ï¼Œç”¨æˆ·çš„æ¯æ¬¡æ›´æ–°æ“ä½œéƒ½éœ€è¦é‡æ–°åˆ·æ–°é¡µé¢ã€‚åŠå…¶å½±å“äº¤äº’ä½“éªŒï¼Œéšç€ç½‘ç»œçš„å‘å±•ï¼Œè¿«åˆ‡éœ€è¦ä¸€ç§æ–¹æ¡ˆæ¥æ”¹å–„è¿™ç§æƒ…å†µã€‚ 1996ï¼Œå¾®è½¯é¦–å…ˆæå‡º iframe æ ‡ç­¾ï¼Œiframeå¸¦æ¥äº†å¼‚æ­¥åŠ è½½å’Œè¯·æ±‚å…ƒç´ çš„æ¦‚å¿µï¼Œéšååœ¨ 1998 å¹´ï¼Œå¾®è½¯çš„ Outloook Web App å›¢é˜Ÿæå‡ºAjaxçš„åŸºæœ¬æ¦‚å¿µï¼ˆXMLHttpRequestçš„å‰èº«ï¼‰ï¼Œå¹¶åœ¨IE5é€šè¿‡ActiveXæ¥å®ç°äº†è¿™é¡¹æŠ€æœ¯ã€‚åœ¨å¾®è½¯å®ç°è¿™ä¸ªæ¦‚å¿µåï¼Œå…¶ä»–æµè§ˆå™¨æ¯”å¦‚Moziliaï¼ŒSafariï¼ŒOperaç›¸ç»§ä»¥ XMLHttpRequestæ¥å®ç°Ajaxã€‚ï¼ˆğŸ˜­ å…¼å®¹é—®é¢˜ä»æ­¤å‡ºç°ï¼Œè¯è¯´å¾®è½¯å‘½åçœŸå–œæ¬¢ç”¨Xï¼ŒMFCæºç ä¸€å¤§å †ã€‚ã€‚ï¼‰ä¸è¿‡åœ¨ IE7 å‘å¸ƒæ—¶ï¼Œå¾®è½¯é€‰æ‹©äº†å¦¥åï¼Œå…¼å®¹äº†XMLHttpRequestçš„å®ç°ã€‚ æœ‰äº†Ajaxåï¼Œç”¨æˆ·äº¤äº’å°±ä¸ç”¨æ¯æ¬¡éƒ½åˆ·æ–°é¡µé¢ï¼Œä½“éªŒå¸¦æ¥äº†æå¤§çš„æå‡ã€‚ ä½†çœŸæ­£è®©è¿™é¡¹æŠ€æœ¯å‘æ‰¬å…‰å¤§çš„ï¼Œ(ï½¡ï½¥âˆ€ï½¥)ï¾‰ï¾è¿˜æ˜¯åæ¥çš„ Google Mapï¼Œå®ƒçš„å‡ºç°å‘äººä»¬å±•ç°äº†Ajaxçš„çœŸæ­£é­…åŠ›ï¼Œé‡Šæ”¾äº†ä¼—å¤šå¼€å‘äººå‘˜çš„æƒ³è±¡åŠ›ï¼Œè®©å…¶ä¸ä»…ä»…å±€é™äºç®€å•çš„æ•°æ®å’Œé¡µé¢äº¤äº’ï¼Œä¸ºåæ¥å¼‚æ­¥äº¤äº’ä½“éªŒæ–¹å¼çš„ç¹è£å‘å±•å¸¦æ¥äº†æ ¹åŸºã€‚ è€Œå¼‚æ­¥äº¤äº’ä½“éªŒçš„æ›´é«˜çº§ç‰ˆæœ¬å°±æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„SPAï¼ŒSPAä¸å•å•åœ¨é¡µé¢äº¤äº’ä¸Šåšåˆ°äº†ä¸åˆ·æ–°ï¼Œè€Œä¸”åœ¨é¡µé¢ä¹‹é—´è·³è½¬ä¹Ÿåšåˆ°äº†ä¸åˆ·æ–°ï¼Œä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œå°±ä¿ƒä½¿äº†å‰ç«¯è·¯ç”±çš„è¯ç”Ÿã€‚ å‰ç«¯è·¯ç”±çš„å®ç°æ–¹å¼å‰ç«¯è·¯ç”±å…¶å®åªè¦è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š åœ¨é¡µé¢ä¸åˆ·æ–°çš„å‰æä¸‹å®ç°urlå˜åŒ– æ•æ‰åˆ°urlçš„å˜åŒ–ï¼Œä»¥ä¾¿æ‰§è¡Œé¡µé¢æ›¿æ¢é€»è¾‘åœ¨ 2014 å¹´ä¹‹å‰ï¼Œå¤§å®¶æ˜¯é€šè¿‡ hash æ¥å®ç°è·¯ç”±ï¼Œurl hash å°±æ˜¯ç±»ä¼¼äºï¼š1http://www.xxx.com/#/login è¿™ç§ #ã€‚åé¢hashå€¼çš„å˜åŒ–ï¼Œå¹¶ä¸ä¼šå¯¼è‡´æµè§ˆå™¨å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œæµè§ˆå™¨ä¸å‘å‡ºè¯·æ±‚ï¼Œä¹Ÿå°±ä¸ä¼šåˆ·æ–°é¡µé¢ã€‚å¦å¤–æ¯æ¬¡hashå€¼çš„å˜åŒ–ï¼Œè¿˜ä¼šè§¦å‘hashchangeè¿™ä¸ªäº‹ä»¶ï¼Œé€šè¿‡è¿™ä¸ªäº‹ä»¶æˆ‘ä»¬å°±å¯ä»¥çŸ¥é“hashå€¼å‘ç”Ÿäº†å“ªäº›å˜åŒ–ã€‚ç„¶åæˆ‘ä»¬ä¾¿å¯ä»¥ç›‘å¬hashchangeæ¥å®ç°æ›´æ–°é¡µé¢éƒ¨åˆ†å†…å®¹çš„æ“ä½œï¼š 1234function matchAndUpdate () &#123; // todo åŒ¹é… hash åš dom æ›´æ–°æ“ä½œ&#125;window.addEventListener('hashchange', matchAndUpdate) åæ¥ï¼Œå› ä¸ºHTML5æ ‡å‡†å‘å¸ƒã€‚å¤šäº†ä¸¤ä¸ª APIï¼ŒpushStateå’ŒreplaceStateï¼Œé€šè¿‡è¿™ä¸¤ä¸ªAPIå¯ä»¥æ”¹å˜ urlåœ°å€ä¸”ä¸ä¼šå‘é€è¯·æ±‚ã€‚åŒæ—¶è¿˜æœ‰popstateäº‹ä»¶ã€‚é€šè¿‡è¿™äº›å°±èƒ½ç”¨å¦ä¸€ç§æ–¹å¼æ¥å®ç°å‰ç«¯è·¯ç”±äº†ï¼Œä½†åŸç†éƒ½æ˜¯è·Ÿhashå®ç°ç›¸åŒçš„ã€‚ç”¨äº†HTML5çš„å®ç°ï¼Œå•é¡µè·¯ç”±çš„urlå°±ä¸ä¼šå¤šå‡ºä¸€ä¸ª#ï¼Œå˜å¾—æ›´åŠ ç¾è§‚ã€‚ä½†å› ä¸ºæ²¡æœ‰ # å·ï¼Œæ‰€ä»¥å½“ç”¨æˆ·åˆ·æ–°é¡µé¢ä¹‹ç±»çš„æ“ä½œæ—¶ï¼Œæµè§ˆå™¨è¿˜æ˜¯ä¼šç»™æœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚ä¸ºäº†é¿å…å‡ºç°è¿™ç§æƒ…å†µï¼Œæ‰€ä»¥è¿™ä¸ªå®ç°éœ€è¦æœåŠ¡å™¨çš„æ”¯æŒï¼Œéœ€è¦æŠŠæ‰€æœ‰è·¯ç”±éƒ½é‡å®šå‘åˆ°æ ¹é¡µé¢ï¼š 1234function matchAndUpdate () &#123; // todo åŒ¹é…è·¯å¾„ åš dom æ›´æ–°æ“ä½œ&#125;window.addEventListener('popstate', matchAndUpdate) Vue-Routerçš„å®ç°æ–¹å¼Vue-Routerè·ŸVuexä¸€æ ·éƒ½æ˜¯é€šè¿‡Vue.useè¿™ä¸ªå…¨å±€APIæ¥æ³¨å†Œçš„ï¼Œè¿™ä¸ªæ–¹æ³•å®šä¹‰åœ¨vue/src/core/global-api/use.jsï¼š 1234567891011121314151617181920212223/* @flow */import &#123; toArray &#125; from '../util/index'export function initUse (Vue: GlobalAPI) &#123; Vue.use = function (plugin: Function | Object) &#123; const installedPlugins = (this._installedPlugins || (this._installedPlugins = [])) if (installedPlugins.indexOf(plugin) &gt; -1) &#123; return this &#125; // additional parameters const args = toArray(arguments, 1) args.unshift(this) if (typeof plugin.install === 'function') &#123; plugin.install.apply(plugin, args) &#125; else if (typeof plugin === 'function') &#123; plugin.apply(null, args) &#125; installedPlugins.push(plugin) return this &#125;&#125; Vue.useæ¥å—ä¸€ä¸ªpluginå‚æ•°ï¼Œå¹¶ä¸”ç»´æŠ¤äº†ä¸€ä¸ª_installedPluginsæ•°ç»„ï¼Œå®ƒå­˜å‚¨æ‰€æœ‰æ³¨å†Œè¿‡çš„pluginï¼›å¦‚æœpluginæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¼šåˆ¤æ–­pluginæœ‰æ²¡æœ‰å®šä¹‰installæ–¹æ³•ï¼Œå¦‚æœæœ‰çš„è¯åˆ™è°ƒç”¨è¯¥æ–¹æ³•ï¼Œå¹¶ä¸”è¯¥æ–¹æ³•æ‰§è¡Œçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯Vueï¼›å¦‚æœpluginæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä¼šè¢«ä½œä¸ºinstallæ–¹æ³•ï¼Œæœ€åæŠŠpluginå­˜å‚¨åˆ°installedPluginsæ•°ç»„é‡Œé¢ï¼ŒVueçš„è¿™ç§æ’ä»¶æ³¨å†Œçš„æœºåˆ¶æœ‰ä¸€ä¸ªå¥½å¤„å°±æ˜¯æˆ‘ä»¬ä¸éœ€è¦é¢å¤–çš„å»import Vueäº†ã€‚ è·¯ç”±çš„æ³¨å†ŒVue-Routerçš„å…¥å£åœ¨src/index.jsï¼Œå…¶ä¸­installæ–¹æ³•å®šä¹‰åœ¨src/install.jsï¼Œå¯ä»¥çœ‹ä¸€ä¸‹srcä¸‹é¢çš„ç›®å½•ç»“æ„ï¼š 12345678910111213141516171819202122232425â”œâ”€â”€ componentsâ”‚ â”œâ”€â”€ link.jsâ”‚ â””â”€â”€ view.jsâ”œâ”€â”€ create-matcher.jsâ”œâ”€â”€ create-route-map.jsâ”œâ”€â”€ historyâ”‚ â”œâ”€â”€ abstract.jsâ”‚ â”œâ”€â”€ base.jsâ”‚ â”œâ”€â”€ hash.jsâ”‚ â””â”€â”€ html5.jsâ”œâ”€â”€ index.jsâ”œâ”€â”€ install.jsâ””â”€â”€ util â”œâ”€â”€ async.js â”œâ”€â”€ dom.js â”œâ”€â”€ location.js â”œâ”€â”€ misc.js â”œâ”€â”€ params.js â”œâ”€â”€ path.js â”œâ”€â”€ push-state.js â”œâ”€â”€ query.js â”œâ”€â”€ resolve-components.js â”œâ”€â”€ route.js â”œâ”€â”€ scroll.js â””â”€â”€ warn.js ç®€å•çœ‹ä¸‹installçš„æµç¨‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061import View from './components/view'import Link from './components/link'export let _Vueexport function install (Vue) &#123; // ç¡®ä¿Vue-Routeråªè¢«installä¸€æ¬¡ if (install.installed &amp;&amp; _Vue === Vue) return install.installed = true _Vue = Vue const isDef = v =&gt; v !== undefined const registerInstance = (vm, callVal) =&gt; &#123; let i = vm.$options._parentVnode if (isDef(i) &amp;&amp; isDef(i = i.data) &amp;&amp; isDef(i = i.registerRouteInstance)) &#123; i(vm, callVal) &#125; &#125; Vue.mixin(&#123; // åœ¨beforeCreateé’©å­é‡Œé¢åˆå§‹åŒ–è·¯ç”± beforeCreate () &#123; // æ ¹ç»„ä»¶çš„$optionsä¸Šæ‰æœ‰routerå¯¹è±¡ if (isDef(this.$options.router)) &#123; // è®¾ç½®æ ¹è·¯ç”± this._routerRoot = this // è·å–åˆ°æ ¹ç»„ä»¶ä¸Šçš„routerå®ä¾‹ this._router = this.$options.router // è·¯ç”±åˆå§‹åŒ– this._router.init(this) // ä¸º_routeå±æ€§å®ç°åŒå‘ç»‘å®š Vue.util.defineReactive(this, '_route', this._router.history.current) &#125; else &#123; // è·å–çˆ¶ç»„ä»¶çš„_routerRoot this._routerRoot = (this.$parent &amp;&amp; this.$parent._routerRoot) || this &#125; // æ³¨å†Œ&lt;router-view&gt;&lt;/router-view&gt;å®ä¾‹çš„é’©å­ registerInstance(this, this) &#125;, destroyed () &#123; registerInstance(this) &#125; &#125;) // æ–¹ä¾¿å…¨å±€é€šè¿‡this.$routerè·å–è·¯ç”±å®ä¾‹ Object.defineProperty(Vue.prototype, '$router', &#123; get () &#123; return this._routerRoot._router &#125; &#125;) // æ–¹ä¾¿å…¨å±€é€šè¿‡this.$routeè·å–è·¯ç”±å¯¹è±¡ Object.defineProperty(Vue.prototype, '$route', &#123; get () &#123; return this._routerRoot._route &#125; &#125;) // æ³¨å†Œå…¨å±€ç»„ä»¶&lt;router-view/&gt;å’Œ&lt;router-link/&gt; Vue.component('RouterView', View) Vue.component('RouterLink', Link) // ä½¿ç”¨å’Œcreatedç›¸åŒçš„åˆå¹¶ç­–ç•¥ const strats = Vue.config.optionMergeStrategies // use the same hook merging strategy for route hooks strats.beforeRouteEnter = strats.beforeRouteLeave = strats.beforeRouteUpdate = strats.created&#125; é¦–å…ˆé€šè¿‡è®¾ç«‹ä¸€ä¸ªinstalledæ ‡å¿—ä½æ¥ç¡®ä¿Vue-Routeråªè¢«å®‰è£…ä¸€æ¬¡ï¼Œç„¶åé€šè¿‡å˜é‡_Vueæ‰¿è½½ä¼ å…¥çš„Vueå®ä¾‹ï¼Œç„¶ååˆ©ç”¨Vue.mixinå‘æ¯ä¸€ä¸ªVueå®ä¾‹æ³¨å†ŒbeforeCreateå’Œdestroyedé’©å­å‡½æ•°ã€‚ åœ¨beforeCreateå‡½æ•°é‡Œé¢ï¼Œå¦‚æœæ˜¯æ ¹ç»„ä»¶ï¼Œå°†æ ¹ç»„ä»¶èµ‹å€¼ç»™this._routerRootï¼Œè·å–æ ¹ç»„ä»¶çš„è·¯ç”±å®ä¾‹ä¹‹åæ‰§è¡Œinitåˆå§‹åŒ–å‡½æ•°ï¼Œç„¶åè°ƒç”¨Vueçš„defineReactiveå°†_routeå˜ä¸ºå“åº”å¼å¯¹è±¡ï¼Œå¦‚æœä¸æ˜¯æ ¹ç»„ä»¶åˆ™è·å–çˆ¶ç»„ä»¶çš„_routerRootå±æ€§ã€‚ åœ¨beforeCreateå‡½æ•°çš„æœ€åéƒ¨åˆ†å’Œdestroyedå‡½æ•°é‡Œé¢éƒ½æ‰§è¡Œäº†registerInstanceå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯æ³¨å†Œ&lt;router-view&gt;å®ä¾‹çš„é’©å­å‡½æ•°ï¼Œæ ¹æ®ä¼ å…¥å‚æ•°çš„ä¸ªæ•°æ¥å†³å®šæ˜¯æ³¨å†Œè¿˜æ˜¯å–æ¶ˆæ³¨å†Œï¼Œå‡½æ•°çš„å®šä¹‰åœ¨src/components/view.jsé‡Œé¢: 123456789101112// attach instance registration hook // this will be called in the instance's injected lifecycle hooks data.registerRouteInstance = (vm, val) =&gt; &#123; // val could be undefined for unregistration const current = matched.instances[name] if ( (val &amp;&amp; current !== vm) || (!val &amp;&amp; current === vm) ) &#123; matched.instances[name] = val &#125; &#125; å›åˆ°install.jsï¼Œç´§æ¥ç€ï¼Œä¸ºäº†è®©æˆ‘ä»¬èƒ½å¤Ÿå…¨å±€çš„ä½¿ç”¨this.$routerå’Œthis.$routeåœ¨VueåŸå‹ä¸Šå®šä¹‰äº†å¯¹åº”çš„getæ–¹æ³•ï¼Œç„¶åé€šè¿‡Vue.componentæ³¨å†Œäº†å…¨å±€ç»„ä»¶æ³¨å†Œå…¨å±€ç»„ä»¶&lt;router-view/&gt;å’Œå’Œ&lt;router-link/&gt;ï¼Œæœ€åå®šä¹‰äº†ä¸€äº›é’©å­å‡½æ•°çš„ä½¿ç”¨ç­–ç•¥ï¼Œè¿™å°±æ˜¯æ•´ä¸ªVue-Routerçš„å®‰è£…è¿‡ç¨‹ã€‚ è·¯ç”±çš„å®ä¾‹åŒ–å…ˆçœ‹ä¸€ä¸‹Vue-Routerçš„æ„é€ å‡½æ•°ï¼Œå½“æˆ‘ä»¬newä¸€ä¸ªVue-Routerçš„æ—¶å€™éƒ½å¹²äº†äº›ä»€ä¹ˆï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254/* @flow */import &#123; install &#125; from './install'import &#123; START &#125; from './util/route'import &#123; assert &#125; from './util/warn'import &#123; inBrowser &#125; from './util/dom'import &#123; cleanPath &#125; from './util/path'import &#123; createMatcher &#125; from './create-matcher'import &#123; normalizeLocation &#125; from './util/location'import &#123; supportsPushState &#125; from './util/push-state'import &#123; HashHistory &#125; from './history/hash'import &#123; HTML5History &#125; from './history/html5'import &#123; AbstractHistory &#125; from './history/abstract'import type &#123; Matcher &#125; from './create-matcher'export default class VueRouter &#123; static install: () =&gt; void; static version: string; app: any; apps: Array&lt;any&gt;; ready: boolean; readyCbs: Array&lt;Function&gt;; options: RouterOptions; mode: string; history: HashHistory | HTML5History | AbstractHistory; matcher: Matcher; fallback: boolean; beforeHooks: Array&lt;?NavigationGuard&gt;; resolveHooks: Array&lt;?NavigationGuard&gt;; afterHooks: Array&lt;?AfterNavigationHook&gt;; constructor (options: RouterOptions = &#123;&#125;) &#123; // æ ¹Vueå®ä¾‹ this.app = null // å­˜å‚¨å«æœ‰this.$options.routerå±æ€§çš„Vueå®ä¾‹ this.apps = [] // ä¼ å…¥è·¯ç”±çš„é…ç½® this.options = options this.beforeHooks = [] this.resolveHooks = [] this.afterHooks = [] // åˆ›å»ºè·¯ç”±åŒ¹é…å¯¹è±¡ this.matcher = createMatcher(options.routes || [], this) // é»˜è®¤ä¸ºhashæ¨¡å¼ let mode = options.mode || 'hash' // å½“æµè§ˆå™¨ä¸æ”¯æŒ history.pushState æ§åˆ¶è·¯ç”±æ˜¯å¦åº”è¯¥å›é€€åˆ° hash æ¨¡å¼ã€‚é»˜è®¤å€¼ä¸º true this.fallback = mode === 'history' &amp;&amp; !supportsPushState &amp;&amp; options.fallback !== false if (this.fallback) &#123; mode = 'hash' &#125; // æ”¯æŒæ‰€æœ‰ JavaScript è¿è¡Œç¯å¢ƒï¼Œå¦‚ Node.js æœåŠ¡å™¨ç«¯ã€‚å¦‚æœå‘ç°æ²¡æœ‰æµè§ˆå™¨çš„ APIï¼Œè·¯ç”±ä¼šè‡ªåŠ¨å¼ºåˆ¶è¿›å…¥è¿™ä¸ªæ¨¡å¼ if (!inBrowser) &#123; mode = 'abstract' &#125; this.mode = mode // æ ¹æ®modeé‡‡ç”¨ä¸åŒçš„è·¯ç”±æ–¹å¼ switch (mode) &#123; case 'history': this.history = new HTML5History(this, options.base) break case 'hash': this.history = new HashHistory(this, options.base, this.fallback) break case 'abstract': this.history = new AbstractHistory(this, options.base) break default: if (process.env.NODE_ENV !== 'production') &#123; assert(false, `invalid mode: $&#123;mode&#125;`) &#125; &#125; &#125; match ( raw: RawLocation, current?: Route, redirectedFrom?: Location ): Route &#123; return this.matcher.match(raw, current, redirectedFrom) &#125; get currentRoute (): ?Route &#123; return this.history &amp;&amp; this.history.current &#125; init (app: any /* Vue component instance */) &#123; // åœ¨åˆå§‹åŒ–Vue-Routerä¹‹å‰å¿…é¡»å…ˆé€šè¿‡Vue.use(VueRouter)æ³¨å†Œ process.env.NODE_ENV !== 'production' &amp;&amp; assert( install.installed, `not installed. Make sure to call \\`Vue.use(VueRouter)\\` ` + `before creating root instance.` ) this.apps.push(app) // set up app destroyed handler // https://github.com/vuejs/vue-router/issues/2639 app.$once('hook:destroyed', () =&gt; &#123; // clean out app from this.apps array once destroyed const index = this.apps.indexOf(app) if (index &gt; -1) this.apps.splice(index, 1) // ensure we still have a main app or null if no apps // we do not release the router so it can be reused if (this.app === app) this.app = this.apps[0] || null &#125;) // main app previously initialized // return as we don't need to set up new history listener if (this.app) &#123; return &#125; this.app = app const history = this.history if (history instanceof HTML5History) &#123; history.transitionTo(history.getCurrentLocation()) &#125; else if (history instanceof HashHistory) &#123; const setupHashListener = () =&gt; &#123; history.setupListeners() &#125; history.transitionTo( history.getCurrentLocation(), setupHashListener, setupHashListener ) &#125; history.listen(route =&gt; &#123; this.apps.forEach((app) =&gt; &#123; app._route = route &#125;) &#125;) &#125; beforeEach (fn: Function): Function &#123; return registerHook(this.beforeHooks, fn) &#125; beforeResolve (fn: Function): Function &#123; return registerHook(this.resolveHooks, fn) &#125; afterEach (fn: Function): Function &#123; return registerHook(this.afterHooks, fn) &#125; onReady (cb: Function, errorCb?: Function) &#123; this.history.onReady(cb, errorCb) &#125; onError (errorCb: Function) &#123; this.history.onError(errorCb) &#125; push (location: RawLocation, onComplete?: Function, onAbort?: Function) &#123; this.history.push(location, onComplete, onAbort) &#125; replace (location: RawLocation, onComplete?: Function, onAbort?: Function) &#123; this.history.replace(location, onComplete, onAbort) &#125; go (n: number) &#123; this.history.go(n) &#125; back () &#123; this.go(-1) &#125; forward () &#123; this.go(1) &#125; getMatchedComponents (to?: RawLocation | Route): Array&lt;any&gt; &#123; const route: any = to ? to.matched ? to : this.resolve(to).route : this.currentRoute if (!route) &#123; return [] &#125; return [].concat.apply([], route.matched.map(m =&gt; &#123; return Object.keys(m.components).map(key =&gt; &#123; return m.components[key] &#125;) &#125;)) &#125; resolve ( to: RawLocation, current?: Route, append?: boolean ): &#123; location: Location, route: Route, href: string, // for backwards compat normalizedTo: Location, resolved: Route &#125; &#123; current = current || this.history.current const location = normalizeLocation( to, current, append, this ) const route = this.match(location, current) const fullPath = route.redirectedFrom || route.fullPath const base = this.history.base const href = createHref(base, fullPath, this.mode) return &#123; location, route, href, // for backwards compat normalizedTo: location, resolved: route &#125; &#125; addRoutes (routes: Array&lt;RouteConfig&gt;) &#123; this.matcher.addRoutes(routes) if (this.history.current !== START) &#123; this.history.transitionTo(this.history.getCurrentLocation()) &#125; &#125;&#125;function registerHook (list: Array&lt;any&gt;, fn: Function): Function &#123; list.push(fn) return () =&gt; &#123; const i = list.indexOf(fn) if (i &gt; -1) list.splice(i, 1) &#125;&#125;function createHref (base: string, fullPath: string, mode) &#123; var path = mode === 'hash' ? '#' + fullPath : fullPath return base ? cleanPath(base + '/' + path) : path&#125;VueRouter.install = installVueRouter.version = '__VERSION__'// é€šè¿‡linkæ ‡ç­¾å¼•ç”¨jsçš„å®è¡Œè‡ªåŠ¨æ³¨å†Œif (inBrowser &amp;&amp; window.Vue) &#123; window.Vue.use(VueRouter)&#125; æ„é€ å‡½æ•°é‡Œé¢å®šä¹‰äº†ä¸€äº›å±æ€§ï¼Œå…¶ä¸­this.appè¡¨ç¤ºæ ¹Vueçš„å®ä¾‹ï¼Œthis.appså­˜å‚¨å«æœ‰this.$options.routerå±æ€§çš„Vueå®ä¾‹ï¼Œåˆå§‹åŒ–Vue-Routeråä¼ å…¥çš„é…ç½®éƒ½ä¼šå­˜å‚¨åœ¨this.optionsï¼Œthis.beforeHooksã€this.resolveHooksã€this.afterHooksç”¨æ¥å­˜å‚¨é’©å­å‡½æ•°ï¼Œthis.matcheræ˜¯è·¯ç”±åŒ¹é…åè¿”å›çš„å¯¹è±¡ï¼Œthis.fallbackä¼šæ ¹æ®é…ç½®çš„modeå‚æ•°ä»¥åŠæµè§ˆå™¨æ”¯æŒåº¦æ¥å†³å®šç»™æ˜¯å¦å›é€€åˆ°hashæ¨¡å¼ï¼Œthis.modeå°±æ˜¯è·¯ç”±åˆ›å»ºçš„æ¨¡å¼ï¼Œè¿™é‡Œæä¾›hashã€historyã€abstractä¸‰ç§æ¨¡å¼ï¼Œthis.historyè¡¨ç¤ºæ ¹æ®ä¸åŒçš„è·¯ç”±æ¨¡å¼æ¥åˆ›å»ºçš„è·¯ç”±historyçš„å…·ä½“å®ç°æ–¹å¼ã€‚ å®ä¾‹åŒ–Vue-Routerä¹‹åä¼šè¿”å›å®ƒçš„å®ä¾‹routerï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨Vue-Routerçš„æ—¶å€™éœ€è¦åœ¨åˆå§‹åŒ–Vueçš„æ—¶å€™ä¼ å…¥è¿™ä¸ªrouterå±æ€§ï¼š 12345new Vue(&#123; el: '#app', router, render: h =&gt; h(App)&#125;) è¿™ä¸ªæ—¶å€™ä¼šæŠŠrouterå±æ€§é…ç½®åˆ°this.$optionsï¼Œå›æƒ³åˆ°install.jsé‡Œé¢åœ¨beforeCreateé’©å­å‡½æ•°é‡Œé¢æ‰§è¡Œçš„æ–¹æ³•ï¼š 1234567891011beforeCreate () &#123; // æ ¹ç»„ä»¶çš„$optionsä¸Šæ‰æœ‰routerå¯¹è±¡ if (isDef(this.$options.router)) &#123; // è®¾ç½®æ ¹è·¯ç”± this._routerRoot = this // è·å–åˆ°æ ¹ç»„ä»¶ä¸Šçš„routerå®ä¾‹ this._router = this.$options.router // è·¯ç”±åˆå§‹åŒ– this._router.init(this) // .... &#125; æ‰€ä»¥è¿™ä¸ªæ—¶å€™ä¼šæ‰§è¡Œinitæ–¹æ³•ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051init (app: any /* Vue component instance */) &#123; // åœ¨åˆå§‹åŒ–Vue-Routerä¹‹å‰å¿…é¡»å…ˆé€šè¿‡Vue.use(VueRouter)æ³¨å†Œ process.env.NODE_ENV !== 'production' &amp;&amp; assert( install.installed, `not installed. Make sure to call \\`Vue.use(VueRouter)\\` ` + `before creating root instance.` ) // å­˜å‚¨appå®ä¾‹ this.apps.push(app) // set up app destroyed handler // https://github.com/vuejs/vue-router/issues/2639 app.$once('hook:destroyed', () =&gt; &#123; // clean out app from this.apps array once destroyed const index = this.apps.indexOf(app) if (index &gt; -1) this.apps.splice(index, 1) // ensure we still have a main app or null if no apps // we do not release the router so it can be reused if (this.app === app) this.app = this.apps[0] || null &#125;) // main app previously initialized // return as we don't need to set up new history listener if (this.app) &#123; return &#125; this.app = app const history = this.history // æ ¹æ®historyå®ç°çš„æ–¹å¼ä¸åŒæ‰§è¡Œä¸åŒçš„é€»è¾‘ if (history instanceof HTML5History) &#123; history.transitionTo(history.getCurrentLocation()) &#125; else if (history instanceof HashHistory) &#123; const setupHashListener = () =&gt; &#123; history.setupListeners() &#125; history.transitionTo( history.getCurrentLocation(), setupHashListener, setupHashListener ) &#125; // æ›´æ–°æ ¹ç»„ä»¶çš„è·¯ç”±å¯¹è±¡ history.listen(route =&gt; &#123; this.apps.forEach((app) =&gt; &#123; app._route = route &#125;) &#125;)&#125; initå…¶å®æ²¡å¹²å¾ˆå¤šäº‹æƒ…ï¼Œé¦–å…ˆæŠŠä¼ å…¥çš„Vueå®ä¾‹å­˜å‚¨åˆ°appsæ•°ç»„ä¸­ï¼Œç„¶åæŠŠthis.historyèµ‹å€¼ç»™ä¸€ä¸ªæœ¬åœ°å˜é‡ï¼Œæ ¹æ®this.historyå®ç°æ–¹å¼çš„ä¸åŒæ‰§è¡Œä¸åŒçš„é€»è¾‘ï¼Œæœ€åé€šè¿‡historyçš„å›è°ƒæ›´æ–°è·¯ç”±å¯¹è±¡ä¹Ÿå°±æ˜¯this.$routeã€‚ æ— è®ºthis.historyæ˜¯åŸºäºhistoryè¿˜æ˜¯hashå®ç°çš„ï¼Œæœ€åéƒ½ä¼šè°ƒç”¨transitionToæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å®šä¹‰åœ¨src/history/base.jsï¼š 12345transitionTo (location: RawLocation, onComplete?: Function, onAbort?: Function) &#123; const route = this.router.match(location, this.current) this.confirmTransition(route, () =&gt; &#123; // ... &#125; å®é™…ä¸Šå°±æ˜¯è°ƒç”¨matchæ–¹æ³•ï¼š 12345678match ( raw: RawLocation, current?: Route, redirectedFrom?: Location): Route &#123; return this.matcher.match(raw, current, redirectedFrom)&#125; é‚£æˆ‘ä»¬å¯ä»¥å…ˆæŠŠä¸Šé¢çš„é€»è¾‘æ”¾ä¸€è¾¹ï¼Œå…ˆäº†è§£ä¸€ä¸‹matchersçš„æ„å»ºï¼Œç›¸å…³çš„æºç åœ¨src/create-matcher.js: matchçš„å®ç°123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205/* @flow */import type VueRouter from './index'import &#123; resolvePath &#125; from './util/path'import &#123; assert, warn &#125; from './util/warn'import &#123; createRoute &#125; from './util/route'import &#123; fillParams &#125; from './util/params'import &#123; createRouteMap &#125; from './create-route-map'import &#123; normalizeLocation &#125; from './util/location'export type Matcher = &#123; match: (raw: RawLocation, current?: Route, redirectedFrom?: Location) =&gt; Route; addRoutes: (routes: Array&lt;RouteConfig&gt;) =&gt; void;&#125;;export function createMatcher ( routes: Array&lt;RouteConfig&gt;, router: VueRouter): Matcher &#123; const &#123; pathList, pathMap, nameMap &#125; = createRouteMap(routes) // æ·»åŠ è·¯ç”±è·¯å¾„å…³ç³»æ˜ å°„ function addRoutes (routes) &#123; createRouteMap(routes, pathList, pathMap, nameMap) &#125; function match ( raw: RawLocation, currentRoute?: Route, redirectedFrom?: Location ): Route &#123; // æ ¹æ®rawå’ŒcurrentRouteè®¡ç®—å‡ºæ–°çš„location const location = normalizeLocation(raw, currentRoute, false, router) const &#123; name &#125; = location if (name) &#123; // å¦‚æœæ˜¯å‘½åè·¯ç”±ï¼Œå–å‡ºå¯¹åº”çš„è·¯ç”±record const record = nameMap[name] if (process.env.NODE_ENV !== 'production') &#123; warn(record, `Route with name '$&#123;name&#125;' does not exist`) &#125; // ç”Ÿæˆä¸€æ¡æ–°è®°å½• if (!record) return _createRoute(null, location) const paramNames = record.regex.keys .filter(key =&gt; !key.optional) .map(key =&gt; key.name) if (typeof location.params !== 'object') &#123; location.params = &#123;&#125; &#125; // èµ‹å€¼params if (currentRoute &amp;&amp; typeof currentRoute.params === 'object') &#123; for (const key in currentRoute.params) &#123; if (!(key in location.params) &amp;&amp; paramNames.indexOf(key) &gt; -1) &#123; location.params[key] = currentRoute.params[key] &#125; &#125; &#125; if (record) &#123; location.path = fillParams(record.path, location.params, `named route \"$&#123;name&#125;\"`) return _createRoute(record, location, redirectedFrom) &#125; &#125; else if (location.path) &#123; location.params = &#123;&#125; for (let i = 0; i &lt; pathList.length; i++) &#123; const path = pathList[i] const record = pathMap[path] if (matchRoute(record.regex, location.path, location.params)) &#123; return _createRoute(record, location, redirectedFrom) &#125; &#125; &#125; // no match return _createRoute(null, location) &#125; function redirect ( record: RouteRecord, location: Location ): Route &#123; const originalRedirect = record.redirect let redirect = typeof originalRedirect === 'function' ? originalRedirect(createRoute(record, location, null, router)) : originalRedirect if (typeof redirect === 'string') &#123; redirect = &#123; path: redirect &#125; &#125; if (!redirect || typeof redirect !== 'object') &#123; if (process.env.NODE_ENV !== 'production') &#123; warn( false, `invalid redirect option: $&#123;JSON.stringify(redirect)&#125;` ) &#125; return _createRoute(null, location) &#125; const re: Object = redirect const &#123; name, path &#125; = re let &#123; query, hash, params &#125; = location query = re.hasOwnProperty('query') ? re.query : query hash = re.hasOwnProperty('hash') ? re.hash : hash params = re.hasOwnProperty('params') ? re.params : params if (name) &#123; // resolved named direct const targetRecord = nameMap[name] if (process.env.NODE_ENV !== 'production') &#123; assert(targetRecord, `redirect failed: named route \"$&#123;name&#125;\" not found.`) &#125; return match(&#123; _normalized: true, name, query, hash, params &#125;, undefined, location) &#125; else if (path) &#123; // 1. resolve relative redirect const rawPath = resolveRecordPath(path, record) // 2. resolve params const resolvedPath = fillParams(rawPath, params, `redirect route with path \"$&#123;rawPath&#125;\"`) // 3. rematch with existing query and hash return match(&#123; _normalized: true, path: resolvedPath, query, hash &#125;, undefined, location) &#125; else &#123; if (process.env.NODE_ENV !== 'production') &#123; warn(false, `invalid redirect option: $&#123;JSON.stringify(redirect)&#125;`) &#125; return _createRoute(null, location) &#125; &#125; function alias ( record: RouteRecord, location: Location, matchAs: string ): Route &#123; const aliasedPath = fillParams(matchAs, location.params, `aliased route with path \"$&#123;matchAs&#125;\"`) const aliasedMatch = match(&#123; _normalized: true, path: aliasedPath &#125;) if (aliasedMatch) &#123; const matched = aliasedMatch.matched const aliasedRecord = matched[matched.length - 1] location.params = aliasedMatch.params return _createRoute(aliasedRecord, location) &#125; return _createRoute(null, location) &#125; function _createRoute ( record: ?RouteRecord, location: Location, redirectedFrom?: Location ): Route &#123; if (record &amp;&amp; record.redirect) &#123; return redirect(record, redirectedFrom || location) &#125; if (record &amp;&amp; record.matchAs) &#123; return alias(record, location, record.matchAs) &#125; return createRoute(record, location, redirectedFrom, router) &#125; return &#123; match, addRoutes &#125;&#125;function matchRoute ( regex: RouteRegExp, path: string, params: Object): boolean &#123; const m = path.match(regex) if (!m) &#123; return false &#125; else if (!params) &#123; return true &#125; for (let i = 1, len = m.length; i &lt; len; ++i) &#123; const key = regex.keys[i - 1] const val = typeof m[i] === 'string' ? decodeURIComponent(m[i]) : m[i] if (key) &#123; // Fix #1994: using * with props: true generates a param named 0 params[key.name || 'pathMatch'] = val &#125; &#125; return true&#125;function resolveRecordPath (path: string, record: RouteRecord): string &#123; return resolvePath(path, record.parent ? record.parent.path : '/', true)&#125; createMatcheræ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯åˆå§‹åŒ–è·¯ç”±çš„é…ç½®å¯¹è±¡routesï¼Œç¬¬äºŒä¸ªæ˜¯æˆ‘ä»¬çš„è·¯ç”±å®ä¾‹routerï¼Œé¦–å…ˆä¼šè·‘ä¸€ä¸ªcreateRouteMapçš„é€»è¾‘ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ªè·¯ç”±æ˜ å°„ï¼Œè¿™ä¸ªæ–¹æ³•å®šä¹‰åœ¨src/create-route-map.jsï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179/* @flow */import Regexp from 'path-to-regexp'import &#123; cleanPath &#125; from './util/path'import &#123; assert, warn &#125; from './util/warn'export function createRouteMap ( routes: Array&lt;RouteConfig&gt;, oldPathList?: Array&lt;string&gt;, oldPathMap?: Dictionary&lt;RouteRecord&gt;, oldNameMap?: Dictionary&lt;RouteRecord&gt;): &#123; pathList: Array&lt;string&gt;; pathMap: Dictionary&lt;RouteRecord&gt;; nameMap: Dictionary&lt;RouteRecord&gt;;&#125; &#123; // the path list is used to control path matching priority const pathList: Array&lt;string&gt; = oldPathList || [] // $flow-disable-line const pathMap: Dictionary&lt;RouteRecord&gt; = oldPathMap || Object.create(null) // $flow-disable-line const nameMap: Dictionary&lt;RouteRecord&gt; = oldNameMap || Object.create(null) routes.forEach(route =&gt; &#123; addRouteRecord(pathList, pathMap, nameMap, route) &#125;) // ç¡®ä¿é€šé…ç¬¦çš„è·¯å¾„åœ¨æœ€åæ‰è¢«åŒ¹é… // ensure wildcard routes are always at the end for (let i = 0, l = pathList.length; i &lt; l; i++) &#123; if (pathList[i] === '*') &#123; pathList.push(pathList.splice(i, 1)[0]) l-- i-- &#125; &#125; return &#123; pathList, pathMap, nameMap &#125;&#125;function addRouteRecord ( pathList: Array&lt;string&gt;, pathMap: Dictionary&lt;RouteRecord&gt;, nameMap: Dictionary&lt;RouteRecord&gt;, route: RouteConfig, parent?: RouteRecord, matchAs?: string) &#123; const &#123; path, name &#125; = route if (process.env.NODE_ENV !== 'production') &#123; // pathä¸èƒ½ä¸ºç©ºå¹¶ä¸”componentçš„å€¼å¿…é¡»ç”¨ä¸€ä¸ªç»„ä»¶åè€Œä¸æ˜¯ä¸€ä¸ªstringå­—ç¬¦ä¸² assert(path != null, `\"path\" is required in a route configuration.`) assert( typeof route.component !== 'string', `route config \"component\" for path: $&#123;String(path || name)&#125; cannot be a ` + `string id. Use an actual component instead.` ) &#125; // pathToRegexpOptionsæ˜¯ç¼–è¯‘æ­£åˆ™çš„é€‰é¡¹ const pathToRegexpOptions: PathToRegexpOptions = route.pathToRegexpOptions || &#123;&#125; // normalize path const normalizedPath = normalizePath( path, parent, pathToRegexpOptions.strict ) // caseSensitiveåŒ¹é…è§„åˆ™æ˜¯å¦å¤§å°å†™æ•æ„Ÿï¼Ÿ(é»˜è®¤å€¼ï¼šfalse) if (typeof route.caseSensitive === 'boolean') &#123; pathToRegexpOptions.sensitive = route.caseSensitive &#125; const record: RouteRecord = &#123; path: normalizedPath, regex: compileRouteRegex(normalizedPath, pathToRegexpOptions), components: route.components || &#123; default: route.component &#125;, instances: &#123;&#125;, name, parent, matchAs, redirect: route.redirect, beforeEnter: route.beforeEnter, meta: route.meta || &#123;&#125;, props: route.props == null ? &#123;&#125; : route.components ? route.props : &#123; default: route.props &#125; &#125; // å¦‚æœæœ‰å­è·¯ç”± if (route.children) &#123; // Warn if route is named, does not redirect and has a default child route. // If users navigate to this route by name, the default child will // not be rendered (GH Issue #629) if (process.env.NODE_ENV !== 'production') &#123; if (route.name &amp;&amp; !route.redirect &amp;&amp; route.children.some(child =&gt; /^\\/?$/.test(child.path))) &#123; warn( false, `Named Route '$&#123;route.name&#125;' has a default child route. ` + `When navigating to this named route (:to=\"&#123;name: '$&#123;route.name&#125;'\"), ` + `the default child route will not be rendered. Remove the name from ` + `this route and use the name of the default child route for named ` + `links instead.` ) &#125; &#125; // å¾ªç¯æ·»åŠ å­è·¯ç”±è·¯å¾„ route.children.forEach(child =&gt; &#123; const childMatchAs = matchAs ? cleanPath(`$&#123;matchAs&#125;/$&#123;child.path&#125;`) : undefined addRouteRecord(pathList, pathMap, nameMap, child, record, childMatchAs) &#125;) &#125; // è®¾ç½®äº†è·¯ç”±åˆ«å if (route.alias !== undefined) &#123; // ç»Ÿä¸€è½¬æ¢ä¸ºæ•°ç»„ const aliases = Array.isArray(route.alias) ? route.alias : [route.alias] aliases.forEach(alias =&gt; &#123; const aliasRoute = &#123; path: alias, children: route.children &#125; addRouteRecord( pathList, pathMap, nameMap, aliasRoute, parent, record.path || '/' // matchAs ) &#125;) &#125; // æ·»åŠ pathè®°å½•ä»¥åŠå»ºç«‹pathå’Œè®°å½•çš„å¯¹åº”å…³ç³» if (!pathMap[record.path]) &#123; pathList.push(record.path) pathMap[record.path] = record &#125; // å¦‚æœé…ç½®äº†å‘½åè·¯ç”±ï¼Œç»™nameå’Œrecordå»ºç«‹æ˜ å°„å…³ç³» if (name) &#123; if (!nameMap[name]) &#123; nameMap[name] = record &#125; else if (process.env.NODE_ENV !== 'production' &amp;&amp; !matchAs) &#123; // å·²ç»æœ‰è¿™ä¸ªå‘½åçš„è·¯ç”±å­˜åœ¨å¹¶ä¸”æ²¡æœ‰ç»™è¿™ä¸ªè·¯ç”±è®¾ç½®é‡å®šå‘ï¼Œè¯´æ˜ç»™äº†é‡å¤å‘½å warn( false, `Duplicate named routes definition: ` + `&#123; name: \"$&#123;name&#125;\", path: \"$&#123;record.path&#125;\" &#125;` ) &#125; &#125;&#125;function compileRouteRegex (path: string, pathToRegexpOptions: PathToRegexpOptions): RouteRegExp &#123; const regex = Regexp(path, [], pathToRegexpOptions) if (process.env.NODE_ENV !== 'production') &#123; const keys: any = Object.create(null) regex.keys.forEach(key =&gt; &#123; // æœ‰é‡å¤çš„åŠ¨æ€è·¯å¾„å‚æ•° warn(!keys[key.name], `Duplicate param keys in route with path: \"$&#123;path&#125;\"`) keys[key.name] = true &#125;) &#125; return regex&#125;function normalizePath (path: string, parent?: RouteRecord, strict?: boolean): string &#123; // æ›¿æ¢æ ¹è·¯ç”±è·¯å¾„ if (!strict) path = path.replace(/\\/$/, '') if (path[0] === '/') return path if (parent == null) return path // å°†//çš„è·¯å¾„æ›¿æ¢æˆ/ return cleanPath(`$&#123;parent.path&#125;/$&#123;path&#125;`)&#125; è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯å°†è·¯ç”±é…ç½®è½¬æ¢æˆä¸€ç»„ç»„æ˜ å°„å…³ç³»è¡¨ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡: 12345return &#123; pathList, pathMap, nameMap&#125; å…¶ä¸­pathListå­˜å‚¨äº†æ‰€æœ‰çš„pathï¼ŒpathMapè¡¨ç¤ºäº†pathåˆ°RouteRecordå¯¹è±¡çš„ä¸€ä¸€æ˜ å°„å…³ç³»ï¼ŒnameMapåˆ™è¡¨ç¤ºäº†nameåˆ°RouteRecordå¯¹è±¡çš„æ˜ å°„å…³ç³»ï¼ŒRouteRecordå¯¹è±¡æ˜¯å¯¹è·¯ç”±é…ç½®å‚æ•°routesæ¯ä¸€é¡¹è¿›è¡Œéå†åè°ƒç”¨addRouteRecordæ–¹æ³•ç”Ÿæˆçš„ä¸€æ¡è®°å½•ï¼Œæ–¹æ³•å®šä¹‰å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114function addRouteRecord ( pathList: Array&lt;string&gt;, pathMap: Dictionary&lt;RouteRecord&gt;, nameMap: Dictionary&lt;RouteRecord&gt;, route: RouteConfig, parent?: RouteRecord, matchAs?: string) &#123; const &#123; path, name &#125; = route if (process.env.NODE_ENV !== 'production') &#123; // pathä¸èƒ½ä¸ºç©ºå¹¶ä¸”componentçš„å€¼å¿…é¡»ç”¨ä¸€ä¸ªç»„ä»¶åè€Œä¸æ˜¯ä¸€ä¸ªstringå­—ç¬¦ä¸² assert(path != null, `\"path\" is required in a route configuration.`) assert( typeof route.component !== 'string', `route config \"component\" for path: $&#123;String(path || name)&#125; cannot be a ` + `string id. Use an actual component instead.` ) &#125; // pathToRegexpOptionsæ˜¯ç¼–è¯‘æ­£åˆ™çš„é€‰é¡¹ const pathToRegexpOptions: PathToRegexpOptions = route.pathToRegexpOptions || &#123;&#125; // normalize path const normalizedPath = normalizePath( path, parent, pathToRegexpOptions.strict ) // caseSensitiveåŒ¹é…è§„åˆ™æ˜¯å¦å¤§å°å†™æ•æ„Ÿï¼Ÿ(é»˜è®¤å€¼ï¼šfalse) if (typeof route.caseSensitive === 'boolean') &#123; pathToRegexpOptions.sensitive = route.caseSensitive &#125; const record: RouteRecord = &#123; path: normalizedPath, regex: compileRouteRegex(normalizedPath, pathToRegexpOptions), components: route.components || &#123; default: route.component &#125;, instances: &#123;&#125;, name, parent, matchAs, redirect: route.redirect, beforeEnter: route.beforeEnter, meta: route.meta || &#123;&#125;, props: route.props == null ? &#123;&#125; : route.components ? route.props : &#123; default: route.props &#125; &#125; // å¦‚æœæœ‰å­è·¯ç”± if (route.children) &#123; // Warn if route is named, does not redirect and has a default child route. // If users navigate to this route by name, the default child will // not be rendered (GH Issue #629) if (process.env.NODE_ENV !== 'production') &#123; if (route.name &amp;&amp; !route.redirect &amp;&amp; route.children.some(child =&gt; /^\\/?$/.test(child.path))) &#123; warn( false, `Named Route '$&#123;route.name&#125;' has a default child route. ` + `When navigating to this named route (:to=\"&#123;name: '$&#123;route.name&#125;'\"), ` + `the default child route will not be rendered. Remove the name from ` + `this route and use the name of the default child route for named ` + `links instead.` ) &#125; &#125; // å¾ªç¯æ·»åŠ å­è·¯ç”±è·¯å¾„ route.children.forEach(child =&gt; &#123; const childMatchAs = matchAs ? cleanPath(`$&#123;matchAs&#125;/$&#123;child.path&#125;`) : undefined addRouteRecord(pathList, pathMap, nameMap, child, record, childMatchAs) &#125;) &#125; // è®¾ç½®äº†è·¯ç”±åˆ«å if (route.alias !== undefined) &#123; // ç»Ÿä¸€è½¬æ¢ä¸ºæ•°ç»„ const aliases = Array.isArray(route.alias) ? route.alias : [route.alias] aliases.forEach(alias =&gt; &#123; const aliasRoute = &#123; path: alias, children: route.children &#125; addRouteRecord( pathList, pathMap, nameMap, aliasRoute, parent, record.path || '/' // matchAs ) &#125;) &#125; // æ·»åŠ pathè®°å½•ä»¥åŠå»ºç«‹pathå’Œè®°å½•çš„å¯¹åº”å…³ç³» if (!pathMap[record.path]) &#123; pathList.push(record.path) pathMap[record.path] = record &#125; // å¦‚æœé…ç½®äº†å‘½åè·¯ç”±ï¼Œç»™nameå’Œrecordå»ºç«‹æ˜ å°„å…³ç³» if (name) &#123; if (!nameMap[name]) &#123; nameMap[name] = record &#125; else if (process.env.NODE_ENV !== 'production' &amp;&amp; !matchAs) &#123; // å·²ç»æœ‰è¿™ä¸ªå‘½åçš„è·¯ç”±å­˜åœ¨å¹¶ä¸”æ²¡æœ‰ç»™è¿™ä¸ªè·¯ç”±è®¾ç½®é‡å®šå‘ï¼Œè¯´æ˜ç»™äº†é‡å¤å‘½å warn( false, `Duplicate named routes definition: ` + `&#123; name: \"$&#123;name&#125;\", path: \"$&#123;record.path&#125;\" &#125;` ) &#125; &#125;&#125; è¿™ä¸ªæ–¹æ³•é¦–å…ˆä¼šå¯¹pathä½¿ç”¨normalizePathè¿›è¡Œè§„èŒƒåŒ–å¤„ç†ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•ï¼š 123456789function normalizePath (path: string, parent?: RouteRecord, strict?: boolean): string &#123; // æ›¿æ¢æ ¹è·¯ç”±è·¯å¾„ if (!strict) path = path.replace(/\\/$/, '') // è¯´æ˜æ˜¯ä¸€çº§è·¯å¾„ï¼Œç›´æ¥è¿”å› if (path[0] === '/') return path if (parent == null) return path // å°†//çš„è·¯å¾„æ›¿æ¢æˆ/å¹¶ä¸”æ‹¼æ¥çˆ¶è·¯ç”±çš„è·¯å¾„ return cleanPath(`$&#123;parent.path&#125;/$&#123;path&#125;`)&#125; ä¸»è¦ä½œç”¨å°±æ˜¯ç”Ÿæˆå¤šå±‚è·¯ç”±çš„å…·ä½“è·¯å¾„ï¼Œç„¶åæ ¹æ®å·²æœ‰å‚æ•°æ„å»ºRouteRecordï¼š 1234567891011121314151617const record: RouteRecord = &#123; path: normalizedPath, regex: compileRouteRegex(normalizedPath, pathToRegexpOptions), components: route.components || &#123; default: route.component &#125;, instances: &#123;&#125;, name, parent, matchAs, redirect: route.redirect, beforeEnter: route.beforeEnter, meta: route.meta || &#123;&#125;, props: route.props == null ? &#123;&#125; : route.components ? route.props : &#123; default: route.props &#125;&#125; è¿™é‡Œè§£é‡Šä¸‹regexè¿™ä¸ªå‚æ•°ï¼Œç”¨åˆ°äº†path-to-regexpè¿™ä¸ªåº“ï¼Œè¿™ä¸ªåº“å¯ä»¥æŠŠè·¯å¾„è½¬æ¢ä¸ºæ­£åˆ™è¡¨è¾¾å¼ï¼Œä¸¾ä¸ªæ —å­ï¼š 1234const keys = []const regexp = pathToRegexp('/foo/:bar', keys)// regexp = /^\\/foo\\/([^\\/]+?)\\/?$/i// keys = [&#123; name: 'bar', prefix: '/', delimiter: '/', optional: false, repeat: false, pattern: '[^\\\\/]+?' &#125;] ç”¨è¿™ä¸ªåº“ä½œä¸ºè·¯å¾„åŒ¹é…å¼•æ“æ˜¯ä¸ºäº†å®ç°å¯é€‰çš„åŠ¨æ€è·¯å¾„å‚æ•°ã€åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªã€ä¸€ä¸ªæˆ–å¤šä¸ªï¼Œç”šè‡³æ˜¯è‡ªå®šä¹‰æ­£åˆ™åŒ¹é…ã€‚ç´§æ¥ç€åˆ¤æ–­æ˜¯å¦é…ç½®äº†å­è·¯ç”±ï¼Œç„¶åå¾ªç¯è°ƒç”¨addRouteRecordè¿™ä¸ªæ–¹æ³•ï¼Œå¹¶æŠŠå½“å‰çš„recordä½œä¸ºparentï¼Œå¦‚æœè®¾ç½®äº†è·¯ç”±åˆ«åï¼Œä¹Ÿä¼šç»™åˆ«åæ·»åŠ ä¸€ä»½recordï¼Œæœ€åå°±æ˜¯æ›´æ–°æ˜ å°„è¡¨ï¼Œè¿”å›ä¸€ä¸ªArrayå¯¹è±¡ä»¥åŠä¸¤ä¸ªDictionaryå¯¹è±¡ã€‚ å›åˆ°create-matcher.jsï¼Œå®ƒå¯¹å¤–æš´éœ²äº†ä¸¤ä¸ªæ–¹æ³•ï¼šaddRouteså’Œmatchï¼Œåˆ†åˆ«ç”¨äºåŠ¨æ€æ·»åŠ è·¯ç”±é…ç½®ä»¥åŠè¿”å›ä¸€ä¸ªè·¯ç”±çš„è·¯å¾„ï¼Œå…ˆçœ‹addRoutesï¼š 123function addRoutes (routes) &#123; createRouteMap(routes, pathList, pathMap, nameMap) &#125; å…¶å®å°±æ˜¯åœ¨ç°æœ‰çš„pathListã€pathMapã€nameMapä¸ŠåŠ¨æ€æ·»åŠ ä¸€æ¡æ–°çºªå½•ï¼Œè¿™å‡ ä¸ªéƒ½æ˜¯å¼•ç”¨ç±»å‹ï¼Œæ‰§è¡ŒaddRoutesä¹‹åéƒ½ä¼šè¢«ä¿®æ”¹ã€‚ matchå‡½æ•°ç›¸å¯¹å¤æ‚ä¸€ç‚¹ï¼Œæ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥ä¸ºstringä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªLocationå¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºå½“å‰çš„è·¯ç”±è·¯å¾„ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¹Ÿæ˜¯Locationå¯¹è±¡ï¼Œè·Ÿé‡å®šå‘æœ‰å…³ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051function match ( raw: RawLocation, currentRoute?: Route, redirectedFrom?: Location): Route &#123; // æ ¹æ®rawå’ŒcurrentRouteè®¡ç®—å‡ºæ–°çš„location const location = normalizeLocation(raw, currentRoute, false, router) const &#123; name &#125; = location if (name) &#123; // å¦‚æœæ˜¯å‘½åè·¯ç”±ï¼Œå–å‡ºå¯¹åº”çš„è·¯ç”±record const record = nameMap[name] if (process.env.NODE_ENV !== 'production') &#123; warn(record, `Route with name '$&#123;name&#125;' does not exist`) &#125; // ç”Ÿæˆä¸€æ¡æ–°è®°å½• if (!record) return _createRoute(null, location) const paramNames = record.regex.keys .filter(key =&gt; !key.optional) .map(key =&gt; key.name) if (typeof location.params !== 'object') &#123; location.params = &#123;&#125; &#125; // èµ‹å€¼params if (currentRoute &amp;&amp; typeof currentRoute.params === 'object') &#123; for (const key in currentRoute.params) &#123; if (!(key in location.params) &amp;&amp; paramNames.indexOf(key) &gt; -1) &#123; location.params[key] = currentRoute.params[key] &#125; &#125; &#125; if (record) &#123; location.path = fillParams(record.path, location.params, `named route \"$&#123;name&#125;\"`) return _createRoute(record, location, redirectedFrom) &#125; &#125; else if (location.path) &#123; location.params = &#123;&#125; for (let i = 0; i &lt; pathList.length; i++) &#123; const path = pathList[i] const record = pathMap[path] if (matchRoute(record.regex, location.path, location.params)) &#123; return _createRoute(record, location, redirectedFrom) &#125; &#125; &#125; // no match return _createRoute(null, location)&#125; ä¸€å¼€å§‹ä¼šæ‰§è¡ŒnormalizeLocationæ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„locationï¼Œçœ‹ä¸€çœ¼normalizeLocationçš„å®ç°ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061export function normalizeLocation ( raw: RawLocation, current: ?Route, append: ?boolean, router: ?VueRouter): Location &#123; let next: Location = typeof raw === 'string' ? &#123; path: raw &#125; : raw // named target if (next._normalized) &#123; // å·²ç»normalizedçš„ç›´æ¥è¿”å› return next &#125; else if (next.name) &#123; // å¦‚æœæ˜¯å‘½åè·¯ç”±ï¼Œè¿”å›ä¸€ä»½å¤‡ä»½ return extend(&#123;&#125;, raw) &#125; // relative params // æ²¡æœ‰pathï¼Œä½†æ˜¯æœ‰paramså’Œcurrent if (!next.path &amp;&amp; next.params &amp;&amp; current) &#123; next = extend(&#123;&#125;, next) next._normalized = true // æ‹¿åˆ°params const params: any = extend(extend(&#123;&#125;, current.params), next.params) if (current.name) &#123; next.name = current.name next.params = params &#125; else if (current.matched.length) &#123; const rawPath = current.matched[current.matched.length - 1].path // æ ¹æ®rawPathå’Œparamsè®¡ç®—å‡ºå½“å‰path next.path = fillParams(rawPath, params, `path $&#123;current.path&#125;`) &#125; else if (process.env.NODE_ENV !== 'production') &#123; warn(false, `relative params navigation requires a current route.`) &#125; return next &#125; // å°†pathæ‹†åˆ†æˆpathã€hashå’Œquery const parsedPath = parsePath(next.path || '') const basePath = (current &amp;&amp; current.path) || '/' // è¿”å›æœ€åæ‹¼æ¥å®Œæˆå¥½çš„è·¯å¾„ï¼Œappendç”¨äºåˆ¤æ–­æ˜¯å¦åœ¨å½“å‰ (ç›¸å¯¹) è·¯å¾„å‰æ·»åŠ åŸºè·¯å¾„ const path = parsedPath.path ? resolvePath(parsedPath.path, basePath, append || next.append) : basePath // è§£æquery parseQueryæ˜¯æä¾›è‡ªå®šä¹‰æŸ¥è¯¢å­—ç¬¦ä¸²çš„è§£æ/åè§£æå‡½æ•°ï¼Œç”¨äºè¦†ç›–é»˜è®¤è¡Œä¸º const query = resolveQuery( parsedPath.query, next.query, router &amp;&amp; router.options.parseQuery ) // è·¯ç”±çš„hashå€¼ let hash = next.hash || parsedPath.hash if (hash &amp;&amp; hash.charAt(0) !== '#') &#123; hash = `#$&#123;hash&#125;` &#125; return &#123; _normalized: true, path, query, hash &#125;&#125; è¿™ä¸ªæ–¹æ³•é¦–å…ˆä¼šåˆ¤æ–­å½“å‰çš„RawLocationæ˜¯å¦å·²ç»ç»è¿‡_normalizedå¤„ç†ï¼Œæ˜¯çš„è¯ç›´æ¥è¿”å›ï¼Œå¦åˆ™çš„è¯ç»§ç»­åˆ¤æ–­å½“å‰Locationæ˜¯å¦æœ‰nameå­—æ®µï¼Œæœ‰çš„è¯é€šè¿‡extendæ–¹æ³•æ‹·è´ä¸€ä»½rawå¯¹è±¡ç›´æ¥è¿”å›ï¼Œè¿™ä¸ªextendæ–¹æ³•çš„å®ç°å¾ˆç®€å•ï¼š 123456export function extend (a, b) &#123; for (const key in b) &#123; a[key] = b[key] &#125; return a&#125; å½“ä¸Šé¢çš„æƒ…å†µéƒ½ä¸æ»¡è¶³ï¼Œæ¥ç€è¿›å…¥ä¸‹ä¸€ä¸ªåˆ¤æ–­æ¡ä»¶ï¼Œå¦‚æœæœ‰å½“å‰Routeä¿¡æ¯ï¼Œæœ‰paramsä½†æ˜¯æ²¡æœ‰pathçš„æƒ…å†µï¼Œé¦–å…ˆä¼šè®¾ç½®_normalizedæ ‡å¿—ä½ï¼Œç„¶åå¯¹paramså‚æ•°è¿›è¡Œåˆå¹¶å¤„ç†ï¼Œç„¶åç»§ç»­åˆ†ä¸ºä¸¤ç§æƒ…å†µå¤„ç†ï¼Œåˆ†åˆ«æ˜¯currentæœ‰nameä¸å¦ï¼Œå‰è€…çš„è¯ä¼šç›´æ¥å°†currentçš„nameå’Œæ‹¼æ¥åçš„paramsèµ‹å€¼ç»™nextåç›´æ¥è¿”å›ï¼Œåè€…çš„è¯ä¼šä»è·¯ç”±è®°å½•é‡Œé¢æ‰¾åˆ°æœ€æ–°çš„ä¸€æ¡è®°å½•çš„pathï¼Œè°ƒç”¨fillParamsæ–¹æ³•æ ¹æ®rawPathå’Œparamsè®¡ç®—å½“å‰pathï¼Œçœ‹ä¸€ä¸‹fillParamså¯¹ç›¸å¯¹è·¯å¾„çš„å¤„ç†ï¼š 1234567891011121314151617181920212223242526272829303132333435/* @flow */import &#123; warn &#125; from './warn'import Regexp from 'path-to-regexp'// $flow-disable-lineconst regexpCompileCache: &#123; [key: string]: Function&#125; = Object.create(null)export function fillParams ( path: string, params: ?Object, routeMsg: string): string &#123; params = params || &#123;&#125; try &#123; const filler = regexpCompileCache[path] || (regexpCompileCache[path] = Regexp.compile(path)) // å¦‚æœparamä¸­æœ‰åä¸ºpathMatchçš„keyå°†ä»–è®¾ç½®ä¸º&#123;0, params[patchMatch]&#125;çš„é”®å€¼å¯¹ // Fix #2505 resolving asterisk routes &#123; name: 'not-found', params: &#123; pathMatch: '/not-found' &#125;&#125; if (params.pathMatch) params[0] = params.pathMatch // å°†åŠ¨æ€è·¯å¾„å‚æ•°æ›¿æ¢æˆæ­£å¼å‚æ•° return filler(params, &#123; pretty: true &#125;) &#125; catch (e) &#123; if (process.env.NODE_ENV !== 'production') &#123; warn(false, `missing param for $&#123;routeMsg&#125;: $&#123;e.message&#125;`) &#125; return '' &#125; finally &#123; // delete the 0 if it was added delete params[0] &#125;&#125; å…¶å®è¿™é‡Œå°±æ˜¯æŠŠå½¢å¦‚{zapId: 1}çš„paramså‚æ•°é€šè¿‡Regexp.compileç”Ÿæˆçš„æ–¹æ³•æ‹¼æ¥åˆ°pathåé¢ï¼Œå°±åƒè¿™æ ·ï¼š 123const toPath = pathToRegexp.compile('/user/:id')toPath(&#123; id: 123 &#125;) //=&gt; \"/user/123\" å›åˆ°create-matcher.jsï¼Œè®¡ç®—å‡ºæ–°çš„locationä¹‹åå¯¹å‘½åè·¯ç”±å’Œéå‘½åè·¯ç”±è¿›è¡Œäº†ä¸åŒçš„å¤„ç†ï¼Œå¦‚æœnameå­˜åœ¨ï¼Œä»nameMapå­—å…¸é‡Œé¢åŒ¹é…å‡ºå¯¹åº”çš„recordï¼Œå¦‚æœrecordä¸å­˜åœ¨é€šè¿‡_createRouteç”Ÿæˆä¸€æ¡æ–°çš„recordç›´æ¥è¿”å›ï¼Œå¦åˆ™å–å‡ºè¿™æ¡recordé‡Œé¢çš„paramsçš„keyç»„æˆçš„æ•°ç»„ï¼Œå°†currentRouteé‡Œé¢çš„paramsä»¥key/valueçš„å½¢å¼ä¸é‡å¤åœ°å­˜å…¥åä¸ºlocation.paramsçš„ä¸€ä¸ªå¯¹è±¡é‡Œé¢ï¼Œæœ€åä¾ç„¶æ˜¯é€šè¿‡fillParamsæ‹¼æ¥paramså‚æ•°åˆ°è·¯å¾„å°¾éƒ¨ï¼Œé€šè¿‡_createRouteæ–¹æ³•åˆ›å»ºä¸€æ¡æ–°è·¯å¾„è¿”å›ã€‚ åä¹‹ï¼Œå¦‚æœæ˜¯éå‘½åè·¯ç”±ï¼Œä¼šé€šè¿‡pathListè¿”å›pathå¯¹åº”çš„recordï¼Œç„¶åé€šè¿‡createRouteæ–¹æ³•åˆ¤æ–­æ˜¯å¦èƒ½å¤ŸåŒ¹é…åˆ°è·¯ç”±ä¿¡æ¯ï¼Œæ˜¯çš„è¯ä¹Ÿä¼šé€šè¿‡_createRouteç”Ÿæˆä¸€æ¡æ–°è·¯å¾„è¿”å›ã€‚æ¥ä¸‹æ¥åªè¦ææ‡‚matchRouteå’Œ_createRouteå¹²äº†ä»€ä¹ˆå°±è¡Œäº†ï¼Œå…ˆçœ‹matchRouteï¼š 123456789101112131415161718192021222324function matchRoute ( regex: RouteRegExp, path: string, params: Object): boolean &#123; const m = path.match(regex) if (!m) &#123; return false &#125; else if (!params) &#123; return true &#125; for (let i = 1, len = m.length; i &lt; len; ++i) &#123; const key = regex.keys[i - 1] const val = typeof m[i] === 'string' ? decodeURIComponent(m[i]) : m[i] if (key) &#123; // Fix #1994: using * with props: true generates a param named 0 params[key.name || 'pathMatch'] = val &#125; &#125; return true&#125; å…¶å®å°±æ˜¯é€šè¿‡matchæ–¹æ³•åšåˆ¤æ–­ï¼Œå¦‚æœæ²¡åŒ¹é…åˆ°ç›´æ¥è¿”å›falseï¼Œå¦‚æœä¼ å…¥äº†paramsä¼šå°†pathé‡Œé¢çš„paramsä»¥key/valueå½¢å¼å­˜å…¥ï¼Œè¿™ä¸ªä¼ å…¥çš„paramsåœ¨è¿™é‡Œæ˜¯location.paramsæ‰€ä»¥å’Œå‰é¢åšçš„æ˜¯ä¸€æ ·çš„æ“ä½œã€‚ æ¥ç€çœ‹_createRouteæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿåœ¨create_matcher.jså†…éƒ¨ï¼š 1234567891011121314function _createRoute ( record: ?RouteRecord, location: Location, redirectedFrom?: Location): Route &#123; if (record &amp;&amp; record.redirect) &#123; return redirect(record, redirectedFrom || location) &#125; if (record &amp;&amp; record.matchAs) &#123; return alias(record, location, record.matchAs) &#125; return createRoute(record, location, redirectedFrom, router)&#125; æ— è®ºæ˜¯å¦è®¾ç½®äº†redirectè¿˜æ˜¯aliasæœ€åéƒ½ä¼šé‡æ–°è°ƒç”¨_createRouteï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥çœ‹æœ€åçš„createRouteæ–¹æ³•ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133/* @flow */import type VueRouter from '../index'import &#123; stringifyQuery &#125; from './query'const trailingSlashRE = /\\/?$/export function createRoute ( record: ?RouteRecord, location: Location, redirectedFrom?: ?Location, router?: VueRouter): Route &#123; // æä¾›è‡ªå®šä¹‰æŸ¥è¯¢å­—ç¬¦ä¸²çš„è§£æ/åè§£æå‡½æ•°ã€‚è¦†ç›–é»˜è®¤è¡Œä¸º const stringifyQuery = router &amp;&amp; router.options.stringifyQuery let query: any = location.query || &#123;&#125; try &#123; query = clone(query) &#125; catch (e) &#123;&#125; const route: Route = &#123; name: location.name || (record &amp;&amp; record.name), meta: (record &amp;&amp; record.meta) || &#123;&#125;, path: location.path || '/', hash: location.hash || '', query, params: location.params || &#123;&#125;, fullPath: getFullPath(location, stringifyQuery), // å®Œæ•´è·¯å¾„ matched: record ? formatMatch(record) : [] &#125; if (redirectedFrom) &#123; route.redirectedFrom = getFullPath(redirectedFrom, stringifyQuery) &#125; return Object.freeze(route)&#125;function clone (value) &#123; if (Array.isArray(value)) &#123; return value.map(clone) &#125; else if (value &amp;&amp; typeof value === 'object') &#123; const res = &#123;&#125; for (const key in value) &#123; res[key] = clone(value[key]) &#125; return res &#125; else &#123; return value &#125;&#125;// the starting route that represents the initial stateexport const START = createRoute(null, &#123; path: '/'&#125;)function formatMatch (record: ?RouteRecord): Array&lt;RouteRecord&gt; &#123; const res = [] while (record) &#123; res.unshift(record) record = record.parent &#125; return res&#125;function getFullPath ( &#123; path, query = &#123;&#125;, hash = '' &#125;, _stringifyQuery): string &#123; const stringify = _stringifyQuery || stringifyQuery return (path || '/') + stringify(query) + hash&#125;export function isSameRoute (a: Route, b: ?Route): boolean &#123; if (b === START) &#123; return a === b &#125; else if (!b) &#123; return false &#125; else if (a.path &amp;&amp; b.path) &#123; return ( a.path.replace(trailingSlashRE, '') === b.path.replace(trailingSlashRE, '') &amp;&amp; a.hash === b.hash &amp;&amp; isObjectEqual(a.query, b.query) ) &#125; else if (a.name &amp;&amp; b.name) &#123; return ( a.name === b.name &amp;&amp; a.hash === b.hash &amp;&amp; isObjectEqual(a.query, b.query) &amp;&amp; isObjectEqual(a.params, b.params) ) &#125; else &#123; return false &#125;&#125;function isObjectEqual (a = &#123;&#125;, b = &#123;&#125;): boolean &#123; // handle null value #1566 if (!a || !b) return a === b const aKeys = Object.keys(a) const bKeys = Object.keys(b) if (aKeys.length !== bKeys.length) &#123; return false &#125; return aKeys.every(key =&gt; &#123; const aVal = a[key] const bVal = b[key] // check nested equality if (typeof aVal === 'object' &amp;&amp; typeof bVal === 'object') &#123; return isObjectEqual(aVal, bVal) &#125; return String(aVal) === String(bVal) &#125;)&#125;export function isIncludedRoute (current: Route, target: Route): boolean &#123; return ( current.path.replace(trailingSlashRE, '/').indexOf( target.path.replace(trailingSlashRE, '/') ) === 0 &amp;&amp; (!target.hash || current.hash === target.hash) &amp;&amp; queryIncludes(current.query, target.query) )&#125;function queryIncludes (current: Dictionary&lt;string&gt;, target: Dictionary&lt;string&gt;): boolean &#123; for (const key in target) &#123; if (!(key in current)) &#123; return false &#125; &#125; return true&#125; é€šè¿‡ä¼ å…¥çš„recordå’Œlocationåˆ›å»ºä¸€ä¸ªä¸å¯è¢«ä¿®æ”¹çš„Routeå¯¹è±¡ï¼Œå…¶ä¸­æœ‰ä¸ªmatchedå±æ€§é€šè¿‡formatMatchæ–¹æ³•æ„å»ºï¼š 12345678function formatMatch (record: ?RouteRecord): Array&lt;RouteRecord&gt; &#123; const res = [] while (record) &#123; res.unshift(record) record = record.parent &#125; return res&#125; é€šè¿‡å¾ªç¯ä¸æ–­åœ°æŸ¥æ‰¾å½“å‰recordçš„parentï¼Œç„¶åè¿”å›è¿™æ¡çº¿ä¸Šæ‰€æœ‰çš„recordç»„æˆçš„æ•°ç»„ã€‚ è·¯ç”±çš„è·³è½¬æ— è®ºæ˜¯Hashè·¯ç”±è¿˜æ˜¯Historyè·¯ç”±ï¼Œåœ¨åˆå§‹åŒ–çš„æ—¶å€™éƒ½ä¼šé€šè¿‡transitionToæ–¹æ³•è·³è½¬åˆ°åˆå§‹è·¯å¾„ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯æˆ‘ä»¬åˆ‡æ¢è·¯ç”±è·¯å¾„æ—¶å€™ä½¿ç”¨çš„æ–¹æ³•ï¼Œä¸‹é¢åˆ†æä¸€ä¸‹è¯¥æ–¹æ³•çš„å®ç°è¿‡ç¨‹ï¼š 12345678910111213141516171819202122232425transitionTo (location: RawLocation, onComplete?: Function, onAbort?: Function) &#123; // é€šè¿‡locationå’Œcurrentè¿”å›åˆå§‹åŒ–Routeä¿¡æ¯ const route = this.router.match(location, this.current) this.confirmTransition(route, () =&gt; &#123; this.updateRoute(route) // æ‰§è¡ŒonCompleteå›è°ƒ onComplete &amp;&amp; onComplete(route) this.ensureURL() // fire ready cbs once if (!this.ready) &#123; this.ready = true this.readyCbs.forEach(cb =&gt; &#123; cb(route) &#125;) &#125; &#125;, err =&gt; &#123; // å¦‚æœè·³è½¬è¢«ç»ˆæ­¢ if (onAbort) &#123; onAbort(err) &#125; if (err &amp;&amp; !this.ready) &#123; this.ready = true this.readyErrorCbs.forEach(cb =&gt; &#123; cb(err) &#125;) &#125; &#125;) &#125; åˆå§‹åŒ–è°ƒç”¨çš„æ—¶å€™ï¼Œæ‹¿åˆ°çš„æ˜¯åˆå§‹åŒ–çš„Routeï¼Œé€šè¿‡confirmTransitionæ–¹æ³•è¿›è¡Œå®é™…çš„è·³è½¬æ“ä½œï¼ŒåŒæ—¶å¯¹è·³è½¬æˆåŠŸå’Œå¤±è´¥ä¸¤ç§æƒ…å†µéƒ½è®¾ç½®äº†å›è°ƒå‡½æ•°ï¼Œçœ‹ä¸€ä¸‹è¿™ä¸ªå‡½æ•°çš„å®šä¹‰ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105confirmTransition (route: Route, onComplete: Function, onAbort?: Function) &#123; const current = this.current const abort = err =&gt; &#123; if (isError(err)) &#123; // å°†æ‰€æœ‰çš„é”™è¯¯ä¿¡æ¯éƒ½å­˜å…¥errorCbs if (this.errorCbs.length) &#123; this.errorCbs.forEach(cb =&gt; &#123; cb(err) &#125;) &#125; else &#123; warn(false, 'uncaught error during route navigation:') console.error(err) &#125; &#125; onAbort &amp;&amp; onAbort(err) &#125; if ( // å¦‚æœæ˜¯åŒä¸€ä¸ªè·¯ç”±è·¯å¾„ isSameRoute(route, current) &amp;&amp; // in the case the route map has been dynamically appended to route.matched.length === current.matched.length ) &#123; // ensureURLåœ¨ä¸åŒçš„è·¯ç”±å®ç°æ–¹å¼é‡Œé¢è¯¥æ–¹æ³•çš„å®ç°ä¸ä¸€æ · this.ensureURL() // å¦‚æœè®¾ç½®äº†abortæ–¹æ³•è¿™é‡Œç›´æ¥è°ƒç”¨ return abort() &#125; // æ‹¿åˆ°è·¯å¾„çš„å˜åŒ–éƒ¨åˆ†ä»¥åŠé—å¼ƒéƒ¨åˆ†å’Œå‡çº§éƒ¨åˆ† const &#123; updated, deactivated, activated &#125; = resolveQueue(this.current.matched, route.matched) // ç»´æŒä¸€ä¸ªå¯¹åº”è·¯å¾„å˜åŒ–çš„å¯¼èˆªå®ˆå«çš„é’©å­ç»„æˆçš„List const queue: Array&lt;?NavigationGuard&gt; = [].concat( // in-component leave guards extractLeaveGuards(deactivated), // global before hooks this.router.beforeHooks, // in-component update hooks extractUpdateHooks(updated), // in-config enter guards activated.map(m =&gt; m.beforeEnter), // async components resolveAsyncComponents(activated) ) this.pending = route // å®šä¹‰ä¸€ä¸ªè¿­ä»£å™¨ const iterator = (hook: NavigationGuard, next) =&gt; &#123; if (this.pending !== route) &#123; return abort() &#125; try &#123; hook(route, current, (to: any) =&gt; &#123; if (to === false || isError(to)) &#123; // next(false) -&gt; abort navigation, ensure current URL this.ensureURL(true) abort(to) &#125; else if ( typeof to === 'string' || (typeof to === 'object' &amp;&amp; ( typeof to.path === 'string' || typeof to.name === 'string' )) ) &#123; // next('/') or next(&#123; path: '/' &#125;) -&gt; redirect abort() if (typeof to === 'object' &amp;&amp; to.replace) &#123; this.replace(to) &#125; else &#123; this.push(to) &#125; &#125; else &#123; // ç¡®è®¤è·³è½¬ï¼Œæ‰§è¡Œå›è°ƒ // confirm transition and pass on the value next(to) &#125; &#125;) &#125; catch (e) &#123; abort(e) &#125; &#125; runQueue(queue, iterator, () =&gt; &#123; const postEnterCbs = [] const isValid = () =&gt; this.current === route // wait until async components are resolved before // extracting in-component enter guards // æ‰§è¡ŒbeforeRouteEnteré’©å­å‡½æ•° const enterGuards = extractEnterGuards(activated, postEnterCbs, isValid) const queue = enterGuards.concat(this.router.resolveHooks) runQueue(queue, iterator, () =&gt; &#123; if (this.pending !== route) &#123; return abort() &#125; this.pending = null onComplete(route) if (this.router.app) &#123; this.router.app.$nextTick(() =&gt; &#123; postEnterCbs.forEach(cb =&gt; &#123; cb() &#125;) &#125;) &#125; &#125;) &#125;)&#125; é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªabortå‡½æ•°ç”¨äºå¤„ç†è·¯ç”±è·³è½¬å¤±è´¥çš„æƒ…å†µä»¥åŠæ‰§è¡ŒonAbortå›è°ƒï¼Œç„¶ååˆ¤æ–­å¦‚æœè¦è·³è½¬çš„è·¯ç”±å’Œå½“å‰è·¯ç”±æ˜¯åŒä¸€ä¸ªçš„è¯ï¼Œç›´æ¥è°ƒç”¨this.ensureURL()å’Œabort()ï¼Œè¿™ä¸ªensureURLåœ¨ä¸åŒçš„è·¯ç”±å®ç°æ–¹å¼é‡Œé¢è¯¥æ–¹æ³•çš„å®ç°ä¸ä¸€æ ·ï¼Œæœ€ç»ˆéƒ½æ˜¯åšäº†è·¯ç”±è·³è½¬çš„æ“ä½œï¼Œç´§æ¥ç€é€šè¿‡resolveQueueæ–¹æ³•æ‹¿åˆ°ä¸‰ä¸ªæ•°ç»„ï¼Œåˆ†åˆ«å­˜å‚¨ç€å›ºå®šçš„éƒ¨åˆ†ï¼Œé—å¼ƒçš„éƒ¨åˆ†ä»¥åŠæ›´æ–°çš„éƒ¨åˆ†ï¼Œè¿™ä¸ªæ–¹æ³•çš„å®ç°å¦‚ä¸‹ï¼š 123456789101112131415161718192021function resolveQueue ( current: Array&lt;RouteRecord&gt;, next: Array&lt;RouteRecord&gt;): &#123; updated: Array&lt;RouteRecord&gt;, activated: Array&lt;RouteRecord&gt;, deactivated: Array&lt;RouteRecord&gt;&#125; &#123; let i const max = Math.max(current.length, next.length) for (i = 0; i &lt; max; i++) &#123; if (current[i] !== next[i]) &#123; break &#125; &#125; return &#123; updated: next.slice(0, i), activated: next.slice(i), deactivated: current.slice(i) &#125;&#125; è·¯ç”±ä»currentå˜ä¸ºnextï¼Œä¸¤ä¸ªè·¯å¾„çš„å…¬å…±éƒ¨åˆ†å°±æ˜¯next.slice(0, i)ï¼Œnext.slice(0, i)å°±æ˜¯è·¯å¾„éœ€è¦æ›´æ–°çš„éƒ¨åˆ†ï¼Œè€Œcurrent.slice(i)å°±æ˜¯è·¯å¾„éœ€è¦å˜åŒ–çš„éƒ¨åˆ†ã€‚ æ‹¿åˆ°ä¸‰ä¸ªæ•°ç»„ä¹‹åä¼šæ„é€ ä¸€ä¸ªqueueé˜Ÿåˆ—ï¼Œé‡Œé¢å­˜å‚¨äº†è·¯å¾„å˜åŒ–è¦æ‰§è¡Œçš„é’©å­å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å®˜æ–¹è¯´çš„è·¯ç”±å®ˆå«ï¼Œä¼šæŒ‰æ¬¡åºæ‰§è¡Œä¸€äº›è¯¸å¦‚beforeRouteLeaveã€beforeRouteUpdateç­‰æ–¹æ³•ï¼Œä¸‹é¢è¿˜ä¼šå®šä¹‰ä¸€ä¸ªè¿­ä»£å™¨ï¼Œè¿™ä¸ªè¿­ä»£å™¨ä¼šæ ¹æ®ä¼ å…¥çš„roå‚æ•°æ¥å†³å®šæ‰§è¡Œabortè¿˜æ˜¯nextæ–¹æ³•ï¼Œæœ€åæ‰§è¡ŒrunQueueæ–¹æ³•æ¥æ‰§è¡Œè¿™ä¸ªé˜Ÿåˆ—ï¼Œè¿™ä¸ªæ–¹æ³•çš„å®šä¹‰å¦‚ä¸‹ï¼š 12345678910111213141516export function runQueue (queue: Array&lt;?NavigationGuard&gt;, fn: Function, cb: Function) &#123; const step = index =&gt; &#123; if (index &gt;= queue.length) &#123; cb() &#125; else &#123; if (queue[index]) &#123; fn(queue[index], () =&gt; &#123; step(index + 1) &#125;) &#125; else &#123; step(index + 1) &#125; &#125; &#125; step(0)&#125; è¿™é‡Œçš„fnå…¶å®å°±æ˜¯iteratoré‡Œé¢çš„nextå‡½æ•°ï¼Œåªæœ‰æ‰§è¡Œäº†nextå‡½æ•°indexæ‰ä¼š+1ï¼Œæ‰ä¼šè¿›è¡Œç®¡é“ä¸­çš„ä¸‹ä¸€ä¸ªé’©å­ï¼Œå¦‚æœå…¨éƒ¨é’©å­æ‰§è¡Œå®Œäº†ï¼Œåˆ™å¯¼èˆªçš„çŠ¶æ€ä¼šå˜æˆconfirmed(ç¡®è®¤çš„)ã€‚ æœ€åå¯ä»¥çœ‹ä¸€ä¸‹Vue-Routeré‡Œé¢å¯¹å¯¼èˆªçš„å®Œæ•´è§£ææµç¨‹ï¼š å¯¼èˆªè¢«è§¦å‘ã€‚åœ¨å¤±æ´»çš„ç»„ä»¶é‡Œè°ƒç”¨ç¦»å¼€å®ˆå«ã€‚è°ƒç”¨å…¨å±€çš„ beforeEach å®ˆå«ã€‚åœ¨é‡ç”¨çš„ç»„ä»¶é‡Œè°ƒç”¨ beforeRouteUpdate å®ˆå« (2.2+)ã€‚åœ¨è·¯ç”±é…ç½®é‡Œè°ƒç”¨ beforeEnterã€‚è§£æå¼‚æ­¥è·¯ç”±ç»„ä»¶ã€‚åœ¨è¢«æ¿€æ´»çš„ç»„ä»¶é‡Œè°ƒç”¨ beforeRouteEnterã€‚è°ƒç”¨å…¨å±€çš„ beforeResolve å®ˆå« (2.5+)ã€‚å¯¼èˆªè¢«ç¡®è®¤ã€‚è°ƒç”¨å…¨å±€çš„ afterEach é’©å­ã€‚è§¦å‘ DOM æ›´æ–°ã€‚ç”¨åˆ›å»ºå¥½çš„å®ä¾‹è°ƒç”¨ beforeRouteEnter å®ˆå«ä¸­ä¼ ç»™ next çš„å›è°ƒå‡½æ•°ã€‚ æ€»ç»“ä¼ ç»Ÿçš„è·¯ç”±å®ç°æ˜¯é€šè¿‡å¯¹è·¯å¾„çš„åˆ‡æ¢åšåˆ°çš„ï¼Œå¯¹äºVue-Routerè€Œè¨€ï¼Œè·¯ç”±æ¨¡å—çš„æœ¬è´¨ å°±æ˜¯å»ºç«‹èµ·urlå’Œé¡µé¢ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚è·¯ç”±å§‹ç»ˆä¼šç»´æŠ¤å½“å‰çš„çº¿è·¯ï¼Œè·¯ç”±åˆ‡æ¢çš„æ—¶å€™ä¼šæŠŠå½“å‰çº¿è·¯åˆ‡æ¢åˆ°ç›®æ ‡çº¿è·¯ï¼Œåˆ‡æ¢è¿‡ç¨‹ä¸­ä¼šæ‰§è¡Œä¸€ç³»åˆ—çš„å¯¼èˆªå®ˆå«é’©å­å‡½æ•°ï¼Œä¼šæ›´æ”¹urlï¼ŒåŒæ ·ä¹Ÿä¼šæ¸²æŸ“å¯¹åº”çš„ç»„ä»¶ï¼Œåˆ‡æ¢å®Œæ¯•åä¼šæŠŠç›®æ ‡çº¿è·¯æ›´æ–°æ›¿æ¢å½“å‰çº¿è·¯ï¼Œè¿™æ ·å°±ä¼šä½œä¸ºä¸‹ä¸€æ¬¡çš„è·¯å¾„åˆ‡æ¢çš„ä¾æ®. å‚è€ƒé“¾æ¥ï¼šVueæ ¸å¿ƒè§£å¯†","tags":[{"name":"javascript","slug":"javascript","permalink":"https://www.limuyang.cc/tags/javascript/"},{"name":"vue-router","slug":"vue-router","permalink":"https://www.limuyang.cc/tags/vue-router/"},{"name":"æºç é˜…è¯»","slug":"æºç é˜…è¯»","permalink":"https://www.limuyang.cc/tags/æºç é˜…è¯»/"}]},{"title":"å®ç°ä¸€ä¸ªç¬¦åˆPromise/A+è§„èŒƒçš„Promise","date":"2019-04-23T23:16:48.000Z","path":"2019/04/23/å®ç°ä¸€ä¸ªç¬¦åˆPromise-A-è§„èŒƒçš„Promise/","text":"æ¦‚å¿µæ‰€è°“Promiseï¼Œç®€å•è¯´å°±æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œé‡Œé¢ä¿å­˜ç€æŸä¸ªæœªæ¥æ‰ä¼šç»“æŸçš„äº‹ä»¶ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼‰çš„ç»“æœã€‚ä»è¯­æ³•ä¸Šè¯´ï¼ŒPromise æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä»å®ƒå¯ä»¥è·å–å¼‚æ­¥æ“ä½œçš„æ¶ˆæ¯ã€‚Promise æä¾›ç»Ÿä¸€çš„ APIï¼Œå„ç§å¼‚æ­¥æ“ä½œéƒ½å¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚ ç®€æ˜“ç‰ˆPromiseçš„å®ç°åœ¨å®ç°ä¸€ä¸ªèƒ½é€šè¿‡Promise A+è§„èŒƒæµ‹è¯•çš„Promiseç‰ˆæœ¬ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå†™ä¸€ä¸ªç®€æ˜“ç‰ˆçš„Promiseï¼Œç»“åˆæˆ‘ä»¬å¹³å¸¸ä½¿ç”¨Promiseçš„å§¿åŠ¿ï¼š 123456789const promise = new Promise(function(resolve, reject) &#123; // ... some code if (/* å¼‚æ­¥æ“ä½œæˆåŠŸ */)&#123; resolve(value); &#125; else &#123; reject(error); &#125;&#125;); å¯¹ç…§Promise A+è§„èŒƒå¼€å§‹æ’¸ä»£ç ã€‚ 123451.1 â€œpromiseâ€ is an object or function with a then method whose behavior conforms to this specification.1.2 â€œthenableâ€ is an object or function that defines a then method.1.3 â€œvalueâ€ is any legal JavaScript value (including undefined, a thenable, or a promise).1.4 â€œexceptionâ€ is a value that is thrown using the throw statement.1.5 â€œreasonâ€ is a value that indicates why a promise was rejected. å…ˆå®ç°ä¸€ä¸ªPromiseçš„æ„é€ å‡½æ•°ï¼š 12345678function Promise(executor) &#123; let self = this self.status = 'pending' // ä¸€ä¸ªpromiseå¿…é¡»å¤„äºä¸‰ç§çŠ¶æ€ä¹‹ä¸€ï¼š è¯·æ±‚æ€ï¼ˆpendingï¼‰ï¼Œ å®Œæˆæ€ï¼ˆfulfilledï¼‰ï¼Œæ‹’ç»æ€ï¼ˆrejectedï¼‰ self.value = null self.onResolveCallbacks = [] // Promise resolveçš„æ—¶å€™å¯èƒ½ä¼šæœ‰å¤šä¸ªå›è°ƒ self.onRejectCallbacks = [] // åŒä¸Š executor(resolve, reject) // æ‰§è¡Œexecutor&#125; åœ¨æ„é€ å‡½æ•°å†…éƒ¨å…ˆä½¿ç”¨ä¸€ä¸ªå¸¸é‡selfï¼Œå½“å¼‚æ­¥æ‰§è¡Œçš„æ—¶å€™å¯ä»¥è·å–æ­£ç¡®çš„thiså¯¹è±¡ Promiseçš„åˆå§‹çŠ¶æ€åº”è¯¥æ˜¯pending valueå˜é‡ç”¨äºå­˜å‚¨resolveæˆ–è€…rejectçš„å€¼ï¼Œè¿™é‡Œå…¶å®åŒæ—¶è¡¨ç¤ºäº†è§„èŒƒä¸­çš„value/reason å½“æ‰§è¡Œå®ŒPromiseä¹‹åå½“å‰Promiseçš„statuså¯èƒ½è¿˜æ˜¯pendingï¼Œè¿™ä¸ªæ—¶å€™è¦æŠŠthenæ–¹æ³•ä¸­ä¼ å…¥çš„å›è°ƒå­˜å‚¨åˆ°å¯¹åº”çš„callBackList æˆ‘ä»¬çŸ¥é“Promiseæ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¿™ä¸ªå‡½æ•°æœ‰resolveå’Œrejectä¸¤ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œresolveå‡½æ•°å¯ä»¥å°†Promiseçš„çŠ¶æ€ä»pendingè½¬ä¸ºfulfilledï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œçš„ç»“æœä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ï¼Œrejectå‡½æ•°å¯ä»¥å°†Promiseçš„çŠ¶æ€ä»pendingè½¬ä¸ºrejectedï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œå¤±è´¥æŠ¥å‡ºçš„é”™è¯¯ä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ï¼Œä¸‹é¢æˆ‘ä»¬æ¥å®ç°è¿™ä¸¤ä¸ªå‡½æ•°ï¼š 1234567891011121314151617181920212223242526272829function Promise(executor) &#123; let self = this self.status = 'pending' self.value = null self.onResolveCallbacks = [] self.onRejectCallbacks = [] function resolve(value) &#123; if (self.status === 'pending') &#123; self.status = 'fulfilled' self.value = value self.onResolveCallbacks.forEach(cb =&gt; cb(self.value)) &#125; &#125; function reject(reason) &#123; if (self.status === 'pending') &#123; self.status = 'rejected' self.value = reason self.onRejectCallbacks.forEach(cb =&gt; cb(self.value)) &#125; &#125; try &#123; executor(resolve, reject) &#125; catch (e) &#123; reject(e) &#125;&#125; è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦è§£é‡Šçš„æ˜¯ï¼Œæ‰§è¡Œexecutoræœ‰å¯èƒ½ä¼šå‡ºé”™å°±åƒä¸‹é¢è¿™æ ·ï¼Œå¦‚æœå‡ºé”™äº†Promiseåº”è¯¥rejectè¿™ä¸ªå‡ºé”™çš„å€¼ï¼š 123new Promise(function(resolve, reject) &#123; throw 2&#125;) ä¸‹ä¸€æ­¥ï¼Œå®ç°é€»è¾‘è¾ƒä¸ºå¤æ‚çš„thenå‡½æ•°ï¼Œä¹Ÿæ˜¯æ•´ä¸ªPromiseçš„ç²¾é«“æ‰€åœ¨ï¼š 12345A promise must provide a then method to access its current or eventual value or reason.A promiseâ€™s then method accepts two arguments:promise.then(onFulfilled, onRejected) å› ä¸ºthenæ–¹æ³•å¯ä»¥é“¾å¼è°ƒç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠå®ƒæ„é€ åœ¨Promiseçš„åŸå‹é“¾ä¸Šï¼š 123Promise.prototype.then = function(onFulfilled, onRejected) &#123; // å†…éƒ¨å®ç°&#125; æ ¹æ®æ ‡å‡†2.2.1å’Œ2.2.7æˆ‘ä»¬å¯ä»¥å†™å‡ºå¦‚ä¸‹ä»£ç ï¼š 123456789101112131415Promise.prototype.then = function(onFulfilled, onRejected) &#123; let self = this onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : v =&gt; v // 2.2.1.1 onRejected = typeof onRejected === 'function' ? onRejected : r =&gt; &#123; throw r &#125; // 2.2.1.2 if (self.status === 'pending') &#123; self.onResolveCallbacks.push(onFulfilled) self.onRejectCallbacks.push(onRejected) &#125; else if (self.status === 'fulfilled') &#123; onFulfilled(self.value) &#125; else if (self.status === 'rejected') &#123; onRejected(self.value) &#125;&#125; ä¸ºäº†é€ä¼ æˆ‘ä»¬åœ¨onFulfilled/onRejectedä¸æ˜¯ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™ä¹Ÿåˆ›é€ äº†ä¸€ä¸ªå‡½æ•°è¿”å›å½“å‰onFulfilled/onRejectedçš„å€¼ï¼Œå½“statuså¤„äºpendingçŠ¶æ€ï¼Œæˆ‘ä»¬ä¸èƒ½ç¡®å®šè°ƒç”¨onFulfilledè¿˜æ˜¯onRejectedï¼Œåªæœ‰ç­‰çŠ¶æ€ç¡®å®šåæ‰å¯ä»¥å¤„ç†ï¼Œæ‰€ä»¥è¿™é‡ŒæŠŠä¸¤ä¸ªcallbackå­˜å…¥å›è°ƒæ•°ç»„é‡Œé¢ï¼Œå¦‚æœæ˜¯ç¡®å®šçŠ¶æ€åˆ™è°ƒç”¨å¯¹åº”çš„æ–¹æ³•å³å¯ï¼Œè¿™å°±æ˜¯æœ€ç®€æ˜“ç‰ˆæœ¬çš„Promiseï¼Œæ¥è¯•ä¸€ä¸‹ï¼š 1234567new Promise(function(resolve, reject) &#123; setTimeout(() =&gt; &#123; resolve(1) &#125;)&#125;).then((value) =&gt; &#123; console.log(value) // æ‰“å°ç»“æœ 1&#125;) å®ç°ä¸€ä¸ªç¬¦åˆPromise/A+è§„èŒƒçš„Promiseä»¥ä¸Šé¢çš„ç®€æ˜“ç‰ˆä¸ºåŸºç¡€ï¼Œç»§ç»­æ”¹é€ thenæ–¹æ³•ï¼Œè§„èŒƒä¸­æœ‰æåˆ°è¯´thenéœ€è¦è¿”å›ä¸€ä¸ªPromiseï¼Œè¿™ä¹Ÿæ˜¯å®ƒå¯ä»¥é“¾å¼æ“ä½œçš„å…³é”®æ‰€åœ¨ï¼š 123then must return a promise [3.3].promise2 = promise1.then(onFulfilled, onRejected); è™½ç„¶è¯´è§„èŒƒé‡Œé¢å…è®¸æˆ‘ä»¬è¿”å›åŒä¸€ä¸ªPromiseï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œéµå¾ªå¤§å¤šæ•°Promiseçš„å®ç°ç»™å®ƒè¿”å›ä¸€ä¸ªæ–°çš„Promiseï¼š 12345678910111213141516171819202122Promise.prototype.then = function(onFulfilled, onRejected) &#123; let self = this onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : v =&gt; v // 2.2.1.1 onRejected = typeof onRejected === 'function' ? onRejected : r =&gt; &#123; throw r &#125; // 2.2.1.2 let returnedPromise = null // 2.2.7 if (self.status === 'pending') &#123; return returnedPromise = new Promise((resolve, reject) =&gt; &#123; self.onResolveCallbacks.push(onFulfilled) self.onRejectCallbacks.push(onRejected) &#125;) &#125; else if (self.status === 'fulfilled') &#123; return returnedPromise = new Promise((resolve, reject) =&gt; &#123; onFulfilled(self.value) &#125;) &#125; else if (self.status === 'rejected') &#123; return returnedPromise = new Promise((resolve, reject) =&gt; &#123; onRejected(self.value) &#125;) &#125;&#125; æ ¹æ®è§„èŒƒçš„å®šä¹‰ï¼Œæˆ‘ä»¬è¿™é‡Œè¿˜éœ€è¦å®šä¹‰ä¸€ä¸ª[[Resolve]](promise2, x)è§£æå‡½æ•°ï¼Œè§£æonFulfilledæˆ–onRejectedçš„è¿”å›å€¼ï¼ŒåŒæ—¶å¯¹ä¸¤ä¸ªæ–¹æ³•æ‰§è¡ŒæœŸé—´æŠ›å‡ºçš„é”™è¯¯è¿›è¡Œrejectï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950Promise.prototype.then = function(onFulfilled, onRejected) &#123; let self = this onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : v =&gt; v // 2.2.1.1 onRejected = typeof onRejected === 'function' ? onRejected : r =&gt; &#123; throw r &#125; // 2.2.1.2 let returnedPromise = null // 2.2.7 if (self.status === 'pending') &#123; return returnedPromise = new Promise((resolve, reject) =&gt; &#123; self.onResolveCallbacks.push(() =&gt; &#123; try &#123; let x = onFulfilled(self.value) ResolutionProcedure(returnedPromise, x, resolve, reject) &#125; catch (e) &#123; reject(e) &#125; &#125;) self.onRejectCallbacks.push(() =&gt; &#123; try &#123; let x = onRejected(self.value) ResolutionProcedure(returnedPromise, x, resolve, reject) &#125; catch (e) &#123; reject(e) &#125; &#125;) &#125;) &#125; else if (self.status === 'fulfilled') &#123; return returnedPromise = new Promise((resolve, reject) =&gt; &#123; try &#123; let x = onFulfilled(self.value) ResolutionProcedure(returnedPromise, x, resolve, reject) &#125; catch (e) &#123; reject(e) &#125; &#125;) &#125; else if (self.status === 'rejected') &#123; return returnedPromise = new Promise((resolve, reject) =&gt; &#123; try &#123; let x = onRejected(self.value) ResolutionProcedure(returnedPromise, x, resolve, reject) &#125; catch (e) &#123; reject(e) &#125; &#125;) &#125;&#125;function ResolutionProcedure(promise, x, resolvePromise, rejectPromise) &#123; // å†…éƒ¨å®ç°&#125; æ¥ä¸‹æ¥åªéœ€è¦å…³æ³¨è¿™ä¸ªResolutionProcedureå‡½æ•°çš„å†…éƒ¨å®ç°ï¼Œè¿™é‡Œå…¶å®è§„èŒƒéƒ½ç»™å‡ºäº†æ‰€æœ‰çš„è¯¦ç»†æ­¥éª¤ï¼ŒæŒ‰ç…§è§„èŒƒæ¥åšå°±è¡Œï¼š 12345678910111213141516171819202122232425262728293031323334353637383940function ResolutionProcedure(promise, x, resolvePromise, rejectPromise) &#123; try &#123; if (promise === x) &#123; return rejectPromise(new TypeError('2.3.1')) &#125; if (x instanceof Promise) //2.3.2 x.then(((value)=&gt;&#123; ResolutionProcedure(promise, value, reslove, reject); &#125;,(reason)=&gt;&#123; reject(reason) &#125;)); let called = false // 2.3.3.3.3 if (x !== null &amp;&amp; (typeof x === 'object' || typeof x === 'function')) &#123; // 2.3.3 try &#123; // 2.3.3.1 let then = x.then if (typeof then === 'function') &#123; // 2.3.3.3 then.call(x, (value) =&gt; &#123; if (called) return called = true return ResolutionProcedure(promise, value, resolvePromise, rejectPromise) &#125;, (reason) =&gt; &#123; if (called) return called = true return rejectPromise(reason) &#125;) &#125; else &#123; return resolvePromise(x) // 2.3.4 &#125; &#125; catch (e) &#123; if (called) return called = true return rejectPromise(e) // 2.3.3.2 &#125; &#125; else &#123; return resolvePromise(x) // 2.3.3.4 &#125; &#125; catch (e) &#123; return rejectPromise(e) &#125;&#125; ç„¶åæˆ‘ä»¬æ³¨æ„åˆ°è§„èŒƒ2.2.4ä¸­è¯´äº†åªæœ‰åœ¨æ‰§è¡Œæ ˆåŒ…å«å¹³å°ä»£ç çš„æ—¶å€™æ‰å¯ä»¥è°ƒç”¨onFulfilledå’ŒonRejectedï¼š 1onFulfilled or onRejected must not be called until the execution context stack contains only platform code. è§£é‡Šæ–‡æ¡ˆä¸­ä¹Ÿè¯´äº†å…¶å®å°±æ˜¯å¼‚æ­¥æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥ç”¨setTimeoutæˆ–setImmediateæ¥åšåˆ°è¿™ä¸€ç‚¹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354Promise.prototype.then = function(onFulfilled, onRejected) &#123; let self = this onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : v =&gt; v // 2.2.1.1 onRejected = typeof onRejected === 'function' ? onRejected : r =&gt; &#123; throw r &#125; // 2.2.1.2 let returnedPromise = null // 2.2.7 if (self.status === 'pending') &#123; return returnedPromise = new Promise((resolve, reject) =&gt; &#123; self.onResolveCallbacks.push(() =&gt; &#123; setTimeout(() =&gt; &#123; try &#123; let x = onFulfilled(self.value) ResolutionProcedure(returnedPromise, x, resolve, reject) &#125; catch (e) &#123; reject(e) &#125; &#125;, 0) &#125;) self.onRejectCallbacks.push(() =&gt; &#123; setTimeout(() =&gt; &#123; try &#123; let x = onRejected(self.value) ResolutionProcedure(returnedPromise, x, resolve, reject) &#125; catch (e) &#123; reject(e) &#125; &#125;, 0) &#125;) &#125;) &#125; else if (self.status === 'fulfilled') &#123; return returnedPromise = new Promise((resolve, reject) =&gt; &#123; setTimeout(() =&gt; &#123; try &#123; let x = onFulfilled(self.value) ResolutionProcedure(returnedPromise, x, resolve, reject) &#125; catch (e) &#123; reject(e) &#125; &#125;, 0) &#125;) &#125; else if (self.status === 'rejected') &#123; return returnedPromise = new Promise((resolve, reject) =&gt; &#123; setTimeout(() =&gt; &#123; try &#123; let x = onRejected(self.value) ResolutionProcedure(returnedPromise, x, resolve, reject) &#125; catch (e) &#123; reject(e) &#125; &#125;, 0) &#125;) &#125;&#125; æµ‹è¯•è¿™é‡Œç”¨å®˜æ–¹æä¾›çš„promises-aplus-testsæ¥éªŒè¯æˆ‘ä»¬å†™å‡ºæ¥çš„åº“æ˜¯å¦ç¬¦åˆè§„èŒƒï¼Œä¸ºäº†è·‘æµ‹è¯•æˆ‘ä»¬è¿˜éœ€è¦åŠ ä¸Šdeferredæ–¹æ³•ï¼š 12345678910Promise.deferred = function() &#123; let defer = &#123;&#125; defer.promise = new Promise((resolve, reject) =&gt; &#123; defer.resolve = resolve defer.reject = reject &#125;) return defer&#125;module.exports = Promise è·‘ä¸€ä¸‹æµ‹è¯•ï¼š 123npm install -g promises-aplus-tests promises-aplus-tests ./promise.js è¯´æ˜æˆ‘ä»¬å†™çš„åº“æ˜¯ç¬¦åˆçš„Promise/A+æ ‡å‡†çš„ æ‰©å±•Promise/A+è§„èŒƒåªæ˜¯å®šä¹‰äº†thenæ–¹æ³•ï¼Œä½†æ˜¯Promiseæœ¬èº«è¿˜æœ‰ä¸€äº›å…¶ä»–çš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å®ç°ä¸€ä¸‹ï¼š catch 123Promise.prototype.catch = function(onRejected) &#123; return this.then(null, onRejected)&#125; race 1234567Promise.prototype.race = function(values) &#123; return new Promise(function(resolve, reject) &#123; for (let i = 0, len = values.length; i &lt; len; i++) &#123; values[i].then(resolve, reject) &#125; &#125;)&#125; all 1234567891011121314151617181920Promise.all = function(promises) &#123; return new Promise(function(resolve, reject) &#123; let resolvedCounter = 0 let promiseNum = promises.length let resolvedValues = new Array(promiseNum) for (let i = 0; i &lt; promiseNum; i++) &#123; (function(i) &#123; Promise.resolve(promises[i]).then(function(value) &#123; resolvedCounter++ resolvedValues[i] = value if (resolvedCounter === promiseNum) &#123; return resolve(resolvedValues) &#125; &#125;, function(reason) &#123; return reject(reason) &#125;) &#125;)(i) &#125; &#125;)&#125; finally 123456789101112131415Promise.prototype.finally = function(callback) &#123; let constructor = this.constructor return this.then( function(value) &#123; return constructor.resolve(callback()).then(function() &#123; return value &#125;) &#125;, function(reason) &#123; return constructor.resolve(callback()).then(function() &#123; return constructor.reject(reason) &#125;) &#125; )&#125; æœ€åå¥‰ä¸Šå®ç°åçš„å…¨éƒ¨ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185function Promise(executor) &#123; let self = this self.status = 'pending' self.value = null self.onResolveCallbacks = [] self.onRejectCallbacks = [] function resolve(value) &#123; if (self.status === 'pending') &#123; self.status = 'fulfilled' self.value = value self.onResolveCallbacks.forEach(cb =&gt; cb(self.value)) &#125; &#125; function reject(reason) &#123; if (self.status === 'pending') &#123; self.status = 'rejected' self.value = reason self.onRejectCallbacks.forEach(cb =&gt; cb(self.value)) &#125; &#125; try &#123; executor(resolve, reject) &#125; catch (e) &#123; reject(e) &#125;&#125;Promise.prototype.then = function(onFulfilled, onRejected) &#123; let self = this onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : v =&gt; v // 2.2.1.1 onRejected = typeof onRejected === 'function' ? onRejected : r =&gt; &#123; throw r &#125; // 2.2.1.2 let returnedPromise = null // 2.2.7 if (self.status === 'pending') &#123; return returnedPromise = new Promise((resolve, reject) =&gt; &#123; self.onResolveCallbacks.push(() =&gt; &#123; setTimeout(() =&gt; &#123; try &#123; let x = onFulfilled(self.value) ResolutionProcedure(returnedPromise, x, resolve, reject) &#125; catch (e) &#123; reject(e) &#125; &#125;, 0) &#125;) self.onRejectCallbacks.push(() =&gt; &#123; setTimeout(() =&gt; &#123; try &#123; let x = onRejected(self.value) ResolutionProcedure(returnedPromise, x, resolve, reject) &#125; catch (e) &#123; reject(e) &#125; &#125;, 0) &#125;) &#125;) &#125; else if (self.status === 'fulfilled') &#123; return returnedPromise = new Promise((resolve, reject) =&gt; &#123; setTimeout(() =&gt; &#123; try &#123; let x = onFulfilled(self.value) ResolutionProcedure(returnedPromise, x, resolve, reject) &#125; catch (e) &#123; reject(e) &#125; &#125;, 0) &#125;) &#125; else if (self.status === 'rejected') &#123; return returnedPromise = new Promise((resolve, reject) =&gt; &#123; setTimeout(() =&gt; &#123; try &#123; let x = onRejected(self.value) ResolutionProcedure(returnedPromise, x, resolve, reject) &#125; catch (e) &#123; reject(e) &#125; &#125;, 0) &#125;) &#125;&#125;Promise.prototype.catch = function(onRejected) &#123; return this.then(null, onRejected)&#125;Promise.prototype.race = function(values) &#123; return new Promise(function(resolve, reject) &#123; for (let i = 0, len = values.length; i &lt; len; i++) &#123; values[i].then(resolve, reject) &#125; &#125;)&#125;Promise.all = function(promises) &#123; return new Promise(function(resolve, reject) &#123; let resolvedCounter = 0 let promiseNum = promises.length let resolvedValues = new Array(promiseNum) for (let i = 0; i &lt; promiseNum; i++) &#123; (function(i) &#123; Promise.resolve(promises[i]).then(function(value) &#123; resolvedCounter++ resolvedValues[i] = value if (resolvedCounter === promiseNum) &#123; return resolve(resolvedValues) &#125; &#125;, function(reason) &#123; return reject(reason) &#125;) &#125;)(i) &#125; &#125;)&#125;Promise.prototype.finally = function(callback) &#123; let constructor = this.constructor return this.then( function(value) &#123; return constructor.resolve(callback()).then(function() &#123; return value &#125;) &#125;, function(reason) &#123; return constructor.resolve(callback()).then(function() &#123; return constructor.reject(reason) &#125;) &#125; )&#125;function ResolutionProcedure(promise, x, resolvePromise, rejectPromise) &#123; try &#123; if (promise === x) &#123; return rejectPromise(new TypeError('2.3.1')) &#125; if (x instanceof Promise) //2.3.2 x.then(((value) =&gt; &#123; ResolutionProcedure(promise, value, reslove, reject) &#125;, (reason) =&gt; &#123; reject(reason) &#125;)) let called = false // 2.3.3.3.3 if (x !== null &amp;&amp; (typeof x === 'object' || typeof x === 'function')) &#123; // 2.3.3 try &#123; // 2.3.3.1 let then = x.then if (typeof then === 'function') &#123; // 2.3.3.3 then.call(x, (value) =&gt; &#123; if (called) return called = true return ResolutionProcedure(promise, value, resolvePromise, rejectPromise) &#125;, (reason) =&gt; &#123; if (called) return called = true return rejectPromise(reason) &#125;) &#125; else &#123; return resolvePromise(x) // 2.3.4 &#125; &#125; catch (e) &#123; if (called) return called = true return rejectPromise(e) // 2.3.3.2 &#125; &#125; else &#123; return resolvePromise(x) // 2.3.3.4 &#125; &#125; catch (e) &#123; return rejectPromise(e) &#125;&#125;Promise.deferred = function() &#123; let defer = &#123;&#125; defer.promise = new Promise((resolve, reject) =&gt; &#123; defer.resolve = resolve defer.reject = reject &#125;) return defer&#125;module.exports = Promise","tags":[{"name":"javascript","slug":"javascript","permalink":"https://www.limuyang.cc/tags/javascript/"},{"name":"Promise","slug":"Promise","permalink":"https://www.limuyang.cc/tags/Promise/"}]},{"title":"é˜…è¯»åˆ†æVuexæºç ","date":"2019-03-29T16:28:18.000Z","path":"2019/03/29/é˜…è¯»åˆ†æVuexæºç /","text":"ä¸ç®¡æ˜¯Vueæ¡†æ¶è¿˜æ˜¯Reactæ¡†æ¶ï¼Œåœ¨å®é™…å¼€å‘ä½¿ç”¨çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬éƒ½ä¼šæœ‰å¾ˆå¤šæƒ…å†µä¸‹éƒ½ä¼šæœ‰çŠ¶æ€å…±äº«çš„éœ€æ±‚ï¼Œè¿™äº›çŠ¶æ€å…±äº«ä¼šå‘ç”Ÿåœ¨çˆ¶å­ç»„ä»¶å’Œå…„å¼Ÿç»„ä»¶ä¹‹é—´ï¼Œæˆ‘ä»¬ä¸ºäº†ç»´æŠ¤è¿™äº›çŠ¶æ€ç»å¸¸ä¼šå†™å¾ˆå¤šéå¿…è¦æ€§çš„ä»£ç ï¼Œè¿™äº›ä»£ç ä¸€å¤šèµ·æ¥ï¼Œç»´æŠ¤å°±ä¼šå˜å¾—å¾ˆå›°éš¾ï¼Œæ­£æ˜¯ç”±äºæœ‰è¿™ç§éœ€æ±‚ï¼Œäººä»¬å¼€å‘äº†è®¸å¤šç›¸å…³çš„åº“ï¼Œä»Fluxåˆ°Reduxå†åˆ°Vuexï¼Œè¿™äº›åº“çš„å¤§è‡´æ€è·¯éƒ½æ˜¯ï¼šå°†å…±äº«çš„çŠ¶æ€æŠ½ç¦»å‡ºæ¥ï¼Œé€šè¿‡å®šä¹‰å’Œéš”ç¦»çŠ¶æ€ç®¡ç†ä¸­çš„å„ç§æ¦‚å¿µå¹¶å¼ºåˆ¶éµå®ˆä¸€å®šçš„è§„åˆ™ï¼Œè¾¾åˆ°ä»£ç ç»“æ„åŒ–å’Œæ˜“ç»´æŠ¤çš„ç›®çš„ã€‚ ç®€å•çŠ¶æ€ç®¡ç†èµ·æ­¥åœ¨è¯´åˆ°Vuexä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆäº†è§£ä¸‹ç®€å•çš„çŠ¶æ€ç®¡ç†ï¼Œä¹Ÿå°±æ˜¯Storeæ¨¡å¼ å½“ä½ æœ‰ä¸€å¤„éœ€è¦å¤šä¸ªå®ä¾‹å…±äº«çš„çŠ¶æ€ï¼Œå¯ä»¥ç®€å•åœ°é€šè¿‡ç»´æŠ¤ä¸€ä»½æ•°æ®æ¥å®ç°å…±äº«ï¼š 123456789const sourceOfTruth = &#123;&#125;const vmA = new Vue(&#123; data: sourceOfTruth&#125;)const vmB = new Vue(&#123; data: sourceOfTruth&#125;) ç°åœ¨å½“ sourceOfTruth å‘ç”Ÿå˜åŒ–ï¼ŒvmAå’ŒvmBéƒ½å°†è‡ªåŠ¨çš„æ›´æ–°å¼•ç”¨å®ƒä»¬çš„è§†å›¾ï¼Œä½†æ˜¯é‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œåœ¨ä»»ä½•æ—¶é—´ï¼Œæˆ‘ä»¬åº”ç”¨ä¸­çš„ä»»ä½•éƒ¨åˆ†ï¼Œåœ¨ä»»ä½•æ•°æ®æ”¹å˜åï¼Œéƒ½ä¸ä¼šç•™ä¸‹å˜æ›´è¿‡çš„è®°å½•ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä¸€ä¸ªç®€å•çš„Storeæ¨¡å¼: 1234567891011121314var store = &#123; debug: true, state: &#123; message: 'Hello!' &#125;, setMessageAction (newValue) &#123; if (this.debug) console.log('setMessageAction triggered with', newValue) this.state.message = newValue &#125;, clearMessageAction () &#123; if (this.debug) console.log('clearMessageAction triggered') this.state.message = '' &#125;&#125; æ‰€æœ‰ store ä¸­ state çš„æ”¹å˜ï¼Œéƒ½æ”¾ç½®åœ¨ store è‡ªèº«çš„ action ä¸­å»ç®¡ç†ã€‚è¿™ç§é›†ä¸­å¼çŠ¶æ€ç®¡ç†èƒ½å¤Ÿè¢«æ›´å®¹æ˜“åœ°ç†è§£å“ªç§ç±»å‹çš„ mutation å°†ä¼šå‘ç”Ÿï¼Œä»¥åŠå®ƒä»¬æ˜¯å¦‚ä½•è¢«è§¦å‘ã€‚å½“é”™è¯¯å‡ºç°æ—¶ï¼Œæˆ‘ä»¬ç°åœ¨ä¹Ÿä¼šæœ‰ä¸€ä¸ª log è®°å½• bug ä¹‹å‰å‘ç”Ÿäº†ä»€ä¹ˆï¼Œæ­¤å¤–ï¼Œæ¯ä¸ªå®ä¾‹/ç»„ä»¶ä»ç„¶å¯ä»¥æ‹¥æœ‰å’Œç®¡ç†è‡ªå·±çš„ç§æœ‰çŠ¶æ€ï¼š 12345678910111213var vmA = new Vue(&#123; data: &#123; privateState: &#123;&#125;, sharedState: store.state &#125;&#125;)var vmB = new Vue(&#123; data: &#123; privateState: &#123;&#125;, sharedState: store.state &#125;&#125;) æ¥ç€æˆ‘ä»¬ç»§ç»­å»¶ä¼¸çº¦å®šï¼Œç»„ä»¶ä¸å…è®¸ç›´æ¥ä¿®æ”¹å±äº store å®ä¾‹çš„ stateï¼Œè€Œåº”æ‰§è¡Œ action æ¥åˆ†å‘ (dispatch) äº‹ä»¶é€šçŸ¥ store å»æ”¹å˜ï¼Œè¿™æ ·çš„è¯ï¼Œä¸€ä¸ªFluxæ¶æ„å°±å®ç°äº†ã€‚ ç›®å½•ç»“æ„ Vuex çš„ç‰ˆæœ¬æ˜¯ 3.1.0 1234567891011121314ç›®å½•ç»“æ„â”œâ”€â”€ helpers.js æä¾›actionã€mutationsä»¥åŠgettersçš„æŸ¥æ‰¾APIâ”œâ”€â”€ index.esm.jsâ”œâ”€â”€ index.js æ˜¯æºç ä¸»å…¥å£æ–‡ä»¶ï¼Œæä¾›storeçš„å„moduleæ„å»ºå®‰è£…â”œâ”€â”€ mixin.js æä¾›äº†storeåœ¨Vueå®ä¾‹ä¸Šçš„è£…è½½æ³¨å…¥â”œâ”€â”€ module æä¾›moduleå¯¹è±¡ä¸moduleå¯¹è±¡æ ‘çš„åˆ›å»ºåŠŸèƒ½â”‚ â”œâ”€â”€ module-collection.jsâ”‚ â””â”€â”€ module.jsâ”œâ”€â”€ plugins æä¾›å¼€å‘è¾…åŠ©æ’ä»¶ï¼Œå¦‚â€œæ—¶å…‰ç©¿æ¢­â€åŠŸèƒ½â”‚ â”œâ”€â”€ devtool.jsâ”‚ â””â”€â”€ logger.jsâ”œâ”€â”€ store.js æ„å»ºstoreâ””â”€â”€ util.js æä¾›äº†å·¥å…·æ–¹æ³•å¦‚findã€deepCopyã€forEachValueä»¥åŠassertç­‰æ–¹æ³•ã€‚ ä¸€èˆ¬æˆ‘çœ‹æºç éƒ½æ˜¯ä»å…¥å£æ–‡ä»¶å¼€å§‹çœ‹ï¼Œè¿™é‡Œæ˜¯index.jsï¼š 12345678910111213import &#123; Store, install &#125; from './store'import &#123; mapState, mapMutations, mapGetters, mapActions, createNamespacedHelpers &#125; from './helpers'export default &#123; Store, install, version: '__VERSION__', mapState, mapMutations, mapGetters, mapActions, createNamespacedHelpers&#125; å…¥å£æ–‡ä»¶å¯¹å¤–æš´éœ²äº†Vuexç›¸å…³çš„APIï¼Œè‡³äºä¸ºä»€ä¹ˆè¿™é‡Œæœ‰ä¸€ä¸ªinstallï¼Œå…¶å®æ˜¯å› ä¸ºVuexæ˜¯è¢«å½“åšVueçš„æ’ä»¶æ¥ä½¿ç”¨çš„ï¼Œå¼€å‘ä¸€ä¸ªVueæ’ä»¶çš„è¯å°±éœ€è¦å¯¹å¤–æš´éœ²ä¸€ä¸ªinstallæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°Vueæ„é€ å™¨ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¯é€‰çš„é€‰é¡¹å¯¹è±¡ã€‚ Store.jsStore.jså¯¹å¤–æš´éœ²å‡ºäº†Storeè¿™ä¸ªç±»å’Œinstallè¿™ä¸ªæ–¹æ³•ï¼Œåœ¨å¼€å§‹åˆ†æStore.jsä¹‹å‰æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹installï¼š 12345678910111213export function install (_Vue) &#123; if (Vue &amp;&amp; _Vue === Vue) &#123; // æŠ¥é”™ï¼Œå·²ç»ä½¿ç”¨äº† Vue.use(Vuex)æ–¹æ³•æ³¨å†Œäº† if (process.env.NODE_ENV !== 'production') &#123; console.error( '[vuex] already installed. Vue.use(Vuex) should be called only once.' ) &#125; return &#125; Vue = _Vue applyMixin(Vue)&#125; é€»è¾‘å¾ˆç®€å•ï¼Œåªæ˜¯æŠŠä¼ å…¥çš„_Vueèµ‹å€¼ç»™Vueï¼Œç„¶åè°ƒç”¨applyMixin(Vue)æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å®šä¹‰åœ¨src/mixin.jsä¸­ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041export default function (Vue) &#123; const version = Number(Vue.version.split('.')[0]) // åœ¨å…¨å±€beforeCreateé’©å­é‡Œé¢åˆå§‹åŒ–vuex if (version &gt;= 2) &#123; Vue.mixin(&#123; beforeCreate: vuexInit &#125;) &#125; else &#123; // override init and inject vuex init procedure // for 1.x backwards compatibility. const _init = Vue.prototype._init Vue.prototype._init = function (options = &#123;&#125;) &#123; options.init = options.init ? [vuexInit].concat(options.init) : vuexInit _init.call(this, options) &#125; &#125; /** * Vuex init hook, injected into each instances init hooks list. */ function vuexInit () &#123; const options = this.$options // store injection if (options.store) &#123; // new Vue(&#123; // el: '#app', // router, // store, // render: h =&gt; h(App) // &#125;) // è¿™é‡Œè·å–çš„storeå°±æ˜¯ä¸Šé¢åˆå§‹åŒ–Vueçš„æ—¶å€™ä¼ å…¥çš„storeï¼Œæ‰€ä»¥åé¢æˆ‘ä»¬å¯ä»¥é€šè¿‡this.$storeè·å–åˆ°storeå®ä¾‹ this.$store = typeof options.store === 'function' ? options.store() : options.store &#125; else if (options.parent &amp;&amp; options.parent.$store) &#123; // å¦‚æœæ˜¯å­ç»„ä»¶ï¼Œåˆ™ä»æ ¹ç»„ä»¶è·å–store this.$store = options.parent.$store &#125; &#125;&#125; applyMixinæ–¹æ³•ä¸»è¦æ˜¯ä¸ºäº†åœ¨beforeCreateçš„å…¨å±€é’©å­ç»™æ‰€æœ‰å­ç»„ä»¶æ³¨å…¥$storeå±æ€§æ–¹ä¾¿åç»­è°ƒç”¨ï¼Œè®¾ç½®åˆ°thisä¸Šæ‰€ä»¥åé¢å†å…¨å±€éƒ½å¯ä»¥é€šè¿‡this.$storeæ¥è®¿é—®storeå¯¹è±¡ Storeçš„å®ä¾‹åŒ–å½“æˆ‘ä»¬å¼•å…¥Vuexä¹‹åä¸‹ä¸€æ­¥çš„æ“ä½œå°±æ˜¯å®ä¾‹åŒ–ä¸€ä¸ªStoreå¯¹è±¡ï¼Œä¼šè¿”å›ä¸€ä¸ªstoreå®ä¾‹å¹¶ä¸”ä¼ å…¥Vueçš„æ„é€ å™¨ï¼š 1234567891011121314151617const store = new Vuex.Store(&#123; state: &#123; count: 0 &#125;, mutations: &#123; increment (state) &#123; state.count++ &#125; &#125;&#125;)new Vue(&#123; el: '#app', router, store, render: h =&gt; h(App)&#125;) åœ¨Storeçš„æ„é€ å‡½æ•°å½“ä¸­ï¼Œé¦–å…ˆä¼šå¯¹æ‰§è¡Œç¯å¢ƒè¿›è¡Œæ–­è¨€(æ˜¯å¦è°ƒç”¨äº†Vue.use(Vuex)æ¥åˆå§‹åŒ–/æ˜¯å¦æ”¯æŒPromiseç­‰)ï¼š 123456789101112131415161718export class Store &#123; constructor (options = &#123;&#125;) &#123; // Auto install if it is not done yet and `window` has `Vue`. // To allow users to avoid auto-installation in some cases, // this code should be placed here. See #731 // åœ¨æµè§ˆå™¨ç¯å¢ƒä¸‹ï¼Œå¦‚æœæ’ä»¶è¿˜æœªå®‰è£…åˆ™å®ƒä¼šè‡ªåŠ¨å®‰è£…ã€‚ // å®ƒå…è®¸ç”¨æˆ·åœ¨æŸäº›æƒ…å†µä¸‹é¿å…è‡ªåŠ¨å®‰è£…ã€‚ if (!Vue &amp;&amp; typeof window !== 'undefined' &amp;&amp; window.Vue) &#123; install(window.Vue) &#125; if (process.env.NODE_ENV !== 'production') &#123; assert(Vue, `must call Vue.use(Vuex) before creating a store instance.`) assert(typeof Promise !== 'undefined', `vuex requires a Promise polyfill in this browser.`) assert(this instanceof Store, `store must be called with the new operator.`) &#125; // çœç•¥æ— å…³ä»£ç &#125; assertè¿™ä¸ªæ–¹æ³•è¢«å®šä¹‰åœ¨utils.jså½“ä¸­ï¼š 123export function assert (condition, msg) &#123; if (!condition) throw new Error(`[vuex] $&#123;msg&#125;`)&#125; å…¶å®è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å°±æ˜¯æŠ›å‡ºä¸€äº›å¼‚å¸¸ä¿¡æ¯ï¼Œç´§æ¥ç€å®šä¹‰äº†ä¸€äº›Storeçš„å†…éƒ¨å˜é‡ï¼š 1234567891011121314151617181920212223242526272829303132const &#123; // ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«åº”ç”¨åœ¨ store ä¸Šçš„æ’ä»¶æ–¹æ³• plugins = [], // ä½¿ Vuex store è¿›å…¥ä¸¥æ ¼æ¨¡å¼ï¼Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œä»»ä½• mutation å¤„ç†å‡½æ•°ä»¥å¤–ä¿®æ”¹ Vuex state éƒ½ä¼šæŠ›å‡ºé”™è¯¯ strict = false &#125; = options // store internal state // åˆ¤æ–­æ˜¯å¦æ˜¯é€šè¿‡mutationæ›´æ”¹çš„state this._committing = false // å­˜æ”¾action this._actions = Object.create(null) this._actionSubscribers = [] // å­˜æ”¾mutations this._mutations = Object.create(null) // å­˜æ”¾getters this._wrappedGetters = Object.create(null) // ä¼ å…¥çš„optionså¯¹è±¡ï¼Œå…¶å®å°±æ˜¯åˆå§‹åŒ–æ—¶å€™ä¼ å…¥çš„å¯¹è±¡ new Vuex.Store(&#123;options&#125;) // &#123; // modules: &#123; // cart, // products // &#125;, // strict: debug, // plugins: debug ? [createLogger()] : [] // &#125;) // åˆå§‹åŒ–modules this._modules = new ModuleCollection(options) // æ ¹æ®namespaceæ¥mapå¯¹åº”çš„module this._modulesNamespaceMap = Object.create(null) this._subscribers = [] // ç”¨$watchç›‘æµ‹storeæ•°æ®çš„å˜åŒ– this._watcherVM = new Vue() è¿™é‡Œæœ‰ä¸ªå¾ˆæœ‰æ„æ€çš„çŸ¥è¯†ç‚¹ï¼Œå°±æ˜¯æˆ‘ä»¬å‘ç°è¿™é‡Œåˆ›å»ºç©ºå¯¹è±¡çš„æ—¶å€™ç”¨çš„éƒ½æ˜¯Object.create(null)ï¼Œè¿™æ˜¯å› ä¸ºå¦‚æœç›´æ¥ç”¨ä¸€ä¸ª{}èµ‹å€¼çš„è¯ç­‰ä»·äºObject.create(Object.prototype)ï¼Œå®ƒè¿˜ä¼šä»Object.prototypeä¸Šç»§æ‰¿ä¸€äº›æ–¹æ³•å¦‚hasOwnPropertyã€isPrototypeOfç­‰ï¼Œå¦‚æœç”¨Object.create(null)åˆ™è¯´æ˜è¿™ä¸ªå¯¹è±¡çš„åŸå‹æ˜¯nullä¹Ÿå°±æ˜¯æ²¡æœ‰ç»§æ‰¿ä»»ä½•å¯¹è±¡ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨Storeçš„åˆå§‹åŒ–è¿‡ç¨‹ä¸­è¿˜æœ‰å‡ ä¸ªä¸»è¦çš„æ–¹æ³•ï¼Œä¸‹é¢è¿›è¡Œé€ä¸€çš„åˆ†æï¼š æ¨¡å—çš„åˆå§‹åŒ–ç”±äºStoreä½¿ç”¨çš„æ˜¯å•ä¸€çš„çŠ¶æ€æ ‘ï¼Œåº”ç”¨çš„æ‰€æœ‰çŠ¶æ€ä¼šé›†ä¸­åˆ°ä¸€ä¸ªæ¯”è¾ƒå¤§çš„å¯¹è±¡ã€‚å½“åº”ç”¨å˜å¾—éå¸¸å¤æ‚æ—¶ï¼Œstore å¯¹è±¡å°±æœ‰å¯èƒ½å˜å¾—ç›¸å½“è‡ƒè‚¿ã€‚ä¸ºäº†è§£å†³ä»¥ä¸Šé—®é¢˜ï¼ŒVuex å…è®¸æˆ‘ä»¬å°† store åˆ†å‰²æˆæ¨¡å—ï¼ˆmoduleï¼‰ã€‚æ¯ä¸ªæ¨¡å—æ‹¥æœ‰è‡ªå·±çš„stateã€mutationã€actionã€getterã€ç”šè‡³æ˜¯åµŒå¥—å­æ¨¡å—â€”â€”ä»ä¸Šè‡³ä¸‹è¿›è¡ŒåŒæ ·æ–¹å¼çš„åˆ†å‰²ï¼š 1234567891011121314151617181920212223const moduleA = &#123; state: &#123; ... &#125;, mutations: &#123; ... &#125;, actions: &#123; ... &#125;, getters: &#123; ... &#125;&#125;const moduleB = &#123; state: &#123; ... &#125;, mutations: &#123; ... &#125;, actions: &#123; ... &#125;, getters: &#123; ... &#125;,&#125;const store = new Vuex.Store(&#123; modules: &#123; a: moduleA, b: moduleB &#125;&#125;)store.state.a // -&gt; moduleA çš„çŠ¶æ€store.state.b // -&gt; moduleB çš„çŠ¶æ€ å®Œæˆè¿™ç§æ ‘å½¢ç»“æ„çš„æ„å»ºå…¥å£å°±æ˜¯ï¼š 12345678910// ä¼ å…¥çš„optionså¯¹è±¡ï¼Œå…¶å®å°±æ˜¯åˆå§‹åŒ–æ—¶å€™ä¼ å…¥çš„å¯¹è±¡ new Vuex.Store(&#123;options&#125;)// &#123;// modules: &#123;// cart,// products// &#125;,// strict: debug,// plugins: debug ? [createLogger()] : []// &#125;)this._modules = new ModuleCollection(options) ModuleCollectionè¿™ä¸ªç±»çš„å®šä¹‰åœ¨src/module/module-collection.jsï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133import Module from './module'import &#123; assert, forEachValue &#125; from '../util'export default class ModuleCollection &#123; constructor (rawRootModule) &#123; // register root module (Vuex.Store options) this.register([], rawRootModule, false) &#125; // è·å–å¯¹åº”äºpathçš„Module get (path) &#123; // this.rootæ ¹Module return path.reduce((module, key) =&gt; &#123; return module.getChild(key) &#125;, this.root) &#125; getNamespace (path) &#123; let module = this.root return path.reduce((namespace, key) =&gt; &#123; module = module.getChild(key) return namespace + (module.namespaced ? key + '/' : '') &#125;, '') &#125; update (rawRootModule) &#123; update([], this.root, rawRootModule) &#125; register (path, rawModule, runtime = true) &#123; if (process.env.NODE_ENV !== 'production') &#123; // æ£€æµ‹moduleå¯¹åº”çš„å‡½æ•°çš„å½¢å¼æ˜¯å¦æ­£ç¡® assertRawModule(path, rawModule) &#125; // æ„å»ºModuleå¯¹è±¡ const newModule = new Module(rawModule, runtime) if (path.length === 0) &#123; this.root = newModule &#125; else &#123; // è·å–Parent Module const parent = this.get(path.slice(0, -1)) // æ·»åŠ å­Module parent.addChild(path[path.length - 1], newModule) &#125; // register nested modules if (rawModule.modules) &#123; // é€’å½’æ³¨å†Œå­Module forEachValue(rawModule.modules, (rawChildModule, key) =&gt; &#123; this.register(path.concat(key), rawChildModule, runtime) &#125;) &#125; &#125; unregister (path) &#123; const parent = this.get(path.slice(0, -1)) const key = path[path.length - 1] if (!parent.getChild(key).runtime) return parent.removeChild(key) &#125;&#125;function update (path, targetModule, newModule) &#123; if (process.env.NODE_ENV !== 'production') &#123; assertRawModule(path, newModule) &#125; // update target module targetModule.update(newModule) // update nested modules if (newModule.modules) &#123; for (const key in newModule.modules) &#123; if (!targetModule.getChild(key)) &#123; if (process.env.NODE_ENV !== 'production') &#123; console.warn( `[vuex] trying to add a new module '$&#123;key&#125;' on hot reloading, ` + 'manual reload is needed' ) &#125; return &#125; update( path.concat(key), targetModule.getChild(key), newModule.modules[key] ) &#125; &#125;&#125;const functionAssert = &#123; assert: value =&gt; typeof value === 'function', expected: 'function'&#125;const objectAssert = &#123; assert: value =&gt; typeof value === 'function' || (typeof value === 'object' &amp;&amp; typeof value.handler === 'function'), expected: 'function or object with \"handler\" function'&#125;// actionsä½¿ç”¨objectAssertæ˜¯å› ä¸ºåœ¨å¸¦å‘½åç©ºé—´çš„æ¨¡å—æ³¨å†Œå…¨å±€actionæ—¶actionçš„å®šä¹‰ä¼šæ”¾åœ¨å‡½æ•°handlerä¸­const assertTypes = &#123; getters: functionAssert, mutations: functionAssert, actions: objectAssert&#125;function assertRawModule (path, rawModule) &#123; Object.keys(assertTypes).forEach(key =&gt; &#123; if (!rawModule[key]) return const assertOptions = assertTypes[key] // å¾ªç¯getters/mutations/actions // valueå’Œtypeå¯¹åº”å‡½æ•°ä½“å’Œå‡½æ•°å forEachValue(rawModule[key], (value, type) =&gt; &#123; assert( assertOptions.assert(value), makeAssertionMessage(path, key, type, value, assertOptions.expected) ) &#125;) &#125;)&#125;function makeAssertionMessage (path, key, type, value, expected) &#123; let buf = `$&#123;key&#125; should be $&#123;expected&#125; but \"$&#123;key&#125;.$&#123;type&#125;\"` if (path.length &gt; 0) &#123; buf += ` in module \"$&#123;path.join('.')&#125;\"` &#125; buf += ` is $&#123;JSON.stringify(value)&#125;.` return buf&#125; å®ä¾‹åŒ–ModuleCollectionå…¶å®å°±æ˜¯æ‰§è¡Œregisteræ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ¥å—3ä¸ªå‚æ•°ï¼Œå…¶ä¸­pathå‚æ•°å°±æ˜¯moduleçš„è·¯å¾„ï¼Œè¿™ä¸ªå€¼æ˜¯æˆ‘ä»¬æ‹†åˆ†moduleæ—¶å€™moduleçš„keyç»„æˆçš„ä¸€ä¸ªæ•°ç»„ï¼Œä»¥ä¸Šé¢ä¸ºä¾‹çš„è¯ï¼ŒmoduleAå’ŒmoduleBçš„pathåˆ†åˆ«ä¸º[&quot;a&quot;]å’Œ[&quot;b&quot;]ï¼Œå¦‚æœä»–ä»¬è¿˜æœ‰å­moduleåˆ™å­moduleçš„pathçš„å½¢å¼å¤§è‡´å¦‚[&quot;a&quot;ï¼Œ&quot;a1&quot;]/[&quot;b&quot;ï¼Œ&quot;b1&quot;]ï¼Œç¬¬äºŒä¸ªå‚æ•°å…¶å®æ˜¯å®šä¹‰moduleçš„é…ç½®ï¼ŒåƒrawRootModuleå°±æ˜¯æˆ‘ä»¬æ„å»ºä¸€ä¸ªStoreçš„æ—¶å€™ä¼ å…¥çš„é‚£ä¸ªå¯¹è±¡ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°runtimeè¡¨ç¤ºæ˜¯å¦æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶åˆ›å»ºçš„moduleï¼Œç´§æ¥ç€åœ¨registeræ–¹æ³•å†…éƒ¨é€šè¿‡assertRawModuleæ–¹æ³•éå†moduleå†…éƒ¨çš„gettersã€mutationsã€actionsæ˜¯å¦ç¬¦åˆè¦æ±‚ï¼Œç´§æ¥ç€é€šè¿‡const newModule = new Module(rawModule, runtime)æ„å»ºä¸€ä¸ªmoduleå¯¹è±¡ï¼Œçœ‹ä¸€çœ¼moduleç±»çš„å®ç°ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071import &#123; forEachValue &#125; from '../util'// Base data struct for store's module, package with some attribute and methodexport default class Module &#123; constructor (rawModule, runtime) &#123; this.runtime = runtime // Store some children item this._children = Object.create(null) // Store the origin module object which passed by programmer this._rawModule = rawModule const rawState = rawModule.state // Store the origin module's state // state() &#123; // return &#123; // // state here instead // &#125; // &#125; this.state = (typeof rawState === 'function' ? rawState() : rawState) || &#123;&#125; &#125; get namespaced () &#123; return !!this._rawModule.namespaced &#125; addChild (key, module) &#123; this._children[key] = module &#125; removeChild (key) &#123; delete this._children[key] &#125; getChild (key) &#123; return this._children[key] &#125; update (rawModule) &#123; this._rawModule.namespaced = rawModule.namespaced if (rawModule.actions) &#123; this._rawModule.actions = rawModule.actions &#125; if (rawModule.mutations) &#123; this._rawModule.mutations = rawModule.mutations &#125; if (rawModule.getters) &#123; this._rawModule.getters = rawModule.getters &#125; &#125; forEachChild (fn) &#123; forEachValue(this._children, fn) &#125; forEachGetter (fn) &#123; if (this._rawModule.getters) &#123; forEachValue(this._rawModule.getters, fn) &#125; &#125; forEachAction (fn) &#123; if (this._rawModule.actions) &#123; forEachValue(this._rawModule.actions, fn) &#125; &#125; forEachMutation (fn) &#123; if (this._rawModule.mutations) &#123; forEachValue(this._rawModule.mutations, fn) &#125; &#125;&#125; åªæ˜¯ç®€å•åœ°æè¿°äº†æ„å»ºå‡ºæ¥çš„æ¯ä¸ªæ¨¡å—çš„ä¸€äº›å±æ€§å’Œæ–¹æ³•ï¼Œå›åˆ°ä¸Šé¢çš„registerå‡½æ•°ï¼Œæ„å»ºå®ŒModuleä¹‹åï¼Œæˆ‘ä»¬å…ˆåˆ¤æ–­pathçš„é•¿åº¦ï¼Œå¦‚æœé•¿åº¦ä¸º0è¯´æ˜æ˜¯æ ¹moduleï¼Œå°†å®ƒèµ‹å€¼ç»™this.rootï¼Œå¦åˆ™çš„è¯è·å–åˆ°è¿™ä¸ªmoduleçš„parentï¼Œç„¶åé€šè¿‡moduleçš„addChildæ–¹æ³•å»ºç«‹æ¨¡å—ä¹‹é—´çš„çˆ¶å­å…³ç³»ï¼š 1234// è·å–Parent Moduleconst parent = this.get(path.slice(0, -1))// æ·»åŠ å­Moduleparent.addChild(path[path.length - 1], newModule) è¿™é‡Œè°ƒç”¨äº†getæ–¹æ³•ï¼Œä¼ å…¥çš„pathæ˜¯parentæ¨¡å—çš„pathï¼š 123456get (path) &#123; // this.rootæ ¹Module return path.reduce((module, key) =&gt; &#123; return module.getChild(key) &#125;, this.root) &#125; å› ä¸ºpathæ˜¯æ•´ä¸ªæ¨¡å—æ ‘çš„è·¯å¾„ï¼Œè¿™é‡Œé€šè¿‡reduceæ–¹æ³•ä¸€å±‚å±‚è§£æå»æ‰¾åˆ°å¯¹åº”æ¨¡å—ï¼ŒæŸ¥æ‰¾çš„è¿‡ç¨‹æ˜¯ç”¨çš„module.getChild(key)æ–¹æ³•ï¼Œè¿”å›çš„æ˜¯this._children[key]ï¼Œè¿™äº›_childrenå°±æ˜¯é€šè¿‡æ‰§è¡Œparent.addChild(path[path.length - 1], newModule)æ–¹æ³•æ·»åŠ çš„ï¼Œå°±è¿™æ ·ï¼Œæ¯ä¸€ä¸ªæ¨¡å—éƒ½é€šè¿‡pathå»å¯»æ‰¾åˆ°parent`moduleï¼Œç„¶åé€šè¿‡addChildå»ºç«‹çˆ¶å­å…³ç³»ï¼Œé€çº§é€’è¿›ï¼Œæ„å»ºå®Œæˆæ•´ä¸ªmodule`æ ‘ã€‚ æ¨¡å—çš„å®‰è£…æ¥ä¸‹æ¥å›åˆ°Store.jsï¼Œåˆå§‹åŒ–modulesä¹‹åä¼šæ‰§è¡Œä¸€äº›bindæ“ä½œï¼š 12345678const store = thisconst &#123; dispatch, commit &#125; = thisthis.dispatch = function boundDispatch (type, payload) &#123; return dispatch.call(store, type, payload)&#125;this.commit = function boundCommit (type, payload, options) &#123; return commit.call(store, type, payload, options)&#125; è¿™æ˜¯ä¸ºäº†å½“æˆ‘ä»¬åœ¨ç»„ä»¶å†…éƒ¨ä½¿ç”¨this.$store.commit/this.$store.dispatchæ–¹æ³•æ—¶å€™çš„thisæŒ‡å‘çš„æ˜¯å½“å‰çš„storeè€Œä¸æ˜¯ç»„ä»¶æœ¬èº«ï¼Œè¿™é‡Œå…ˆç•¥è¿‡commitå’Œdispatchæ–¹æ³•çš„å®ç°ï¼Œå…ˆåˆ†æStore.jsçš„åˆå§‹åŒ–æ“ä½œï¼Œåœ¨åˆå§‹åŒ–moduleä¹‹åä¼šè¿›è¡Œmoduleå®‰è£…çš„ä¸€äº›æ“ä½œï¼š 12345const state = this._modules.root.state// init root module.// this also recursively registers all sub-modules// and collects all module getters inside this._wrappedGettersinstallModule(this, state, [], this._modules.root) çœ‹ä¸€çœ¼installModuleæ–¹æ³•çš„å®ç°ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142function installModule (store, rootState, path, module, hot) &#123; // åˆ¤æ–­æ˜¯å¦æ˜¯æ ¹module const isRoot = !path.length // è·å–moduleçš„å‘½åç©ºé—´ const namespace = store._modules.getNamespace(path) // å°†moduleçš„å‘½åç©ºé—´å’Œmoduleæœ¬èº«ä¸€ä¸€å¯¹åº”å­˜å‚¨åœ¨_modulesNamespaceMapå¯¹è±¡é‡Œé¢æ–¹ä¾¿åç»­æŸ¥æ‰¾ if (module.namespaced) &#123; store._modulesNamespaceMap[namespace] = module &#125; // set state if (!isRoot &amp;&amp; !hot) &#123; const parentState = getNestedState(rootState, path.slice(0, -1)) const moduleName = path[path.length - 1] store._withCommit(() =&gt; &#123; Vue.set(parentState, moduleName, module.state) &#125;) &#125; const local = module.context = makeLocalContext(store, namespace, path) module.forEachMutation((mutation, key) =&gt; &#123; const namespacedType = namespace + key registerMutation(store, namespacedType, mutation, local) &#125;) module.forEachAction((action, key) =&gt; &#123; const type = action.root ? key : namespace + key const handler = action.handler || action registerAction(store, type, handler, local) &#125;) module.forEachGetter((getter, key) =&gt; &#123; const namespacedType = namespace + key registerGetter(store, namespacedType, getter, local) &#125;) module.forEachChild((child, key) =&gt; &#123; installModule(store, rootState, path.concat(key), child, hot) &#125;)&#125; è¿™ä¸ªæ–¹æ³•æ¥å—5ä¸ªå‚æ•°ï¼šstoreæ„å‘³ç€root storeã€stateå°±æ˜¯root stateã€pathæ˜¯å½“å‰æ¨¡å—è·¯å¾„ã€moduleæ˜¯å½“å‰æ¨¡å—ï¼Œhotè¡¨ç¤ºæ˜¯å¦æ˜¯çƒ­æ›´æ–°ã€‚é¦–å…ˆç”¨ä¸€ä¸ªå˜é‡isRootåˆ¤æ–­æ˜¯å¦æ˜¯æ ¹moduleï¼Œç„¶åé€šè¿‡ModuleCollectionç±»çš„getNamespaceè·å–å½“å‰è·¯å¾„çš„å‘½åç©ºé—´ï¼Œè¿™é‡Œæä¸€ä¸‹Vuexé‡Œé¢å‘½åç©ºé—´çš„æ¦‚å¿µï¼š é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¨¡å—å†…éƒ¨çš„ actionã€mutation å’Œ getter æ˜¯æ³¨å†Œåœ¨å…¨å±€å‘½åç©ºé—´çš„â€”â€”è¿™æ ·ä½¿å¾—å¤šä¸ªæ¨¡å—èƒ½å¤Ÿå¯¹åŒä¸€ mutation æˆ– action ä½œå‡ºå“åº”ã€‚å¦‚æœå¸Œæœ›ä½ çš„æ¨¡å—å…·æœ‰æ›´é«˜çš„å°è£…åº¦å’Œå¤ç”¨æ€§ï¼Œä½ å¯ä»¥é€šè¿‡æ·»åŠ  namespaced: true çš„æ–¹å¼ä½¿å…¶æˆä¸ºå¸¦å‘½åç©ºé—´çš„æ¨¡å—ã€‚å½“æ¨¡å—è¢«æ³¨å†Œåï¼Œå®ƒçš„æ‰€æœ‰ getterã€action åŠ mutation éƒ½ä¼šè‡ªåŠ¨æ ¹æ®æ¨¡å—æ³¨å†Œçš„è·¯å¾„è°ƒæ•´å‘½åã€‚ä¾‹å¦‚ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940const store = new Vuex.Store(&#123; modules: &#123; account: &#123; namespaced: true, // æ¨¡å—å†…å®¹ï¼ˆmodule assetsï¼‰ state: &#123; ... &#125;, // æ¨¡å—å†…çš„çŠ¶æ€å·²ç»æ˜¯åµŒå¥—çš„äº†ï¼Œä½¿ç”¨ `namespaced` å±æ€§ä¸ä¼šå¯¹å…¶äº§ç”Ÿå½±å“ getters: &#123; isAdmin () &#123; ... &#125; // -&gt; getters['account/isAdmin'] &#125;, actions: &#123; login () &#123; ... &#125; // -&gt; dispatch('account/login') &#125;, mutations: &#123; login () &#123; ... &#125; // -&gt; commit('account/login') &#125;, // åµŒå¥—æ¨¡å— modules: &#123; // ç»§æ‰¿çˆ¶æ¨¡å—çš„å‘½åç©ºé—´ myPage: &#123; state: &#123; ... &#125;, getters: &#123; profile () &#123; ... &#125; // -&gt; getters['account/profile'] &#125; &#125;, // è¿›ä¸€æ­¥åµŒå¥—å‘½åç©ºé—´ posts: &#123; namespaced: true, state: &#123; ... &#125;, getters: &#123; popular () &#123; ... &#125; // -&gt; getters['account/posts/popular'] &#125; &#125; &#125; &#125; &#125;&#125;) å›åˆ°installModuleæ–¹æ³•ï¼Œæˆ‘ä¹ˆå¯ä»¥çœ‹ä¸€ä¸‹æ ¹æ®pathæ¥è·å–namespaceçš„æ–¹æ³•å®ç°ï¼š 1234567getNamespace (path) &#123; let module = this.root return path.reduce((namespace, key) =&gt; &#123; module = module.getChild(key) return namespace + (module.namespaced ? key + '/' : '') &#125;, '') &#125; ä»æ ¹moduleå¼€å§‹ï¼Œé€šè¿‡reduceæ–¹æ³•æ²¿ç€pathä¸€å±‚å±‚æŸ¥æ‰¾å­moduleï¼Œç„¶åå¦‚æœå‘ç°è¯¥moduleé…ç½®äº†namespacedï¼Œå°±æŠŠè¯¥pathæ‹¼æ¥åˆ°namespaceåé¢ï¼Œæœ€åè¿”å›å®Œæ•´çš„è·¯å¾„ã€‚æ¥ä¸‹æ¥å¦‚æœè¯¥moduleé…ç½®äº†namespacedï¼Œåˆ™æŠŠè¯¥moduleçš„namespaceå’Œmoduleæœ¬èº«ä¸€ä¸€å¯¹åº”å­˜å‚¨åˆ°_modulesNamespaceMapå¯¹è±¡é‡Œé¢æ–¹ä¾¿åç»­æŸ¥æ‰¾ï¼š 1234// å°†moduleçš„å‘½åç©ºé—´å’Œmoduleæœ¬èº«ä¸€ä¸€å¯¹åº”å­˜å‚¨åœ¨_modulesNamespaceMapå¯¹è±¡é‡Œé¢æ–¹ä¾¿åç»­æŸ¥æ‰¾if (module.namespaced) &#123; store._modulesNamespaceMap[namespace] = module&#125; ç´§æ¥ç€æ˜¯éroot moduleä¸‹çš„æ¨¡å—stateåˆå§‹åŒ–é€»è¾‘ï¼š 12345678// set stateif (!isRoot &amp;&amp; !hot) &#123; const parentState = getNestedState(rootState, path.slice(0, -1)) const moduleName = path[path.length - 1] store._withCommit(() =&gt; &#123; Vue.set(parentState, moduleName, module.state) &#125;)&#125; å…ˆé€šè¿‡getNestedStateè·å–çˆ¶æ¨¡å—çš„stateï¼Œè¿™ä¸ªæ–¹æ³•çš„å®ç°å¤§åŒå°å¼‚ï¼Œéƒ½æ˜¯é€šè¿‡reduceå‡½æ•°ä¸€å±‚å±‚æŸ¥æ‰¾åˆ°å­æ¨¡å—çš„stateï¼š 12345function getNestedState (state, path) &#123; return path.length ? path.reduce((state, key) =&gt; state[key], state) : state&#125; éšåæˆ‘ä»¬æ‹¿åˆ°å­moduleçš„åç§°ï¼Œè°ƒç”¨storeå¯¹è±¡çš„_withCommitæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•é‡Œé¢çš„å‡½æ•°æ‰§è¡Œçš„æ“ä½œæ˜¯ç»™çˆ¶æ¨¡å—çš„stateæ·»åŠ ä¸€ä¸ªåå­—æ˜¯moduleçš„åç§°çš„å“åº”å¼å±æ€§ï¼Œçœ‹ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨ï¼š 123456_withCommit (fn) &#123; const committing = this._committing this._committing = true fn() this._committing = committing &#125; _committingçš„åˆå§‹å€¼ä¸ºfalseï¼Œç”¨æ¥åˆ¤æ–­æ˜¯å¦æ˜¯é€šè¿‡mutationæ¥æ›´æ”¹çš„stateï¼Œå› ä¸ºåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œæ— è®ºä½•æ—¶å‘ç”Ÿäº†çŠ¶æ€å˜æ›´ä¸”ä¸æ˜¯ç”±mutationå‡½æ•°å¼•èµ·çš„ï¼Œå°†ä¼šæŠ›å‡ºé”™è¯¯ï¼Œåœ¨Store.jsçš„æºç ä¸­æœ‰ç›¸å…³ä»£ç ä½“ç°è¿™ä¸€ç‚¹ï¼š 123456789101112if (store.strict) &#123; enableStrictMode(store)&#125;function enableStrictMode (store) &#123; store._vm.$watch(function () &#123; return this._data.$$state &#125;, () =&gt; &#123; if (process.env.NODE_ENV !== 'production') &#123; assert(store._committing, `do not mutate vuex store state outside mutation handlers.`) &#125; &#125;, &#123; deep: true, sync: true &#125;)&#125; store._vmæ˜¯ä¸€ä¸ªåœ¨Store.jså†…ç½®çš„Vueå¯¹è±¡ï¼š 123456store._vm = new Vue(&#123; data: &#123; $$state: state &#125;, computed&#125;) ç„¶åé€šè¿‡Vueçš„å®ä¾‹æ–¹æ³•$watchç›‘å¬æ¯ä¸€æ¬¡stateçš„å˜åŒ–ï¼Œé€šè¿‡æ–­è¨€åˆ¤æ–­å½“å‰stateçš„å˜åŒ–æ˜¯å¦æ˜¯é€šè¿‡æäº¤ä¸€ä¸ªmutationæ¥å¼•èµ·çš„ï¼Œä¸æ˜¯çš„è¯å°±æŠ¥é”™do not mutate vuex store state outside mutation handlersã€‚ åˆå§‹åŒ–éroot moduleä¸‹çš„stateä¹‹åä¸‹ä¸€æ­¥æ“ä½œæ˜¯æ„é€ ä¸€ä¸ªå½“å‰moduleçš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼š 1const local = module.context = makeLocalContext(store, namespace, path) makeLocalContextæ”¯æŒ3ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯root storeã€å½“å‰moduleçš„namespaceä»¥åŠå½“å‰moduleçš„pathï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556/** * make localized dispatch, commit, getters and state * if there is no namespace, just use root ones */function makeLocalContext (store, namespace, path) &#123; const noNamespace = namespace === '' const local = &#123; dispatch: noNamespace ? store.dispatch : (_type, _payload, _options) =&gt; &#123; const args = unifyObjectStyle(_type, _payload, _options) const &#123; payload, options &#125; = args let &#123; type &#125; = args if (!options || !options.root) &#123; type = namespace + type if (process.env.NODE_ENV !== 'production' &amp;&amp; !store._actions[type]) &#123; console.error(`[vuex] unknown local action type: $&#123;args.type&#125;, global type: $&#123;type&#125;`) return &#125; &#125; return store.dispatch(type, payload) &#125;, commit: noNamespace ? store.commit : (_type, _payload, _options) =&gt; &#123; const args = unifyObjectStyle(_type, _payload, _options) const &#123; payload, options &#125; = args let &#123; type &#125; = args if (!options || !options.root) &#123; type = namespace + type if (process.env.NODE_ENV !== 'production' &amp;&amp; !store._mutations[type]) &#123; console.error(`[vuex] unknown local mutation type: $&#123;args.type&#125;, global type: $&#123;type&#125;`) return &#125; &#125; store.commit(type, payload, options) &#125; &#125; // getters and state object must be gotten lazily // because they will be changed by vm update Object.defineProperties(local, &#123; getters: &#123; get: noNamespace ? () =&gt; store.getters : () =&gt; makeLocalGetters(store, namespace) &#125;, state: &#123; get: () =&gt; getNestedState(store.state, path) &#125; &#125;) return local&#125; é€šè¿‡ä¸€ä¸ªå˜é‡noNamespaceåˆ¤æ–­moduleæ˜¯å¦é…ç½®äº†namespacedå±æ€§ï¼Œç„¶åæ„å»ºä¸€ä¸ªlocalå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…å«äº†commitå’Œdispatchæ–¹æ³•ï¼Œä¸¤ä¸ªæ–¹æ³•å®šä¹‰è¿‡ç¨‹å·®ä¸å¤šï¼Œä»¥commitä¸ºä¾‹ï¼Œå¦‚æœæ²¡æœ‰namespacedå±æ€§ï¼Œè¿™ä¸ªcommitç›´æ¥æŒ‡å‘äº†store.commitï¼Œå¦åˆ™æ„å»ºä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°é¦–å…ˆä¼šå¯¹ä¼ å…¥çš„å‚æ•°é¡ºåºè¿›è¡Œæ ¼å¼åŒ–ï¼ŒunifyObjectStyleæ–¹æ³•å…¼å®¹äº†è½½è·å’Œå¯¹è±¡é£æ ¼çš„ä¸¤ç§æäº¤æ–¹å¼ï¼š 12345678910111213function unifyObjectStyle (type, payload, options) &#123; if (isObject(type) &amp;&amp; type.type) &#123; options = payload payload = type type = type.type &#125; if (process.env.NODE_ENV !== 'production') &#123; assert(typeof type === 'string', `expects string as the type, but found $&#123;typeof type&#125;.`) &#125; return &#123; type, payload, options &#125;&#125; å¦‚æœæ˜¯å¯¹è±¡é£æ ¼çš„æäº¤æ–¹å¼åˆ™å¯¹å‚æ•°ä½ç½®è¿›è¡Œè°ƒæ•´ï¼Œç„¶åè¿”å›ä¸€ä¸ªè°ƒæ•´ä½ç½®åçš„å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰åœ¨commitæ–¹æ³•é‡Œé¢è®¾ç½®rootï¼štrueå‚æ•°ï¼Œåˆ™å°†typeå’Œnamespaceæ‹¼æ¥ä¹‹åæ‰§è¡Œcommitæ–¹æ³•ï¼Œå¦‚æœè®¾ç½®äº†rootï¼štrueæ„å‘³ç€å…è®¸åœ¨å‘½åç©ºé—´æ¨¡å—é‡Œæäº¤æ ¹çš„mutationã€‚ æ„å»ºå®Œlocalå¯¹è±¡åä¼šåœ¨localå¯¹è±¡ä¸Šå®šä¹‰ä¸¤ä¸ªå±æ€§getterså’Œstateï¼š 123456789101112// getters and state object must be gotten lazily// because they will be changed by vm updateObject.defineProperties(local, &#123; getters: &#123; get: noNamespace ? () =&gt; store.getters : () =&gt; makeLocalGetters(store, namespace) &#125;, state: &#123; get: () =&gt; getNestedState(store.state, path) &#125;&#125;) stateçš„è·å–æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯æ ¹æ®root stateå’Œå½“å‰moduleçš„pathè·å–è¯¥moduleçš„stateï¼Œæˆ‘ä»¬çœ‹gettersçš„å®ç°ï¼Œå¦‚æœæ²¡æœ‰namespaceï¼Œç›´æ¥è¿”å›root storeçš„gettersï¼Œå¦åˆ™è°ƒç”¨makeLocalGettersè·å–å¯¹åº”namespaceçš„gettersï¼Œçœ‹ä¸€ä¸‹makeLocalGettersæ–¹æ³•çš„å®ç°ï¼š 12345678910111213141516171819202122function makeLocalGetters (store, namespace) &#123; const gettersProxy = &#123;&#125; const splitPos = namespace.length Object.keys(store.getters).forEach(type =&gt; &#123; // skip if the target getter is not match this namespace if (type.slice(0, splitPos) !== namespace) return // extract local getter type const localType = type.slice(splitPos) // Add a port to the getters proxy. // Define as getter property because // we do not want to evaluate the getters in this time. Object.defineProperty(gettersProxy, localType, &#123; get: () =&gt; store.getters[type], enumerable: true &#125;) &#125;) return gettersProxy&#125; è¿™ä¸ªæ–¹æ³•å¯¹this.gettersä¸Šæ‰€æœ‰çš„å¯ç«ä¸¾å±æ€§è¿›è¡Œéå†ï¼Œç„¶åæˆªå–typeçš„åŒ…å«namespaceçš„éƒ¨åˆ†å’Œä¼ å…¥çš„namespaceè¿›è¡Œå¯¹æ¯”ï¼Œæ‰¾åˆ°åæˆªå–typeé‡Œé¢çš„ååŠéƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯ä¸åŒ…å«namespaceçš„éƒ¨åˆ†ï¼Œç„¶åå®šä¹‰äº†gettersProxyçš„getå±æ€§å¹¶å°†å…¶è¿”å›ã€‚ å›åˆ°installModuleæ–¹æ³•ï¼Œåœ¨å®Œæˆæ„å»ºlocalä¹‹åï¼Œä¼šå¾ªç¯éå†moduleä¸­å®šä¹‰çš„mutationã€actionã€gettersç„¶åæ‰§è¡Œæ³¨å†Œé€»è¾‘ï¼Œè¿™å‡ ä¸ªæ“ä½œéƒ½å·®ä¸å¤šï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸ªmutationçš„ï¼š 12345678910111213141516171819202122 module.forEachMutation((mutation, key) =&gt; &#123; const namespacedType = namespace + key registerMutation(store, namespacedType, mutation, local) &#125;)forEachMutation (fn) &#123; if (this._rawModule.mutations) &#123; forEachValue(this._rawModule.mutations, fn) &#125; &#125; export function forEachValue (obj, fn) &#123; // å°†å¯¹è±¡é‡Œé¢çš„æ¯ä¸€é¡¹ç»„åˆæˆæ•°ç»„ Object.keys(obj).forEach(key =&gt; fn(obj[key], key)) &#125; function registerMutation (store, type, handler, local) &#123; const entry = store._mutations[type] || (store._mutations[type] = []) entry.push(function wrappedMutationHandler (payload) &#123; handler.call(store, local.state, payload) &#125;) &#125; å®é™…ä¸Šå°±æ˜¯ç»™root storeçš„_mutationså¯¹è±¡çš„å¯¹åº”type`pushä¸€ä¸ªå¤„ç†å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°è°ƒç”¨æ—¶å€™ä¼šå°†handlerçš„thisæŒ‡å‘root storeã€‚ åœ¨installModuleçš„æœ€åä¼šå¾ªç¯éå†å­moduleç„¶åæ‰§è¡Œå­moduleçš„installModule`æ–¹æ³•ï¼š 123module.forEachChild((child, key) =&gt; &#123; installModule(store, rootState, path.concat(key), child, hot) &#125;) è‡³æ­¤ï¼ŒinstallModuleæ–¹æ³•åˆ†æå®Œæ¯• åˆå§‹åŒ–store vmè¿™æ˜¯å®ä¾‹åŒ–Storeçš„æœ€åä¸€æ­¥ï¼Œé€šè¿‡resetStoreVMæ–¹æ³•åˆå§‹åŒ–vmä»¥åŠæ³¨å†Œ_wrappedGettersï¼Œå…¶ä¸­æœ‰äº›ä»£ç ä¸Šé¢åˆ†æè¿‡ï¼Œè¿™é‡Œå…ˆè´´å‡ºå…¨éƒ¨ç›¸å…³ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445function resetStoreVM (store, state, hot) &#123; const oldVm = store._vm // bind store public getters store.getters = &#123;&#125; const wrappedGetters = store._wrappedGetters const computed = &#123;&#125; forEachValue(wrappedGetters, (fn, key) =&gt; &#123; // use computed to leverage its lazy-caching mechanism computed[key] = () =&gt; fn(store) Object.defineProperty(store.getters, key, &#123; get: () =&gt; store._vm[key], enumerable: true // for local getters &#125;) &#125;) // use a Vue instance to store the state tree // suppress warnings just in case the user has added // some funky global mixins const silent = Vue.config.silent Vue.config.silent = true store._vm = new Vue(&#123; data: &#123; $$state: state &#125;, computed &#125;) Vue.config.silent = silent // enable strict mode for new vm if (store.strict) &#123; enableStrictMode(store) &#125; if (oldVm) &#123; if (hot) &#123; // dispatch changes in all subscribed watchers // to force getter re-evaluation for hot reloading. store._withCommit(() =&gt; &#123; oldVm._data.$$state = null &#125;) &#125; Vue.nextTick(() =&gt; oldVm.$destroy()) &#125;&#125; Vuex å…è®¸æˆ‘ä»¬åœ¨ store ä¸­å®šä¹‰â€œgetterâ€ï¼ˆå¯ä»¥è®¤ä¸ºæ˜¯ store çš„è®¡ç®—å±æ€§ï¼‰ã€‚å°±åƒè®¡ç®—å±æ€§ä¸€æ ·ï¼Œgetter çš„è¿”å›å€¼ä¼šæ ¹æ®å®ƒçš„ä¾èµ–è¢«ç¼“å­˜èµ·æ¥ï¼Œä¸”åªæœ‰å½“å®ƒçš„ä¾èµ–å€¼å‘ç”Ÿäº†æ”¹å˜æ‰ä¼šè¢«é‡æ–°è®¡ç®—ã€‚è¿™é‡Œé¦–å…ˆéå†wrappedGetterså¾—åˆ°å¯¹åº”çš„fnç»„æˆçš„æ•°ç»„ï¼Œç„¶åå°†å…¶å®šä¹‰ä¸ºä¸€ä¸ªä¸ªè®¡ç®—å±æ€§computed[key] = () =&gt; fn(store)ï¼Œfn(store)å…¶å®å°±æ˜¯æ‰§è¡Œäº†ä¸‹é¢çš„æ–¹æ³•ï¼š 12345678store._wrappedGetters[type] = function wrappedGetter (store) &#123; return rawGetter( local.state, // local state local.getters, // local getters store.state, // root state store.getters // root getters ) &#125; _éšåç»™store.gettersæ–°å¢å±æ€§ï¼Œè®¿é—®è¿™äº›å±æ€§ä¹Ÿå°±æ˜¯ä½¿ç”¨this.store.gettersçš„æ—¶å€™æ‹¿åˆ°çš„æ˜¯keyå¯¹åº”çš„è®¡ç®—å±æ€§çš„å€¼: 1234Object.defineProperty(store.getters, key, &#123; get: () =&gt; store._vm[key], enumerable: true // for local getters &#125;) æ‰§è¡Œè¿™ä¸ªgetterå¯¹åº”çš„å‡½æ•°ç­‰ä»·äºæ‰§è¡Œäº†computed[key] = () =&gt; fn(store)è¿™ä¸ªè®¡ç®—å±æ€§å¯¹åº”çš„å‡½æ•°ï¼Œç”±äºè¿™ä¸ªå‡½æ•°ä¾èµ–äº†storeï¼Œæ‰€ä»¥æ ¹æ®è®¡ç®—å±æ€§çš„ç‰¹æ€§åœ¨storeå˜åŒ–çš„æ—¶å€™è¿™ä¸ªgetterä¹Ÿä¼šå¾—åˆ°ç›¸åº”çš„æ›´æ–°ã€‚æ–¹æ³•çš„æœ€åï¼Œå¤„ç†äº†hotUpdateæ—¶å€™çš„é€»è¾‘ï¼Œå³é”€æ¯æ—§çš„å®ä¾‹ï¼š 12345678910111213141516171819hotUpdate (newOptions) &#123; this._modules.update(newOptions) resetStore(this, true) &#125;function resetStoreVM (store, state, hot) &#123; const oldVm = store._vm // ... if (oldVm) &#123; if (hot) &#123; // dispatch changes in all subscribed watchers // to force getter re-evaluation for hot reloading. store._withCommit(() =&gt; &#123; oldVm._data.$$state = null &#125;) &#125; Vue.nextTick(() =&gt; oldVm.$destroy()) &#125;&#125; è‡³æ­¤ï¼Œæ•´ä¸ªStore.jsçš„ä¸»é¢˜åˆå§‹åŒ–æµç¨‹å·²ç»åˆ†æå®Œæ¯•ï¼Œä¸‹é¢åˆ†æä¸€å†™å†…ç½®å‡½æ•°ä»¥åŠè¾…åŠ©å‡½æ•°çš„å®ç° å·¥å…·å‡½æ•°æ›´æ”¹Vuexçš„storeä¸­çš„çŠ¶æ€çš„å”¯ä¸€æ–¹æ³•æ˜¯æäº¤mutationã€‚Vuexä¸­çš„mutationéå¸¸ç±»ä¼¼äºäº‹ä»¶ï¼šæ¯ä¸ªmutationéƒ½æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²çš„ äº‹ä»¶ç±»å‹ (type) å’Œ ä¸€ä¸ª å›è°ƒå‡½æ•° (handler)ã€‚è¿™ä¸ªå›è°ƒå‡½æ•°å°±æ˜¯æˆ‘ä»¬å®é™…è¿›è¡ŒçŠ¶æ€æ›´æ”¹çš„åœ°æ–¹ï¼Œå¹¶ä¸”å®ƒä¼šæ¥å— state ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼š 1234567891011const store = new Vuex.Store(&#123; state: &#123; count: 1 &#125;, mutations: &#123; increment (state) &#123; // å˜æ›´çŠ¶æ€ state.count++ &#125; &#125;&#125;) æˆ‘ä»¬ä¸èƒ½ç›´æ¥è°ƒç”¨ä¸€ä¸ªmutation handlerï¼Œéœ€è¦ä»¥ç›¸åº”çš„typeè°ƒç”¨store.commitæ–¹æ³•ï¼š 1store.commit('increment') çœ‹ä¸€ä¸‹commitæ–¹æ³•ç›¸å…³çš„å®ç°ï¼š 1234567891011121314151617181920212223242526272829303132333435commit (_type, _payload, _options) &#123; // å°†å¯¹è±¡é£æ ¼çš„commitæ ¼å¼åŒ– const &#123; type, payload, options &#125; = unifyObjectStyle(_type, _payload, _options) const mutation = &#123; type, payload &#125; // é€šè¿‡mutation typeæ‰¾åˆ°å¯¹åº”çš„å›è°ƒå‡½æ•°handlerå¹¶æ‰§è¡Œ const entry = this._mutations[type] if (!entry) &#123; if (process.env.NODE_ENV !== 'production') &#123; console.error(`[vuex] unknown mutation type: $&#123;type&#125;`) &#125; return &#125; this._withCommit(() =&gt; &#123; entry.forEach(function commitIterator (handler) &#123; handler(payload) &#125;) &#125;) // é€šçŸ¥æ‰€æœ‰çš„è®¢é˜…è€… this._subscribers.forEach(sub =&gt; sub(mutation, this.state)) if ( process.env.NODE_ENV !== 'production' &amp;&amp; options &amp;&amp; options.silent ) &#123; console.warn( `[vuex] mutation type: $&#123;type&#125;. Silent option has been removed. ` + 'Use the filter functionality in the vue-devtools' ) &#125; &#125; é¦–å…ˆåŒæ ·æ˜¯å°†è½½è·æ–¹å¼å’Œå¯¹è±¡æ–¹å¼çš„commitæ ¼å¼åŒ–ï¼Œç„¶åæ‰¾åˆ°typeå¯¹åº”çš„mutationï¼Œåœ¨ç¡®ä¿æ•°æ®æ›´æ–°æ–¹å¼æ­£ç¡®çš„æƒ…å†µä¸‹å¾ªç¯æ‰§è¡Œmutationé‡Œé¢çš„æ–¹æ³•ï¼Œç„¶åæ‰€æœ‰mutationç›¸å…³çš„è®¢é˜…è€…ã€‚ dispatchçš„é€»è¾‘è¦ç¨å¾®å¤æ‚ä¸€äº›ï¼Œå› ä¸ºé€šè¿‡dispatchåˆ†å‘actionæ˜¯å¯ä»¥æ‰§è¡Œå¼‚æ­¥æ“ä½œçš„ï¼Œç„¶ååœ¨actionå†…éƒ¨æ‰§è¡Œå¼‚æ­¥æ“ä½œåå†commitä¸€ä¸ªmutationï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445dispatch (_type, _payload) &#123; // å¯¹è±¡é£æ ¼çš„dispatchæ ¼å¼åŒ– const &#123; type, payload &#125; = unifyObjectStyle(_type, _payload) const action = &#123; type, payload &#125; const entry = this._actions[type] if (!entry) &#123; if (process.env.NODE_ENV !== 'production') &#123; console.error(`[vuex] unknown action type: $&#123;type&#125;`) &#125; return &#125; // ä» 3.1.0 èµ·ï¼ŒsubscribeAction ä¹Ÿå¯ä»¥æŒ‡å®šè®¢é˜…å¤„ç†å‡½æ•°çš„è¢«è°ƒç”¨æ—¶æœºåº”è¯¥åœ¨ä¸€ä¸ª action åˆ†å‘ä¹‹å‰è¿˜æ˜¯ä¹‹å (é»˜è®¤è¡Œä¸ºæ˜¯ä¹‹å‰) try &#123; this._actionSubscribers .filter(sub =&gt; sub.before) .forEach(sub =&gt; sub.before(action, this.state)) &#125; catch (e) &#123; if (process.env.NODE_ENV !== 'production') &#123; console.warn(`[vuex] error in before action subscribers: `) console.error(e) &#125; &#125; const result = entry.length &gt; 1 ? Promise.all(entry.map(handler =&gt; handler(payload))) : entry[0](payload) return result.then(res =&gt; &#123; try &#123; this._actionSubscribers .filter(sub =&gt; sub.after) .forEach(sub =&gt; sub.after(action, this.state)) &#125; catch (e) &#123; if (process.env.NODE_ENV !== 'production') &#123; console.warn(`[vuex] error in after action subscribers: `) console.error(e) &#125; &#125; return res &#125;) &#125; åŒæ ·æ˜¯å…ˆæ ¼å¼åŒ–å‚æ•°ï¼Œç„¶åtypeå¯¹åº”çš„actionï¼Œå…ˆåˆ¤æ–­è¯¥typeæ˜¯å¦å­˜åœ¨ï¼Œç„¶åæ‰§è¡Œ_actionSubscribersé‡Œé¢åœ¨actionåˆ†å‘ä¹‹å‰çš„å›è°ƒï¼Œè¿™æ˜¯3.1.0å¼€å§‹æœ‰çš„æ–°åŠŸèƒ½ï¼Œå¯ä»¥æŒ‡å®šè®¢é˜…å¤„ç†å‡½æ•°çš„è¢«è°ƒç”¨æ—¶æœºåº”è¯¥åœ¨ä¸€ä¸ª action åˆ†å‘ä¹‹å‰è¿˜æ˜¯ä¹‹å (é»˜è®¤è¡Œä¸ºæ˜¯ä¹‹å‰)ï¼Œè¿™ä¸ªåŠŸèƒ½å¤šç”¨äºæ’ä»¶ä½¿ç”¨ï¼Œç„¶ååˆ†å‘actionï¼Œå¦‚æœåŒä¸€ä¸ªtypeçš„actionæœ‰å¤šä¸ªå°±ç”¨Promise.allå»åˆ†å‘ï¼Œå¦åˆ™ç›´æ¥ä¼ å…¥è½½è·ï¼Œåœ¨æ‰§è¡Œåˆ†å‘actionå®Œæ¯•ä¹‹åæ‰§è¡Œ_actionSubscribersé‡Œé¢åœ¨actionåˆ†å‘ä¹‹åçš„å›è°ƒï¼Œè‡³æ­¤å®Œæˆä¸€æ¬¡dispatchã€‚ è¾…åŠ©å‡½æ•°ä¸ºäº†è§£å†³é‡å¤ä»£ç çš„å†—ä½™æ€§ï¼ŒVuexå¯¹å¤–æä¾›äº†ä¸€äº›å·¥å…·å‡½æ•°ï¼Œè¿™äº›å·¥å…·å‡½æ•°ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬ç”Ÿæˆè®¡ç®—å±æ€§å‡å°‘å·¥ä½œé‡ï¼Œè¿™äº›å‡½æ•°éƒ½ä½äºsrc/helpers.jsç›®å½•ä¸‹ï¼Œè¿™é‡Œå¯ä»¥åˆ†æä¸€ä¸‹mapStateçš„å®ç°ï¼š 1234567891011121314151617181920212223242526272829/** * Reduce the code which written in Vue.js for getting the state. * @param &#123;String&#125; [namespace] - Module's namespace * @param &#123;Object|Array&#125; states # Object's item can be a function which accept state and getters for param, you can do something for state and getters in it. * @param &#123;Object&#125; */export const mapState = normalizeNamespace((namespace, states) =&gt; &#123; const res = &#123;&#125; normalizeMap(states).forEach((&#123; key, val &#125;) =&gt; &#123; res[key] = function mappedState () &#123; let state = this.$store.state let getters = this.$store.getters if (namespace) &#123; const module = getModuleByNamespace(this.$store, 'mapState', namespace) if (!module) &#123; return &#125; state = module.context.state getters = module.context.getters &#125; return typeof val === 'function' ? val.call(this, state, getters) : state[val] &#125; // mark vuex getter for devtools res[key].vuex = true &#125;) return res&#125;) mapStateå‡½æ•°å¯ä»¥ä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¯é€‰å‚æ•°ï¼Œä»£è¡¨å‘½åç©ºé—´å­—ç¬¦ä¸²ï¼Œå¯¹è±¡å½¢å¼çš„ç¬¬äºŒä¸ªå‚æ•°çš„æˆå‘˜å¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ï¼š 1mapState(namespace?: string, map: Array&lt;string&gt; | Object&lt;string | function&gt;): Object æ‰§è¡ŒmapStateå…¶å®å°±æ˜¯æ‰§è¡ŒnormalizeNamespaceè¿”å›çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„ä½œç”¨ä¹Ÿå¾ˆç®€å•ï¼š 1234567891011121314151617/** * Return a function expect two param contains namespace and map. it will normalize the namespace and then the param's function will handle the new namespace and the map. * @param &#123;Function&#125; fn * @return &#123;Function&#125; */function normalizeNamespace (fn) &#123; return (namespace, map) =&gt; &#123; if (typeof namespace !== 'string') &#123; map = namespace namespace = '' &#125; else if (namespace.charAt(namespace.length - 1) !== '/') &#123; namespace += '/' &#125; return fn(namespace, map) &#125;&#125; åˆ¤æ–­æ˜¯å¦ä¼ å…¥äº†namespaceå‚æ•°ï¼Œæ²¡æœ‰çš„è¯ï¼Œå°†namespaceèµ‹å€¼ç»™mapå‚æ•°ï¼Œå¦‚æœä¼ äº†namespaceåˆ™æ‹¼æ¥å¥½è·¯å¾„ï¼Œæœ€åå°†å¤„ç†å¥½çš„mapä½œä¸ºstatesä¼ å…¥å¤„ç†å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°é¦–å…ˆä¼šå¯¹statesæ‰§è¡ŒnormalizeMapå¤„ç†ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯æŠŠæˆ‘ä»¬ä¼ å…¥mapStateçš„æ•°ç»„/å¯¹è±¡ç»Ÿä¸€è½¬æ¢æˆä¸€ä¸ªå†…éƒ¨å…ƒç´ éƒ½æ˜¯å½¢å¦‚{ key: &#39;a&#39;, val: 1 }çš„æ•°ç»„ï¼š 12345function normalizeMap (map) &#123; return Array.isArray(map) ? map.map(key =&gt; (&#123; key, val: key &#125;)) : Object.keys(map).map(key =&gt; (&#123; key, val: map[key] &#125;))&#125; ç„¶åå¾ªç¯å¤„ç†æ•°ç»„ï¼Œç»“æ„æ¯ä¸€é¡¹çš„keyå’Œvalï¼Œç”¨ä¸€ä¸ªç©ºå¯¹è±¡å­˜å‚¨ï¼Œkeyä½œä¸ºè¿™ä¸ªç©ºå¯¹è±¡resçš„keyï¼Œkeyå¯¹åº”çš„å€¼æ˜¯ä¸€ä¸ªåä¸ºmappedStateçš„å‡½æ•°ï¼Œåœ¨å‡½æ•°å†…éƒ¨è·å–åˆ°äº†stateã€gettersï¼Œç„¶åå†åˆ¤æ–­æ•°ç»„çš„valæ˜¯å¦æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ˜¯çš„è¯ç›´æ¥è°ƒç”¨ï¼Œå¹¶ä¼ å…¥stateå’Œgettersï¼Œå¦åˆ™ç›´æ¥è¿”å›state[val]ã€‚æœ€åå°†æ„å»ºå¥½çš„reså¯¹è±¡è¿”å›ï¼Œé€šè¿‡å¯¹è±¡å±•å¼€è¿ç®—ç¬¦å°†è¿™ä¸ªreså¡«å……åˆ°computedä¸­ã€‚ æ€»ç»“åœ¨Vuexçš„æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬çš„ç»„ä»¶æ ‘æ„æˆäº†ä¸€ä¸ªå·¨å¤§çš„è§†å›¾ï¼Œæ— è®ºè¯¥ç»„ä»¶åœ¨æ ‘çš„å“ªä¸ªä½ç½®ï¼Œå®ƒéƒ½å¯ä»¥è·å–çŠ¶æ€æˆ–è€…è§¦å‘çŠ¶æ€æ›´æ–°çš„è¡Œä¸ºï¼Œé€šè¿‡å®šä¹‰å’Œéš”ç¦»çŠ¶æ€ç®¡ç†ä¸­çš„å„ç§æ¦‚å¿µå¹¶é€šè¿‡å¼ºåˆ¶è§„åˆ™ç»´æŒè§†å›¾å’ŒçŠ¶æ€é—´çš„ç‹¬ç«‹æ€§ï¼Œæˆ‘ä»¬çš„ä»£ç å°†ä¼šå˜å¾—æ›´ç»“æ„åŒ–ä¸”æ˜“ç»´æŠ¤ï¼š","tags":[{"name":"javascript","slug":"javascript","permalink":"https://www.limuyang.cc/tags/javascript/"},{"name":"æºç é˜…è¯»","slug":"æºç é˜…è¯»","permalink":"https://www.limuyang.cc/tags/æºç é˜…è¯»/"},{"name":"vuex","slug":"vuex","permalink":"https://www.limuyang.cc/tags/vuex/"}]},{"title":"é˜…è¯»åˆ†æsnabbdomæºç ","date":"2019-03-06T22:20:26.000Z","path":"2019/03/06/é˜…è¯»åˆ†æsnabbdomæºç /","text":"å°¤å¤§åœ¨å®˜å®£Vue 2.0çš„æ—¶å€™è¿™ä¹ˆè¯´è¿‡ï¼š æ¸²æŸ“å±‚åŸºäºä¸€ä¸ªè½»é‡çº§çš„ Virtual DOM å®ç°è¿›è¡Œäº†é‡å†™ï¼Œè¯¥ Virtual DOM å®ç° fork è‡ª snabbdomã€‚æ–°çš„æ¸²æŸ“å±‚ç›¸æ¯” v1 å¸¦æ¥äº†å·¨å¤§çš„æ€§èƒ½æå‡ï¼Œä¹Ÿè®© Vue 2.0 æˆä¸ºäº†æœ€å¿«é€Ÿçš„æ¡†æ¶ä¹‹ä¸€ã€‚é‚£ä¹ˆå¯¹äºæƒ³è¦æ·±å…¥äº†è§£Vueæºç çš„äººæ¥è¯´å…ˆæ·±å…¥äº†è§£ä¸€ä¸‹snabbdomçš„å®ç°æ˜¯æœ‰å¿…è¦çš„ ä»€ä¹ˆæ˜¯Virtual DOM Virtual DOMä½¿ç”¨JavaScriptå¯¹è±¡æ¥æè¿°èŠ‚ç‚¹ï¼Œåªä¿ç•™ä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯ï¼Œå¯ä»¥æ›´è½»é‡çš„æè¿°DOMæ ‘çš„ç»“æ„ å°†åŸæœ¬éœ€è¦åœ¨çœŸå®DOMè¿›è¡Œçš„åˆ›å»ºèŠ‚ç‚¹,åˆ é™¤èŠ‚ç‚¹,æ·»åŠ èŠ‚ç‚¹ç­‰ä¸€ç³»åˆ—å¤æ‚çš„DOMæ“ä½œå…¨éƒ¨æ”¾åˆ°Vritual DOMä¸­è¿›è¡Œæ¯”å¦‚åœ¨æˆ‘ä»¬çš„snabbdomä¸­å°±æ˜¯ç”¨è¿™æ ·çš„æ–¹å¼æ¥å®šä¹‰ä¸€ä¸ªVNODEï¼š 12345678910111213141516171819202122232425export interface VNode &#123; sel: string | undefined; data: VNodeData | undefined; children: Array&lt;VNode | string&gt; | undefined; elm: Node | undefined; text: string | undefined; key: Key | undefined;&#125;export interface VNodeData &#123; props?: Props; attrs?: Attrs; class?: Classes; style?: VNodeStyle; dataset?: Dataset; on?: On; hero?: Hero; attachData?: AttachData; hook?: Hooks; key?: Key; ns?: string; // for SVGs fn?: () =&gt; VNode; // for thunks args?: Array&lt;any&gt;; // for thunks [key: string]: any; // for any other 3rd party module&#125; æ—¢ç„¶DOMæ ‘ä¿¡æ¯å¯ä»¥é€šè¿‡JavaScriptå¯¹è±¡æ¥è¡¨ç¤ºï¼Œåè¿‡æ¥æˆ‘ä»¬å°±å¯ä»¥ç”¨è¿™ä¸ªJavaScriptå¯¹è±¡è¿˜åŸæ„å»ºä¸€æ£µçœŸæ­£çš„DOMæ ‘ï¼Œå½“çŠ¶æ€å˜åŒ–çš„æ—¶å€™é‡æ–°æ¸²æŸ“è¿™ä¸ª JavaScript çš„å¯¹è±¡ç»“æ„ï¼Œç„¶åå°†ä¸¤ä¸ªJavScriptå¯¹è±¡è¿›è¡Œå¯¹æ¯”ï¼Œè®°å½•å·®å¼‚ï¼Œç„¶åæŠŠå®ƒä»¬åº”ç”¨åœ¨çœŸå®çš„DOMæ ‘ä¸Šï¼Œè¿™ä¾¿æ˜¯diffç®—æ³• åˆ†ææºç ä»å®˜æ–¹ç»™çš„Demoå…¥æ‰‹1234567891011121314151617181920212223242526var snabbdom = require('snabbdom');var patch = snabbdom.init([ // Init patch function with chosen modules require('snabbdom/modules/class').default, // makes it easy to toggle classes require('snabbdom/modules/props').default, // for setting properties on DOM elements require('snabbdom/modules/style').default, // handles styling on elements with support for animations require('snabbdom/modules/eventlisteners').default, // attaches event listeners]);var h = require('snabbdom/h').default; // helper function for creating vnodesvar container = document.getElementById('container');var vnode = h('div#container.two.classes', &#123;on: &#123;click: someFn&#125;&#125;, [ h('span', &#123;style: &#123;fontWeight: 'bold'&#125;&#125;, 'This is bold'), ' and this is just normal text', h('a', &#123;props: &#123;href: '/foo'&#125;&#125;, 'I\\'ll take you places!')]);// Patch into empty DOM element â€“ this modifies the DOM as a side effectpatch(container, vnode);var newVnode = h('div#container.two.classes', &#123;on: &#123;click: anotherEventHandler&#125;&#125;, [ h('span', &#123;style: &#123;fontWeight: 'normal', fontStyle: 'italic'&#125;&#125;, 'This is now italic type'), ' and this is still just normal text', h('a', &#123;props: &#123;href: '/bar'&#125;&#125;, 'I\\'ll take you places!')]);// Second `patch` invocationpatch(vnode, newVnode); // Snabbdom efficiently updates the old view to the new state å¯ä»¥çœ‹åˆ°snabbdomæ ¸å¿ƒæ¨¡å—å¯¹å¤–æš´éœ²ä¸€ä¸ªinitæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„é‡Œé¢çš„æ¯ä¸€é¡¹éƒ½æ˜¯ä¸€ä¸ªmoduleï¼Œè¿™äº›moduleçš„ä½œç”¨æ˜¯æ‰©å±•snabbdomç”Ÿæˆå¤æ‚DOMçš„èƒ½åŠ›ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚å†³å®šæ˜¯å¦è¦å¼•å…¥å¯¹åº”çš„moduleï¼Œä¸æ­¤åŒæ—¶ä½ ä¹Ÿå¯ä»¥å®ç°è‡ªå·±çš„moduleï¼Œæ‰“ä¸ªæ¯”æ–¹ï¼Œå¦‚æœä½ çš„vnodeèŠ‚ç‚¹ä¸éœ€è¦å†™å…¥listenerï¼Œä½ å¯ä»¥ä¸å¼•å…¥snabbdom/modules/eventlistenersï¼Œè°ƒç”¨initæ–¹æ³•ä¹‹åä¼šè¿”å›ä¸€ä¸ªpatchå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªDOMèŠ‚ç‚¹æˆ–è€…ä¸€ä¸ªç”¨äºè¡¨ç¤ºå½“å‰è§†å›¾çš„vnodeèŠ‚ç‚¹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¡¨ç¤ºå³å°†è¦æ›´æ–°çš„è§†å›¾çš„vnodeèŠ‚ç‚¹ï¼Œpatchå‡½æ•°ä¼šæ ¹æ®ä¼ é€’çš„å‚æ•°ä¸åŒè¿›è¡Œå¯¹åº”çš„DOMæ›´æ–°æ“ä½œï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥å…ˆçœ‹ä¸€ä¸‹initå‡½æ•°çš„æ ¸å¿ƒå®ç°(ä¸ºäº†ç†è§£æ–¹ä¾¿æš‚æ—¶éšå»å‡½æ•°å†…éƒ¨çš„å®ç°ç»†èŠ‚)ï¼š1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374export interface Module &#123; pre: PreHook; create: CreateHook; update: UpdateHook; destroy: DestroyHook; remove: RemoveHook; post: PostHook;&#125;export function init(modules: Array&lt;Partial&lt;Module&gt;&gt;, domApi?: DOMAPI) &#123; // cbs ç”¨äºæ”¶é›† module ä¸­çš„ hook let i: number, j: number, cbs = &#123;&#125; as ModuleHooks; const api: DOMAPI = domApi !== undefined ? domApi : htmlDomApi; // æ”¶é›† module ä¸­çš„ hook for (i = 0; i &lt; hooks.length; ++i) &#123; cbs[hooks[i]] = []; for (j = 0; j &lt; modules.length; ++j) &#123; const hook = modules[j][hooks[i]]; if (hook !== undefined) &#123; (cbs[hooks[i]] as Array&lt;any&gt;).push(hook); &#125; &#125; &#125; function emptyNodeAt(elm: Element) &#123; // ... &#125; function createRmCb(childElm: Node, listeners: number) &#123; // ... &#125; // åˆ›å»ºçœŸæ­£çš„ dom èŠ‚ç‚¹ function createElm(vnode: VNode, insertedVnodeQueue: VNodeQueue): Node &#123; // ... &#125; function addVnodes( parentElm: Node, before: Node | null, vnodes: Array&lt;VNode&gt;, startIdx: number, endIdx: number, insertedVnodeQueue: VNodeQueue ) &#123; // ... &#125; // è°ƒç”¨ destory hook // å¦‚æœå­˜åœ¨ children é€’å½’è°ƒç”¨ function invokeDestroyHook(vnode: VNode) &#123; // ... &#125; function removeVnodes(parentElm: Node, vnodes: Array&lt;VNode&gt;, startIdx: number, endIdx: number): void &#123; // ... &#125; function updateChildren(parentElm: Node, oldCh: Array&lt;VNode&gt;, newCh: Array&lt;VNode&gt;, insertedVnodeQueue: VNodeQueue) &#123; // ... &#125; function patchVnode(oldVnode: VNode, vnode: VNode, insertedVnodeQueue: VNodeQueue) &#123; // ... &#125; return function patch(oldVnode: VNode | Element, vnode: VNode): VNode &#123; // ... &#125;;&#125; å¯ä»¥çœ‹åˆ°é¦–å…ˆinitæ–¹æ³•ä¼šæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªç”±moduleç»„æˆçš„æ•°ç»„ï¼Œä»¥åŠä¸€ä¸ªå¯é€‰å‚æ•°domApiï¼Œé»˜è®¤æ˜¯ä½¿ç”¨é¢„å®šä¹‰çš„ä¸€äº›å’ŒDOMæ“ä½œç›¸å…³çš„APIï¼Œæ¥ä¸‹æ¥ä¼šé€šè¿‡å¾ªç¯éå†æ”¶é›†modulesä¸­çš„hookï¼Œå­˜å‚¨åˆ°cbså¯¹è±¡ä¸­ï¼Œä»¥ä¾¿åœ¨æ°å½“çš„æ—¶æœºå¯¹DOMèŠ‚ç‚¹è¿›è¡Œä¸€äº›æ“ä½œï¼Œä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹classè¿™ä¸ªmoduleçš„æºç ï¼š123456789101112131415161718192021222324\"use strict\";Object.defineProperty(exports, \"__esModule\", &#123; value: true &#125;);function updateClass(oldVnode, vnode) &#123; var cur, name, elm = vnode.elm, oldClass = oldVnode.data.class, klass = vnode.data.class; if (!oldClass &amp;&amp; !klass) return; if (oldClass === klass) return; oldClass = oldClass || &#123;&#125;; klass = klass || &#123;&#125;; for (name in oldClass) &#123; if (!klass[name]) &#123; elm.classList.remove(name); &#125; &#125; for (name in klass) &#123; cur = klass[name]; if (cur !== oldClass[name]) &#123; elm.classList[cur ? 'add' : 'remove'](name); &#125; &#125;&#125;exports.classModule = &#123; create: updateClass, update: updateClass &#125;;exports.default = exports.classModule; å¾ˆæ˜æ˜¾å¯ä»¥çœ‹å‡ºè¿™ä¸ªmoduleçš„ä½œç”¨æ˜¯å¯¹æ¯”æ–°æ—§ä¸¤ä¸ªvnodeèŠ‚ç‚¹ï¼Œæ›´æ–°classnameï¼Œæ‰§è¡Œçš„æ—¶æœºåˆ†åˆ«æ˜¯åœ¨è°ƒç”¨createå’Œupdateä¸¤ç§hookçš„æ—¶å€™ï¼Œå…¶ä»–moduleä¹Ÿå·®ä¸å¤šï¼Œè¿™é‡Œä¸å±•å¼€åˆ†æã€‚ä¸‹é¢å‡ ä¸ªéƒ½æ˜¯åŠŸèƒ½å‹å‡½æ•°ç•¥è¿‡ä¸çœ‹ï¼Œç›´æ¥çœ‹è¿”å›çš„patchå‡½æ•° patchå‡½æ•°12345678910111213141516171819202122232425262728293031// ç”¨äºdomç›¸å…³çš„æ›´æ–°return function patch(oldVnode: VNode | Element, vnode: VNode): VNode &#123; let i: number, elm: Node, parent: Node; const insertedVnodeQueue: VNodeQueue = []; // è°ƒç”¨ module ä¸­çš„ pre hook for (i = 0; i &lt; cbs.pre.length; ++i) cbs.pre[i](); if (!isVnode(oldVnode)) &#123; oldVnode = emptyNodeAt(oldVnode); &#125; // åˆ¤æ–­ä¸¤ä¸ªVnodeèŠ‚ç‚¹æ˜¯å¦ç›¸åŒ if (sameVnode(oldVnode, vnode)) &#123; patchVnode(oldVnode, vnode, insertedVnodeQueue); &#125; else &#123; elm = oldVnode.elm as Node; parent = api.parentNode(elm); createElm(vnode, insertedVnodeQueue); if (parent !== null) &#123; api.insertBefore(parent, vnode.elm as Node, api.nextSibling(elm)); removeVnodes(parent, [oldVnode], 0, 0); &#125; &#125; for (i = 0; i &lt; insertedVnodeQueue.length; ++i) &#123; (((insertedVnodeQueue[i].data as VNodeData).hook as Hooks).insert as any)(insertedVnodeQueue[i]); &#125; for (i = 0; i &lt; cbs.post.length; ++i) cbs.post[i](); return vnode;&#125;; å…ˆé€šè¿‡isVnodeæ–¹æ³•æ¥åˆ¤æ–­ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸æ˜¯vnodeï¼Œå¦‚æœä¸æ˜¯çš„è¯é€šè¿‡emptyNodeAtæ–¹æ³•æ¥å°†å…¶è½¬æ¢æˆvnodeï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•å®ç°éƒ½æ¯”è¾ƒç®€å•ï¼š12345678910111213// isVnodefunction isVnode(vnode: any): vnode is VNode &#123; // åˆ¤æ–­æ˜¯å¦å…·æœ‰selå±æ€§ return vnode.sel !== undefined;&#125;// emptyNodeAtfunction emptyNodeAt(elm: Element) &#123; const id = elm.id ? '#' + elm.id : ''; const c = elm.className ? '.' + elm.className.split(' ').join('.') : ''; return vnode(api.tagName(elm).toLowerCase() + id + c, &#123;&#125;, [], undefined, elm); &#125; çœ‹ä¸€çœ¼vnodeæ–¹æ³•çš„å®ç°ï¼š123456789export function vnode(sel: string | undefined, data: any | undefined, children: Array&lt;VNode | string&gt; | undefined, text: string | undefined, elm: Element | Text | undefined): VNode &#123; let key = data === undefined ? undefined : data.key; return &#123;sel: sel, data: data, children: children, text: text, elm: elm, key: key&#125;;&#125; æ¥ç€å¾€ä¸‹çœ‹ï¼Œå½“ä¸¤ä¸ªéœ€è¦è¢«å¯¹æ¯”çš„èŠ‚ç‚¹éƒ½è½¬åŒ–æˆäº†vnodeä¹‹åï¼Œé€šè¿‡sameVnodeæ–¹æ³•åˆ¤æ–­ä¸¤ä¸ªVnodeèŠ‚ç‚¹æ˜¯å¦ç›¸åŒï¼š123function sameVnode(vnode1: VNode, vnode2: VNode): boolean &#123; return vnode1.key === vnode2.key &amp;&amp; vnode1.sel === vnode2.sel;&#125; è¿™é‡Œé€šè¿‡åˆ¤æ–­keyå’Œselæ˜¯å¦ç›¸åŒæ¥åˆ¤æ–­æ˜¯å¦æ˜¯ç›¸åŒvnodeèŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯ä¸¤ä¸ªç›¸åŒçš„vnodeèŠ‚ç‚¹ï¼Œè°ƒç”¨patchVnodeæ–¹æ³•æ¥å¯¹æ¯”æ›´æ–°ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™é€šè¿‡createElmæ–¹æ³•åˆ›å»ºæ–°çš„DOMèŠ‚ç‚¹ï¼Œå¦‚æœå­˜åœ¨çˆ¶èŠ‚ç‚¹ï¼Œåˆ™é€šè¿‡htmdomapié‡Œé¢çš„insertBeforeæ–¹æ³•æ’å…¥æ–°çš„DOMèŠ‚ç‚¹åˆ°å­èŠ‚ç‚¹çš„æœ«å°¾ï¼Œç„¶åé€šè¿‡removeVnodesç§»é™¤æ—§èŠ‚ç‚¹å®Œæˆæ›´æ–°ï¼Œè¿™é‡Œçš„å…³é”®æ–¹æ³•æ˜¯patchVnodeå’ŒcreateElmï¼Œç®€å•èµ·è§å…ˆçœ‹ç¬¬äºŒä¸ªã€‚ createElm12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758// é€šè¿‡vnodeåˆ›å»ºçœŸæ­£çš„domèŠ‚ç‚¹function createElm(vnode: VNode, insertedVnodeQueue: VNodeQueue): Node &#123; let i: any, data = vnode.data; if (data !== undefined) &#123; if (isDef(i = data.hook) &amp;&amp; isDef(i = i.init)) &#123; // è°ƒç”¨init hook i(vnode); data = vnode.data; &#125; &#125; let children = vnode.children, sel = vnode.sel; // å¦‚æœæ˜¯æ³¨é‡ŠèŠ‚ç‚¹ if (sel === '!') &#123; if (isUndef(vnode.text)) &#123; vnode.text = ''; &#125; vnode.elm = api.createComment(vnode.text as string); &#125; else if (sel !== undefined) &#123; // è§£æsel const hashIdx = sel.indexOf('#'); const dotIdx = sel.indexOf('.', hashIdx); const hash = hashIdx &gt; 0 ? hashIdx : sel.length; const dot = dotIdx &gt; 0 ? dotIdx : sel.length; const tag = hashIdx !== -1 || dotIdx !== -1 ? sel.slice(0, Math.min(hash, dot)) : sel; // å¦‚æœæœ‰nså±æ€§è¯´æ˜æ˜¯svgå…ƒç´  const elm = vnode.elm = isDef(data) &amp;&amp; isDef(i = (data as VNodeData).ns) ? api.createElementNS(i, tag) : api.createElement(tag); // è®¾ç½®å…ƒç´ id if (hash &lt; dot) elm.setAttribute('id', sel.slice(hash + 1, dot)); // è®¾ç½®å…ƒç´ classname if (dotIdx &gt; 0) elm.setAttribute('class', sel.slice(dot + 1).replace(/\\./g, ' ')); // è°ƒç”¨create hook for (i = 0; i &lt; cbs.create.length; ++i) cbs.create[i](emptyNode, vnode); // åˆ›å»ºå­å…ƒç´ èŠ‚ç‚¹ if (is.array(children)) &#123; for (i = 0; i &lt; children.length; ++i) &#123; const ch = children[i]; if (ch != null) &#123; api.appendChild(elm, createElm(ch as VNode, insertedVnodeQueue)); &#125; &#125; &#125; else if (is.primitive(vnode.text)) &#123; // æ–‡æœ¬èŠ‚ç‚¹ api.appendChild(elm, api.createTextNode(vnode.text)); &#125; i = (vnode.data as VNodeData).hook; // Reuse variable if (isDef(i)) &#123; // è°ƒç”¨èŠ‚ç‚¹çš„create hook if (i.create) i.create(emptyNode, vnode); // insert hookè¦ç­‰domçœŸæ­£æŒ‚è½½çš„æ—¶å€™æ‰ä¼šè°ƒç”¨ï¼Œè¿™é‡Œå…ˆå­˜å‚¨åˆ°æ•°ç»„é‡Œé¢ if (i.insert) insertedVnodeQueue.push(vnode); &#125; &#125; else &#123; // æ–‡æœ¬èŠ‚ç‚¹ vnode.elm = api.createTextNode(vnode.text as string); &#125; return vnode.elm;&#125; åˆ›å»ºDOMçš„æ—¶å€™é¦–å…ˆè°ƒç”¨vnodeèŠ‚ç‚¹çš„init hookï¼Œç„¶ååˆ¤æ–­è¯¥vnodeèŠ‚ç‚¹æ˜¯æ³¨é‡ŠèŠ‚ç‚¹/æ–‡æœ¬èŠ‚ç‚¹/å¸¦é€‰æ‹©å™¨èŠ‚ç‚¹çš„å…¶ä¸­ä¹‹ä¸€ï¼Œè‡³äºä¸ºä»€ä¹ˆsel === &#39;!&#39;å°±è¯´æ˜æ˜¯æ³¨é‡ŠèŠ‚ç‚¹è¿™é‡Œå¯ä»¥è§£é‡Šä¸€ä¸‹ï¼Œsnabbdomæä¾›äº†tovnodeæ–¹æ³•æ¥å°†ä¸€ä¸ªDOMèŠ‚ç‚¹è½¬æ¢æˆvnodeèŠ‚ç‚¹ï¼Œå¤§è‡´ç”¨æ³•å¦‚ä¸‹ï¼š12345678910111213141516var snabbdom = require('snabbdom')var patch = snabbdom.init([ // Init patch function with chosen modules require('snabbdom/modules/class').default, // makes it easy to toggle classes require('snabbdom/modules/props').default, // for setting properties on DOM elements require('snabbdom/modules/style').default, // handles styling on elements with support for animations require('snabbdom/modules/eventlisteners').default, // attaches event listeners]);var h = require('snabbdom/h').default; // helper function for creating vnodesvar toVNode = require('snabbdom/tovnode').default;var newVNode = h('div', &#123;style: &#123;color: '#000'&#125;&#125;, [ h('h1', 'Headline'), h('p', 'A paragraph'),]);patch(toVNode(document.querySelector('.container')), newVNode) è¿™ä¸ªtovnodeçš„æºç é‡Œé¢æœ‰è¿™ä¹ˆä¸€æ®µï¼š1234567...&#125; else if (api.isComment(node)) &#123; text = api.getTextContent(node) as string; return vnode('!', &#123;&#125;, [], text, node as any); &#125; else &#123; return vnode('', &#123;&#125;, [], undefined, node as any);... é‚£ä¹ˆæˆ‘ä»¬å†æ‰¾ä¸€ä¸‹isCommentæ–¹æ³•åšäº†ä»€ä¹ˆï¼š123function isComment(node: Node): node is Comment &#123; return node.nodeType === 8;&#125; èŠ‚ç‚¹ç±»å‹å¸¸é‡é‡Œé¢type 8å°±æ˜¯Node.COMMENT_NODEä¹Ÿå°±æ˜¯æ³¨é‡ŠèŠ‚ç‚¹ ç„¶åé¡ºç€æºç æˆ‘ä»¬è¿™é‡Œä¸»è¦çœ‹å¸¦é€‰æ‹©å™¨èŠ‚ç‚¹çš„åˆ›å»ºï¼Œé¦–å…ˆå¾—åˆ°tagnameã€classã€idï¼Œç„¶ååœ¨æ ¹æ®æ˜¯å¦æœ‰nså±æ€§æ¥å†³å®šé€šè¿‡createElementè¿˜æ˜¯createElementNSæ¥åˆ›å»ºèŠ‚ç‚¹ï¼Œç´§æ¥ç€å¦‚æœå­˜åœ¨childrenï¼Œå¾ªç¯éå†è°ƒç”¨createElmæ–¹æ³•åˆ›å»ºå­èŠ‚ç‚¹å¹¶æŒ‚è½½åˆ°çˆ¶èŠ‚ç‚¹ä¸Šé¢ï¼ŒDOMèŠ‚ç‚¹åˆ›å»ºå®Œæ¯•ä¹‹åè°ƒç”¨ç›¸åº”çš„hooklå³å¯ã€‚ patchVnodepatchVnodeæ–¹æ³•ä¼šå¯¹ä¼ å…¥çš„ä¸¤ä¸ªvnodeèŠ‚ç‚¹è¿›è¡Œå¯¹æ¯”ï¼Œæœ€ç»ˆå¯¹æ¯”çš„ç»“æœä¼šä½“ç°åœ¨DOMä¸Šï¼Œè¿™ä¾¿æ˜¯diffç®—æ³•ï¼š1234567891011121314151617181920212223242526272829303132333435363738394041424344454647function patchVnode(oldVnode: VNode, vnode: VNode, insertedVnodeQueue: VNodeQueue) &#123; let i: any, hook: any; // è°ƒç”¨prepatch hook if (isDef(i = vnode.data) &amp;&amp; isDef(hook = i.hook) &amp;&amp; isDef(i = hook.prepatch)) &#123; i(oldVnode, vnode); &#125; const elm = vnode.elm = (oldVnode.elm as Node); let oldCh = oldVnode.children; let ch = vnode.children; // å¦‚æœä¸¤ä¸ªvnodeå®Œå…¨ç›¸åŒï¼Œç›´æ¥è¿”å› if (oldVnode === vnode) return; if (vnode.data !== undefined) &#123; // è°ƒç”¨ module ä¸Šçš„ update hook for (i = 0; i &lt; cbs.update.length; ++i) cbs.update[i](oldVnode, vnode); i = vnode.data.hook; // è°ƒç”¨vnodeçš„updateæ–¹æ³• if (isDef(i) &amp;&amp; isDef(i = i.update)) i(oldVnode, vnode); &#125; if (isUndef(vnode.text)) &#123; // æ–°èŠ‚ç‚¹å­˜åœ¨children if (isDef(oldCh) &amp;&amp; isDef(ch)) &#123; // æ–°æ—§èŠ‚ç‚¹å‡å­˜åœ¨ childrenï¼Œä¸”ä¸ä¸€æ ·æ—¶ï¼Œå¯¹ children è¿›è¡Œ diff if (oldCh !== ch) updateChildren(elm, oldCh as Array&lt;VNode&gt;, ch as Array&lt;VNode&gt;, insertedVnodeQueue); &#125; else if (isDef(ch)) &#123; // æ—§èŠ‚ç‚¹ä¸å­˜åœ¨ children æ–°èŠ‚ç‚¹æœ‰ children // æ—§èŠ‚ç‚¹å­˜åœ¨ text ç½®ç©º if (isDef(oldVnode.text)) api.setTextContent(elm, ''); addVnodes(elm, null, ch as Array&lt;VNode&gt;, 0, (ch as Array&lt;VNode&gt;).length - 1, insertedVnodeQueue); &#125; else if (isDef(oldCh)) &#123; // æ–°èŠ‚ç‚¹ä¸å­˜åœ¨ children æ—§èŠ‚ç‚¹å­˜åœ¨ children ç§»é™¤æ—§èŠ‚ç‚¹çš„ children removeVnodes(elm, oldCh as Array&lt;VNode&gt;, 0, (oldCh as Array&lt;VNode&gt;).length - 1); &#125; else if (isDef(oldVnode.text)) &#123; api.setTextContent(elm, ''); &#125; &#125; else if (oldVnode.text !== vnode.text) &#123; if (isDef(oldCh)) &#123; // å¦‚æœæ—§çš„vnodeæœ‰childrenåˆ™ç§»é™¤ removeVnodes(elm, oldCh as Array&lt;VNode&gt;, 0, (oldCh as Array&lt;VNode&gt;).length - 1); &#125; // æ›´æ–°text api.setTextContent(elm, vnode.text as string); &#125; // è°ƒç”¨ postpatch hook if (isDef(hook) &amp;&amp; isDef(i = hook.postpatch)) &#123; i(oldVnode, vnode); &#125;&#125; é¦–å…ˆè°ƒç”¨vnodeä¸Šçš„prepatch hookï¼Œç„¶ååˆ¤æ–­ä¸¤ä¸ªvnodeèŠ‚ç‚¹æ˜¯å¦å®Œå…¨ç›¸åŒï¼Œå¦‚æœå®Œå…¨ç›¸åŒåˆ™ç›´æ¥è¿”å›ï¼Œç´§æ¥ç€éå†è°ƒç”¨moduleçš„update hookå’Œvnodeçš„update hookï¼Œç„¶ååˆ†åˆ«å¤„ç†å¦‚ä¸‹å‡ ç§æƒ…å†µï¼š å¦‚æœæ–°èŠ‚ç‚¹ä¸å­˜åœ¨childrenè€Œæ—§èŠ‚ç‚¹å­˜åœ¨ï¼Œé‚£ä¹ˆä½¿ç”¨removeVnodesæ–¹æ³•ç§»é™¤æ—§èŠ‚ç‚¹çš„childrenå¹¶ä¸”è®¾ç½®æ–‡æœ¬å†…å®¹ å¦‚æœæ–°èŠ‚ç‚¹å­˜åœ¨childrenä¸”æ—§èŠ‚ç‚¹æ²¡æœ‰ï¼Œç„¶åç§»é™¤æ—§èŠ‚ç‚¹çš„æ–‡æœ¬å†…å®¹(å¦‚æœæœ‰çš„è¯)ï¼Œæœ€åé€šè¿‡addVnodesæ–¹æ³•æŒ‚è½½å­èŠ‚ç‚¹ å¦‚æœæ–°æ—§èŠ‚ç‚¹å‡å­˜åœ¨childrenï¼Œè°ƒç”¨updateChildrenæ–¹æ³•å¯¹childrenè¿›è¡Œdiff å¦‚æœæ–°æ—§èŠ‚ç‚¹æ–‡æœ¬å†…å®¹ä¸ç›¸åŒï¼Œç§»é™¤æ—§èŠ‚ç‚¹çš„children(å¦‚æœæœ‰çš„è¯)ï¼Œç„¶åæ›´æ–°æ–‡æœ¬å†…å®¹æœ€åå½“ä¸Šè¿°æ­¥éª¤éƒ½å®Œæˆä¹‹åï¼Œè°ƒç”¨vnodeçš„postpatch hooké’©å­ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å…³æ³¨updateChildrenã€addVnodeså’ŒremoveVnodeséƒ½åˆ†åˆ«å¹²äº†ä»€ä¹ˆã€‚ addVnodes1234567891011121314function addVnodes(parentElm: Node, before: Node | null, vnodes: Array&lt;VNode&gt;, startIdx: number, endIdx: number, insertedVnodeQueue: VNodeQueue) &#123; for (; startIdx &lt;= endIdx; ++startIdx) &#123; const ch = vnodes[startIdx]; if (ch != null) &#123; // å¾ªç¯éå†æ’å…¥domèŠ‚ç‚¹ api.insertBefore(parentElm, createElm(ch, insertedVnodeQueue), before); &#125; &#125;&#125; ä¸»è¦å°±æ˜¯é€šè¿‡éå†childrenæ•°ç»„å¹¶ä¸”è°ƒç”¨createElmæ–¹æ³•ç”ŸæˆDOMæ’å…¥åˆ°çˆ¶å…ƒç´ å­èŠ‚ç‚¹æœ«å°¾æ¥è¾¾åˆ°æ·»åŠ èŠ‚ç‚¹çš„ç›®çš„ removeVnodes12345678910111213141516171819202122232425262728293031323334353637function removeVnodes(parentElm: Node, vnodes: Array&lt;VNode&gt;, startIdx: number, endIdx: number): void &#123; for (; startIdx &lt;= endIdx; ++startIdx) &#123; let i: any, listeners: number, rm: () =&gt; void, ch = vnodes[startIdx]; if (ch != null) &#123; // éæ–‡æœ¬èŠ‚ç‚¹ if (isDef(ch.sel)) &#123; // è°ƒç”¨destroy hook invokeDestroyHook(ch); // å½“æ‰€æœ‰çš„remove hookéƒ½è°ƒç”¨äº†æ‰ä¼šçœŸæ­£è°ƒç”¨ç§»é™¤domçš„æ–¹æ³• listeners = cbs.remove.length + 1; rm = createRmCb(ch.elm as Node, listeners); // è°ƒç”¨moduleçš„remove hook for (i = 0; i &lt; cbs.remove.length; ++i) cbs.remove[i](ch, rm); if (isDef(i = ch.data) &amp;&amp; isDef(i = i.hook) &amp;&amp; isDef(i = i.remove)) &#123; // è°ƒç”¨vnodeçš„remove hook i(ch, rm); &#125; else &#123; rm(); &#125; &#125; else &#123; // Text node api.removeChild(parentElm, ch.elm as Node); &#125; &#125; &#125;&#125;function createRmCb(childElm: Node, listeners: number) &#123; return function rmCb() &#123; if (--listeners === 0) &#123; const parent = api.parentNode(childElm); api.removeChild(parent, childElm); &#125; &#125;;&#125; åŒæ ·æ˜¯éå†ï¼Œåªä¸è¿‡è¿™é‡Œæ˜¯ç§»é™¤èŠ‚ç‚¹ updateChildrenæˆ‘ä»¬çŸ¥é“å½“æ–°æ—§èŠ‚ç‚¹å‡æœ‰childrenå¹¶ä¸”äº’ä¸ç›¸åŒçš„æ—¶å€™ä¼šè°ƒç”¨updateChildrenæ–¹æ³•æ¥å¯¹childrenè¿›è¡Œdiffï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697function updateChildren(parentElm: Node, oldCh: Array&lt;VNode&gt;, newCh: Array&lt;VNode&gt;, insertedVnodeQueue: VNodeQueue) &#123; let oldStartIdx = 0, newStartIdx = 0; let oldEndIdx = oldCh.length - 1; let oldStartVnode = oldCh[0]; let oldEndVnode = oldCh[oldEndIdx]; let newEndIdx = newCh.length - 1; let newStartVnode = newCh[0]; let newEndVnode = newCh[newEndIdx]; let oldKeyToIdx: any; let idxInOld: number; let elmToMove: VNode; let before: any; // éå† oldCh newChï¼Œå¯¹èŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒå’Œæ›´æ–° // æ¯è½®æ¯”è¾ƒæœ€å¤šå¤„ç†ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç®—æ³•å¤æ‚åº¦ O(n) while (oldStartIdx &lt;= oldEndIdx &amp;&amp; newStartIdx &lt;= newEndIdx) &#123; if (oldStartVnode == null) &#123; // å½“å‰èŠ‚ç‚¹å¯èƒ½å·²ç»è¢«å¤„ç†è¿‡ oldStartVnode = oldCh[++oldStartIdx]; // Vnode might have been moved left &#125; else if (oldEndVnode == null) &#123; oldEndVnode = oldCh[--oldEndIdx]; &#125; else if (newStartVnode == null) &#123; newStartVnode = newCh[++newStartIdx]; &#125; else if (newEndVnode == null) &#123; newEndVnode = newCh[--newEndIdx]; &#125; else if (sameVnode(oldStartVnode, newStartVnode)) &#123; // æ–°æ—§å¼€å§‹èŠ‚ç‚¹ç›¸åŒï¼Œç›´æ¥è°ƒç”¨ patchVnode è¿›è¡Œæ›´æ–°ï¼Œä¸‹æ ‡å‘ä¸­é—´æ¨è¿› patchVnode(oldStartVnode, newStartVnode, insertedVnodeQueue); oldStartVnode = oldCh[++oldStartIdx]; newStartVnode = newCh[++newStartIdx]; &#125; else if (sameVnode(oldEndVnode, newEndVnode)) &#123; // æ–°æ—§ç»“æŸèŠ‚ç‚¹ç›¸åŒï¼Œç›´æ¥è°ƒç”¨ patchVnode è¿›è¡Œæ›´æ–°ï¼Œä¸‹æ ‡å‘ä¸­é—´æ¨è¿› patchVnode(oldEndVnode, newEndVnode, insertedVnodeQueue); oldEndVnode = oldCh[--oldEndIdx]; newEndVnode = newCh[--newEndIdx]; &#125; else if (sameVnode(oldStartVnode, newEndVnode)) &#123; // Vnode moved right // æ—§çš„å¼€å§‹èŠ‚ç‚¹ç­‰äºæ–°çš„ç»“æŸèŠ‚ç‚¹ï¼Œä¸¤ä¸ªèŠ‚ç‚¹è¿›è¡Œpatch patchVnode(oldStartVnode, newEndVnode, insertedVnodeQueue); // æŠŠæ—§çš„å¼€å§‹èŠ‚ç‚¹æ’å…¥åˆ°æœ«å°¾ api.insertBefore(parentElm, oldStartVnode.elm as Node, api.nextSibling(oldEndVnode.elm as Node)); oldStartVnode = oldCh[++oldStartIdx]; newEndVnode = newCh[--newEndIdx]; &#125; else if (sameVnode(oldEndVnode, newStartVnode)) &#123; // Vnode moved left // æ—§çš„ç»“æŸèŠ‚ç‚¹ç­‰äºæ–°çš„å¼€å§‹èŠ‚ç‚¹ï¼Œä¸¤ä¸ªèŠ‚ç‚¹è¿›è¡Œpatch patchVnode(oldEndVnode, newStartVnode, insertedVnodeQueue); // æŠŠæ—§çš„å°±ç»“æŸèŠ‚ç‚¹æ’å…¥åˆ°å¼€å¤´ api.insertBefore(parentElm, oldEndVnode.elm as Node, oldStartVnode.elm as Node); oldEndVnode = oldCh[--oldEndIdx]; newStartVnode = newCh[++newStartIdx]; &#125; else &#123; // å¦‚æœä¸Šè¿°æƒ…å†µéƒ½ä¸ç¬¦åˆï¼Œé‚£ä¹ˆåªæœ‰å¯èƒ½æ˜¯ä»¥ä¸‹ä¸¤ç§æƒ…å†µ // 1. è¿™ä¸ªèŠ‚ç‚¹æ˜¯æ–°åˆ›å»ºçš„ // 2. è¿™ä¸ªèŠ‚ç‚¹åœ¨åŸæ¥çš„ä½ç½®æ˜¯å¤„äºä¸­é—´çš„ï¼ˆoldStartIdx å’Œ endStartIdxä¹‹é—´ï¼‰ // å¦‚æœ oldKeyToIdx ä¸å­˜åœ¨ï¼Œåˆ›å»º key åˆ° index çš„æ˜ å°„ // è€Œä¸”ä¹Ÿå­˜åœ¨å„ç§ç»†å¾®çš„ä¼˜åŒ–ï¼Œåªä¼šåˆ›å»ºä¸€æ¬¡ï¼Œå¹¶ä¸”å·²ç»å®Œæˆçš„éƒ¨åˆ†ä¸éœ€è¦æ˜ å°„ if (oldKeyToIdx === undefined) &#123; oldKeyToIdx = createKeyToOldIdx(oldCh, oldStartIdx, oldEndIdx); &#125; idxInOld = oldKeyToIdx[newStartVnode.key as string]; if (isUndef(idxInOld)) &#123; // New element // å°†æ–°èŠ‚ç‚¹æ’å…¥åˆ°å¼€å¤´ api.insertBefore(parentElm, createElm(newStartVnode, insertedVnodeQueue), oldStartVnode.elm as Node); newStartVnode = newCh[++newStartIdx]; &#125; else &#123; // å¦‚æœä¸æ˜¯æ–°èŠ‚ç‚¹ï¼Œè¯´æ˜è¯¥èŠ‚ç‚¹ä¹‹å‰å­˜åœ¨ï¼Œæ‰¾åˆ°è¯¥èŠ‚ç‚¹ elmToMove = oldCh[idxInOld]; // å¦‚æœä¸¤ä¸ªèŠ‚ç‚¹keyç›¸åŒä½†æ˜¯selä¸åŒï¼Œé‚£å°±é€šè¿‡createElmåˆ›å»ºæ–°çš„domèŠ‚ç‚¹ç„¶åæ’å…¥åˆ°å¼€å¤´ if (elmToMove.sel !== newStartVnode.sel) &#123; api.insertBefore(parentElm, createElm(newStartVnode, insertedVnodeQueue), oldStartVnode.elm as Node); &#125; else &#123; // å°†oldChä¸­å·²å­˜åœ¨çš„èŠ‚ç‚¹å’Œæ–°çš„å¼€å§‹èŠ‚ç‚¹è¿›è¡Œpatch patchVnode(elmToMove, newStartVnode, insertedVnodeQueue); // å°†oldChä¸­å¤„ç†è¿‡çš„èŠ‚ç‚¹ç½®ç©ºï¼Œç­‰å¾ªç¯å¤„ç†åˆ°è¿™ä¸ªåœ°æ–¹çš„æ—¶å€™æ–¹ä¾¿ç›´æ¥è·³è¿‡ oldCh[idxInOld] = undefined as any; // å°†å¤„ç†è¿‡åçš„èŠ‚ç‚¹æ’å…¥åˆ°æ—§çš„å¼€å§‹èŠ‚ç‚¹ä¹‹å‰ api.insertBefore(parentElm, (elmToMove.elm as Node), oldStartVnode.elm as Node); &#125; newStartVnode = newCh[++newStartIdx]; &#125; &#125; &#125; // oldChæˆ–newChä¸­æœ‰ä¸€æ–¹å…ˆå¾ªç¯ç»“æŸ if (oldStartIdx &lt;= oldEndIdx || newStartIdx &lt;= newEndIdx) &#123; if (oldStartIdx &gt; oldEndIdx) &#123; // oldCh å·²ç»å…¨éƒ¨å¤„ç†å®Œæˆï¼Œè€Œ newCh è¿˜æœ‰æ–°çš„èŠ‚ç‚¹ï¼Œéœ€è¦å¯¹å‰©ä¸‹çš„æ¯ä¸ªé¡¹éƒ½åˆ›å»ºæ–°çš„ dom before = newCh[newEndIdx+1] == null ? null : newCh[newEndIdx+1].elm; addVnodes(parentElm, before, newCh, newStartIdx, newEndIdx, insertedVnodeQueue); &#125; else &#123; // newCh å·²ç»å…¨éƒ¨å¤„ç†å®Œæˆï¼Œè€Œ oldCh è¿˜æœ‰æ—§çš„èŠ‚ç‚¹ï¼Œéœ€è¦å°†å¤šä½™çš„èŠ‚ç‚¹ç§»é™¤ removeVnodes(parentElm, oldCh, oldStartIdx, oldEndIdx); &#125; &#125;&#125; ç›´æ¥çœ‹æ•´ä¸ªè¿‡ç¨‹ä¼šæœ‰ç‚¹æ‡µï¼Œå¯ä»¥ç»“åˆä¾‹å­ç†è§£ä¸€ä¸‹ï¼Œæˆ‘ä»¬æ‹¿ä¸¤ä¸ªæ•°ç»„è¿›è¡Œæ¼”ç¤ºï¼š å‡è®¾æ—§èŠ‚ç‚¹é¡ºåºä¸º[A, B, C, D]ï¼Œæ–°èŠ‚ç‚¹ä¸º[B, A, C, D, E] ç¬¬ä¸€è½®æ¯”è¾ƒï¼šå¼€å§‹ç»“æŸèŠ‚ç‚¹ä¸¤ä¸¤å¹¶ä¸ç›¸ç­‰ï¼Œäºæ˜¯çœ‹newStartVnodeåœ¨æ—§èŠ‚ç‚¹ä¸­æ˜¯å¦å­˜åœ¨ï¼Œæœ€åæ‰¾åˆ°äº†åœ¨ç¬¬äºŒä¸ªä½ç½®ï¼Œè°ƒç”¨patchVnodeè¿›è¡Œæ›´æ–°ï¼Œå°† oldCh[1] è‡³ç©ºï¼Œå°† dom æ’å…¥åˆ°oldStartVnodeå‰é¢ï¼ŒnewStartIdxå‘ä¸­é—´ç§»åŠ¨ï¼ŒçŠ¶æ€æ›´æ–°å¦‚ä¸‹ ç¬¬äºŒè½®æ¯”è¾ƒï¼šoldStartVnodeå’ŒnewStartVnodeç›¸ç­‰ï¼Œç›´æ¥ patchVnodeï¼ŒnewStartIdxå’Œ oldStartIdxå‘ä¸­é—´ç§»åŠ¨ï¼ŒçŠ¶æ€æ›´æ–°å¦‚ä¸‹ ç¬¬ä¸‰è½®æ¯”è¾ƒï¼šoldStartVnodeä¸ºç©ºï¼ŒoldStartIdxå‘ä¸­é—´ç§»åŠ¨ï¼Œè¿›å…¥ä¸‹è½®æ¯”è¾ƒï¼ŒçŠ¶æ€æ›´æ–°å¦‚ä¸‹ ç¬¬å››è½®æ¯”è¾ƒï¼šoldStartVnodeå’Œ newStartVnodeç›¸ç­‰ï¼Œç›´æ¥patchVnodeï¼ŒnewStartIdxå’Œ oldStartIdxå‘ä¸­é—´ç§»åŠ¨ï¼ŒçŠ¶æ€æ›´æ–°å¦‚ä¸‹ ç¬¬äº”è½®æ¯”è¾ƒï¼šoldStartVnodeå’Œ newStartVnodeç›¸ç­‰ï¼Œç›´æ¥patchVnodeï¼ŒnewStartIdx å’Œ oldStartIdxå‘ä¸­é—´ç§»åŠ¨ï¼ŒçŠ¶æ€æ›´æ–°å¦‚ä¸‹ oldStartIdx å·²ç»å¤§äº oldEndIdxï¼Œå¾ªç¯ç»“æŸï¼Œç”±äºæ˜¯æ—§èŠ‚ç‚¹å…ˆç»“æŸå¾ªç¯è€Œä¸”è¿˜æœ‰æ²¡å¤„ç†çš„æ–°èŠ‚ç‚¹ï¼Œè°ƒç”¨ addVnodeså¤„ç†å‰©ä¸‹çš„æ–°èŠ‚ç‚¹ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ•´ä¸ªsnabbdomçš„æ ¸å¿ƒæµç¨‹å·²ç»æ¢³ç†å®Œæ¯• å‚è€ƒé“¾æ¥","tags":[{"name":"javascript","slug":"javascript","permalink":"https://www.limuyang.cc/tags/javascript/"},{"name":"æºç é˜…è¯»","slug":"æºç é˜…è¯»","permalink":"https://www.limuyang.cc/tags/æºç é˜…è¯»/"},{"name":"snabbdom","slug":"snabbdom","permalink":"https://www.limuyang.cc/tags/snabbdom/"}]},{"title":"é˜…è¯»åˆ†æReduxæºç ","date":"2019-01-12T16:55:21.000Z","path":"2019/01/12/é˜…è¯»åˆ†æReduxæºç /","text":"ä¹‹å‰åœ¨Mediumä¸Šçœ‹è¿‡ä¸€ç¯‡å¾ˆæœ‰æ„æ€çš„æ–‡ç« ï¼š The deepest reason why modern JavaScript frameworks exist æ–‡ç« é‡Œé¢å¤§æ¦‚æè¿°äº†è¿™ä¹ˆä¸€ä¸ªäº‹å®ï¼šæˆ‘ä»¬ç”¨ç€ä¸€ç³»åˆ—ç°ä»£å¼€å‘æ¡†æ¶(Vueã€Reactã€Angular)ï¼Œä½†æ˜¯æˆ‘ä»¬å´å¿½ç•¥äº†ä»–ä»¬ä¹‹æ‰€ä»¥å­˜åœ¨çš„æœ€é‡è¦çš„æ„ä¹‰ï¼š ç®¡ç†ä¸æ–­å˜åŒ–çš„ state éå¸¸å›°éš¾ã€‚å¦‚æœä¸€ä¸ª model çš„å˜åŒ–ä¼šå¼•èµ·å¦ä¸€ä¸ª model å˜åŒ–ï¼Œé‚£ä¹ˆå½“ view å˜åŒ–æ—¶ï¼Œå°±å¯èƒ½å¼•èµ·å¯¹åº” model ä»¥åŠå¦ä¸€ä¸ª model çš„å˜åŒ–ï¼Œä¾æ¬¡åœ°ï¼Œå¯èƒ½ä¼šå¼•èµ·å¦ä¸€ä¸ª view çš„å˜åŒ–ã€‚ç›´è‡³ä½ æä¸æ¸…æ¥šåˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚state åœ¨ä»€ä¹ˆæ—¶å€™ï¼Œç”±äºä»€ä¹ˆåŸå› ï¼Œå¦‚ä½•å˜åŒ–å·²ç„¶ä¸å—æ§åˆ¶ã€‚ å½“ç³»ç»Ÿå˜å¾—é”™ç»¼å¤æ‚çš„æ—¶å€™ï¼Œæƒ³é‡ç°é—®é¢˜æˆ–è€…æ·»åŠ æ–°åŠŸèƒ½å°±ä¼šå˜å¾—ä¸¾æ­¥ç»´è‰°ã€‚ æ— è®ºæ˜¯Vuexè¿˜æ˜¯Reduxï¼Œå…¶å®éƒ½æ˜¯ä¸ºäº†è§£å†³æˆ‘ä»¬stateçš„ç®¡ç†çš„ä¸€ç³»åˆ—é—®é¢˜è€Œäº§ç”Ÿçš„ï¼Œè¿™é‡Œä¸»è¦åˆ†æReduxçš„åŸç†ã€‚ å…ˆçœ‹ä¸€çœ¼Reduxæºç çš„æ–‡ä»¶ç»“æ„ï¼š12345678910â”œâ”€â”€ applyMiddleware.jsâ”œâ”€â”€ bindActionCreators.jsâ”œâ”€â”€ combineReducers.jsâ”œâ”€â”€ compose.jsâ”œâ”€â”€ createStore.jsâ”œâ”€â”€ index.jsâ””â”€â”€ utils â”œâ”€â”€ actionTypes.js â”œâ”€â”€ isPlainObject.js â””â”€â”€ warning.js åŸºæœ¬éƒ½åŒ…å«äº†æˆ‘ä»¬å¸¸ç”¨çš„ä¸€äº›APIå¤–åŠ ä¸€äº›å·¥å…·ç±»æ–¹æ³•ï¼Œé‚£å°±å…ˆä»å…¥å£æ–‡ä»¶å¼€å§‹çœ‹èµ·ã€‚ index123456789101112131415161718192021222324252627282930313233343536import createStore from './createStore'import combineReducers from './combineReducers'import bindActionCreators from './bindActionCreators'import applyMiddleware from './applyMiddleware'import compose from './compose'import warning from './utils/warning'import __DO_NOT_USE__ActionTypes from './utils/actionTypes'/* * This is a dummy function to check if the function name has been altered by minification. * If the function has been minified and NODE_ENV !== 'production', warn the user. */function isCrushed() &#123;&#125;if ( process.env.NODE_ENV !== 'production' &amp;&amp; typeof isCrushed.name === 'string' &amp;&amp; isCrushed.name !== 'isCrushed') &#123; warning( 'You are currently using minified code outside of NODE_ENV === \"production\". ' + 'This means that you are running a slower development build of Redux. ' + 'You can use loose-envify (https://github.com/zertosh/loose-envify) for browserify ' + 'or setting mode to production in webpack (https://webpack.js.org/concepts/mode/) ' + 'to ensure you have the correct code for your production build.' )&#125;export &#123; createStore, combineReducers, bindActionCreators, applyMiddleware, compose, __DO_NOT_USE__ActionTypes&#125; indexå…¥å£æ–‡ä»¶å¯¹å¤–é‡Šæ”¾äº†æˆ‘ä»¬å¸¸ç”¨çš„ä¸€äº›APIï¼Œè¿™ä¸ªæ–‡ä»¶æœ¬èº«è‡ªå¸¦ä¸€ä¸ªisCrushedæ–¹æ³•ï¼Œé€šè¿‡æ³¨é‡Šå¯ä»¥äº†è§£åˆ°è¿™ä¸ªè¢«Reduxå¼€å‘è€…ç§°ä¸ºdummy functionçš„æ–¹æ³•ç”¨äºåˆ¤æ–­Reduxä»£ç æ˜¯å¦è¢«å‹ç¼©ï¼Œåœ¨å¼€å‘ç¯å¢ƒä¼šç»™å‡ºè­¦å‘Šï¼Œå…¶å®æ˜¯ä¸€ä¸ªå‹ç¼©æ£€éªŒå‡½æ•°ã€‚ createStoreé€šå¸¸æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªstoreä¸€èˆ¬ä¼šè¿™ä¹ˆå†™ï¼š 12let storestore = createStore(rootReducerï¼ŒinitStateï¼Œcompose(applyMiddleware(sagaMiddleware))) ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¿”å›ä¸‹ä¸€ç»„çŠ¶æ€æ ‘çš„å‡½æ•°ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šä½¿ç”¨combineReducersæ–¹æ³•æ¥ç”Ÿæˆï¼Œç´§æ¥ç€æˆ‘ä»¬éœ€è¦ä¼ å…¥åˆå§‹åŒ–çš„stateï¼Œæœ€åä¸€ä¸ªå‚æ•°æ˜¯enhancerï¼Œå®ƒå¯ä»¥è®©æˆ‘ä»¬ç”¨ä¸€äº›ä¸­é—´ä»¶æ¥å¢å¼ºStoreï¼Œæ¯”å¦‚æä¾›time travel/persistenceï¼Œä¸‹é¢é€šè¿‡æ•´ä½“ä»£ç æ¥çœ‹ä¸€ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298import $$observable from 'symbol-observable'import ActionTypes from './utils/actionTypes'import isPlainObject from './utils/isPlainObject'/** * Creates a Redux store that holds the state tree. * The only way to change the data in the store is to call `dispatch()` on it. * * There should only be a single store in your app. To specify how different * parts of the state tree respond to actions, you may combine several reducers * into a single reducer function by using `combineReducers`. * * @param &#123;Function&#125; reducer A function that returns the next state tree, given * the current state tree and the action to handle. * * @param &#123;any&#125; [preloadedState] The initial state. You may optionally specify it * to hydrate the state from the server in universal apps, or to restore a * previously serialized user session. * If you use `combineReducers` to produce the root reducer function, this must be * an object with the same shape as `combineReducers` keys. * * @param &#123;Function&#125; [enhancer] The store enhancer. You may optionally specify it * to enhance the store with third-party capabilities such as middleware, * time travel, persistence, etc. The only store enhancer that ships with Redux * is `applyMiddleware()`. * * @returns &#123;Store&#125; A Redux store that lets you read the state, dispatch actions * and subscribe to changes. */export default function createStore(reducer, preloadedState, enhancer) &#123; // ä¼ å‚åˆ¤æ–­ if ( (typeof preloadedState === 'function' &amp;&amp; typeof enhancer === 'function') || (typeof enhancer === 'function' &amp;&amp; typeof arguments[3] === 'function') ) &#123; throw new Error( 'It looks like you are passing several store enhancers to ' + 'createStore(). This is not supported. Instead, compose them ' + 'together to a single function.' ) &#125; // preloadedStateé»˜è®¤æ˜¯undefined if (typeof preloadedState === 'function' &amp;&amp; typeof enhancer === 'undefined') &#123; enhancer = preloadedState preloadedState = undefined &#125; if (typeof enhancer !== 'undefined') &#123; if (typeof enhancer !== 'function') &#123; throw new Error('Expected the enhancer to be a function.') &#125; /// å‡½æ•°æŸ¯é‡ŒåŒ– ä¼ å…¥createStoreä½œä¸ºå‚æ•° return enhancer(createStore)(reducer, preloadedState) &#125; if (typeof reducer !== 'function') &#123; throw new Error('Expected the reducer to be a function.') &#125; // å­˜å‚¨å½“å‰çš„reducer let currentReducer = reducer // å­˜å‚¨å½“å‰çš„state let currentState = preloadedState let currentListeners = [] let nextListeners = currentListeners // åˆ¤æ–­æ˜¯å¦æ­£åœ¨åˆ†å‘äº‹ä»¶ let isDispatching = false /** * This makes a shallow copy of currentListeners so we can use * nextListeners as a temporary list while dispatching. * * This prevents any bugs around consumers calling * subscribe/unsubscribe in the middle of a dispatch. */ function ensureCanMutateNextListeners() &#123; if (nextListeners === currentListeners) &#123; nextListeners = currentListeners.slice() &#125; &#125; /** * Reads the state tree managed by the store. * * @returns &#123;any&#125; The current state tree of your application. */ // è¿”å›å½“å‰çš„state function getState() &#123; if (isDispatching) &#123; throw new Error( 'You may not call store.getState() while the reducer is executing. ' + 'The reducer has already received the state as an argument. ' + 'Pass it down from the top reducer instead of reading it from the store.' ) &#125; return currentState &#125; /** * Adds a change listener. It will be called any time an action is dispatched, * and some part of the state tree may potentially have changed. You may then * call `getState()` to read the current state tree inside the callback. * * You may call `dispatch()` from a change listener, with the following * caveats: * * 1. The subscriptions are snapshotted just before every `dispatch()` call. * If you subscribe or unsubscribe while the listeners are being invoked, this * will not have any effect on the `dispatch()` that is currently in progress. * However, the next `dispatch()` call, whether nested or not, will use a more * recent snapshot of the subscription list. * * 2. The listener should not expect to see all state changes, as the state * might have been updated multiple times during a nested `dispatch()` before * the listener is called. It is, however, guaranteed that all subscribers * registered before the `dispatch()` started will be called with the latest * state by the time it exits. * * @param &#123;Function&#125; listener A callback to be invoked on every dispatch. * @returns &#123;Function&#125; A function to remove this change listener. */ function subscribe(listener) &#123; if (typeof listener !== 'function') &#123; throw new Error('Expected the listener to be a function.') &#125; if (isDispatching) &#123; throw new Error( 'You may not call store.subscribe() while the reducer is executing. ' + 'If you would like to be notified after the store has been updated, subscribe from a ' + 'component and invoke store.getState() in the callback to access the latest state. ' + 'See https://redux.js.org/api-reference/store#subscribe(listener) for more details.' ) &#125; let isSubscribed = true // æµ…æ‹·è´ä¸€ä»½å½“å‰çš„listener ensureCanMutateNextListeners() nextListeners.push(listener) return function unsubscribe() &#123; if (!isSubscribed) &#123; return &#125; if (isDispatching) &#123; throw new Error( 'You may not unsubscribe from a store listener while the reducer is executing. ' + 'See https://redux.js.org/api-reference/store#subscribe(listener) for more details.' ) &#125; isSubscribed = false ensureCanMutateNextListeners() const index = nextListeners.indexOf(listener) nextListeners.splice(index, 1) &#125; &#125; /** * Dispatches an action. It is the only way to trigger a state change. * * The `reducer` function, used to create the store, will be called with the * current state tree and the given `action`. Its return value will * be considered the **next** state of the tree, and the change listeners * will be notified. * * The base implementation only supports plain object actions. If you want to * dispatch a Promise, an Observable, a thunk, or something else, you need to * wrap your store creating function into the corresponding middleware. For * example, see the documentation for the `redux-thunk` package. Even the * middleware will eventually dispatch plain object actions using this method. * * @param &#123;Object&#125; action A plain object representing â€œwhat changedâ€. It is * a good idea to keep actions serializable so you can record and replay user * sessions, or use the time travelling `redux-devtools`. An action must have * a `type` property which may not be `undefined`. It is a good idea to use * string constants for action types. * * @returns &#123;Object&#125; For convenience, the same action object you dispatched. * * Note that, if you use a custom middleware, it may wrap `dispatch()` to * return something else (for example, a Promise you can await). */ function dispatch(action) &#123; if (!isPlainObject(action)) &#123; throw new Error( 'Actions must be plain objects. ' + 'Use custom middleware for async actions.' ) &#125; if (typeof action.type === 'undefined') &#123; throw new Error( 'Actions may not have an undefined \"type\" property. ' + 'Have you misspelled a constant?' ) &#125; if (isDispatching) &#123; throw new Error('Reducers may not dispatch actions.') &#125; try &#123; isDispatching = true currentState = currentReducer(currentState, action) &#125; finally &#123; isDispatching = false &#125; const listeners = (currentListeners = nextListeners) for (let i = 0; i &lt; listeners.length; i++) &#123; const listener = listeners[i] listener() &#125; return action &#125; /** * Replaces the reducer currently used by the store to calculate the state. * * You might need this if your app implements code splitting and you want to * load some of the reducers dynamically. You might also need this if you * implement a hot reloading mechanism for Redux. * * @param &#123;Function&#125; nextReducer The reducer for the store to use instead. * @returns &#123;void&#125; */ // ç”¨ä½œcode splitting æˆ–è€… dynamical load reducer function replaceReducer(nextReducer) &#123; if (typeof nextReducer !== 'function') &#123; throw new Error('Expected the nextReducer to be a function.') &#125; currentReducer = nextReducer // This action has a similiar effect to ActionTypes.INIT. // Any reducers that existed in both the new and old rootReducer // will receive the previous state. This effectively populates // the new state tree with any relevant data from the old one. dispatch(&#123; type: ActionTypes.REPLACE &#125;) &#125; /** * Interoperability point for observable/reactive libraries. * @returns &#123;observable&#125; A minimal observable of state changes. * For more information, see the observable proposal: * https://github.com/tc39/proposal-observable */ function observable() &#123; const outerSubscribe = subscribe return &#123; /** * The minimal observable subscription method. * @param &#123;Object&#125; observer Any object that can be used as an observer. * The observer object should have a `next` method. * @returns &#123;subscription&#125; An object with an `unsubscribe` method that can * be used to unsubscribe the observable from the store, and prevent further * emission of values from the observable. */ subscribe(observer) &#123; if (typeof observer !== 'object' || observer === null) &#123; throw new TypeError('Expected the observer to be an object.') &#125; function observeState() &#123; if (observer.next) &#123; observer.next(getState()) &#125; &#125; observeState() const unsubscribe = outerSubscribe(observeState) return &#123; unsubscribe &#125; &#125;, [$$observable]() &#123; return this &#125; &#125; &#125; // When a store is created, an \"INIT\" action is dispatched so that every // reducer returns their initial state. This effectively populates // the initial state tree. dispatch(&#123; type: ActionTypes.INIT &#125;) return &#123; dispatch, subscribe, getState, replaceReducer, [$$observable]: observable &#125;&#125; Storeå¯¹å¤–æä¾›äº†4ä¸ªAPIï¼š getState() dispatch(action) subscribe(listener) replaceReducer(nextReducer) è¿™äº›APIåœ¨ä¸Šé¢éƒ½æœ‰ä¸€ä¸€å‘ˆç°ï¼Œä»ä¸Šå¾€ä¸‹çœ‹ï¼Œé¦–å…ˆcreateStore.jsä¼šå¯¹ä¼ å‚è¿›è¡Œå¤„ç†ï¼Œæ ¹æ®å‚æ•°ç±»å‹æ¥åˆ¤æ–­æ˜¯å¦ä¼ å…¥äº†è¿‡å¤šçš„enhancerï¼ŒåŒæ—¶ä¼šç»™å‡ºæç¤ºæˆ‘ä»¬å¯ä»¥ç”¨composeæ¥ç»„åˆå¤šä¸ªenhancerï¼Œç„¶ååˆ¤æ–­æ˜¯å¦ä¼ å…¥äº†preloadedStateï¼Œæ²¡æœ‰çš„è¯é»˜è®¤èµ‹å€¼ä¸ºundefinedï¼Œæœ€ååˆ¤æ–­ä¼ å…¥çš„enhancerï¼Œå½“ä¼ å…¥çš„ç±»å‹ä¸æ˜¯functionç±»å‹ç›´æ¥æŠ›å¼‚å¸¸ï¼Œå¦‚æœä¼ å‚ç±»å‹æ— è¯¯ï¼Œå°†createStoreä¼ å…¥enhancerä½œä¸ºå‚æ•°ï¼Œè¿™é‡Œå…¶å®æ˜¯ä¸€ä¸ªå‡½æ•°æŸ¯é‡ŒåŒ–ï¼Œenhancerä¼šè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åå°†reducerå’ŒpreloadedStateä½œä¸ºä¸‹ä¸€çº§å…¥å‚ã€‚ æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹ä¸»è¦APIéƒ¨åˆ†çš„å®ç°ï¼ŒgetStateå…¶å®å°±æ˜¯è¿”å›å½“å‰çš„stateï¼Œå¦‚æœåˆ¤æ–­æ­£åœ¨è°ƒç”¨dispatchä¼šæŠ¥é”™ï¼š 1234567891011function getState() &#123; if (isDispatching) &#123; throw new Error( 'You may not call store.getState() while the reducer is executing. ' + 'The reducer has already received the state as an argument. ' + 'Pass it down from the top reducer instead of reading it from the store.' ) &#125; return currentState&#125; ç„¶åæ˜¯æˆ‘ä»¬å¸¸ç”¨çš„dispatchæ–¹æ³•ï¼š 12345678910111213141516171819202122232425262728293031323334function dispatch(action) &#123; if (!isPlainObject(action)) &#123; throw new Error( 'Actions must be plain objects. ' + 'Use custom middleware for async actions.' ) &#125; if (typeof action.type === 'undefined') &#123; throw new Error( 'Actions may not have an undefined \"type\" property. ' + 'Have you misspelled a constant?' ) &#125; if (isDispatching) &#123; throw new Error('Reducers may not dispatch actions.') &#125; try &#123; isDispatching = true currentState = currentReducer(currentState, action) &#125; finally &#123; isDispatching = false &#125; const listeners = (currentListeners = nextListeners) for (let i = 0; i &lt; listeners.length; i++) &#123; const listener = listeners[i] listener() &#125; return action&#125; è°ƒç”¨dispatchæ—¶å€™æ–¹æ³•å†…éƒ¨ä¼šå…ˆåˆ¤æ–­ä¼ å…¥çš„actionæ˜¯å¦æ˜¯plain objectsï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼š 1234567891011121314/** * @param &#123;any&#125; obj The object to inspect. * @returns &#123;boolean&#125; True if the argument appears to be a plain object. */export default function isPlainObject(obj) &#123; if (typeof obj !== 'object' || obj === null) return false let proto = obj while (Object.getPrototypeOf(proto) !== null) &#123; proto = Object.getPrototypeOf(proto) &#125; return Object.getPrototypeOf(obj) === proto&#125; ç„¶ååˆ¤æ–­actionæ˜¯å¦å«æœ‰typeå±æ€§ï¼Œæ²¡æœ‰çš„è¯ä¼šæŠ¥é”™ï¼Œå½“isDispatchingæ ‡å¿—ä½ä¸ºfalseçš„æ—¶å€™ï¼Œå°†è¿™ä¸ªæ ‡å¿—ä½è®¾ä¸ºtrueï¼Œç„¶åå°†ä¼ å…¥çš„actionå’ŒcurrentStateä¼ å…¥currentReducerå¾—åˆ°å½“å‰çš„çŠ¶æ€å¿«ç…§ï¼Œå®Œæˆè¿™ä»¶äº‹ä¹‹ååˆé‡ç½®isDispatchingä¸ºfalseï¼Œä»¥ä¾¿æ‰§è¡Œä¸‹ä¸€è½®çš„dispatchï¼Œæœ€åä¾æ¬¡æ‰§è¡Œé€šè¿‡subscribeæ–¹æ³•è®¢é˜…çš„å›è°ƒã€‚ ä¸Šé¢æåˆ°çš„subscribeæ–¹æ³•å¹³å¸¸å¼€å‘æ¯”è¾ƒå°‘ç”¨åˆ°ï¼Œä½ å¯ä»¥åœ¨è®¢é˜…çš„å›è°ƒé‡Œé¢é€šè¿‡getStateæ–¹æ³•è·å–å½“å‰çš„stateï¼Œçœ‹ä¸€ä¸‹ç›¸å…³å®ç°ï¼š 123456789101112131415161718192021222324252627282930313233343536373839function subscribe(listener) &#123; if (typeof listener !== 'function') &#123; throw new Error('Expected the listener to be a function.') &#125; if (isDispatching) &#123; throw new Error( 'You may not call store.subscribe() while the reducer is executing. ' + 'If you would like to be notified after the store has been updated, subscribe from a ' + 'component and invoke store.getState() in the callback to access the latest state. ' + 'See https://redux.js.org/api-reference/store#subscribe(listener) for more details.' ) &#125; let isSubscribed = true // æµ…æ‹·è´ä¸€ä»½å½“å‰çš„listener ensureCanMutateNextListeners() nextListeners.push(listener) return function unsubscribe() &#123; if (!isSubscribed) &#123; return &#125; if (isDispatching) &#123; throw new Error( 'You may not unsubscribe from a store listener while the reducer is executing. ' + 'See https://redux.js.org/api-reference/store#subscribe(listener) for more details.' ) &#125; isSubscribed = false ensureCanMutateNextListeners() const index = nextListeners.indexOf(listener) nextListeners.splice(index, 1) &#125;&#125; å°±æ˜¯ç®€å•åœ°æµ…æ‹·è´ä¸€ä»½å½“å‰çš„å›è°ƒListï¼Œå°†è®¢é˜…çš„å›è°ƒåŠ å…¥nextListenersï¼Œè¿”å›ä¸€ä¸ªå–æ¶ˆè®¢é˜…çš„å‡½æ•°ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°ä¼šå°†è¯¥è®¢é˜…ä»nextListenersé‡Œé¢åˆ é™¤ï¼Œå¯ä»¥çœ‹ä¸€ä¸ªå®˜æ–¹çš„ä½¿ç”¨ç¤ºä¾‹ï¼š 123456789101112131415161718192021function select(state) &#123; return state.some.deep.property&#125;let currentValuefunction handleChange() &#123; let previousValue = currentValue currentValue = select(store.getState()) if (previousValue !== currentValue) &#123; console.log( 'Some deep nested property changed from', previousValue, 'to', currentValue ) &#125;&#125;const unsubscribe = store.subscribe(handleChange)unsubscribe() æœ€åä¸€ä¸ªï¼Œä¹Ÿæ˜¯ä¸å¸¸ç”¨çš„æ–¹æ³•replaceReducerï¼š 12345678910111213function replaceReducer(nextReducer) &#123; if (typeof nextReducer !== 'function') &#123; throw new Error('Expected the nextReducer to be a function.') &#125; currentReducer = nextReducer // This action has a similiar effect to ActionTypes.INIT. // Any reducers that existed in both the new and old rootReducer // will receive the previous state. This effectively populates // the new state tree with any relevant data from the old one. dispatch(&#123; type: ActionTypes.REPLACE &#125;) &#125; è¿™ä¸ªæ–¹æ³•ä¸€èˆ¬ç”¨ä½œcode splittingæˆ–è€… dynamical load reducerï¼ŒæˆåŠŸæ›¿æ¢reducerä¹‹åä¼šå‘å‡ºä¸€ä¸ªtypeä¸ºActionTypes.REPLACEçš„actionã€‚ combineReducersåŸºäº Redux çš„åº”ç”¨ç¨‹åºä¸­æœ€å¸¸è§çš„ state ç»“æ„æ˜¯ä¸€ä¸ªç®€å•çš„ JavaScript å¯¹è±¡ï¼Œå®ƒæœ€å¤–å±‚çš„æ¯ä¸ª key ä¸­æ‹¥æœ‰ç‰¹å®šåŸŸçš„æ•°æ®ã€‚ç±»ä¼¼åœ°ï¼Œç»™è¿™ç§ state ç»“æ„å†™ reducer çš„æ–¹å¼æ˜¯åˆ†æ‹†æˆå¤šä¸ª reducerï¼Œæ‹†åˆ†ä¹‹åçš„ reducer éƒ½æ˜¯ç›¸åŒçš„ç»“æ„ï¼ˆstate, actionï¼‰ï¼Œå¹¶ä¸”æ¯ä¸ªå‡½æ•°ç‹¬ç«‹è´Ÿè´£ç®¡ç†è¯¥ç‰¹å®šåˆ‡ç‰‡ state çš„æ›´æ–°ã€‚å¤šä¸ªæ‹†åˆ†ä¹‹åçš„ reducer å¯ä»¥å“åº”ä¸€ä¸ª actionï¼Œåœ¨éœ€è¦çš„æƒ…å†µä¸‹ç‹¬ç«‹çš„æ›´æ–°ä»–ä»¬è‡ªå·±çš„åˆ‡ç‰‡ stateï¼Œæœ€åç»„åˆæˆæ–°çš„ stateã€‚ è¿™ä¸ªæ¨¡å¼æ˜¯å¦‚æ­¤çš„é€šç”¨ï¼ŒRedux æä¾›äº† combineReducers å»å®ç°è¿™ä¸ªæ¨¡å¼ã€‚è¿™æ˜¯ä¸€ä¸ªé«˜é˜¶ Reducer çš„ç¤ºä¾‹ï¼Œä»–æ¥æ”¶ä¸€ä¸ªæ‹†åˆ†å reducer å‡½æ•°ç»„æˆçš„å¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ Reducer å‡½æ•°ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667export default function combineReducers(reducers) &#123; const reducerKeys = Object.keys(reducers) const finalReducers = &#123;&#125; // è¿‡æ»¤ä¸€äº›ä¸å­˜åœ¨çš„reducer for (let i = 0; i &lt; reducerKeys.length; i++) &#123; const key = reducerKeys[i] if (process.env.NODE_ENV !== 'production') &#123; if (typeof reducers[key] === 'undefined') &#123; warning(`No reducer provided for key \"$&#123;key&#125;\"`) &#125; &#125; if (typeof reducers[key] === 'function') &#123; finalReducers[key] = reducers[key] &#125; &#125; const finalReducerKeys = Object.keys(finalReducers) // This is used to make sure we don't warn about the same // keys multiple times. let unexpectedKeyCache if (process.env.NODE_ENV !== 'production') &#123; unexpectedKeyCache = &#123;&#125; &#125; let shapeAssertionError try &#123; assertReducerShape(finalReducers) &#125; catch (e) &#123; shapeAssertionError = e &#125; return function combination(state = &#123;&#125;, action) &#123; if (shapeAssertionError) &#123; throw shapeAssertionError &#125; if (process.env.NODE_ENV !== 'production') &#123; const warningMessage = getUnexpectedStateShapeWarningMessage( state, finalReducers, action, unexpectedKeyCache ) if (warningMessage) &#123; warning(warningMessage) &#125; &#125; let hasChanged = false const nextState = &#123;&#125; for (let i = 0; i &lt; finalReducerKeys.length; i++) &#123; const key = finalReducerKeys[i] const reducer = finalReducers[key] const previousStateForKey = state[key] const nextStateForKey = reducer(previousStateForKey, action) if (typeof nextStateForKey === 'undefined') &#123; const errorMessage = getUndefinedStateErrorMessage(key, action) throw new Error(errorMessage) &#125; nextState[key] = nextStateForKey hasChanged = hasChanged || nextStateForKey !== previousStateForKey &#125; return hasChanged ? nextState : state &#125;&#125; combineReducersæ¥å—ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°é‡Œé¢æ¯ä¸€ä¸ªkeyéƒ½å¯¹åº”ç€ä¸€ä¸ªå€¼ä¸ºreducer functionçš„å‡½æ•°ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢é¦–å…ˆä¼šå¯¹ä¼ å…¥çš„reducersè¿›è¡Œè¿‡æ»¤ï¼Œå»æ‰ä¸€äº›ä¸å­˜åœ¨çš„reducerï¼ŒæŠŠè¿‡æ»¤åçš„ç»“æœå­˜å…¥finalReducersï¼Œç„¶åé€šè¿‡assertReducerShapeè§„èŒƒæˆ‘ä»¬å†™çš„reducerå‡½æ•°ï¼Œçœ‹ä¸€çœ¼è¿™ä¸ªæ–¹æ³•ï¼š 123456789101112131415161718192021222324252627282930313233function assertReducerShape(reducers) &#123; Object.keys(reducers).forEach(key =&gt; &#123; const reducer = reducers[key] const initialState = reducer(undefined, &#123; type: ActionTypes.INIT &#125;) if (typeof initialState === 'undefined') &#123; throw new Error( `Reducer \"$&#123;key&#125;\" returned undefined during initialization. ` + `If the state passed to the reducer is undefined, you must ` + `explicitly return the initial state. The initial state may ` + `not be undefined. If you don't want to set a value for this reducer, ` + `you can use null instead of undefined.` ) &#125; if ( typeof reducer(undefined, &#123; type: ActionTypes.PROBE_UNKNOWN_ACTION() &#125;) === 'undefined' ) &#123; throw new Error( `Reducer \"$&#123;key&#125;\" returned undefined when probed with a random type. ` + `Don't try to handle $&#123; ActionTypes.INIT &#125; or other actions in \"redux/*\" ` + `namespace. They are considered private. Instead, you must return the ` + `current state for any unknown actions, unless it is undefined, ` + `in which case you must return the initial state, regardless of the ` + `action type. The initial state may not be undefined, but can be null.` ) &#125; &#125;)&#125; è¿™é‡Œç»™æ¯ä¸ªreducerå‡½æ•°ä¼ å…¥äº†ä¸€ä¸ªtypeä¸ºActionTypes.INITçš„actionï¼ŒæŒ‰ç†è¯´æ­£å¸¸æƒ…å†µæˆ‘ä»¬çš„reduceråœ¨æ¥å—åˆ°æœªå®šä¹‰typeçš„actionæ—¶å€™åº”è¯¥è¿”å›é»˜è®¤stateï¼Œæ‰€ä»¥è¿™é‡Œåˆ¤æ–­å¦‚æœè¿”å›äº†undefinedé‚£ä¹ˆè¯´æ˜è¿™ä¸ªreducerå†™çš„ä¸å¤Ÿè§„èŒƒã€‚ æœ€åè¿”å›ä¸€ä¸ªåä¸ºcombinationçš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å…¶å®åœ¨createStore.jsçš„dispatchæ–¹æ³•é‡Œé¢æœ‰ä½“ç°ï¼š 123// ... çœç•¥æ— å…³ä»£ç  currentState = currentReducer(currentState, action)// ...çœç•¥æ— å…³ä»£ç  è¿™ä¸ªå‡½æ•°å°±æ˜¯æŠŠæ‰€æœ‰çš„reducerå¾ªç¯æ‰§è¡Œï¼Œç„¶åæ ¹æ®ä¼ å‚å‰åçš„stateåˆ¤æ–­æ˜¯å¦æ”¹å˜æ¥å†³å®šè¿”å›ä¸‹ä¸€ç»„çŠ¶æ€è¿˜æ˜¯å½“å‰çŠ¶æ€ã€‚ composecreateStoreçš„ç¬¬ä¸‰ä¸ªå‡½æ•°å°±æ˜¯store enhancerç”¨äºå¢å¼ºStoreï¼Œå½“ä½ éœ€è¦ä¼ å…¥å¤šä¸ªstore enhancerçš„æ—¶å€™å°±éœ€è¦é€šè¿‡composeæ–¹æ³•å°†å…¶è¿›è¡Œç»„åˆï¼Œçœ‹ä¸€ä¸‹ç»„åˆçš„é€»è¾‘ï¼š 12345678910111213141516171819202122/** * Composes single-argument functions from right to left. The rightmost * function can take multiple arguments as it provides the signature for * the resulting composite function. * * @param &#123;...Function&#125; funcs The functions to compose. * @returns &#123;Function&#125; A function obtained by composing the argument functions * from right to left. For example, compose(f, g, h) is identical to doing * (...args) =&gt; f(g(h(...args))). */export default function compose(...funcs) &#123; if (funcs.length === 0) &#123; return arg =&gt; arg &#125; if (funcs.length === 1) &#123; return funcs[0] &#125; return funcs.reduce((a, b) =&gt; (...args) =&gt; a(b(...args)))&#125; è¿™ä¸ªå‡½æ•°ä¼šå°†ä¼ å…¥çš„å‚æ•°è¿›è¡Œç»„åˆä»å³åˆ°å·¦è¿›è¡Œæ‰§è¡Œï¼Œæ‰€æœ‰ä¼ é€’ç»™composeæ–¹æ³•çš„å‚æ•°éƒ½å¿…é¡»æ˜¯å‡½æ•°ï¼Œé€šè¿‡reduceæ–¹æ³•ç»„åˆï¼Œç»™ç”¨composeæ–¹æ³•ç»„åˆåçš„å‡½æ•°ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¼šä½œä¸ºcomposeå‡½æ•°æœ€åä¸€ä¸ªå‡½æ•°å‚æ•°çš„å‚æ•°ï¼Œè”æƒ³åˆ°æˆ‘ä»¬ä½¿ç”¨createStoreæ–¹æ³•çš„æ—¶å€™ï¼š 1enhancer(createStore)(reducer, preloadedState) å¦‚æœæœ‰å¤šä¸ªstore enhancerè¿™é‡Œçš„enhancerå°±æ˜¯composeï¼ŒcreateStoreå°†ä½œä¸ºæœ€åä¸€ä¸ªstore enhancerå‡½æ•°çš„å‚æ•°ï¼Œç„¶åæŒ‰ç…§æ´‹è‘±åœˆæ¨¡å‹ä»å³å‘å·¦æ‰§è¡Œï¼Œä¸‹é¢æˆ‘ä»¬å¯ä»¥èŠä¸€èŠstore enhancerã€‚ store enhancer store enhancerï¼Œå¯ä»¥ç¿»è¯‘æˆstoreçš„å¢å¼ºå™¨ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¢å¼ºstoreçš„åŠŸèƒ½ã€‚ä¸€ä¸ªstore enhancerï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œå®ƒçš„å‚æ•°æ˜¯åˆ›å»ºstoreçš„å‡½æ•°ï¼ˆstore creatorï¼‰ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªå¯ä»¥åˆ›å»ºåŠŸèƒ½æ›´åŠ å¼ºå¤§çš„storeçš„å‡½æ•°(enhanced store creator)ï¼Œè¿™å’ŒReactä¸­çš„é«˜é˜¶ç»„ä»¶çš„æ¦‚å¿µå¾ˆç›¸ä¼¼ã€‚ ä¸€èˆ¬æ¥è¯´ä¸€ä¸ªstore enhancerçš„ä»£ç ç»“æ„å¦‚ä¸‹ï¼š123456function enhancerCreator() &#123; return createStore =&gt; (...args) =&gt; &#123; // do something based old store // return a new enhanced store &#125;&#125; æˆ‘ä»¬å¯ä»¥æ‰¾ä¸€ä¸ªstore enhancerï¼Œåˆšå¥½reduxå†…éƒ¨å°±æœ‰ä¸€ä¸ªç”¨äºå¢å¼ºä½œç”¨äºdispatchæ–¹æ³•çš„ä¸­é—´ä»¶çš„store enhancerç”Ÿæˆå™¨ï¼Œä¹Ÿå°±æ˜¯applyMiddlewareï¼Œè¿™é‡Œæœ‰ä¸€ç‚¹è¦æ³¨æ„çš„æ˜¯ï¼Œå› ä¸ºmiddlewareéƒ½æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•ç”Ÿæˆçš„store enhancerå¿…é¡»æ”¾åœ¨ç¬¬ä¸€ä½ï¼Œçœ‹ä¸€ä¸‹ç›¸å…³å®ç°ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243import compose from './compose'/** * Creates a store enhancer that applies middleware to the dispatch method * of the Redux store. This is handy for a variety of tasks, such as expressing * asynchronous actions in a concise manner, or logging every action payload. * * See `redux-thunk` package as an example of the Redux middleware. * * Because middleware is potentially asynchronous, this should be the first * store enhancer in the composition chain. * * Note that each middleware will be given the `dispatch` and `getState` functions * as named arguments. * * @param &#123;...Function&#125; middlewares The middleware chain to be applied. * @returns &#123;Function&#125; A store enhancer applying the middleware. */export default function applyMiddleware(...middlewares) &#123; return createStore =&gt; (...args) =&gt; &#123; // åˆ›å»ºä¸€ä¸ªæ–°çš„store const store = createStore(...args) let dispatch = () =&gt; &#123; throw new Error( 'Dispatching while constructing your middleware is not allowed. ' + 'Other middleware would not be applied to this dispatch.' ) &#125; const middlewareAPI = &#123; getState: store.getState, dispatch: (...args) =&gt; dispatch(...args) &#125; // ä¼ å…¥getStateå’Œdispatchï¼Œè¿”å›ä»¥nextä¸ºå‚æ•°çš„åŒ¿åå‡½æ•° const chain = middlewares.map(middleware =&gt; middleware(middlewareAPI)) dispatch = compose(...chain)(store.dispatch) return &#123; ...store, dispatch &#125; &#125;&#125; é€šè¿‡ä¼ å…¥çš„createStoreä»¥åŠreducerå’Œstateåˆ›å»ºä¸€ä¸ªæ–°çš„Storeï¼Œç„¶åå®šä¹‰ä¸€ä¸ªä¸´æ—¶dispatchæ–¹æ³•ï¼Œåœ¨é€šè¿‡applyMiddleWareå¤„ç†ä¹‹å‰è°ƒç”¨dispatchä¼šæŠ¥é”™ï¼Œç„¶åä¼šè°ƒç”¨middlewaresæ•°ç»„ä¸­æ¯ä¸€ä¸ªä¸­é—´ä»¶å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾ä¸€ä¸ªä¸­é—´ä»¶å‡½æ•°çœ‹ä¸€ä¸‹å†…éƒ¨çš„å¤„ç†è¿‡ç¨‹ï¼Œè¿™é‡Œçœ‹ä¸€ä¸‹redux-thunkçš„å¤„ç†æ–¹å¼ï¼š 1234567891011121314function createThunkMiddleware(extraArgument) &#123; return (&#123; dispatch, getState &#125;) =&gt; next =&gt; action =&gt; &#123; if (typeof action === 'function') &#123; return action(dispatch, getState, extraArgument); &#125; return next(action); &#125;;&#125;const thunk = createThunkMiddleware();thunk.withExtraArgument = createThunkMiddleware;export default thunk; æ¯ä¸€ä¸ªmiddlewareéƒ½ä¼šæ¥å—Storeçš„dispatchå’ŒgetStateæ–¹æ³•ä½œä¸ºå‚æ•°ï¼Œredux-thunkçš„å¢å¼ºå‹ä½œç”¨æ˜¯å¯ä»¥è®©ä½ dispatchä¸€ä¸ªå‡½æ•°ï¼Œè¿™æ ·å°±çŸ¥é“äº†æˆ‘ä»¬çš„chainé‡Œé¢çš„å‡½æ•°éƒ½æ˜¯ç±»ä¼¼äºè¿™æ ·çš„ï¼š 123// çœç•¥ä»£ç  return next =&gt; action =&gt; &#123;// çœç•¥ä»£ç  å˜ç›¸çš„å»æ‰äº†ä¸€å±‚ï¼Œç„¶åé€šè¿‡composeæ–¹æ³•ç»„åˆå‡ºæ¥ä¸€ä¸ªå¢å¼ºåçš„dispatchï¼š 1dispatch = compose(...chain)(store.dispatch) å°†storeåŸç”Ÿçš„dispatchä½œä¸ºå‚æ•°ï¼Œåç»­çš„æ¯ä¸€ä¸ªmiddlewareéƒ½å¯¹è¿™ä¸ªdispatchè¿›è¡Œå¢å¼ºï¼Œå½“é‡åˆ°redux-thunkçš„æ—¶å€™ï¼Œä»–ä¼šæ£€æµ‹å½“å‰çš„actionæ˜¯å¦æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ˜¯çš„è¯å°±æ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼ŒåŒç†å…¶ä»–çš„middlewareä¹Ÿæ˜¯ä¾æ¬¡æ‰§è¡Œçš„ã€‚ æ€»ç»“è™½ç„¶Reduxæ˜¯ä¸€ä¸ªä½“å°ç²¾æ‚çš„åº“ï¼Œä½†å®ƒç›¸å…³çš„å†…å®¹å’ŒAPIéƒ½æ˜¯ç²¾æŒ‘ç»†é€‰çš„ï¼Œè¶³ä»¥è¡ç”Ÿå‡ºä¸°å¯Œçš„å·¥å…·é›†å’Œå¯æ‰©å±•çš„ç”Ÿæ€ç³»ç»Ÿã€‚","tags":[{"name":"javascript","slug":"javascript","permalink":"https://www.limuyang.cc/tags/javascript/"},{"name":"æºç é˜…è¯»","slug":"æºç é˜…è¯»","permalink":"https://www.limuyang.cc/tags/æºç é˜…è¯»/"},{"name":"redux","slug":"redux","permalink":"https://www.limuyang.cc/tags/redux/"}]},{"title":"äº¬æ™š8ç‚¹--H5å•é¡µé¢æ‰‹åŠ¿æ»‘å±æ•ˆæœå®è·µ","date":"2018-08-27T23:11:04.000Z","path":"2018/08/27/äº¬æ™š8ç‚¹-H5å•é¡µé¢æ‰‹åŠ¿æ»‘å±æ•ˆæœå®è·µ/","text":"é¡¹ç›®èƒŒæ™¯äº¬æ™š8ç‚¹ä½œä¸ºå†…å®¹å¹³å°é‡ç‚¹æ‰“é€ çš„å†…å®¹IPï¼Œé€šè¿‡ä¼˜è´¨çš„å†…å®¹å½¢å¼ï¼Œæ½œç§»é»˜åŒ–ä¸­è®©ç”¨æˆ·äº†è§£äº§å“ï¼Œå»ºç«‹å¯¹äº¬ä¸œå¼€å§‹ç©å†…å®¹çš„å¿ƒæ™ºå’Œè®¤çŸ¥ï¼Œç›®å‰è¿™ä¸ªé¡¹ç›®å·²ç»è¿­ä»£åˆ°ç¬¬5æœŸï¼Œæœ€å¼€å§‹çš„æ—¶å€™æˆ‘ä»¬çš„é¦–é¡µæ•ˆæœæ˜¯ä¸€ä¸ªå¡ç‰‡å½¢å¼çš„æ—¶é—´è½´ï¼Œé¦–é¡µçš„èƒŒæ™¯å¤§å›¾ä¼šéšç€æ—¶é—´è½´æ‹–åŠ¨åˆ°ä¸åŒçš„å¡ç‰‡è€Œè¿›è¡Œåˆ‡æ¢ï¼šä»ç¬¬5æœŸå¼€å§‹ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†ä¸€ç§å…¨æ–°çš„äº¤äº’æ–¹å¼æ¥ç»™ç”¨æˆ·æ›´å¥½çš„ä½“éªŒåé¦ˆï¼Œé‚£å°±æ˜¯æ»‘å±ï¼Œå¯ä»¥å…ˆçœ‹ä¸€ä¸‹æ•ˆæœï¼š è¦å®ç°çš„æ»‘å±æ•ˆæœ1ã€å·¦å³æ»‘åŠ¨å¯ä»¥åˆ‡æ¢èƒŒæ™¯å›¾ï¼ŒåŒæ—¶åœ¨ä¸´ç•ŒçŠ¶æ€åšå‡ºç›¸åº”å¤„ç†(æ»‘åŠ¨åˆ°ç¬¬ä¸€å¼ å›¾ç‰‡ä¸èƒ½å·¦æ»‘ï¼Œæœ€åä¸€å¼ å›¾ç‰‡ä¸èƒ½å³æ»‘)2ã€æ»‘åŠ¨åˆ‡æ¢å›¾ç‰‡çš„æ—¶å€™å¸¦æœ‰è¦†ç›–çš„åŠ¨æ•ˆ ä¸ºäº†å®ç°ä¸Šè¿°éœ€æ±‚ï¼Œéœ€è¦è€ƒè™‘ä¸‰ä¸ªé—®é¢˜ï¼š å¯¹å›¾ç‰‡ç»„åº”è¯¥é‡‡ç”¨ä½•ç§å½¢å¼çš„å¸ƒå±€ï¼Ÿ æ»‘åŠ¨åˆ‡æ¢æ—¶å€™å¦‚ä½•å®ç°è¦†ç›–åŠ¨æ•ˆï¼Ÿ å¦‚ä½•å¤„ç†ä¸´ç•ŒçŠ¶æ€ä»¥åŠä¸´ç•Œå»¶ä¼¸çŠ¶æ€ï¼Ÿ å¯¹å›¾ç‰‡ç»„åº”è¯¥é‡‡ç”¨ä½•ç§å½¢å¼çš„å¸ƒå±€ é¦–å…ˆå‡è®¾æˆ‘ä»¬æœ‰ä¸€å †è¿™æ ·çš„èƒŒæ™¯å›¾ï¼Œè¦å®ç°è¿™ç§å±‚å çš„æ•ˆæœæœ€ç®€å•çš„æ–¹å¼è«è¿‡äºè®¾ç½® z-index ï¼Œä»å³å‘å·¦æ»‘åŠ¨çš„è¿‡ç¨‹å°±åƒä»ä¸€ä¸ªå¡ç‰Œç»„çš„æœ€ä¸Šæ–¹ä¸æ–­çš„æŠ½å–æœ€ä¸Šé¢é‚£ä¸€å¼ å¡ç‰Œçš„è¿‡ç¨‹ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨position: absolute ç»“åˆz-indexå¾—åˆ°æœ€åŸºæœ¬çš„å¸ƒå±€ï¼š 12345678910111213141516171819202122232425262728293031&lt;template&gt; &lt;div class=\"card-list\"&gt; &lt;div class=\"card-wrapper\" v-for=\"(item, index) in cardsList\" :style=\"&#123;zIndex: cardsList.length - index&#125;\" &gt; &lt;div class=\"card-img\" :style=\"&#123;backgroundImage: 'url('+ item +')'&#125;\" &gt;&lt;/div&gt; &lt;/div&gt; &lt;/div&gt;&lt;/template&gt;&lt;script&gt; import bg1 from '../img/bg1.jpg' import bg2 from '../img/bg2.jpg' import bg3 from '../img/bg3.jpg' export default &#123; data() &#123; return &#123; cardsList: [ bg1, bg2, bg3 ] &#125; &#125; &#125;&lt;/script&gt; æ»‘åŠ¨åˆ‡æ¢æ—¶å€™å¦‚ä½•å®ç°è¦†ç›–åŠ¨æ•ˆæ»‘åŠ¨åˆ‡æ¢æˆ‘ä»¬å¯ä»¥é€šè¿‡ç›‘å¬touchäº‹ä»¶ï¼Œè®¡ç®—æ‰‹æŒ‡æ»‘åŠ¨çš„ä½ç§»ï¼Œé€šè¿‡translate3d(x, y, z)å»æ§åˆ¶å½“å‰å¡ç‰‡åœ¨xè½´ä¸Šçš„ä½ç§»ï¼Œå½“ä»å³å‘å·¦æ»‘çš„æ—¶å€™å½“å‰å¡ç‰‡å‘å·¦ç§»å‡ºå±å¹•ï¼Œè®¾ç½®ä¸€ä¸ªæ»‘åŠ¨çš„ä¸´ç•Œç‚¹ï¼Œè¶…å‡ºè¯¥ä¸´ç•Œç‚¹åˆ™åˆ¤å®šæ»‘åŠ¨åˆ°ä¸‹ä¸€å¼ å›¾ï¼Œå¦åˆ™å›åˆ°åˆå§‹ä½ç½®ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152&lt;template&gt; &lt;div class=\"card-list\"&gt; &lt;div class=\"card-wrapper\" v-for=\"(item, index) in cardsList\" :style=\"&#123;zIndex: cardsList.length - index&#125;\" @touchstart=\"cardTouchStart\" @touchmove=\"cardTouchMove\" @touchend=\"cardTouchEnd\" &gt; // çœç•¥éƒ¨åˆ†domå¸ƒå±€ &lt;/div&gt;&lt;/template&gt;&lt;script&gt; import bg1 from '../img/bg1.jpg' import bg2 from '../img/bg2.jpg' import bg3 from '../img/bg3.jpg' export default &#123; data() &#123; return &#123; cardsList: [ bg1, bg2, bg3 ], // ä½¿ç”¨ä¸€ä¸ªtouchå¯¹è±¡å­˜å‚¨ä¸€äº›å±æ€§ï¼Œæ–¹ä¾¿åç»­æ“ä½œ touch: &#123;&#125; &#125; &#125;, methods: &#123; cardTouchStart(e) &#123; // touchäº‹ä»¶åˆå§‹åŒ–æ ‡å¿—ä½ this.touch.initiated = true // å¼€å§‹æ»‘åŠ¨çš„xè½´åæ ‡ this.touch.startX = e.touches[0].pageX // xè½´æ–¹å‘ä¸Šçš„æ»‘åŠ¨åç§»é‡ this.touch.deltaX = 0 &#125;, cardTouchMove(e) &#123; if (!this.touch.initiated) &#123; return &#125; // æ»‘åŠ¨æ“ä½œ &#125;, cardTouchEnd(e) &#123; // é‡ç½®æ ‡å¿—ä½ this.touch.initiated = false &#125; &#125; &#125;&lt;/script&gt; æ—¢ç„¶æ˜¯é€šè¿‡translate3dè¿›è¡Œä½ç§»å˜å¹»ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨æ°å½“çš„æ—¶å€™åˆå§‹åŒ–æ‰€æœ‰å¡ç‰‡çš„ä½ç½®ï¼Œè¿™é‡Œé»˜è®¤åˆå§‹åŒ–ä½ç½®éƒ½æ˜¯translate3d(0, 0, 0)ï¼ŒåŒæ—¶å½“å‰å¡ç‰‡æ»‘å‡ºå±å¹•å¤–çš„æœ€å¤§ä½ç§»åº”è¯¥åˆšå¥½æ˜¯å±å¹•å®½åº¦ï¼Œè¿™æ ·å½“åå‘æ»‘åŠ¨çš„æ—¶å€™å¡ç‰‡ä¹Ÿèƒ½ç«‹å³å›åˆ°å±å¹•å¯è§åŒºåŸŸï¼Œæ‰€ä»¥æˆ‘ä»¬ä»£ç å¯ä»¥è¿™ä¹ˆå¤„ç†ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667&lt;script&gt; import bg1 from '../img/bg1.jpg' import bg2 from '../img/bg2.jpg' import bg3 from '../img/bg3.jpg' const transform = 'transform' // å±å¹•å®½åº¦ let clientWidth export default &#123; data() &#123; return &#123; cardsList: [ bg1, bg2, bg3 ], touch: &#123;&#125;, nodeList: [], imgNodeList: [], selectIndex: 0 &#125; &#125;, created() &#123; this.$nextTick(() =&gt; &#123; clientWidth = document.documentElement.clientWidth // array-like-objectè½¬æ¢æˆarray this.nodeList = Array.from(document.getElementsByClassName('card-wrapper')) this.imgNodeList = Array.from(document.getElementsByClassName('card-img')) // åˆå§‹åŒ–å¡ç‰‡ä½ç½® this.initCards() &#125;) &#125;, methods: &#123; cardTouchStart(e) &#123; // touchäº‹ä»¶åˆå§‹åŒ–æ ‡å¿—ä½ this.touch.initiated = true // å¼€å§‹æ»‘åŠ¨çš„xè½´åæ ‡ this.touch.startX = e.touches[0].pageX // xè½´æ–¹å‘ä¸Šçš„æ»‘åŠ¨åç§»é‡ this.touch.deltaX = 0 // ç¡®ä¿å¡ç‰‡ä»åˆå§‹åŒ–ä½ç½®å¼€å§‹ä½ç§» this.initCards() &#125;, cardTouchMove(e) &#123; if (!this.touch.initiated) &#123; return &#125; // æ»‘åŠ¨æ“ä½œ &#125;, cardTouchEnd(e) &#123; // é‡ç½®æ ‡å¿—ä½ this.touch.initiated = false &#125;, initCards() &#123; this.nodeList.forEach((item, index) =&gt; &#123; if (index &gt;= this.selectIndex) &#123; item.style[transform] = `translate3d(0, 0, 0)` this.imgNodeList[index].style[transform] = `translate3d(0, 0, 0)` &#125; else &#123; item.style[transform] = `translate3d(-$&#123;clientWidth&#125;px, 0, 0)` this.imgNodeList[index].style[transform] = `translate3d($&#123;clientWidth&#125;px, 0, 0)` &#125; &#125;) &#125; &#125; &#125;&lt;/script&gt; å…³äº initCardsæ–¹æ³•è¿™é‡Œæœ‰å‡ ç‚¹éœ€è¦è§£é‡Šä¸€ä¸‹ï¼Œé¦–æ¬¡äº¬æ™š8ç‚¹è¿™ä¸ªé¡¹ç›®æ¯ä¸€æœŸéƒ½æœ‰å¥½å‡ ä¸ªè§†é¢‘ï¼ŒåŒæ—¶æ¯ä¸€å¤©æ™šä¸Š8ç‚¹éƒ½ä¼šå‡†æ—¶æ›´æ–°ä¸€åªè§†é¢‘ï¼Œæ‰€ä»¥è¿™é‡Œç”¨ä¸€ä¸ªå˜é‡selectIndexå»æ ‡è¯†ä»Šå¤©åº”è¯¥åˆ‡åˆ°å“ªä¸€åªè§†é¢‘ï¼Œindexå°äºselectIndex çš„å¡ç‰‡å°±ä¼šç§»å‡ºåˆ°å±å¹•å¤–ï¼Œè€Œindexå¤§äºselectIndexçš„å¡ç‰‡åˆ™ä¼šç”±äºæˆ‘ä»¬è®¾ç½®äº†z-indexçš„å…³ç³»è€Œä¸å¯è§ï¼Œå…¶æ¬¡ï¼Œä¸ºäº†è¾¾åˆ°æ»‘åŠ¨æ—¶å€™ä¸‹ä¸€å¼ å¡ç‰‡è¦†ç›–å½“å‰å¡ç‰‡çš„æ•ˆæœï¼Œæˆ‘ä»¬è¿™é‡Œç”¨äº†ä¸€ä¸ªå¾ˆå·§å¦™çš„æ–¹å¼ï¼šé”™ä½ï¼Œä¹Ÿå°±æ˜¯è¯´å½“åŒ…è£¹å¡ç‰‡çš„divç”±äºæ‰‹æŒ‡æ»‘åŠ¨è€Œå‘å·¦æ»‘åŠ¨å‡ºå±å¹•å¤–çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ§åˆ¶å¡ç‰‡è‡ªèº«äº§ç”Ÿä¸€ä¸ªå‘å³æ»‘åŠ¨åŒæ ·è·ç¦»çš„ä½ç§»ï¼Œè¿™æ ·å°±èƒ½ç»™äººçœ‹èµ·æ¥å¡ç‰‡æ²¡åœ¨åŠ¨çš„å‡è±¡ï¼Œå‘å³ç§»åŠ¨åŒç†ï¼Œä¸Šä¸€ä¸ªå›¾ç›´è§‚çš„çœ‹ä¸€ä¸‹ï¼š é€šè¿‡ä»£ç æ¥å‘ˆç°è¿™ä¸ªæ•ˆæœï¼š 1234567891011121314// çœç•¥ä¸ç›¸å¹²ä»£ç  cardTouchMove(e) &#123; if (!this.touch.initiated) &#123; return &#125; // åŠ¨æ€åç§»é‡ this.touch.deltaX = e.touches[0].pageX - this.touch.startX if (this.touch.deltaX &gt;= 0) &#123; // å‘å³æ»‘åŠ¨ &#125; else &#123; // å‘å·¦æ»‘åŠ¨ &#125; &#125;,// çœç•¥ä¸æƒ³å¹²ä»£ç  ä»¥å³æ»‘ä¸ºä¾‹ç»™å‡ºå¤§è‡´å¤„ç†è¿‡ç¨‹ï¼š 123456789101112131415161718192021222324252627282930313233343536cardTouchMove(e) &#123; if (!this.touch.initiated) &#123; return &#125; // æ»‘åŠ¨æ“ä½œ // åŠ¨æ€åç§»é‡ this.touch.deltaX = e.touches[0].pageX - this.touch.startX this.touch.offset = -clientWidth + this.touch.deltaX if (this.touch.deltaX &gt;= 0) &#123; if (this.selectIndex === 0) &#123; // ç¬¬ä¸€å¼ ï¼Œæ— æ³•å³æ»‘ &#125; else &#123; // å‘å³æ»‘åŠ¨ this.nodeList[this.selectIndex].style[transform] = `translate3d(0, 0, 0)` this.imgNodeList[this.selectIndex].style[transform] = `translate3d(0, 0, 0)` // ä¸Šä¸€å¼ è¿›å…¥è§†é‡ this.nodeList[this.selectIndex - 1].style[transform] = `translate3d($&#123;this.touch.offset&#125;px, 0, 0)` this.imgNodeList[this.selectIndex - 1].style[transform] = `translate3d($&#123;-this.touch.offset&#125;px, 0, 0)` &#125; &#125; else &#123; // å‘å·¦æ»‘åŠ¨ &#125;&#125;,cardTouchEnd(e) &#123; // é‡ç½®æ ‡å¿—ä½ this.touch.initiated = false if (this.touch.deltaX &gt;= 0) &#123; // å³æ»‘ if (this.selectIndex === 0) &#123; // ç¬¬ä¸€å¼ ï¼Œæ— æ³•å³æ»‘ &#125; else &#123; this.nodeList[this.selectIndex - 1].style[transform] = `translate3d(0, 0, 0)` this.imgNodeList[this.selectIndex - 1].style[transform] = `translate3d(0, 0, 0)` &#125; &#125;&#125; çœ‹ä¸‹åˆæ­¥æ•ˆæœå·²ç»å‡ºæ¥äº† å¦‚ä½•å¤„ç†ä¸´ç•ŒçŠ¶æ€ä»¥åŠä¸´ç•Œå»¶ä¼¸çŠ¶æ€ä¸Šé¢å…¶å®å¤„ç†è¿‡ä¸€ç§ä¸´ç•ŒçŠ¶æ€ï¼Œå°±æ˜¯å½“æ»‘åŠ¨åˆ°ç¬¬ä¸€å¼ æˆ–è€…æœ€åä¸€å¼ çš„æ—¶å€™ä¸åšå¤„ç†ï¼Œè¿˜æœ‰ä¸€ç§ä¸´ç•Œå»¶ä¼¸çŠ¶æ€ï¼Œå‡è®¾æˆ‘ä»¬è¿™ä¸ªæ—¶å€™æ‰‹æŒ‡ä»å·¦å‘å³æ»‘åŠ¨ï¼Œå¹¶ä¸”æˆ‘ä»¬æ­¤æ—¶æ»‘è¿‡çš„å®½åº¦å·²ç»è¶…è¿‡äº†å±å¹•çš„å®½åº¦ï¼Œè¿™ä¸ªæ—¶å€™å¯¹ç”¨æˆ·æ¥è¯´ä½“éªŒæœ€å¥½çš„å¤„ç†æ˜¯ç»§ç»­æ‹‰å‡ºä¸‹ä¸€å¼ å¡ç‰‡ï¼ŒåŒæ ·ç”¨å‘å³æ»‘åŠ¨ç»™å‡ºå¤„ç†çš„ç¤ºä¾‹ï¼š 1234567891011121314// å‘å³æ»‘åŠ¨this.nodeList[this.selectIndex].style[transform] = `translate3d(0, 0, 0)`this.imgNodeList[this.selectIndex].style[transform] = `translate3d(0, 0, 0)`if (this.touch.offset &lt; 0) &#123; // å³æ»‘ä½ç§»è¿˜æœªè¶…å‡ºä¸€ä¸ªå±å¹•å®½åº¦ this.nodeList[this.selectIndex - 1].style[transform] = `translate3d($&#123;this.touch.offset&#125;px, 0, 0)` this.imgNodeList[this.selectIndex - 1].style[transform] = `translate3d($&#123;-this.touch.offset&#125;px, 0, 0)`&#125; else &#123; // å³æ»‘ä½ç§»è¶…å‡ºäº†ä¸€ä¸ªå±å¹•çš„å®½åº¦ this.nodeList[this.selectIndex - 1].style[transform] = `translate3d(0, 0, 0)` this.imgNodeList[this.selectIndex - 1].style[transform] = `translate3d(0, 0, 0)` this.selectIndex -= 1 this.touch.startX = e.touches[0].pageX&#125; å¯ä»¥çœ‹åˆ°æ— ç¼è¿ç»­è¿‡æ¸¡çš„æ•ˆæœï¼Œè¿˜æœ‰ä¸€ç§éœ€è¦å¤„ç†çš„æƒ…å†µä¹Ÿæ˜¯å‡ºäºç”¨æˆ·ä½“éªŒè€ƒè™‘ï¼Œæˆ‘ä»¬åº”è¯¥è®¾ç½®ä¸€ä¸ªé˜ˆå€¼ï¼Œæˆ‘è¿™é‡Œè®¾ç½®çš„æ˜¯å±å¹•å®½åº¦çš„20%ï¼Œå½“ç”¨æˆ·æ»‘åŠ¨æ²¡æœ‰è¶…è¿‡è¿™ä¸ªé˜ˆå€¼çš„æ—¶å€™å¡ç‰‡å›åˆ°åŸæ¥ä½ç½®ï¼Œè¶…è¿‡åˆ™æ»‘åŠ¨åˆ°ä¸‹ä¸€å¼ ï¼š 12345if (this.touch.deltaX &lt; this.touch.threshold) &#123; // å›åˆ°åŸç‚¹ &#125; else &#123; // æ‰§è¡Œæ»‘åŠ¨é€»è¾‘ &#125; ä¼˜åŒ–ç‚¹åˆ°ç›®å‰ä¸ºæ­¢ä¸Šé¢çš„ä»£ç ç¤ºä¾‹åªæ˜¯ç»™å‡ºäº†æœ€åŸºæœ¬çš„æ•ˆæœï¼Œå®é™…é¡¹ç›®ä¸­å¡ç‰‡è¿˜ç”¨åˆ°äº†å¹³æ»‘è¿‡æ¸¡ï¼Œè¿™é‡Œæ¨èä½¿ç”¨tween.jsçš„ES6å®ç°ç‰ˆæœ¬es6-tweenï¼Œå¦å¤–ï¼Œå®é™…æˆ‘ä»¬é¡¹ç›®ä¸­å¤„ç†è§¦æ‘¸äº‹ä»¶çš„æ—¶å€™æœ‰ä¸€ç‚¹å¾ˆé‡è¦çš„æ˜¯å¤„ç†å¤šæŒ‡æ»‘åŠ¨ï¼Œè¿™é‡Œæä¾›ä¸€ä¸ªæ¯”è¾ƒé è°±çš„æ€è·¯ï¼šé€šè¿‡å®˜æ–¹TouchEvent APIé‡Œé¢æä¾›çš„changedToucheså¯¹è±¡æŸ¥æ‰¾å‘ç”Ÿäº†å˜åŒ–çš„è§¦ç‚¹ï¼Œé€šè¿‡å¯¹æ¯”è¿™äº›è§¦ç‚¹çš„identifierå±æ€§å»æ‰¾åˆ°æœ€å¼€å§‹è§¦æ‘¸å±å¹•çš„é‚£ä¸ªè§¦ç‚¹ï¼Œå¿½ç•¥å…¶ä»–è§¦ç‚¹çš„äº‹ä»¶å³å¯ã€‚","tags":[{"name":"æ»‘å±æ•ˆæœ","slug":"æ»‘å±æ•ˆæœ","permalink":"https://www.limuyang.cc/tags/æ»‘å±æ•ˆæœ/"},{"name":"äº¬æ™š8ç‚¹","slug":"äº¬æ™š8ç‚¹","permalink":"https://www.limuyang.cc/tags/äº¬æ™š8ç‚¹/"}]},{"title":"äº¬æ™š8ç‚¹-H5è§†é¢‘æ²‰æµ¸å¼æ’­æ”¾è§£å†³æ–¹æ¡ˆ","date":"2018-07-22T23:46:19.000Z","path":"2018/07/22/äº¬æ™š8ç‚¹-H5è§†é¢‘æ²‰æµ¸å¼æ’­æ”¾è§£å†³æ–¹æ¡ˆ/","text":"â€œæ²‰æµ¸æ’­æ”¾å¼â€è¿™ä¸ªæ¦‚å¿µæ˜¯æˆ‘ä»Androidå¼€å‘é‡Œé¢çš„æ²‰æµ¸å¼å¼•ç”³è¿‡æ¥çš„ä¸€ä¸ªæ¦‚å¿µï¼Œæ²‰æµ¸å¼å…¶å®å°±æ˜¯éšè—é¡µé¢é¡¶éƒ¨çš„status barå’Œåº•éƒ¨çš„navigation barä¹‹åå‘ˆç°å‡ºæ¥çš„é¡µé¢ï¼Œä¸€èˆ¬ç”¨æˆ·å¾ˆå®¹æ˜“æŠŠæ²‰æµ¸å¼çŠ¶æ€æ å’Œé€æ˜åŒ–çŠ¶æ€æ æ··ä¸ºä¸€è°ˆï¼Œä»–ä»¬çš„åŒºåˆ«å¦‚ä¸‹ï¼š æ²‰æµ¸å¼çŠ¶æ€æ  é€æ˜åŒ–çŠ¶æ€æ  é‚£ä¹ˆå›åˆ°å‰ç«¯å¼€å‘ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•è®©videoæ ‡ç­¾å‘ˆç°è¿™ç§æ²‰æµ¸å¼çš„æ’­æ”¾æ•ˆæœï¼Œå¹³å¸¸æˆ‘ä»¬ä½¿ç”¨videoæ ‡ç­¾éƒ½æ˜¯è¿™æ ·çš„ï¼š 123456789101112&lt;div id=\"app\"&gt; &lt;video id=\"videos\" playsinline=\"true\" webkit-playsinline=\"true\" /*IOSæ’­æ”¾è§†é¢‘ä¼šè‡ªåŠ¨è°ƒç”¨åŸç”Ÿæ’­æ”¾å™¨å…¨å±æ’­æ”¾ï¼Œè¿™é‡Œä½¿ç”¨è¿™ä¸ªå±æ€§è®©IOSå†…æ’­æ”¾è§†é¢‘çš„æ—¶å€™ä½¿ç”¨inlineæ¨¡å¼ï¼ŒåŒæ—¶æˆ‘ä»¬è®¾ç½®å®½é«˜ç­‰äºå±å¹•å®½é«˜æ¥å®ç°IOSä¸‹çš„å…¨å±æ’­æ”¾*/ x5-video-orientation=\"portraint\" preload=\"auto\" style=\"width: 100%;height: 100%\" &gt; &lt;source src=\"//gw.alicdn.com/bao/uploaded/TB1YKBlb_ZRMeJjSsppXXXrEpXa.mp4\" type=\"video/mp4\"&gt; &lt;/video&gt;&lt;/div&gt; æ­£å¸¸æƒ…å†µä¸‹æˆ‘ä»¬è¦åšç«–ç‰ˆè§†é¢‘ï¼Œè§†é¢‘çš„æ¯”ä¾‹éƒ½æ˜¯16:9ï¼Œä¹Ÿå°±æ˜¯é«˜/å®½çº¦ç­‰äº1.78ï¼Œè¿™é‡Œç”¨åˆ°çš„æµ‹è¯•è§†é¢‘ä¹Ÿæ˜¯16:9çš„ï¼Œè€Œä¸”é»˜è®¤æƒ…å†µä¸‹videoçš„object-fitå±æ€§çš„å€¼æ˜¯containï¼Œä¹Ÿå°±æ˜¯ä¿æŒé•¿å®½æ¯”ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸‹ä¸åšå¤„ç†åœ¨iphone6/7/8ä¸‹çš„è¡¨ç°æƒ…å†µï¼š çœ‹èµ·æ¥æ¯”è¾ƒå®Œç¾ï¼Œå› ä¸ºè¿™å‡ æ¬¾æ‰‹æœºåˆ†è¾¨ç‡éƒ½æ˜¯16:9çš„ï¼Œè§†é¢‘ç»´æŒå±å¹•å¤§å°å®Œå…¨æ²¡æœ‰é—®é¢˜ï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹åˆ†è¾¨ç‡ä¸æ˜¯16:9çš„æœºå‹ï¼Œæ¯”è¾ƒå…¸å‹çš„å°±æ˜¯iphoneXï¼Œé¢å‘è€æ¿å¼€å‘çš„åŒå­¦å¯èƒ½å¯¹é€‚é…è¿™æ¬¾æœºå‹é¢‡æœ‰æ€¨è¨€ï¼š æœ‰äººä¼šè§‰å¾—å¥‡æ€ªä¸ºä»€ä¹ˆæˆ‘ä»¬è®¾ç½®äº†videoçš„å®½é«˜éƒ½æ˜¯ç™¾åˆ†ç™¾ä¸Šä¸‹è¿˜æ¼å‡ºäº†ä¸¤ä¸ªç™½æ¡ï¼Œè¿™é‡Œå…¶å®æ˜¯object-fitè¿™ä¸ªå±æ€§åœ¨ä½œæ€ªï¼Œæ—¢ç„¶é»˜è®¤çš„æ˜¯containï¼Œæˆ‘ä»¬å°±æ”¹ä¸ºfillå§ï¼Œå†çœ‹ä¸€ä¸‹æ•ˆæœ: è¿™æ ·çœ‹èµ·æ¥æ²¡é—®é¢˜ï¼Œä½†æ˜¯ä½ è§‰å¾—äº§å“å°å§å§ä¼šè¿™ä¹ˆè½»æ˜“æ”¾è¿‡ä½ å—ï¼Ÿtoo navieï¼Œä½ çœ‹æˆ‘ä»¬æ­£å¸¸16:9çš„è§†é¢‘åœ¨iphoneXè¿™ç§18:9çš„å±å¹•ä¸Šæ˜¯æœ‰å½¢å˜çš„ï¼Œè€Œä¸”å¸‚é¢ä¸Šè¿™ä¹ˆå¤šåˆ†è¾¨ç‡ä¸åŒçš„è®¾å¤‡ï¼Œå¦‚æœè¦è¿½æ±‚ä¸åŒçš„æ‰‹æœºä¸Šæœ‰æœ€æ¥è¿‘çš„ç”¨æˆ·ä½“éªŒè¿™ä¹ˆåšè‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œæœ‰äººå¯èƒ½ä¼šæåˆ°object-fitä¸­çš„coverå±æ€§ï¼Œæ²¡é”™ï¼Œè¿™ä¸ªå±æ€§å¯ä»¥è®©æˆ‘ä»¬çš„è§†é¢‘ç­‰æ¯”ä¾‹ç¼©æ”¾ï¼Œå¦‚æœå®½é«˜ä¸åŒ¹é…ä¼šå¯¹å¤„ç†å¯¹è±¡åšè£å‰ªæ“ä½œï¼Œæ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹ç°åœ¨åœ¨å¾®ä¿¡é‡Œé¢çš„æ•ˆæœï¼š å…¶ä»–æ•ˆæœéƒ½è›®å¥½ï¼Œä½ ä¼šå‘ç°å³ä¸Šè§’æœ‰ä¸ªå¯æ¶çš„å…¨å±ï¼Œè¿™ä¸ªå…¨å±æŒ‰é’®æ˜¯å¾®ä¿¡çš„x5å†…æ ¸è‡ªå¸¦çš„ï¼Œæ²¡æ³•å»é™¤ï¼Œè¿™ä¸ªæœ‰å¾ˆå¤šäººç»™è…¾è®¯x5å¼€å‘å›¢é˜Ÿé‚£è¾¹æè¿‡issueï¼Œä½†æ˜¯æš‚æ—¶æ²¡æœ‰åŠæ³•å¤„ç†ï¼Œæˆ‘åç»­ä¼šæåˆ°ä¸€ä¸ªå¦è¾Ÿè¹Šå¾„çš„æ–¹æ¡ˆï¼Œå…ˆå›åˆ°è¿™é‡Œï¼Œç‚¹äº†è¿™ä¸ªå…¨å±æŒ‰é’®ä¹‹åä¼šè¿›å…¥å¾®ä¿¡çš„å…¨å±æ’­æ”¾æ¨¡å¼ï¼Œè€Œä¸”æ”¾å®Œä¹‹åä¼šå‡ºç°ä¸€å †å¹¿å‘Šåˆ—è¡¨ï¼Œè¿™éƒ½æ˜¯æˆ‘ä»¬ä¸æƒ³çœ‹åˆ°äº†ï¼Œå…¶æ¬¡å¦‚æœæˆ‘ä»¬çš„äº§å“éœ€æ±‚ä¸å•å•æ˜¯å…¨å±æ’­æ”¾ï¼Œè¿˜æƒ³åœ¨è§†é¢‘ä¸Šé¢æ”¾ä¸€äº›äº¤äº’æŒ‰é’®ä¹‹ç±»çš„ï¼Œè¿™ç§æ–¹å¼å°±åšä¸åˆ°ï¼Œå› ä¸ºvideoæ˜¯åœ¨æœ€ä¸Šä¸€çº§çš„ï¼Œä½†æ˜¯ä¸¤ç§æ–¹å¼ä¾‹å¤–ï¼Œä¸€ä¸ªæ˜¯å¾®ä¿¡æŠŠä½ ä»¬çš„åŸŸååŠ å…¥ç™½åå•ï¼Œè¿™ç§å¯ä»¥åœ¨Androidæ‰‹æœºçš„videoä¸Šéšæ„æ”¾ç½®domå…ƒç´ ï¼ŒIOSæœ¬èº«æ²¡æœ‰è¿™ä¸ªé™åˆ¶ï¼Œå¦ä¸€ç§æ›´ä¸ºé€šç”¨çš„æ–¹å¼æ˜¯ç”¨å¾®ä¿¡x5å†…æ ¸çš„åŒå±‚æ’­æ”¾æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼æœ‰ä¸¤ç§å¥½å¤„ï¼š å»é™¤äº†å³ä¸Šè§’è®¨åŒçš„â€å…¨å±â€æŒ‰é’® çœŸæ­£å®ç°äº†x5å†…æ ¸ä¸‹çš„æ²‰æµ¸å¼æ’­æ”¾ï¼Œæˆ‘ä»¬çœ‹åˆ°ç›®å‰çš„å®ç°åœ¨å¾®ä¿¡ä¸Šè¿˜æ˜¯å¸¦æœ‰æµè§ˆå™¨çš„titleBarçš„åœ¨x5å†…æ ¸çš„ç¯å¢ƒä¸‹å®ç°åŒå±‚æ’­æ”¾å¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨videoä¸Šæ·»åŠ è¿™ä¹ˆä¸¤è¡Œå±æ€§ï¼š 12x5-video-player-type=\"h5\"x5-video-player-fullscreen=\"true\" å†çœ‹ä¸€ä¸‹è¿™ä¸ªæ—¶å€™çš„æ•ˆæœï¼š ç¡®å®æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„æ²‰æµ¸å¼æ’­æ”¾ï¼Œå¦‚æœä½ çš„appé‡Œé¢webviewç”¨çš„ä¹Ÿæ˜¯x5å†…æ ¸é‚£ä¹ˆè¿™ä¸ªé¡µé¢ä¹Ÿèƒ½åœ¨appä¸Šè¾¾åˆ°åŒæ ·çš„æ•ˆæœï¼Œä½†æ˜¯è¿™ç§åŒå±‚æ’­æ”¾ä¾ç„¶æœ‰æ— æ³•è§£å†³çš„é—®é¢˜ï¼Œé¦–å…ˆè¿™ä¸ªå…¨å±æ¨¡å¼ä¼šé‡æ–°è®¡ç®—å®½é«˜ï¼Œè§¦å‘è§†å£å¤§å°å˜åŒ–ï¼Œä¹Ÿå°±æ˜¯è¯´ç”¨æˆ·è§†è§‰ä¸Šä¼šæœ‰ä¸€ä¸ªè§†å£å˜åŒ–çš„è¿‡ç¨‹ï¼Œå…¶æ¬¡ï¼ŒåŒå±‚æ’­æ”¾æ¨¡å¼è™½ç„¶æ²¡æœ‰äº†â€å…¨å±â€æŒ‰é’®ï¼Œä½†æ˜¯å·¦ä¸Šè§’çš„æŒ‰é’®ç”¨äºé€€å‡ºæ²‰æµ¸å¼å…¨å±ï¼Œå³ä¸Šè§’çš„æŒ‰é’®ç‚¹å¼€æ˜¯åˆ†äº«ï¼Œåˆ†äº«çš„å†…å®¹ä¸å¯å®šåˆ¶ï¼Œå›ºå®šä½å½“å‰é¡µé¢çš„title+urlçš„ç»„åˆï¼Œå¦‚æœä½ å¯¹é¡µé¢çš„å®šåˆ¶åŒ–è¦æ±‚æ¯”è¾ƒé«˜çš„è¯ï¼Œæˆ‘è¿™é‡Œæœ‰ä¸€ä¸ªå¤‡é€‰çš„æ–¹æ¡ˆï¼Œé‚£å°±æ˜¯æ”¾å¼ƒåŒå±‚æ’­æ”¾æ¨¡å¼ï¼Œå½“ç„¶è¿™ä¸ªå‰ææ˜¯ä½ ä¸éœ€è¦åœ¨videoé¡µé¢ä¸Šåšä¸€äº›äº¤äº’æ“ä½œï¼Œæˆ–è€…è¯´ä½ çš„åŸŸåå¤„äºå¾®ä¿¡ç™½åå•ä¸‹ï¼Œå½“æˆ‘ä»¬åœ¨éæ²‰æµ¸å¼ä¸‹åˆæƒ³è¦æ‰“åˆ°ç­‰æ¯”ä¾‹ç¼©æ”¾è§†é¢‘çš„æ•ˆæœï¼ŒåŒæ—¶æˆ‘ä»¬è¿˜è¦å»é™¤x5è‡ªå¸¦çš„â€å…¨å±â€æŒ‰é’®ï¼Œæœ€å¥½çš„æ–¹å¼å°±æ˜¯åŠ¨æ€å»è®¡ç®—è§†é¢‘çš„å®½é«˜ï¼ŒæŠŠè§†é¢‘æ’‘å¤§ï¼ŒæŠŠâ€å…¨å±â€æŒ‰é’®æ’‘å‡ºæµè§ˆå™¨é¡µé¢ï¼Œè¿™æ ·åŸºæœ¬å°±èƒ½è¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„äº†ï¼Œè¿™é‡Œä»¥16:9çš„æ ‡å‡†ä¸ºä¾‹ï¼š 123456789101112131415161718this.$nextTick(() =&gt; &#123; // åŠ¨æ€å¤„ç†videoæ ‡ç­¾å®½é«˜é€‚é… const video = this.$refs.video const ratio = Math.fround(document.documentElement.clientHeight / document.documentElement.clientWidth) if (ratio &gt;= 1.78) &#123; // ç«–å± video.height = document.documentElement.clientHeight + 100 video.width = Math.floor(video.clientHeight * 0.572) const winW = document.documentElement.clientWidth video.style.left = (winW - video.width) / 2 + 'px' &#125; else &#123; // å®½å± video.width = document.documentElement.clientWidth + 100 video.height = Math.floor(video.width * 1.78) const winH = document.documentElement.clientHeight video.style.top = (winH - video.height) / 2 + 'px' &#125; &#125;) è®²è§£ä¸‹æ€è·¯ï¼Œ16:9çš„è§†é¢‘ä¹Ÿå°±æ˜¯é«˜å®½æ¯”å·®ä¸å¤šæ˜¯1.78ï¼Œé‚£ä¹ˆå¤§äºè¿™ä¸ªæ¯”ä¾‹çš„å°±æ˜¯ç±»ä¼¼äºiphoneXçš„é•¿å±å¹•ç±»å‹çš„æ‰‹æœºï¼Œå¯¹äºè¿™ç§æ‰‹æœºæˆ‘ä»¬è¦åšç­‰æ¯”ç¼©æ”¾é€‚é…çš„è¯å°±ä»¥æ‰‹æœºçš„é•¿ä¸ºæ ‡å‡†ï¼Œå…ˆè®©è§†é¢‘çš„é•¿åº¦ç­‰äºæ‰‹æœºçš„é•¿åº¦ï¼Œè¿™é‡Œæˆ‘åŠ ä¸Šçš„100pxå¯ä»¥ç†è§£ä¸ºä¸Šä¸‹åœ¨åŠ ä¸Š50pxï¼Œç›®çš„å°±æ˜¯ä¸ºäº†æŠŠè§†é¢‘é•¿åº¦æ‹‰å¤§ï¼Œè®©â€å…¨å±â€æŒ‰é’®æ¶ˆå¤±åœ¨è§†çº¿å†…ï¼Œå®é™…è¿™ä¸ªå€¼å¯ä»¥è‡ªå·±å°è¯•ä¿®æ”¹ï¼Œè®©åå®½å°±æ˜¯æ­¤æ—¶é«˜çš„1/78å€ï¼Œç„¶åä½¿ç”¨ç»å¯¹å¸ƒå±€å»è®¾ç½®è§†é¢‘çš„å·¦è¾¹è·ï¼Œå°±å¯ä»¥è¾¾åˆ°ç­‰æ¯”ç¼©æ”¾çš„æ•ˆæœï¼ŒåŒç†å¯ä»¥ç†è§£å¤„ç†å®½å±æ‰‹æœºçš„ä»£ç éƒ¨åˆ†ï¼Œå½“ç„¶ï¼Œåº”è¯¥è¿˜æœ‰æ›´å®Œç¾çš„æ–¹æ¡ˆï¼Œå¯ä»¥åœ¨è¯„è®ºåŒºç•™è¨€æ¢è®¨~","tags":[{"name":"video","slug":"video","permalink":"https://www.limuyang.cc/tags/video/"},{"name":"æ²‰æµ¸å¼","slug":"æ²‰æµ¸å¼","permalink":"https://www.limuyang.cc/tags/æ²‰æµ¸å¼/"},{"name":"x5å†…æ ¸åŒå±‚æ’­æ”¾å™¨","slug":"x5å†…æ ¸åŒå±‚æ’­æ”¾å™¨","permalink":"https://www.limuyang.cc/tags/x5å†…æ ¸åŒå±‚æ’­æ”¾å™¨/"}]},{"title":"webpackä»0åˆ°1ä½¿ç”¨æŒ‡å—","date":"2018-05-19T16:02:23.000Z","path":"2018/05/19/webpackä»0åˆ°1ä½¿ç”¨æŒ‡å—/","text":"ä¸ºä»€ä¹ˆè¦ç”¨webpackå…³äºä¸ºä»€ä¹ˆè¦ä½¿ç”¨webpackï¼Œæˆ‘æ¯”è¾ƒè®¤åŒçš„ä¸€ç§è¯´æ³•æ˜¯ï¼š webpackå¯ä»¥å¾ˆå¥½åœ°ç®¡ç†ä½ å¼€å‘ä¸­é‡åˆ°çš„å„ç§HTMLã€JSã€CSSä»¥åŠå„ç§å›¾ç‰‡èµ„æºæ–‡ä»¶ï¼ŒåŒæ—¶å¯¹åº”ä¸åŒçš„èµ„æºï¼Œwebpackè¿˜æä¾›äº†å¯¹åº”çš„Loaderså°†å…¶è¿›è¡Œè½¬åŒ–ä¸ºé€‚ç”¨äºæµè§ˆå™¨ä½¿ç”¨çš„æ ¼å¼ å¦‚ä½•ä»0å¼€å§‹ä¸Šæ‰‹webpackåä¼šæ— æœŸé‡Œé¢ï¼Œé˜¿å•è¯´è¿‡è¿™ä¹ˆä¸€å¥è¯ï¼šâ€ä½ è¿ä¸–ç•Œéƒ½æ²¡æœ‰è§‚è¿‡ï¼Œå“ªé‡Œæ¥çš„ä¸–ç•Œè§‚â€ï¼Œåœ¨æˆ‘ä»¬å®é™…çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œæ¯”å¦‚ä½ ç”¨çš„æ˜¯vueï¼Œé‚£ä¹ˆvueå·²ç»æœ‰å¾ˆå¥½çš„è„šæ‰‹æ¶å·¥å…·(vue-cli)ä¾›ä½ ä½¿ç”¨äº†ï¼Œæˆ–è€…æœ‰çš„å¼€å‘å›¢é˜Ÿï¼Œä¼šæœ‰æŠ€æœ¯Leaderä¸“é—¨é¢„å…ˆåšå¥½ç›¸å…³çš„æ¨¡æ¿ï¼Œæ–¹ä¾¿åæ¥æ–°åŠ å…¥çš„æˆå‘˜å°½å¿«ä¸Šæ‰‹é¡¹ç›®ï¼Œä½†æ˜¯éšç€ä½ å¼€å‘çš„é¡¹ç›®è¶Šå¤šï¼Œä½ å¯èƒ½ä¼šè¶Šä¸æ³¨æ„åˆ°é‚£äº›æœ€åŸºæœ¬çš„ä¸œè¥¿ï¼Œæ¯”å¦‚è¯´è¿™ä¸ªæ¨¡æ¿åˆ°åº•æ˜¯å¦‚ä½•æ­å»ºçš„ï¼Œæˆ–è€…è¯´è®©ä½ è‡ªå·±æ¥æ­å»ºä¸€ä¸ªæ¨¡æ¿ç»™å…¶ä»–äººç”¨ï¼Œæ˜¯å¦ä¹Ÿèƒ½åšåˆ°å¦‚æ­¤çš„ç®€å•æ˜“ä¸Šæ‰‹ï¼Œæˆ‘æƒ³è¿™æ˜¯æ¯ä¸€ä¸ªæƒ³è¦åœ¨å‰ç«¯è·¯ä¸Šè¿›é˜¶çš„äººéœ€è¦è€ƒè™‘çš„é—®é¢˜ã€‚ æœ€å¥½çš„æ–¹å¼å°±æ˜¯è‡ªå·±è¯•ç€å»æ­ä¸€ä¸ªæœ€ç®€å•çš„æ¨¡æ¿ï¼Œä»0åˆ°1çš„è¿‡ç¨‹æ˜¯æœ€ç—›è‹¦çš„ï¼Œä½†æ˜¯1åˆ°2æˆ–è€…è¯´2åˆ°3éƒ½æ˜¯æ°´åˆ°æ¸ æˆçš„äº‹ï¼Œä¸‹é¢å°±çœ‹çœ‹æ€ä¹ˆå¼€å§‹ä»0æ­å»ºä¸€ä¸ªåŸºäºwebpackçš„vueçš„å¼€å‘ç¯å¢ƒ åˆ›å»ºé¡¹ç›®æ³¨ï¼šä½¿ç”¨çš„webpackç‰ˆæœ¬ä¸º^3.10.0é¦–å…ˆé€šè¿‡webstormæˆ–è€…ä½ æ‰‹ä¸Šçš„å…¶ä»–IDEåˆ›å»ºä¸€ä¸ªç©ºçš„é¡¹ç›®ï¼Œæˆ‘è¿™é‡Œæš‚ä¸”å«proWebpackï¼Œåˆ›å»ºå¥½åæ˜¯è¿™ä¸ªæ ·å­çš„ï¼š å› ä¸ºæˆ‘ä»¬é€šè¿‡npmæ¥ç®¡ç†åŒ…ï¼Œç„¶åæ¯ä¸ªé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹éƒ½ä¼šæœ‰ä¸€ä¸ªpackage.jsonæ–‡ä»¶æ¥ç®¡ç†é¡¹ç›®çš„é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬åç§°ã€ç‰ˆæœ¬ã€è®¸å¯è¯ç­‰å…ƒæ•°æ®ä»¥åŠè®°å½•æ‰€éœ€çš„å„ç§æ¨¡å—ï¼ŒåŒ…æ‹¬ æ‰§è¡Œä¾èµ–ï¼Œå’Œå¼€å‘ä¾èµ–ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨å‘½ä»¤æ§åˆ¶å°ç”¨npm initå‘½ä»¤åˆ›å»ºä¸€ä¸ªpackage.jsonæ–‡ä»¶ï¼Œä½†æ˜¯è¿™æ ·å¾ˆéº»çƒ¦ï¼Œå› ä¸ºè¿™æ ·npmä¼šé€šè¿‡å‘½ä»¤è¡Œé—®ç­”çš„æ–¹å¼æ¥åˆå§‹åŒ–å¹¶åˆ›å»ºpackage.jsonæ–‡ä»¶ï¼Œä¸ºäº†æ–¹ä¾¿èµ·è§æˆ‘ä»¬ä½¿ç”¨npm init -yï¼Œè¿™æ ·npmå°±ä¼šä½¿ç”¨ä¸€äº›é»˜è®¤å€¼è¿›è¡Œåˆå§‹åŒ–ï¼š okç°åœ¨æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªpackage.jsonæ–‡ä»¶ï¼ŒåŒ…å«äº†ä¸€äº›ç®€å•çš„ä¿¡æ¯æ¯”å¦‚nameã€versionç­‰å­—æ®µï¼Œæ¥ä¸‹æ¥ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯æƒ³æ­å»ºä¸€ä¸ªç”¨äºvueå¼€å‘ç¯å¢ƒçš„webpackç›®å½•ç»“æ„ï¼Œåˆ°ç›®å‰ä¸ºæ­¢è¿˜æ²¡çœ‹åˆ°vueçš„å½±å­ï¼Œä¾ç„¶æ˜¯åœ¨å‘½ä»¤è¡Œä½¿ç”¨npm install vue --saveï¼Œè¿™é‡Œæ³¨æ„package.jsonä¸­çš„ä¾èµ–åŒ…æœ‰dependencieså’ŒdevDependenciesä¸¤ç§ï¼Œè¿™ä¸¤ç§çš„åŒºåˆ«ï¼šdependencies è¡¨ç¤ºæˆ‘ä»¬è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨è¯¥ä¾èµ–ï¼ŒdevDependencies åˆ™è¡¨ç¤ºæˆ‘ä»¬ä»…åœ¨å¼€å‘ç¯å¢ƒä½¿ç”¨è¯¥ä¾èµ–ï¼Œæˆ‘ä»¬installæ—¶å€™ä½¿ç”¨â€“saveä¼šæŠŠåŒ…å®‰è£…åœ¨dependencies ä¸‹é¢ï¼Œæ‰€ä»¥æ‰§è¡Œå®Œä¸Šé¢çš„å‘½ä»¤ä½ å¯ä»¥çœ‹åˆ°è¿™æ ·çš„ç›®å½•ç»“æ„ï¼š123456789101112131415&#123; \"name\": \"proWebpack\", \"version\": \"1.0.0\", \"description\": \"\", \"main\": \"index.js\", \"scripts\": &#123; \"test\": \"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\" &#125;, \"keywords\": [], \"author\": \"\", \"license\": \"ISC\", \"dependencies\": &#123; \"vue\": \"^2.5.16\" &#125;&#125; ç„¶ååœ¨devDependenciesä¸‹é¢å®‰è£…webpackï¼Œå†æ¬¡æé†’ï¼Œç”±äºwebpack4å˜åŒ–è¾ƒå¤§ï¼Œè¿™é‡Œä½¿ç”¨^3.10.0ç‰ˆæœ¬çš„webpackï¼š npm install -D webpack@3.10.0ï¼Œæ­¤æ—¶ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š123456789101112131415161718&#123; \"name\": \"proWebpack\", \"version\": \"1.0.0\", \"description\": \"\", \"main\": \"index.js\", \"scripts\": &#123; \"test\": \"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\" &#125;, \"keywords\": [], \"author\": \"\", \"license\": \"ISC\", \"dependencies\": &#123; \"vue\": \"^2.5.16\" &#125;, \"devDependencies\": &#123; \"webpack\": \"^3.10.0\" &#125;&#125; åˆ›å»ºå…¥å£æ–‡ä»¶æ¥ä¸‹æ¥åˆ›å»ºå…¥å£æ–‡ä»¶ï¼Œåœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªindex.htmlä½œä¸ºå¯åŠ¨é¡µé¢ï¼Œä¸€ä¸ªwebpack.config.jsä½œä¸ºwebpacké…ç½®æ–‡ä»¶(å®é™…é¡¹ç›®ä¸­è¿™é‡Œä¼šæœ‰webpacké…ç½®æ–‡ä»¶ï¼Œåˆ†åˆ«ç”¨äºå¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒï¼Œè¿™é‡Œç®€ä¾¿èµ·è§å°±ç”¨ä¸€ä¸ªé…ç½®æ–‡ä»¶)ï¼Œæ–°å»ºä¸€ä¸ªsrcç›®å½•ï¼Œåœ¨è¯¥ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªindex.jsä½œä¸ºæ‰“åŒ…å…¥å£æ–‡ä»¶ï¼š1234567proWebpackâ”œâ”€ index.html å¯åŠ¨é¡µé¢â”œâ”€ package-lock.jsonâ”œâ”€ package.json åŒ…ç®¡ç†â”œâ”€ srcâ”‚ â””â”€ index.js å…¥å£æ–‡ä»¶â””â”€ webpack.config.js webpacké…ç½®æ–‡ä»¶ ä¸ºäº†æ›´æ¥è¿‘vue-cliåˆ›å»ºå‡ºæ¥çš„æ¨¡æ¿ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªVueå®ä¾‹æä¾›ç»™å…¥å£æ–‡ä»¶çš„elæŒ‚è½½ï¼Œè¿™ä¸ªVueæ–‡ä»¶å¾ˆç®€å•é•¿è¿™æ ·ï¼š123&lt;template&gt; &lt;div&gt;proWebpack&lt;/div&gt;&lt;/template&gt; ç„¶åå†™å¥½å…¥å£æ–‡ä»¶ï¼š1234567import Vue from 'vue'import App from '../App.vue'new Vue(&#123; el: '#app', render: h =&gt; h(App)&#125;) åŒæ—¶åˆ«å¿˜è®°åœ¨Index.htmlé‡Œé¢è¦æä¾›ä¸€ä¸ªä¾›vueå®ä¾‹æŒ‚è½½çš„HTMLElementå®ä¾‹ï¼š12345678910&lt;!DOCTYPE html&gt;&lt;html lang=\"en\"&gt;&lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;title&gt;proWebpack&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;div class=\"app\"&gt;proWebpack&lt;/div&gt;&lt;/body&gt;&lt;/html&gt; è¿™æ ·å‡†å¤‡å·¥ä½œåšå¾—å·®ä¸å¤šäº†ï¼Œä¸‹é¢åšæœ€æ ¸å¿ƒçš„éƒ¨åˆ† webpack.config.jsçš„ç¼–å†™webpackæœ‰è¿™ä¹ˆå‡ ä¸ªæ ¸å¿ƒçš„æ¦‚å¿µï¼š entry å…¥å£èµ·ç‚¹ï¼Œwebpackä¼šæ‰¾å‡ºå…¥å£èµ·ç‚¹çš„ç›´æ¥æˆ–é—´æ¥ä¾èµ–é¡¹ï¼Œå°†ä»–ä»¬è¿›è¡Œå¤„ç†è¾“å‡ºä¸ºæˆ‘ä»¬ç§°ä¹‹ä¸ºbundleçš„æ–‡ä»¶ä¸­ output è¾“å‡ºè·¯å¾„ï¼Œå‘Šè¯‰ webpack åœ¨å“ªé‡Œè¾“å‡ºå®ƒæ‰€åˆ›å»ºçš„ bundlesä»¥åŠå¦‚ä½•ç»™è¿™äº›buldleså‘½å loader å› ä¸ºwebpackæœ¬èº«åªèƒ½ç†è§£javascriptæ–‡ä»¶ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬è¦ç”¨vueæˆ–è€…Reactçš„æ—¶å€™å¯ä»¥ä½¿ç”¨ç›¸å…³çš„loader(æ¯”å¦‚æˆ‘ä»¬ç†ŸçŸ¥çš„vue-loader)æ¥å°†å…¶è½¬æ¢æˆwebpack èƒ½å¤Ÿå¤„ç†çš„æœ‰æ•ˆæ¨¡å— plugins æ‰©å±•æ’ä»¶ï¼Œå¯ä»¥ç”¨äºæ‰“åŒ…çš„ä¼˜åŒ–å’Œå‹ç¼©ï¼Œè¿™ä¸ªå¯èƒ½è¦ç»“åˆå®é™…ä½¿ç”¨æ›´å¥½ç†è§£ module æ¨¡å— webpackä¸­çš„ä¸€åˆ‡ä½ éƒ½å¯ä»¥ç†è§£ä¸ºæ¨¡å— chunk ä»£ç å—ï¼Œä¸€ä¸ª chunk ç”±å¤šä¸ªæ¨¡å—ç»„åˆè€Œæˆï¼Œç”¨äºä»£ç åˆå¹¶ä¸åˆ†å‰²ã€‚ ä¸‹é¢å¼€å§‹é…ç½®ï¼Œå› ä¸ºæ‰€æœ‰è¾“å‡ºæ–‡ä»¶çš„ç›®æ ‡è·¯å¾„å¿…é¡»æ˜¯ç»å¯¹è·¯å¾„ï¼Œæ‰€ä»¥è¿™é‡Œè¦ç”¨åˆ°ä½¿Node.js çš„ path æ¨¡å—123// å¼•å…¥webpackå’Œpathæ¨¡å—const path = require('path')const webpck = require('webpack') ç®€å•é…ç½®æ–‡ä»¶çš„entryå’Œoutput12345678910111213const path = require('path')const webpck = require('webpack')const productionPath = require('./package.json').namemodule.exports = &#123; entry: &#123; index: './src/index.js' &#125;, output: &#123; path: path.join(__dirname, 'dist', productionPath), filename: 'bundle.js' &#125;&#125; è¿™é‡Œä»£ç åº”è¯¥ä¸éš¾ç†è§£ï¼Œå°±æ˜¯ä»index.jsè¿™ä¸ªå…¥å£è¿›å»ï¼ŒæŠŠç›´æ¥æˆ–é—´æ¥ä¾èµ–é¡¹æ‰“åŒ…è¾“å‡ºdistæ–‡ä»¶å¤¹ç›®å½•ä¸‹,æ€ä¹ˆè¿è¡Œå‘¢ï¼Œæˆ‘ä»¬éœ€è¦åœ¨package.jsonçš„scriptså¯¹è±¡é‡Œé¢æ·»åŠ æˆ‘ä»¬è‡ªå·±çš„buildå‘½ä»¤ï¼š12// è¿™é‡Œç”¨æœ€ç®€å•çš„å‘½ä»¤&quot;build&quot;: &quot;webpack -w&quot;, å› ä¸ºæˆ‘ä»¬çš„webpacké…ç½®æ–‡ä»¶å°±å«webpack.config.jsï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œwebpackåœ¨æ‰§è¡Œçš„æ—¶å€™ä¼šæœç´¢å½“å‰ç›®å½•webpack.config.js æ–‡ä»¶æ‰§è¡Œï¼Œå®é™…å¼€å‘ä¸­æˆ‘ä»¬ä¼šä½¿ç”¨ â€“config é€‰é¡¹æ¥æŒ‡å®šé…ç½®æ–‡ä»¶æ¥å¯¹å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„é…ç½®åšå‡ºåŒºåˆ† ç›´æ¥åœ¨æ§åˆ¶å°npm run buildï¼Œæœä¸å…¶ç„¶æŠ¥é”™äº†ï¼š1234567ERROR in ./App.vueModule parse failed: Unexpected token (1:0)You may need an appropriate loader to handle this file type.| &lt;template&gt;| &lt;div&gt;proWebpack&lt;/div&gt;| &lt;/template&gt; @ ./src/index.js 2:0-28 å¾ˆæ˜æ˜¾ï¼Œwebpackå‘Šè¯‰æˆ‘ä»¬ä»–æ²¡æ³•è¯†åˆ«vueæ–‡ä»¶ï¼Œéœ€è¦æˆ‘ä»¬æä¾›ä¸€ä¸ªç›¸å…³çš„loaderæ¥å¤„ç†æˆwebpackå¯ä»¥è¯†åˆ«çš„æ–‡ä»¶ï¼Œè¿™é‡Œå…ˆnpm install vue-loader -Dï¼Œç„¶åå›åˆ°webpack.config.jsoné…ç½®loaderï¼š123456789101112131415161718192021222324252627const path = require(&apos;path&apos;)const webpck = require(&apos;webpack&apos;)module.exports = &#123; entry: &#123; index: &apos;./src/index.js&apos; &#125;, output: &#123; path: path.join(__dirname, &apos;dist&apos;), filename: &apos;bundle.js&apos; &#125;, module: &#123; // æ¨¡å—é…ç½® rules: [ //æ¨¡å—è§„åˆ™(é…ç½® loaderã€è§£æå™¨ç­‰é€‰é¡¹) &#123; // è¿™é‡Œæ˜¯åŒ¹é…æ¡ä»¶ï¼Œæ¯ä¸ªé€‰é¡¹éƒ½æ¥æ”¶ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æˆ–å­—ç¬¦ä¸² // testæ˜¯å¿…é¡»åŒ¹é…é€‰é¡¹ // exclude æ˜¯å¿…ä¸åŒ¹é…é€‰é¡¹(ä¼˜å…ˆäº test å’Œ include) // å¯¹é€‰ä¸­åçš„æ–‡ä»¶é€šè¿‡ use é…ç½®é¡¹æ¥åº”ç”¨ Loaderï¼Œå¯ä»¥åªåº”ç”¨ä¸€ä¸ª Loader æˆ–è€…æŒ‰ç…§ä»åå¾€å‰çš„é¡ºåºåº”ç”¨ä¸€ç»„ Loaderï¼ŒåŒæ—¶è¿˜å¯ä»¥åˆ†åˆ«ç»™ Loader ä¼ å…¥å‚æ•°ã€‚ test: /\\.vue$/, exclude: /node_modules/, use: &#123;loader: &quot;vue-loader&quot;&#125; &#125; ] &#125;&#125; é…ç½®å¥½ä¹‹åå†runä¸€éï¼Œå’¦ï¼ŒåˆæŠ¥é”™ï¼Œæˆ‘ä»¬çœ‹ä¸‹ä¸»è¦çš„æŠ¥é”™ä¿¡æ¯ï¼š1234ERROR in ./App.vueModule build failed: Error: Cannot find module &apos;vue-template-compiler&apos; at Function.Module._resolveFilename (module.js:527:15) at Function.Module._load (module.js:476:23) cannot founté‚£å°±æ˜¯éœ€è¦æˆ‘ä»¬å»installå‘—ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¦ä¸‹è¿™ä¸ªæ¨¡å—ï¼Œæˆ‘æ‰¾åˆ°ä¸€ä¸ªæ¯”è¾ƒé è°±çš„è¯´æ³•ï¼š å…¶ä¸­ vue-template-compiler æ˜¯ vue-loader çš„ peerDependenciesï¼Œnpm3 ä¸ä¼šè‡ªåŠ¨å®‰è£… peerDependenciesï¼Œç„¶è€Œ vue-template-compiler åˆæ˜¯å¿…å¤‡çš„ï¼Œé‚£ä¸ºä»€ä¹ˆä½œè€…ä¸å°†å…¶æ”¾åˆ° dependencies ä¸­å‘¢ï¼Ÿæœ‰äººåœ¨ github ä¸Šæè¿‡è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å¤§è‡´ç¿»è¯‘ä¸€ä¸‹ä½œè€…çš„å›ç­”ï¼ˆä»…ä¾›å‚è€ƒï¼‰ï¼šè¿™æ ·åšçš„åŸå› æ˜¯å› ä¸ºæ²¡æœ‰å¯é çš„æ–¹å¼æ¥å›ºå®šåµŒå¥—ä¾èµ–çš„å…³ç³»ï¼Œæ€ä¹ˆç†è§£è¿™å¥è¯ï¼Ÿé¦–å…ˆ vue-template-compiler å’Œ vue çš„ç‰ˆæœ¬å·æ˜¯ä¸€è‡´çš„ï¼ˆç›®å‰æ˜¯åŒæ­¥æ›´æ–°ï¼‰ï¼Œå°† vue-template-compiler æŒ‡å®šä¸º vue-loader çš„ dependencies å¹¶ä¸èƒ½ä¿è¯ vue-template-compiler å’Œ vue çš„ç‰ˆæœ¬å·æ˜¯ç›¸åŒçš„ï¼Œè®©ç”¨æˆ·è‡ªå·±æŒ‡å®šç‰ˆæœ¬æ‰èƒ½ä¿è¯è¿™ä¸€ç‚¹ã€‚æŸ¥çœ‹ä½œè€…çš„å›ç­”ï¼ˆè‹±æ–‡ï¼‰ ã€‚å¦‚æœä¸¤è€…ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œè¿è¡Œæ—¶å°±ä¸ä¼šé”™è¯¯æç¤ºã€‚ é‚£åªéœ€è¦æˆ‘ä»¬npm i vue-template-compiler -Dä¸€ä¸‹ï¼Œç„¶ååœ¨è·‘ä¸€ébuildè„šæœ¬ï¼Œä¸å‡ºæ„å¤–ä½ åº”è¯¥èƒ½åœ¨é¡¹ç›®æ ¹ç›®å½•çœ‹åˆ°ä¸€ä¸ªdistæ–‡ä»¶å¤¹ï¼ŒæŠŠè¿™ä¸ªæ–‡ä»¶å¤¹é‡Œé¢çš„jsæ–‡ä»¶å¼•å…¥å¯åŠ¨é¡µé¢ï¼š1234567891011&lt;!DOCTYPE html&gt;&lt;html lang=\"en\"&gt;&lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;title&gt;proWebpack&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;div class=\"app\"&gt;proWebpack&lt;/div&gt;&lt;script src=\"/dist/bundle.js\"&gt;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt; æ¥ä¸‹æ¥æˆ‘ä»¬è¦è®¿é—®è¿™ä¸ªé¡µé¢ï¼Œè¿™é‡Œç”¨åˆ°webpackæä¾›çš„devseveræ¥è°ƒè¯•æˆ‘ä»¬çš„é¡µé¢ï¼Œ DevServer ä¼šå¯åŠ¨ä¸€ä¸ª HTTP æœåŠ¡å™¨ç”¨äºæœåŠ¡ç½‘é¡µè¯·æ±‚ï¼ŒåŒæ—¶ä¼šå¸®åŠ©å¯åŠ¨ Webpack ï¼Œå¹¶æ¥æ”¶ Webpack å‘å‡ºçš„æ–‡ä»¶æ›´å˜ä¿¡å·ï¼Œé€šè¿‡ WebSocket åè®®è‡ªåŠ¨åˆ·æ–°ç½‘é¡µåšåˆ°å®æ—¶é¢„è§ˆã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ ç”¨vue-cliæ­å»ºå‡ºæ¥çš„è„šæ‰‹æ¶å¯ä»¥åšåˆ°é¡µé¢å®æ—¶æ¸²æŸ“ï¼Œé…ç½®è¿™ä¸ªä¹Ÿå¾ˆç®€å•ï¼Œåœ¨webpack.config.jsé‡Œé¢æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š123devServer: &#123; port: 3000, // ç«¯å£å· &#125; å…¶å®webpack-dev-serverå¯ä»¥é…ç½®å¾ˆå¤šå‚æ•°ï¼Œè¿™é‡Œä¸è¿‡å¤šå±•å¼€ï¼Œæ¥ä¸‹æ¥éœ€è¦ä¿®æ”¹ä¸‹æˆ‘ä»¬çš„buildè„šæœ¬ï¼š1\"build\": \"webpack-dev-server\" åˆ«å¿˜äº†npm installä¸€ä¸‹webpack-dev-serverï¼Œæœ€åæ‰§è¡Œnpm run buildçœ‹åˆ°æ§åˆ¶å°æŠ¥å‡ºæˆåŠŸä¿¡æ¯å¹¶å‘Šè¯‰ä½ ä½ çš„é¡¹ç›®æ­£è¿è¡Œåœ¨localhost:3000ï¼š1234567$ npm run build&gt; proWebpack@1.0.0 build D:\\proWebpack&gt; webpack-dev-server --openProject is running at http://localhost:3000/webpack output is served from / è®¿é—®localhost:3000çœ‹åˆ°å¦‚ä¸‹æ˜¾ç¤ºçš„è¯ï¼Œæ­å–œä½ ï¼Œwebpacké…ç½®å¦‚ä½•ä»0åˆ°1ä½ åº”è¯¥å·²ç»æ¸…æ¥šäº†ï¼š æ›´è¿›ä¸€æ­¥æˆ‘ä»¬çŸ¥é“äº†æ€ä¹ˆåˆæ­¥é…ç½®webpackè¿˜è¿œè¿œä¸å¤Ÿï¼Œå®é™…å¼€å‘ä¸­æˆ‘ä»¬ä¼šé‡åˆ°æ›´å¤šæ ·çš„æƒ…å†µï¼Œæ¯”å¦‚è¯´å½“æˆ‘ä»¬åªæœ‰ä¸€ä¸ªè¾“å‡ºæ–‡ä»¶çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥åœ¨outputå†™æ­»ï¼Œå°±åƒæˆ‘ä»¬ä¸Šé¢å†™çš„ï¼š1234output: &#123; path: path.join(__dirname, &apos;dist&apos;), filename: &apos;bundle.js&apos; &#125; ä½†æ˜¯å½“æˆ‘ä»¬æœ‰å¤šä¸ªæ–‡ä»¶è¾“å‡ºçš„æ—¶å€™ï¼Œä¸€ä¸ªä¸ªå»å†™æ˜¯ä¸€ä¸ªè´¹åŠ›ä¸è®¨å¥½çš„åšæ³•ï¼Œè¿™ä¸ªæ—¶å€™å°±è¦ç”¨åˆ°webpackå†…ç½®çš„å˜é‡äº†ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™ï¼š1234output: &#123; path: path.join(__dirname, &apos;dist&apos;), filename: &apos;[name].[hash].js&apos; &#125; è¿™æ ·ä¼šèµ‹äºˆæ¯ä¸€ä¸ªbundleå”¯ä¸€çš„åç§°ï¼Œå¹¶ä¸”åœ¨æ¯æ¬¡æ„å»ºè¿‡ç¨‹ä¸­ï¼Œç”Ÿæˆå”¯ä¸€çš„ hash ï¼Œè¿™æ—¶å€™ç¨å¾®æ”¹åŠ¨ä¸€ä¸‹è„šæœ¬æ–‡ä»¶ï¼š12345\"scripts\": &#123; \"start\": \"webpack-dev-server\", \"build\": \"webpack -w\", \"test\": \"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\" &#125;, ä¹‹å‰å†™ä¸€èµ·æ˜¯ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œ ç°åœ¨æˆ‘æŠŠè·‘æœ¬åœ°æœåŠ¡å™¨å’Œæ‰“åŒ…çš„è„šæœ¬æ‹†å¼€å†™ï¼Œæ›´è¯­ä¹‰åŒ–ï¼Œä¸€èˆ¬æ­£å¸¸å¼€å‘ä¹Ÿæ˜¯è¿™ä¹ˆåšçš„ï¼Œå…ˆè·‘ä¸€ä¸‹buildï¼Œä½ ä¼šå‘ç°æ­¤æ—¶distæ–‡ä»¶å¤¹ä¸‹é¢ç”Ÿæˆäº†æ–°çš„æ‰“åŒ…æ–‡ä»¶index.8ad46f4fb5c8385db614.jsï¼Œç„¶åæŠŠè¿™ä¸ªæ–‡ä»¶åŒæ ·å¼•å…¥index.htmlï¼Œè·‘startè„šæœ¬å‘ç°ç»“æœä¹Ÿæ˜¯ç…§å¸¸è¾“å‡ºï¼Œä½†æ˜¯åˆæœ‰äº†æ–°çš„é—®é¢˜ï¼Œå¦‚æœæˆ‘ä»¬æ¯æ¬¡buildä¹‹åéƒ½è¦æ‰‹åŠ¨å¼•å…¥å¸¦ç€ä¸€é•¿ä¸²hashçš„jsæ–‡ä»¶ä¹Ÿæ˜¯å¾ˆè ¢çš„äº‹æƒ…ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸Šä¸€ä¸ªpluginå«åšhtml-webpack-pluginï¼Œè¿™ä¸ªæ’ä»¶ä¸»è¦æœ‰ä¸¤ä¸ªä½œç”¨ï¼š1ã€åœ¨æ¯æ¬¡ç¼–è¯‘å®Œæˆä¹‹ååŠ¨æ€ä¸ºhtmlæ–‡ä»¶å¼•å…¥å¤–éƒ¨èµ„æº(scriptã€link)ï¼Œå¯¹äºæˆ‘meä½ è¿™ç§å¸¦hashçš„æ–‡ä»¶åæ¥è¯´æ— ç–‘æ˜¯æä¸ºæ–¹ä¾¿çš„2ã€å¯ä»¥åˆ¶å®šä¸€ä¸ªæ¨¡æ¿çš„htmlæ–‡ä»¶ï¼Œhtml-webpack-pluginå¯ä»¥æ ¹æ®è¿™ä¸ªæ¨¡æ¿æ¥ç”Ÿæˆhtmlå…¥å£æ–‡ä»¶ ä¸‹é¢çœ‹ä¸‹å¦‚ä½•ä½¿ç”¨ï¼š12345678910// å¼•å…¥const HtmlWebpackPlugin = require('html-webpack-plugin') //çœç•¥è‹¥å¹²ä»£ç  plugins: [ new HtmlWebpackPlugin(&#123; filename: './index.html', // ç”Ÿæˆçš„å…¥å£æ–‡ä»¶çš„åå­—ï¼Œé»˜è®¤å°±æ˜¯index.html template: './index.tpl.html',// æœ‰æ—¶å€™ï¼Œæ’ä»¶è‡ªåŠ¨ç”Ÿæˆçš„htmlæ–‡ä»¶ï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬éœ€è¦ç»“æ„ï¼Œæˆ‘ä»¬éœ€è¦ç»™å®ƒæŒ‡å®šä¸€ä¸ªæ¨¡æ¿ï¼Œè®©æ’ä»¶æ ¹æ®æˆ‘ä»¬ç»™çš„æ¨¡æ¿ç”Ÿæˆhtml inject: 'body',// æœ‰å››ä¸ªé€‰é¡¹å€¼ true, body, head, false----true:é»˜è®¤å€¼ï¼Œscriptæ ‡ç­¾ä½äºhtmlæ–‡ä»¶çš„ body åº•éƒ¨ body:åŒtrue head:æ’å…¥çš„jsæ–‡ä»¶ä½äºheadæ ‡ç­¾å†… false:ä¸æ’å…¥ç”Ÿæˆçš„jsæ–‡ä»¶ï¼Œåªç”Ÿæˆä¸€ä¸ªçº¯html &#125;) ], ç”¨åˆ°çš„index.tpl.htmlåªæ˜¯å’Œä¹‹å‰çš„index.htmlä½œäº†ä¸€ç‚¹å°å°çš„åŒºåˆ†ï¼Œè®©äººçŸ¥é“è¿™æ˜¯æ¨¡æ¿ç”Ÿæˆçš„ï¼š1234567891011// index.tpl.html&lt;!DOCTYPE html&gt;&lt;html lang=\"en\"&gt;&lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;title&gt;è¿™æ˜¯æ¨¡æ¿ç”Ÿæˆçš„&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;div class=\"app\"&gt;proWebpack&lt;/div&gt;&lt;/body&gt;&lt;/html&gt; æ–¹ä¾¿èµ·è§æˆ‘ä»¬åœ¨package.jsonåœ¨æ·»åŠ ä¸€ä¸ªcleançš„è„šæœ¬ï¼Œæ¯æ¬¡buildä¹‹å‰å…ˆåˆ é™¤ä¹‹å‰ç”Ÿæˆçš„distæ–‡ä»¶ï¼š123456&quot;scripts&quot;: &#123; &quot;start&quot;: &quot;webpack-dev-server&quot;, &quot;build&quot;: &quot;npm run clean &amp;&amp; webpack -w&quot;, &quot;clean&quot;: &quot;rimraf dist&quot;, // æ·»åŠ cleanè„šæœ¬ &quot;test&quot;: &quot;echo \\&quot;Error: no test specified\\&quot; &amp;&amp; exit 1&quot; &#125; ç„¶årun buildä¸€ä¸‹ï¼šæˆ‘ä»¬å‘ç°è¿™ä¸ªæ—¶å€™çš„å…¥å£æ–‡ä»¶å·²ç»æ˜¯æ ¹æ®æ¨¡æ¿è‡ªåŠ¨ç”Ÿæˆçš„äº†ï¼Œè€Œä¸”è‡ªåŠ¨æŠŠç”Ÿæˆçš„jsæ–‡ä»¶æ·»åŠ åˆ°äº†å…¥å£æ–‡ä»¶é‡Œé¢ï¼ŒåŒæ—¶npm run startå‘½ä»¤çœ‹åˆ°çš„ç•Œé¢ä¹Ÿæ˜¯ä½¿ç”¨æ¨¡æ¿ç”Ÿæˆçš„é¡µé¢ï¼Œè¿™å°±å¤§åŠŸå‘Šæˆäº†ã€‚ æœ€åå…¶å®è¿™é‡Œè¿˜æœ‰ä¸€ç‚¹æ²¡æœ‰æåˆ°çš„å°±æ˜¯cssçš„å¤„ç†ï¼Œé™¤äº†css-loaderæˆ‘ä»¬å¹³å¸¸å¼€å‘è¿˜ä¼šç”¨åˆ°ä¸€äº›cssé¢„å¤„ç†å™¨å¦‚scssï¼Œè¿˜æœ‰postcssç­‰æ ·å¼å¤„ç†å·¥å…·ï¼Œè¿™é‡Œçš„å¤„ç†å…¶å®ä¹Ÿä¸éš¾ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥è‡ªå·±å°è¯•ä¸€ä¸‹ï¼Œè¿™é‡Œç”±äºç¯‡å¹…åŸå› (æˆ‘æƒ³å·æ‡’)å°±ä¸è¿‡å¤šå±•å¼€äº†ã€‚","tags":[{"name":"webpack","slug":"webpack","permalink":"https://www.limuyang.cc/tags/webpack/"}]},{"title":"æœªçŸ¥æ—…ç¨‹ åˆå½±ç•™å¿µ","date":"2018-04-29T10:07:17.000Z","path":"2018/04/29/æœªçŸ¥æ—…ç¨‹-åˆå½±ç•™å¿µ/","text":"ä»1994å¹´çš„17å·å°é£ï¼Œçˆ¶äº²å‡ºæµ·æ—¶æµ©æ±‰10å²ï¼Œèºèºå£ä¸­çš„19å¹´å‰ï¼Œæ—…è¡Œè€…1å·é£å‡ºå¤ªé˜³ç³»ï¼Œå‘¨æ²«æ‰€åœ¨çš„æŸä¸­å›½å—éƒ¨å½±è§†åŸçš„é»„å¶æ»¡ï¼Œè‹ç±³å£ä¸­çš„å¤©æ°”é©¬ä¸Šå˜æš–åœ°è¿™äº›çº¿ç´¢åŸºæœ¬å¯æ¨çŸ¥ï¼šä¸‰å…„å¼Ÿå‡ºå‘çš„æ—¶é—´å¤§æ¦‚æ˜¯2013å¹´å†¬å¤©ï¼Œæµ©æ±‰2013å¹´29å²å·¦å³ã€‚æ­¤è¡Œçš„å‡ºå‘ç‚¹æ˜¯ä¸œæå²›ï¼Œæ ¹æ®å‘å°„åœ°ç‚¹åœ¨å°åº¦ï¼Œæ±Ÿæ²³å£ä¸­çš„3980å…¬é‡Œ(å›¾ä¸Šç›´çº¿è·ç¦»ï¼Œå› ä¸ºæµ©æ±‰å·è›‹çš„æƒ…èŠ‚é‡Œæ±Ÿæ²³æ‹¿å‡ºåœ°å›¾è¯´åˆ°äº†æ¯”ä¾‹å°º)ï¼ŒåŸºæœ¬å¯æ¨è‡³ç›®çš„åœ°åœ¨ä¸­å°è¾¹å¢ƒçš„è¥¿è—å—éƒ¨ã€‚ äººç‰©åˆ†æã€‚ç”µå½±é‡Œï¼Œæ‰€æœ‰äººéƒ½æ˜¯éª—å­ï¼Œä¹Ÿéƒ½è¢«åˆ«äººéª—äº†ã€‚é«˜æ˜ä¹‹å¤„å°±åœ¨äºï¼Œä»–ä»¬è¯´çš„å‡è¯ï¼Œéª—äº†ç”µå½±é‡Œçš„äººï¼Œä¹Ÿéª—äº†ç”µå½±å¤–çš„äººã€‚ èƒ¡ç”Ÿèƒ¡ç”Ÿè¿™ç«™ï¼Œå«ä¹¡æƒ…ã€‚ å¦‚æœä½ ä»¥ä¸ºå‚»å­å°±åªæ˜¯å‚»å­ï¼Œé‚£ä½ å°±é”™äº†ã€‚ èƒ¡ç”Ÿå…¶å®å¾ˆæ˜ç™½ï¼Œè‡ªå·±æ ¹æœ¬ä¸é€‚åˆå¤–é¢çš„ä¸–ç•Œã€‚åœ¨å‘¨æ²«å·¥ä½œçš„é‚£ä¸ªå½±è§†åŸºåœ°ï¼Œä½ å¯ä»¥çœ‹å‡ºä»–å¯¹å¤–é¢ä¸–ç•Œçš„å·¨å¤§é™Œç”Ÿä¸ç–ç¦»ã€‚æ‰€ä»¥ä»–éª—äº†æ±Ÿæ²³æµ©æ±‰ï¼Œè¯´æ˜¯å»æŠ½çƒŸï¼Œä¸ªäººè§‰å¾—æ›´æœ‰å¯èƒ½æ˜¯ä»–è‡ªå·±æ€è€ƒäº†è®¸ä¹…ï¼Œè§æ±Ÿæ²³æµ©æ±‰å·²èµ°ï¼Œä¾¿è‡ªå·±å›äº†ä¸œæå²›ã€‚ ä¾æ®æ˜¯ï¼Œæµ©æ±‰æ‰“ç”µè¯é—®å®¾é¦†å‰å°ï¼Œå®¾é¦†å‰å°å°±æ²¡çœ‹åˆ°è¿‡â€œæŠ½çƒŸâ€çš„è¿™ä¸ªäººã€‚å½“ç„¶ä½ ä¼šåé©³ï¼Œå‰å°æ ¹æœ¬æ‡’å¾—ç†ä»–ä»¬ã€‚ä½†æ˜¯æŒ‰å‡ºå‘å‰æ±Ÿæ²³ç»™èƒ¡ç”Ÿçš„æŒ‡ç¤ºï¼Œâ€œæ— è®ºä½ åœ¨å“ªå…¬é‡Œèµ°ä¸¢ï¼Œåªè¦å›åˆ°åŸåœ°ç­‰å°±å¯ä»¥ï¼Œè‡³äºå…¶ä»–çš„ï¼Œæˆ‘éƒ½å®‰æ’å¥½äº†â€ã€‚æ‰€ä»¥å¦‚æœèƒ¡ç”Ÿåœ¨åŸåœ°ç­‰ï¼Œå®¾é¦†ã€ç”µå°æ˜¯ä¸€å®šä¼šæ‰¾åˆ°ä»–çš„ã€‚ æ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯è¿™æ ·ä¸€å¥è¯ï¼Œâ€œå¤§å®¶éƒ½è¯´æˆ‘è„‘å­æœ‰é—®é¢˜ï¼Œä»–ä»¬(æ±Ÿæ²³æµ©æ±‰)è¯´æˆ‘æ˜¯æ­£å¸¸çš„ã€‚â€åŸå› å¾ˆç®€å•ã€‚æ±Ÿæ²³æ²¡è§‚è¿‡ä¸–ç•Œï¼Œæœ‰ç€è€å¸ˆä¸€æ ·å¹³ç­‰å¾…äººçš„å–„è‰¯ã€‚è€Œæµ©æ±‰åˆ™æ˜¯å› ä¸ºï¼Œèƒ¡ç”Ÿæ˜¯ä¸œæå²›ä¸Šå”¯ä¸€è¯´ä»–â€œå¾ˆåšå¼ºâ€å¹¶ä¸”â€œå¾ˆæ¬£èµâ€ä»–çš„äººï¼Œæ‰€ä»¥ä½œä¸ºæœ¬èƒ½å›é¦ˆï¼Œè¯´ä»–è„‘å­æ²¡é—®é¢˜ã€‚ ç„¶è€Œäº‹å®æ˜¯ï¼Œå½“èƒ¡ç”Ÿä¸¢äº†çš„æ—¶å€™ï¼Œæ±Ÿæ²³æµ©æ±‰æ ¹æœ¬å°±æ²¡å›å¤´æ‰¾ä»–ã€‚åªæ˜¯åœ¨ç”µå°å¹¿æ’­ç™»äº†ä¸€æ¡å¯»äººå¯äº‹ã€‚ç„¶è€Œäº‹å®æ˜¯ï¼Œå½“å¯»äººç”µå°åé—®æµ©æ±‰æ‰€å¯»ä¹‹äººæ˜¯æ™ºéšœå¦çš„æ—¶å€™ï¼Œæµ©æ±‰æ²¡æ€ä¹ˆçŠ¹è±«å°±å›å¤äº†â€œå•Šï¼Œå¯¹â€ã€‚ç„¶è€Œäº‹å®æ˜¯ï¼Œç”šè‡³åœ¨æ±Ÿæ²³çš„å¹»æƒ³ä¸­ï¼Œé‚»å±…å‘¨æ²«å§å§æˆåäº†ï¼Œå…„å¼Ÿå‡ºä¹¦è¡£é”¦è¿˜ä¹¡äº†ï¼Œæ ¹æœ¬å°±å¿˜äº†æœ‰ä»–èƒ¡ç”Ÿè¿™ä¹ˆä¸ªäººã€‚è‡³äºä¸ºä»€ä¹ˆæ˜¯æ±Ÿæ²³çš„å¹»æƒ³ï¼Œåé¢è¯´æ±Ÿæ²³çš„æ—¶å€™å†è§£é‡Šã€‚ èƒ¡ç”Ÿè·‘å›å²›ä¸Šï¼Œç­‰äº†ä»–ä»¬æ‰€æœ‰äºº3å¹´ã€‚ä»å²›æ­Œæ—¶çš„ç ´è´¥è’èŠœåˆ°æœ€åçš„å¼€æ»¡çƒŸèŠ±ï¼Œéƒ½æ²¡èƒ½å†è§åˆ°å®¶ä¹¡æ›¾ç»çš„æœ‹å‹ã€‚èƒ¡ç”Ÿè‡ªç¦»å¼€ä¸œæå²›çš„ç¬¬ä¸€å¤©æ™šä¸Šç§è‡ªè·‘å›å®¶ä¹¡ï¼Œä»–ç†Ÿæ‚‰çš„ï¼Œæ²¡æœ‰ç¬¬äºŒä¸ªäººçš„ä¸œæå²›ï¼Œæ‰¾å›å±äºè‡ªå·±çš„å¹³å‡¡ä¹‹è·¯ï¼Œå’Œæ‰€æœ‰äººï¼Œåä¼šæ— æœŸã€‚ æˆ–è®¸èƒ¡ç”Ÿçš„ç»“å±€ï¼Œæ˜¯æ‰€æœ‰äººé‡Œæœ€å¥½çš„ã€‚ å‘¨æ²«å‘¨æ²«è¿™ç«™ï¼Œå«å‹æƒ…ã€‚å¥¹æœ‰ç‚¹åƒã€Š1988ã€‹é‡Œçš„å­Ÿå­Ÿï¼Œä½†å´ä¸æ˜¯ã€‚ ä½ èº«è¾¹ä¸€å®šæœ‰ä¸€ä¸ªå«å‘¨æ²«çš„äººï¼Œå¥¹å„¿æ—¶åŒä½ ä¸€èµ·æˆé•¿ã€‚åæ¥ï¼Œä½ ä»¬åˆ†å¼€ï¼Œä½†æ˜¯ï¼Œä½ ä»¬éƒ½æ²¡å¿˜äº†å½¼æ­¤ï¼Œå¶å°”è”ç³»ä¸€å®šä¼šè¯´ï¼Œæœ‰æœºä¼šä¸€å®šä¸€èµ·åƒä¸ªé¥­ï¼Œæˆ–è€…æ˜¯ï¼Œè¦å¸¸èšå¸¸è”ç³»å•Šã€‚ è€Œå¥¹å´å·²ä¸æ˜¯å½“å¹´çš„å¥¹ï¼šâ€œå¤§åŸå¸‚å°±è·Ÿè¿™ä¸ªç‰‡åœºå·®ä¸å¤šï¼Œæ²¡ä»€ä¹ˆæ„æ€â€ï¼Œâ€œå¾€ä¸Šçˆ¬ï¼Œå¾—é äººé™…å…³ç³»ï¼Œå®¶åº­åŠ¿åŠ›â€ã€‚è™½ç„¶è‡ªå·±åªæ˜¯ä¸ªæ›¿èº«ï¼Œä¸è¿‡ä¾ç„¶ä¹è§‚ã€‚å› ä¸ºå¥¹åšä¿¡ï¼Œâ€œèƒŒäº•ç¦»ä¹¡å°±å¾—è¦å‡ºäººå¤´åœ°â€ã€‚ å…¶å®å“ªæœ‰å…¬å¹³å‘¢ï¼Œå½“ä»–ä»¬èµ°åœ¨å½±è§†åŸºåœ°é‡Œæ—¶ï¼Œä¸€æ—çš„ç¾¤æ¼”ä¸‰äº”æˆç¾¤çš„èšæˆä¸€å †ï¼Œæ›¿èº«ä»ç©ºä¸­åŠç€å¨äºšè½åœ°ï¼Œè“è‰²è¡£æœçš„å…«è·¯ã€ç»¿è‰²è¡£æœçš„ä¼ªå†›ã€é»‘è‰²è¡£æœçš„å›½å†›æ‰“æˆä¸€ç‰‡ï¼Œæˆ–è®¸åœ¨é•œå¤´ä¹‹å¤–ï¼Œè®¸å¤šæ­£æ¼”åœ¨é‚£è¾¹è¡¥å¦†åƒé¥­ï¼Œè€Œå¾ˆå¤šæƒ³æ¼”ç¾¤ä¼—æ¼”å‘˜çš„è·¯äººæ­£åœ¨é—¨å¤–ç­‰å¾…ã€‚ä»–ä»¬ä¹‹ä¸­æœ‰å¤šå°‘äººåªæ˜¯ä¸ºäº†æ··å£é¥­åƒï¼Œè€Œåˆæœ‰å¤šå°‘äººæ˜¯çœŸçš„æœ‰æ€€æœ‰ä¸€ä¸ªæ¼”å‘˜æ¢¦ã€‚ç‰‡åœºé‡Œï¼Œä¸€è¡Œäººç©¿è¿‡å½±è§†åŸºåœ°ï¼Œå…¶å®æ˜¯ç©¿è¿‡äº†å¤ªå¤šäººçš„äººç”Ÿå’Œå–œæ€’å“€ä¹ã€‚ï¼ˆæ¥¼ä¸»ä¹±å…¥ä¸€ä¸‹ï¼Œè¿™é‡Œæ¥¼ä¸»è®¤ä¸ºè¿˜å«æœ‰å¯¹ç›®å‰æ³›æ»¥çš„æŠ—æ—¥ç¥å‰§çš„ä¸€ä¸ªè®½åˆºï¼‰ åœ¨æ±Ÿæ²³æ„æ·«çš„ç»“å±€é‡Œï¼Œå¥¹çº¢äº†ï¼Œç»“å°¾èˆ¹ä¸Šçš„ç”µè§†é‡Œï¼Œå¥¹æˆä¸ºä¸‡åƒäººçš„å¶åƒã€‚æˆ–è®¸å¥¹çœŸçš„çº¢äº†ï¼Œå› ä¸ºå¥¹æœ‰ä¸€å¤©æ‘¸é€äº†è¿™ä¸ªè¡Œä¸šçœŸæ­£çš„è§„åˆ™ï¼›æˆ–è®¸å¥¹ä¾æ—§åªæ˜¯ä¸ªå°æ¼”å‘˜ï¼Œåœ¨ä¸ºè‡ªå·±çš„å‰é€”åŠªåŠ›æ‰“æ‹¼ã€‚ ç„¶è€Œåœ¨çœŸå®çš„åœºæ™¯é‡Œï¼Œå‘¨æ²«éª—äº†æµ©æ±‰ã€‚ å¥¹å…ˆæ˜¯è¯•æ¢çš„é—®äº†æµ©æ±‰å…³äºèºèºçš„æƒ…å†µã€‚æµ©æ±‰è¯´è‡ªå·±â€œæ··å¾—ä¸€èˆ¬ï¼Œç•™ä¸ªå¿µæƒ³â€ã€‚çœ‹åˆ°æµ©æ±‰ä¾ç„¶å¯¹èºèºå¿µå¿µä¸å¿˜ï¼Œå¥¹è‡ªå·±æ‰¾äº†ä¸ªå°é˜¶ï¼šâ€œå¹¸äºæˆ‘10å²çš„æ—¶å€™ï¼Œå°±åŠæ—¶ä¸å–œæ¬¢ä½ äº†â€ã€‚æˆ–è®¸å‘¨æ²«10å²é‚£å¹´ï¼Œæµ©æ±‰çš„çˆ¶äº²ç¦»å¼€äº†æµ©æ±‰ï¼Œæˆ–è®¸å‘¨æ²«10å²é‚£å¹´ï¼Œæµ©æ±‰å¼€å§‹ä¸èºèºé€šä¿¡ï¼Œä»æ­¤å¿ƒä¸­åªæœ‰èºèºã€‚ ç„¶è€Œå–œæ¬¢å°±æ˜¯å–œæ¬¢ã€‚ä¸ç„¶æ€ä¹ˆä¼šé‚£ä¹ˆåŠªåŠ›ï¼Œå»æ‰¾æµ©æ±‰å–œæ¬¢çš„æ˜æ˜Ÿè¦ç­¾åç…§ï¼Ÿä¸ç„¶åœ¨åˆ†åˆ«æ—¶ï¼Œæ€ä¹ˆæœ‰é‚£ä¹ˆæ·±æƒ…çš„ä¸€ä¸ªå›çœ¸ï¼Ÿ ç„¶è€Œï¼Œç²‰è½¬è·¯äººï¼Œä»¥åŠï¼Œæµ©æ±‰å¿ƒä¸åœ¨ç„‰ï¼Œè¿™æ‰æ˜¯äº‹å®ã€‚ æµ©æ±‰è¯´ç²‰è½¬è·¯äººçš„æ—¶å€™ï¼Œå‘¨æ²«çš„è„¸ä¸Šï¼Œå…ˆæ˜¯ç¬‘è„¸ï¼Œç„¶ååƒµä½ç–‘æƒ‘ï¼Œæ¥ç€æ˜¯è‡ªå˜²ä¼¼çš„æ·¡ç¬‘ï¼Œæœ€åæ˜¯å·¨å¤§çš„å¤±è½ã€‚è‡ªä¿¡æ»¡æ»¡å¸Œæœ›èƒ½è®©å¯¹æ–¹å–œæ¬¢ï¼Œå´æ¢æ¥ä¸€ä¸ªæ®‹æŸçš„å›åº”ï¼Œæµ©æ±‰å•Šæµ©æ±‰ï¼Œä½ å“ªæ€•æ˜¯å®‰æ…°æˆ‘ä¸€ä¸‹ä¹Ÿå¥½ï¼Œä¸ºä»€ä¹ˆå°±é‚£ä¹ˆå¿å¿ƒä¼¤å®³ä¸€ä¸ªå–œæ¬¢ç€ä½ çš„äººï¼Ÿ å› ä¸ºå¯¹æ‹äººï¼Œæˆ‘ä»¬ä¹ æƒ¯è¯´å‡è¯ï¼Œå¯¹æœ‹å‹ï¼Œæˆ‘ä»¬ä¹ æƒ¯è¯´çœŸè¯ã€‚æ‰€ä»¥å‘¨æ²«å’Œæµ©æ±‰ï¼Œåªèƒ½æ˜¯æœ‹å‹ã€‚ ç„¶åæµ©æ±‰ç»§ç»­è¡¥åˆ€ï¼Œè¯´å‘¨æ²«â€œè¿™èº«è¡£æœæ²¡åˆšæ‰é‚£ä»¶å¥½çœ‹â€ï¼Œå‘¨æ²«ç»ˆäºä»å¯¹æµ©æ±‰çš„å¹»æƒ³ä¸­èµ°å‡ºï¼Œâ€œè¿™è¡£æœä¹Ÿä¸åˆèº«ï¼Œå¤´å‘è¿˜æ˜¯å‡çš„ï¼Œä½ ä»¥ä¸ºæˆ‘æœ‰çš„é€‰å•Šâ€ã€‚ ä½ ã€‚ä»¥ã€‚ä¸ºã€‚æˆ‘ã€‚æœ‰ã€‚çš„ã€‚é€‰ã€‚å•Šã€‚å‘¨æ²«çš„æ‚²å‰§å°±åœ¨ï¼Œå¥¹æ²¡å¾—é€‰ã€‚å–œæ¬¢çš„è§’è‰²æ²¡å¾—é€‰ï¼Œå–œæ¬¢çš„äººä¹Ÿæ²¡å¾—é€‰ï¼Œä¸€åˆ‡éƒ½æ˜¯å› ä¸ºï¼Œèµ°ä¸Šçš„è·¯è®©å¥¹æ²¡å¾—é€‰ã€‚ å®Œç¾æ—¶ä¸çœŸå®ï¼ŒçœŸå®æ—¶ä¸å®Œç¾ã€‚ä½ çœ‹æˆ‘å®Œç¾æ—¶ï¼Œæˆ‘ä¸è¿‡æ˜¯æ›¿èº«ã€‚ä½ çœ‹æˆ‘ä¸æ˜¯æ›¿èº«æ—¶ï¼Œæˆ‘å´åªèƒ½ç©¿ä¸Šä¸åˆèº«çš„è¡£æœï¼Œå¸¦ä¸Šå‡çš„å¤´å‘ã€‚ æµ©æ±‰è¯´ä¸¤äººä»å°ä¸€èµ·é•¿å¤§ï¼Œä½†å´è¯´ä¸ç®—é’æ¢…ç«¹é©¬ï¼Œå¸Œæœ›ä¸¤äººæ—¶å¸¸è§é¢ã€‚å‘¨æ²«æ­¤æ—¶çš„è„¸ä¸Šï¼Œæ´‹æº¢ç€å·¨å¤§çš„å–œæ‚¦ã€‚æ²¡å…³ç³»ï¼Œä½ è®°å¾—æˆ‘ä»¬ä¸€èµ·é•¿å¤§å°±å¥½ï¼Œæ²¡å…³ç³»ï¼Œä½ å¸Œæœ›æ—¶å¸¸è§æˆ‘å°±å¥½ã€‚ å¥¹å¸Œæœ›è‡ªå·±æœ‰ä¸€å¤©å¯ä»¥ç”¨çœŸå®çš„å®Œç¾çš„ç«™åœ¨å„¿æ—¶å–œæ¬¢çš„æµ©æ±‰é¢å‰ã€‚å°±åƒæ˜¯ä»–ä»¬åœ¨ç”µå½±é‡Œç¬¬ä¸€æ¬¡ç›¸è§æ—¶é‚£æ ·ï¼Œæµ©æ±‰å’Œä»–å°±è¿™ä¹ˆäº’ç›¸å‡æœ›å¯¹æ–¹åˆ°å‡ºç¥ã€‚ å¥¹ä¸æƒ³å»æ¥æµ©æ±‰é€å¥¹çš„èŠ±ï¼Œæˆ‘çŒœä¸æ˜¯å› ä¸ºâ€œä¸å¥½æ‹¿â€ï¼Œè€Œæ˜¯å¥¹æ€•é‚£æŸèŠ±ä¾µå äº†æ‹¥æŠ±æµ©æ±‰çš„ç©ºé—´ã€‚å¥¹æ˜¯å¤šä¹ˆå¸Œæœ›å’Œè‡ªå·±å“ªæ€•æ˜¯æ›¾ç»å–œæ¬¢çš„äººåœ¨å¯èƒ½æ˜¯è¯€åˆ«çš„é‚£æ¬¡åˆ†åˆ«å‰äº’ç›¸æ‹¥æŠ±ã€‚ ç„¶è€Œåªèƒ½æ˜¯ï¼Œæœ‹å‹ã€‚æ‰€ä»¥ï¼Œä»€ä¹ˆéƒ½æ²¡å‘ç”Ÿã€‚å‘¨æ²«è¯´å»ä¸‹ä¸€éƒ¨æˆï¼Œæµ©æ±‰è¯´å»ä¸‹ä¸€ä¸ªåœ°æ–¹ã€‚å‘¨æ²«çš„ä¸‹ä¸€éƒ¨æˆï¼Œæ˜¯è¢«æªæ€ï¼Œæ˜¯ç»ˆç»“ï¼Œæ˜¯æ­»äº¡ï¼Œæˆ–è®¸ï¼Œä¹Ÿæ˜¯é‡Šç„¶ã€‚æµ©æ±‰çš„ä¸‹ä¸€ä¸ªåœ°æ–¹ï¼Œæ®èƒ¡ç”Ÿçš„äº¤å¾…ï¼Œæ˜¯èºèºï¼Œæ˜¯æµ©æ±‰ä»æœªè§è¿‡çš„loverï¼Œæ˜¯å¸Œæœ›ï¼Œæ˜¯æ–°ç”Ÿï¼Œæ˜¯æµ©æ±‰åœ¨å¤–10å¹´çš„æ”¯æŸ±å’ŒåŠ¨åŠ›ã€‚ç„¶è€Œäº‹å®æ˜¯ï¼Œæ®Šé€”åŒå½’ã€‚ â€œå¹¸äºæˆ‘10å²çš„æ—¶å€™ï¼Œå°±åŠæ—¶ä¸å–œæ¬¢ä½ äº†â€ã€‚åœ¨è¯´è¿™è¯ä¹‹å‰ï¼Œå‘¨æ²«ç”¨æ‰‹æŠŠæµ©æ±‰è‹±ä¿Šçš„è„¸æ‰­å‘è‡ªå·±ã€‚è¿™ä¸ªå°åŠ¨ä½œåƒæäº†æƒ…ä¾£ä¹‹é—´ä¿¡èª“æ—¦æ—¦å‰çš„å‡†å¤‡æ´»åŠ¨ï¼Œç„¶è€Œå‘¨æ²«è¯´å‡ºå£çš„ä¸æ˜¯â€œä½ çŸ¥é“å—ï¼Œä»10å²é‚£å¹´æˆ‘å°±ä¸€ç›´å–œæ¬¢ä½ â€ï¼Œè€Œæ˜¯å¥¹çŸ¥é“ï¼Œåªèƒ½æ˜¯æœ‹å‹ï¼Œä¸ç„¶è¿è¿™æ ·è½»æ¾é€—å¼„ä½ çš„æœºä¼šï¼Œéƒ½æ²¡æœ‰äº†ã€‚ â€œè®°å¾—å•Šï¼Œè¦æ˜¯ä½ ä»¬ä»¥åè¿˜æ··å¾—ä¸å¥½ï¼Œå¯ä»¥æ¥æ‰¾æˆ‘â€ï¼Œâ€œæ··å¾—å¥½ï¼Œä½ ä»¬å°±ä¸ä¼šæ¥æ‰¾æˆ‘äº†â€ã€‚è¿™è¯è™½è¯´æ˜¯â€œä½ ä»¬â€ï¼Œä½†å´æ˜¯å¯¹æµ©æ±‰ä¸€ä¸ªäººè¯´çš„ã€‚æ½œå°è¯æ˜¯â€œæµ©æ±‰ï¼Œå¦‚æœä½ è½é­„ï¼Œæˆ‘ä¼šä¸€ç›´ç­‰ä½ â€â€œæµ©æ±‰ï¼Œå¦‚æœä½ æˆåŠŸï¼Œå°±å»ç»™ä½ çˆ±çš„äººå¹¸ç¦ï¼Œé‚£ä¸ªäººï¼Œä¸€å®šä¸æ˜¯æˆ‘â€ã€‚å‘¨æ²«è¯´è¿™è¯æ—¶äº‘æ·¡é£è½»ï¼Œå°±åƒæ˜¯å¯¹è‡ªå·±è¯´ä¸€æ ·ã€‚ æˆ‘æ²¡æœ‰ä¸€ä¸ªå­—è¯´æˆ‘çˆ±ä½ ï¼Œä½†æˆ‘çš„æ¯ä¸€å¥è¯ï¼Œæ¯ä¸€ä¸ªè¡¨æƒ…ï¼Œæ¯ä¸€ä¸ªåŠ¨ä½œéƒ½åœ¨è¯´æˆ‘çˆ±ä½ ã€‚å› ä¸ºä½ ç²‰è½¬è·¯äººï¼Œå› ä¸ºä½ å¿ƒä¸åœ¨æˆ‘ã€‚æ‰€ä»¥ï¼Œä½ ã€‚ä»¥ã€‚ä¸ºã€‚æˆ‘ã€‚æœ‰ã€‚çš„ã€‚é€‰ã€‚å•Šï¼Ÿæˆ‘èƒ½åšä»€ä¹ˆï¼Ÿæˆ‘åªèƒ½é»˜é»˜åœ°ï¼Œå‡æœ›ä½ ï¼Œç¥ç¦ä½ ã€‚ è¿™ä»½æƒ…æ„Ÿï¼Œåƒæäº†èºèºå£ä¸­çš„â€œä½†çˆ±ï¼Œå°±æ˜¯å…‹åˆ¶â€ã€‚è¿™å…‹åˆ¶ï¼Œåœ¨ç‰‡åœºä½ æœ›æˆ‘çš„æ—¶å€™ï¼Œåœ¨è·¯ä¸Šæˆ‘é€—ä½ çš„æ—¶å€™ï¼Œåœ¨æ¡¥å¤´ä½ ä¼¤æˆ‘çš„æ—¶å€™ï¼Œåœ¨è·¯ä¸Šæˆ‘ç¦»å¼€çš„æ—¶å€™ã€‚ å‘¨æ²«ç•™ä¸‹çš„é‚£ä¸ªç¾æäº†çš„å›çœ¸æ¶ˆå¤±åœ¨æµ©æ±‰ç»§ç»­å‰è¡Œçš„è·¯ä¸Šï¼Œçœ¼ç¥é‡Œï¼Œæ˜¯å¯¹æµ©æ±‰å•çº¯è€Œç‚½çƒˆçš„æƒ…æ„Ÿï¼Œæˆ–è®¸ä½ çš„è§†çº¿é‡Œæ—©å·²æ²¡æœ‰æˆ‘ï¼Œä½†æˆ‘çŸ¥é“ï¼Œä½ è‚¯å®šä¼šåœ¨é‚£ä¸ªæ–¹å‘ï¼Œè½¬èº«ç¦»å¼€ã€‚æ‰€ä»¥åœ¨ä½ æ¶ˆå¤±çš„é‚£ä¸€åˆ»ï¼Œæˆ‘ä¾ç„¶å¯ä»¥ï¼ŒæŒ‚ç€å¹¸ç¦çš„ç¬‘ã€‚ ä¸€å£°æªå“ï¼Œåœ¨æ›¿èº«å°æ¼”å‘˜çš„å¹³å‡¡ä¹‹è·¯ä¸Šï¼Œå‘¨æ²«å’Œæ‰€æœ‰äººï¼Œåä¼šæ— æœŸã€‚ ç„¶è€Œä½ æ˜¯è¿™ä¸–ç•Œä¸Šæœ€å¥½çœ‹çš„å§‘å¨˜ã€‚ è‹ç±³è‹ç±³è¿™ç«™ï¼Œå«çˆ±æƒ…ã€‚ä»–æœ‰ç‚¹åƒã€Š1988ã€‹é‡Œçš„å¨œå¨œï¼Œä½†ä¹Ÿä¸æ˜¯ã€‚ è‹ç±³ä¹Ÿæ˜¯ä¸ªéª—å­ï¼Œä¸æŠ˜ä¸æ‰£çš„ï¼Œæ­£ä¹‰çš„ï¼Œç»„å›¢æ¥çš„ï¼Œéª—å­ã€‚ åŒæ±Ÿæ²³çš„ç›¸é‡ï¼Œå°±åƒæ˜¯æ±Ÿæ²³ç»™é‚£ä¸ªå®¾é¦†ä¸‹çš„å®šä¹‰ä¸€æ ·ï¼šâ€œé¡ºè·¯åˆä¾¿å®œï¼Œç¼˜åˆ†å§â€ï¼Œäºæ˜¯æ­¤ç­‰ä¾¿å®œä¸”é¡ºè·¯çš„â€œå¥½äº‹â€ï¼Œæ‘Šç»™äº†æ±Ÿæ²³ã€‚ ä»™äººè·³çš„è¿‡ç¨‹ä»ä¸€å¼€å§‹å°±åŸ‹å¥½äº†ä¼ç¬”ï¼Œæ­¤æ—¶æ•…äº‹åŒçº¿å¼€å±•ã€‚æµ©æ±‰æ³¨æ„åˆ°çš„é‚£è¾†æ»¡èº«æ³¥ç‚¹çš„é»‘è‰²è½¿è½¦ï¼Œè¿™ä¾¿æ˜¯ä¸‰å”å›¢ä¼™çš„çº¿ç´¢ã€‚ ç„¶åç”µå½±æ˜¯ä¸€æ®µå¤åˆ¶ã€Š1988ã€‹çš„å¼€æˆ¿ç»å†ï¼šä¿å®‰è£¹ç€å†›å¤§è¡£èƒŒå¯¹ç€è·¯ç¡åœ¨è¿å®¢æ¾çš„æ‹›ç‰Œä¸‹çš„æ²™å‘ä¸Šï¼Ÿå‰å°çš„æœåŠ¡å‘˜ä¸çŸ¥å»å‘ã€‚æˆ‘å«äº†ä¸€å£°æœåŠ¡å‘˜ï¼Œä¿å®‰ç¼“ç¼“ä¼¸å‡ºæ‰‹ï¼ŒæŠŠå†›å¤§è¡£å¾€ç©ºä¸­ä¸€æ’©ï¼Œæ”¾ä¸‹çš„æ—¶å€™é‚£é‡Œå·²ç»åŠåç€ä¸€ä¸ªå¥³æœåŠ¡å‘˜ã€‚æœåŠ¡å‘˜è¾¹æ•´ç†å¤´å‘è¾¹æ¢¦æ¸¸ä¸€æ ·åˆ°äº†å‰å°åé¢ã€‚ äºæ˜¯è½¬è§’é‡åˆ°çˆ±ã€‚è‹ç±³å‡ºåœºã€‚ è‹ç±³æ¥åˆ°äº†ä¸‰å”å‘æ¥çš„æš—å·ï¼Œå°±æ˜¯é‚£é¦–ã€ŠQue Sera Seraã€‹ã€‚æ±Ÿæ²³å½“ç€è‹ç±³æœ—è¯µæ­Œè¯ä¸­æ–‡ç‰ˆçš„æ—¶å€™ï¼Œæˆ‘æƒ³ä¸åªæ˜¯è‹ç±³åŠ¨äº†å¿ƒã€‚ä¸€ä¸ªæ»¡è„¸æ²§æ¡‘ï¼Œä¸€æœ¬æ­£ç»å´æµªæ¼«æ–‡è‰ºçš„â€œå¤§å”â€æ”¾åœ¨ä»»ä½•å¥³ç”Ÿé¢å‰ï¼Œéƒ½å…·æœ‰è¶³å¤Ÿçš„æ€ä¼¤åŠ›ã€‚å°±ç€è¾£é…±é¢åŒ…çš„æ–‡è‰ºå¤§å”ï¼Œè®©è‹ç±³è®¤è¯†åˆ°ï¼Œè¿™ä¸–ä¸Šç«Ÿæœ‰åœ¨å¦‚æ­¤è¯±æƒ‘ä¸‹ä¾ç„¶æ·¡ç„¶äºæ­¤äº«å—éŸ³ä¹ç¾é£Ÿçš„ç‰¹ç«‹ç‹¬è¡Œçš„å¯çˆ±ä¹‹äººã€‚æ±Ÿæ²³é¡ºæ‰‹é€’ç»™è‹ç±³ä»–çš„é»‘æš—æ–™ç†ï¼Œæ‰“æ–­äº†è‹ç±³æƒ³è¦è¯´çš„è¯ã€‚è¿™æ—¶èˆ’ç¼“çš„é’¢ç´æ›²ç›–è¿‡ã€ŠQSSã€‹ï¼Œæ±Ÿæ²³çš„å•çº¯å¼•å‘äº†è‹ç±³å¯¹å„¿æ—¶ç¾å¥½çš„æ€ç´¢ï¼Œä¾§è„¸ä¸Šï¼Œæµ®ç°äº†ä¸è¡Œéª—ç›¸æ‚–çš„ç¾å¥½çš„ç¬‘ã€‚ è¿™ä¸€åˆ»ï¼Œä¸ç®¡ä½ æ—¶å¦“å¥³ä¹Ÿå¥½ï¼Œéª—å­ä¹Ÿç½¢ã€‚éƒ½ä¼šç–¯ç‹‚å¯¹è¿™ä¸ªå¨å¸ˆäº§ç”Ÿè«å¤§çš„å¥½æ„Ÿï¼Œå› ä¸ºä»–çƒ¹é¥ªå‡ºäº†ï¼Œä½ å¿ƒé‡Œæ€€å¿µçš„å‘³é“ã€‚ ä»–ä»¬çš„ç›¸çˆ±ã€‚ä¸€ä¸ªæ˜¯è£…ç‹ ï¼Œä¸€ä¸ªæ˜¯çœŸçº¯ã€‚ ç„¶åæ˜¯åˆ†å±ä¸åŒæ¬¡å…ƒçš„äºŒäººå…‰æ€ªé™†ç¦»çš„å¯¹è¯ã€‚ â€”â€”è€å¸ˆï¼Œä½ å–œæ¬¢è„šå•Šï¼Ÿâ€”â€”å½“ä½ èµ¤è„šè¸©åœ¨åœ°æ¿ä¸Šæ—¶ï¼Œå°±ä¸ä¼šæœ‰é™ç”µäº†ã€‚ è¿™æ ·çš„å¯¹è¯ä¸€å‡ºï¼Œä¾¿é¢„ç¤ºç€äºŒäººä¾¿å†æ— å¯èƒ½åœ¨ä¸€èµ·äº†ã€‚æœ€åèˆ¹ä¸Šçš„é•œå¤´ï¼Œä¸è¿‡æ˜¯ã€Šæ—…è¡Œè€…ã€‹é‡Œçš„é•œåƒç½¢äº†ã€‚ â€œæ±Ÿè€å¸ˆï¼Œæˆ‘ä¸æ˜¯ä½ çš„å­¦ç”Ÿï¼Œä½ ä¸ç”¨å¯¹æ¯ä¸ªè¿‡å®¢è´Ÿè´£ï¼Œä¹Ÿåˆ«å»æ•™è·¯äººè¯¥èµ°é‚£æ¡è·¯ã€‚â€ï¼Œâ€œä»å°åˆ°å¤§æˆ‘éƒ½æ˜¯ä¼˜ï¼Œä½ å«æˆ‘æ€ä¹ˆä»è‰¯ï¼Ÿâ€æ½œå°è¯æ˜¯ï¼šæˆ‘æ€ä¹ˆç”Ÿæ´»ä½ ç®¡ä¸ç€ï¼Œä½ æˆ‘ä¸è¿‡è·¯äººã€‚è‹ç±³æ˜¯ä¸ªæœ‰æ•…äº‹çš„äººï¼Œè¿™æ ·çš„å§‘å¨˜å…¶å®å¾ˆéš¾æ‰¾åˆ°èƒ½è¯´è¯çš„äººã€‚å› ä¸ºè¯´å‡ºå£çš„æ¯å¥è¯éƒ½è¯ä¸­æœ‰è¯ï¼Œå¯åˆ°æœ€åä½ å‘ç°å¥¹é€šé€šæ˜¯è¯´ç»™è‡ªå·±åœ¨å¬ã€‚å¥½åƒè‚¯è·Ÿç€ä½ å»åˆ°å¤©æ¶¯æµ·è§’ï¼ŒçœŸè¦ç¦»å¼€çš„æ—¶å€™æ— æ‰€ç‰µæŒ‚ã€‚ è‹ç±³è™½ç„¶æ˜¯ä¸ªéª—å­ï¼Œä½†æœ¬æ€§ä¾ç„¶æœ‰å–„çš„ä¸€æ–¹é¢ã€‚æ¯”å¦‚å¯¹è‚šå­é‡Œå­©å­çš„ç»å¯¹å‘µæŠ¤ã€‚å¥¹å…³å¿ƒé¢åŒ…é‡Œæ˜¯å¦æœ‰é˜²è…å‰‚ï¼Œå¥¹è¦èµšé’±åœ¨å›½å¤–ç”Ÿå­©å­ã€‚å¥¹çš„ä»·å€¼è§‚æ˜¯ï¼šå«–å®¢æ˜¯é”™çš„ï¼Œå»èµšçŠ¯é”™äººçš„é’±å°±æ˜¯æ²¡é”™ã€‚çœ‹ä¸Šå»ä¼¼ä¹æœ‰é‚£ä¹ˆä¸€ç‚¹â€œä»¥é‚ªåˆ¶é‚ªâ€çš„æ­£ä¹‰ã€‚ç„¶è€Œåœ¨ä¸‰å”çœ¼é‡Œï¼Œå¥¹å’Œæ±Ÿæ²³æµ©æ±‰è¿˜éƒ½æ˜¯å­©å­ï¼Œå› ä¸ºâ€œå°æœ‹å‹çˆ±åˆ†å¯¹é”™â€ã€‚ å¥¹æƒ³æŠŠè‡ªå·±çš„æ•…äº‹éƒ½å°†ç»™æ±Ÿæ²³å¬ï¼Œè¿™æ•…äº‹ä¸€å®šå¾ˆåå·ï¼Œä½†æ— éå¦‚æ­¤ï¼šå½“æˆ‘è¿˜æ˜¯ä¸€ä¸ªå°å¥³å­©çš„æ—¶å€™ï¼Œæˆ‘é—®æˆ‘çš„å¦ˆå¦ˆï¼Œæˆ‘å°†æ¥ä¼šæˆä»€ä¹ˆæ ·å‘¢ï¼Ÿæˆ‘ä¼šå˜ç¾ä¸½å—ï¼Ÿæˆ‘ä¼šå˜å¯Œæœ‰å—ï¼Ÿå¥¹æ˜¯è¿™ä¹ˆçš„å‘Šè¯‰æˆ‘çš„â€”â€”568åŒ…é’Ÿï¼Œ868åŒ…å¤œã€‚ äºæ˜¯åœ¨çŠ¹è±«ä¹‹åï¼Œå¥¹è¿˜æ˜¯ç¦»å¼€äº†æ±Ÿæ²³ã€‚æ±Ÿæ²³æ˜¯ç”·äººï¼Œæ˜¯ç”·äººå°±æœ‰æˆä¸ºè´Ÿå¿ƒæ±‰ç‹å…«è›‹çš„å¯èƒ½ã€‚æ‰€ä»¥å¥¹æœ€åè¿˜æ˜¯è¸ä¸Šäº†ä¸‰å”çš„è½¦ï¼Œå¸¦ç€æ±Ÿæ²³ç»™äºˆå¥¹æ³¯ç„¶å‰çš„æŒ£æ‰ï¼Œèµ°ä¸Šå¹³å‡¡ä¹‹è·¯ï¼Œä¸æ‰€æœ‰äººï¼Œåä¼šæ— æœŸã€‚ èºèº èºèºè¿™ç«™ï¼Œå«äº²æƒ…ã€‚ åŒæ ·çš„ï¼Œä¹Ÿæ˜¯éª—å­ï¼Œéª—äº†æµ©æ±‰19å¹´ã€‚ åœ¨ä¸€å¼€å§‹ï¼Œå¥¹æ˜¯æˆ‘ä»¬ç”Ÿå‘½ä¸­æœ€çˆ±çš„é‚£ä¸ªå§‘å¨˜ï¼Œè€Œå¥¹æ‰€åœ¨çš„åœ°æ–¹ï¼Œå«åšè¿œæ–¹ã€‚èºèºå¯¹äºæµ©æ±‰ï¼Œåœ¨èƒ¡ç”Ÿä¸€å¼€å§‹ä»‹ç»å½¢æˆçš„è‹±æ–‡å­—å¹•é‡Œï¼Œå°±æ˜¯â€œdream loverâ€ã€‚ æµ©æ±‰ç´§å¼ è€Œåˆä¸“æ³¨çš„æœ›ç€èºèºè€ç»ƒçš„æ¢ç€ç”µç¯æ³¡ï¼Œè€Œååˆ˜èºèºå›å¤´ï¼Œæµ©æ±‰æŒ¤å‡ºäº†ä¸€ä¸å¾®ç¬‘ï¼Œè€Œåˆ˜èºèºå´åƒè§ä¸€ä¸ªè€æœ‹å‹èˆ¬ï¼Œå¤§å¤§æ–¹æ–¹ä¼¸å‡ºäº†è‡ªå·±çš„æ‰‹ï¼Œè‡ªä¿¡çš„è¯´å‡ºæ¥è‡ªå·±çš„åå­—ï¼Œæµ©æ±‰ä¼¸æ‰‹ï¼Œå´è¢«ä¸¤äººä¸­é—´ç¡¬éš”ç€ä¸€ä¸ªå°çƒæ¡Œé˜»æŒ¡äº†ã€‚ æ¨ªåœ¨ä¸¤ä¸ªäººä¸­é—´çš„ï¼Œæ˜¯éšè—äº†19å¹´çš„å·¨å¤§éª—å±€ã€‚ æµ©æ±‰ä¸ºäº†æ©é¥°å°´å°¬æå‡ºäº†æ¥ä¸€å±€å°çƒï¼Œè‡ªä¿¡æ»¡æ»¡çš„æµ©æ±‰è®¤ä¸ºæ‹¿ä¸‹èºèºå¿—åœ¨å¿…å¾—ï¼Œä¸ä»…æ˜¯çƒæ¡Œä¸Šçš„æ‹¿ä¸‹ã€‚äºæ˜¯å¼€çƒçš„ä»–ä¸Šæ¥æ²¡æœ‰ä»€ä¹ˆç­–ç•¥ï¼Œå°±æ˜¯â€œå¤§åŠ›å‡ºå¥‡è¿¹â€ï¼Œå³ä½¿èºèºæŠŠå·§å…‹ç²‰æ”¾åœ¨æµ©æ±‰æ—è¾¹ï¼Œç¤ºæ„è®©ä»–åšå¥½å‡†å¤‡åœ¨å‡ºæ†ï¼Œæµ©æ±‰ä¹Ÿä¸æ¯«ä¸ä¸ºæ‰€åŠ¨ã€‚ ç»“æœè‡ªç„¶æ˜¯æ¢èºèºä¸Šæ‰‹ã€‚â€œä½ å…ˆå¬æˆ‘è¯´å®Œï¼Œåˆ«é—®é—®é¢˜â€ç¬¬ä¸€é¢—çƒæ‰“è¿›ã€‚ ç°åœ¨å‘Šè¯‰ä½ å¯èƒ½ä¸æ—©ä¸æ™šï¼Œè™½ç„¶æˆ‘ä»¬è®¤è¯†æ—¶é—´ä¹…ï¼Œä½†è§é¢æ—¶é—´çŸ­ã€‚ç¬¬äºŒã€ä¸‰é¢—çƒæ‰“è¿›ã€‚ 19å¹´å‰ï¼Œ9417å·å°é£ï¼Œä½ çˆ¶äº²ç¦»å¼€äº†ä½ ã€‚ç¬¬å››é¢—çƒæ‰“è¿›ã€‚ ä½ è§†çˆ¶äº²ä¸ºå¶åƒï¼Œä½ è®¤ä¸ºä»–æ­»å¾—å…¶æ‰€ã€‚ç¬¬äº”é¢—çƒæ‰“è¿›ã€‚ å…¶å®ä»–æ²¡æ­»ï¼Œè€Œæ˜¯æ¥æ‰¾äº†æˆ‘å’Œæˆ‘å¦ˆã€‚ç¬¬å…­é¢—çƒæ‰“è¿›ã€‚ ä»–æ¥æ¢æ¬ æˆ‘ä»¬æ¯å¥³çš„å€ºï¼Œè€Œä½ ä¹Ÿé•¿å¤§äº†ã€‚ç¬¬ä¸ƒé¢—çƒæ‰“è¿›ã€‚ å¤©åº•ä¸‹ä¸æ˜¯æ‰€æœ‰å€ºéƒ½èƒ½è¿˜ï¼Œè€Œä»–å¯¹ä½ åˆ™æ¬ ä¸‹äº†æ–°å€ºï¼Œä»–å¾ˆæƒ³çŸ¥é“ä½ çš„æ¶ˆæ¯ã€‚ç¬¬å…«é¢—çƒæ‰“è¿›ã€‚ äºæ˜¯æˆ‘ä»¬å°±â€œå¶ç„¶çš„â€è®¤è¯†äº†ï¼Œæˆ‘ä»¬é€šä¿¡ï¼Œæ˜¯ä½ çˆ¶äº²æƒ³çŸ¥é“ä½ çš„æ¶ˆæ¯ã€‚å°é¢ä¸Šåªå‰©æœ€åä¸€é¢—çƒã€‚ ç„¶è€Œèºèºæ‰“ä¸ä¸‹å»äº†ï¼Œæ”¶æ†ã€‚å› ä¸ºï¼Œçˆ¶äº²æ­»äº†ï¼ŒçœŸçš„æ˜¯çœŸæ­»äº†ã€‚èºèºä¸€ç›´éƒ½åœ¨è¯´ï¼Œä½ çˆ¶äº²ã€‚å´ä»æ²¡è¯´ï¼Œå’±çˆ¸ã€‚ å½“ä¸€åœºæµ©å¤§çš„éª—å±€åœ¨ä½ é¢å‰è¢«å¦ç™½çš„æ—¶å€™ï¼Œä½ ä¼šæ€ä¹ˆåšå‘¢ã€‚æ„¤æ€’ï¼Œå¤±è½ï¼Œå§”å±ˆï¼Œè¿˜æ˜¯æ‚²ä¼¤ã€‚æµ©æ±‰æ‹¿ç€å°çƒæ†åœ¨ä¸€æ—å¬å®Œäº†æ•´ä¸ªäº‹æƒ…çš„æ¥é¾™å»è„‰ï¼Œä»–ä¸€è¨€ä¸å‘çœ‹ç€èºèºä¸€ä¸ªä¸€ä¸ªæ‰“è¿›å°é¢ä¸Šçš„çƒï¼Œå°±åƒä¸€å±‚ä¸€å±‚æ­å¼€å°‘å¹´æ—¶çš„ç–¤ã€‚ èºèºæŠŠçƒåŠè½»åŠé‡åœ°å¡å…¥çƒç½‘ï¼Œä¸€åˆ‡å°˜åŸƒè½å®šï¼Œå¼€é—¨ç¦»å¼€ï¼Œâ€œä½ æ¶ˆåŒ–ä¸€ä¸‹å§â€ã€‚ è®½åˆºçš„æ˜¯ï¼Œæµ©æ±‰çœ¼ä¸­ç¥è¯ä¸€èˆ¬çš„çˆ¶äº²ï¼Œä¸æ˜¯æ­»åœ¨æå‡»é£æµªä¸­ï¼Œè€Œæ˜¯å–äº†é…’ï¼ŒæŠ½äº†çƒŸï¼Œç‚¹äº†æˆ¿å­ï¼Œçƒ§æ­»äº†ã€‚ â€œæ¯ä¸€å°ä¿¡éƒ½æ˜¯æˆ‘å†™çš„ï¼Œâ€æ‰€ä»¥èºèºåœ¨ä¹æµ©æ±‰ï¼›â€œåªä¸è¿‡åæ¥ï¼Œåªå‰©æˆ‘ä¸€ä¸ªäººè¯»äº†ã€‚â€æ‰€ä»¥èºèºåœ¨ä¹çˆ¶äº²ã€‚ ç„¶è€Œ2013å¹´ï¼Œèºèºåªåœ¨è¿™ä¸ªå°é•‡ï¼Œå¼€äº†ä¸€å®¶å°å°çƒå…ã€‚æ‰€ä»¥å¥¹ç•™ä¸ä½å¼Ÿå¼Ÿæµ©æ±‰ã€‚æµ©æ±‰åœ¨å¤–æ‰“æ‹¼äº†10å¹´ï¼Œå´åªæœ‰ä¸€éƒ¨è½¦ï¼Œåˆè¦é€æ±Ÿæ²³å…¥èŒã€‚æ‰€ä»¥æµ©æ±‰è½½ä¸èµ°çˆ±äººèºèºã€‚ â€œå–œæ¬¢å°±ä¼šæ”¾è‚†ï¼Œä½†çˆ±å°±æ˜¯å…‹åˆ¶â€ï¼Œæµ©æ±‰ä¸´èµ°å‰åˆ˜èºèºæ²™å“‘ç€å–‰å’™å‘Šè¯‰ä»–è¿™ä¸ªé“ç†ã€‚æˆ‘æƒ³ï¼Œæµ©æ±‰å¯¹èºèºæ˜¯æ”¾è‚†ï¼Œè€Œèºèºå¯¹æµ©æ±‰ï¼Œåˆ™æ˜¯æ·±æ²‰çš„çˆ±ã€‚æ—¢æœ‰ç”·å¥³ä¹‹çˆ±ï¼Œä¹Ÿæœ‰å§å¼Ÿä¹‹çˆ±ã€‚ éª—ä¸€ä¸ªäºº19å¹´ï¼Œæµ©æ±‰éš¾è¿‡ï¼Œèºèºåˆä½•å°å¥½å—ã€‚éª—äººçš„äººæ°¸è¿œæ¯”è¢«éª—çš„äººç—›è‹¦ï¼Œåœ¨å¥¹æ ¹æœ¬ä¸æƒ³æ¬ºéª—çš„å‰æä¸‹ã€‚å‘½è¿å¯ç¬‘åœ°å°†ä»–ä»¬è”ç³»åœ¨äº†ä¸€èµ·ï¼Œç”¨ä¸€ç§ä»¥ä¸ºæ˜¯å¶ç„¶ï¼Œä½†æ˜¯å…¶å®æ˜¯å¿…ç„¶çš„æ–¹å¼ã€‚ â€œä½ æœ‰æˆ‘çš„ä¸€åˆ‡è”ç³»æ–¹å¼ï¼Œèµ°å§ã€‚â€ã€‚æ½œå°è¯æ˜¯ï¼Œâ€œæˆ‘ç­‰ç€ä½ å›æ¥ï¼Œåœ¨ä»»ä½•ä½ æƒ³å›æ¥çš„æ—¶å€™ã€‚â€ã€‚ äºæ˜¯æµ©æ±‰ä¸Šè·¯ï¼Œä»–ç”šè‡³è¿˜æ²¡å†³å®šé€‰æ‹©å“ªç§æƒ…ç»ªæ¥å—è¿™ä¸ªç°å®ã€‚é‚£ä¸ªæ³¨å®šè¦é”™è¿‡çš„å¥½å§‘å¨˜ï¼Œè½¬èº«ç¦»å¼€ï¼Œåœ¨æ–°çš„ä¸€æ¡Œå°çƒé‡Œï¼Œè¸ä¸Šé‡Šæ€€ä¹‹åçš„å¹³å‡¡ä¹‹è·¯ï¼ŒåŒæ‰€æœ‰äººï¼Œåä¼šæ— æœŸã€‚ é˜¿å•é˜¿å•è¿™ç«™ï¼Œå«æ— æƒ…ã€‚ ä»–ç”¨é«˜è¶…çš„éª—æœ¯ï¼Œå°è¯äº†æ­Œè¯é‡Œé‚£å¥â€œå½“ä¸€éƒ¨è½¦æ¶ˆå¤±å¤©é™…ï¼Œå½“ä¸€ä¸ªäººæˆäº†è°œï¼Œä½ ä¸çŸ¥é“ï¼Œä»–ä»¬ä¸ºä½•ç¦»å»ï¼Œå°±åƒä½ ä¸çŸ¥é“è¿™ç«Ÿæ˜¯ç»“å±€ã€‚â€ã€‚å›å¤´å†çœ‹ï¼Œä½ ä»ç„¶ä¸çŸ¥é“ä»–é‚£å¥æ˜¯çœŸï¼Œé‚£å¥æ˜¯å‡ã€‚ æˆ‘å®æ„¿ç›¸ä¿¡ï¼Œä»–è¯´çš„è¯éƒ½æ˜¯çœŸçš„ã€‚ ä½ æ°¸è¿œçŒœä¸åˆ°è‡ªå·±ä¼šåœ¨ä»€ä¹ˆæ—¶å€™é‡è§é˜¿å•ã€‚ä¸€ä¸ªè®¡åˆ’ä¹‹ä¸­çš„è½¬å¼¯ï¼Œä¸€æ¬¡è®¡åˆ’ä¹‹å¤–çš„åœæ³Šï¼Œæ¯ä¸€ä¸ªè½¬è§’éƒ½æœ‰å¯èƒ½é‡è§æœªçŸ¥çš„æ—…äººï¼Œä½†åˆæœªå¿…å°±æ˜¯ä»–ã€‚ é˜¿å•ï¼Œæ˜¯æˆ‘ä»¬æ¯ä¸ªäººç”Ÿå‘½ä¸­æˆ–æ—©æˆ–æ™šï¼Œè¿Ÿæ—©è¦å‡ºç°çš„é‚£ä¸ªäººã€‚ ä»–å¹½é»˜ï¼Œè±è¾¾ï¼Œèº«ä¸ŠèƒŒè´Ÿç€åƒå±±ä¸‡æ°´çš„æƒ…æ€€ã€‚ä»–è¡Œç¨‹åå‡ ä¸‡å…¬é‡Œï¼Œå¿ƒä¸­æœ‰ç€ä¸ä¸ºå¤–äººæ‰€çŸ¥çš„é—æ†¾ã€‚ä»–ç”Ÿé‡Œæ¥ï¼Œæ­»é‡Œå»ï¼Œçœ‹ç€æœ€äº²çˆ±çš„äººç¦»å¼€è‡ªå·±ï¼Œåˆç”¨è‡ªæˆ‘çš„æ–¹å¼å°†å¥¹é“­è®°â€”â€”å³ä¾¿é‚£ä¸æ˜¯çœŸçš„ã€‚ é˜¿å•åƒä¸€ä¸ªæ‚–è®ºï¼Œä½ å¸Œæœ›æˆä¸ºä»–ï¼Œä½†åˆæŠ—æ‹’æˆä¸ºä»–ã€‚ä»–è¯´ï¼Œå°ä¼™å­ï¼Œä½ åº”è¯¥å¤šå‡ºæ¥èµ°èµ°çš„ã€‚æ±Ÿæ²³ä¸‹æ„è¯†åœ°åæŠ—ï¼Œå¯æ˜¯æˆ‘çš„ä¸–ç•Œè§‚å’Œä½ çš„ä¸ä¸€æ ·ã€‚äºæ˜¯ä»–ç¬‘äº†ï¼Œä½ è¿ä¸–ç•Œéƒ½æ²¡æœ‰è§‚è¿‡ï¼Œå“ªå„¿æ¥çš„ä¸–ç•Œè§‚ã€‚æ±Ÿæ²³æ— ä»åé©³ã€‚ ç»ˆç©¶æ— æ³•æŠ—æ‹’é˜¿å•çš„é­…åŠ›ï¼Œäºæ˜¯ä½ ä¿¡ä»»äº†è¿™æ ·çš„ä¸€ä¸ªäººã€‚ä½ è§‰å¾—ä»–å¯äº¤ï¼Œç”šè‡³æ„¿æ„å’Œä»–ä¸€èµ·ä¸Šè·¯ã€‚ä½ æ»¡å¿ƒæœŸå¾…ï¼Œå‡†å¤‡è½¬èº«å‘Šè¯‰ä»–è¿™å¯èƒ½æ˜¯ä½ ä¸€ç”Ÿä¸­æœ€é‡å¤§çš„å†³å®šâ€”â€”æ¥ç€ä½ çœ‹åˆ°äº†ä»–çš„èƒŒå½±ã€‚ä½ ä¸ç¡®å®šè¿™æ˜¯çœŸçš„è¿˜æ˜¯å‡çš„ï¼Œåªèƒ½ç«™åœ¨åŸåœ°å‚»å‚»ç­‰å¾…ï¼Œå¿ƒä¸­æ€€æœ‰æœ€åçš„æ¬¢å–œã€‚ç›´åˆ°ä»–æ”¾ä¸‹äº†æ‰€æœ‰ä½ çš„è¡Œæï¼Œä¹Ÿå¸ä¸‹äº†ä½ æ‰€æœ‰çš„æœŸæœ›ï¼Œä½ åˆ°é‚£æ—¶æ‰ç›¸ä¿¡ï¼Œä»–ç»™ä½ ä¸Šäº†ä¸€è¯¾ï¼Œå´æ— æƒ…åœ°æ”¶äº†é«˜é¢å­¦è´¹ã€‚ æˆ–è®¸ä»–æ­»äº†ï¼Œå’Œå¯ç¬‘çš„nt3m5på«æ˜Ÿä¸€æ ·æ²¡å‡ç©ºå°±ç‚¸äº†ï¼Œå› ä¸ºåœ¨é«˜æ¸©ç¯å¢ƒä¸‹ï¼Œæ±½æ²¹è½¦æ˜¯åƒä¸èµ·æŸ´æ²¹çš„ã€‚æˆ–è®¸ä»–æ²¡æ­»ï¼Œå’Œæ—…è¡Œè€…1å·ä¸€æ ·å†²ç ´å¤ªé˜³ç³»ï¼Œè¿æ°”å¥½é©¾ç€éª—æ¥çš„è½¦ï¼Œå›åˆ°ä¸œèå–è½¦ä¹°æ‘©æ‰˜å¨¶ä¸ªæ‡‚ä»–çš„æ–°è€å©†ã€‚ ä»–åˆ°åº•å«å•æ´å®¾ï¼Œè¿˜æ˜¯å«å•è¡Œè€…ï¼Ÿæ€»ä¹‹ï¼Œåœ¨æ”¾ä¸‹é©¬è¾¾çš„é‚£ä¸€åˆ»ä»–é©±è½¦é£é©°æ¶ˆå¤±ï¼Œèµ°ä¸Šè’å‡‰çš„å¹³å‡¡ä¹‹è·¯ï¼ŒåŒæ‰€æœ‰äººï¼Œåä¼šæ— æœŸã€‚ æ±Ÿæ²³ æ±Ÿæ²³è¿™ç«™ï¼Œå«å…„å¼Ÿæƒ…ã€‚ èƒ¡ç”Ÿå¯¹æ±Ÿæ²³è€å¸ˆçš„è¯„ä»·æ˜¯ï¼šâ€œä»–äººå¾ˆæ€ªâ€ã€‚è¿èƒ¡ç”Ÿéƒ½è§‰å¾—ä»–æ€ªï¼Œä¸œæå²›æ°‘è‡ªç„¶è§‰å¾—ä»–æ›´æ€ªã€‚ è‡ªå¸¦â€œè¯´æ•™â€å…‰ç¯å’Œâ€œå…¨çŸ¥â€å…‰ç¯ã€‚ä¹¦æœ¬ä¸Šçš„ä¸œè¥¿ï¼Œä»–å…¨éƒ½æ‡‚ï¼Œè€Œä¸”æœ‰ä¸ªâ€œæˆ‘æ•™ä½ â€çš„å£å¤´ç¦…â€”â€”â€œè¿™æ˜¯æ¯”ä¾‹å°ºï¼Œæˆ‘æ•™ä½ å•Šâ€ï¼Œâ€œæˆ‘æ•™ä½ å•Šï¼Œé¢åŒ…å’Œè¾£é…±â€¦â€¦â€ é¢åŒ…å¤¹è¾£æ¤’ï¼Œå·¥ä½œé åˆ†é…ï¼Œä¸å–œå¾€ä¸Šçˆ¬ï¼Œä»äº‹å°æ•™12å¹´ã€‚å‘¨æ²«è¯´ä»–ä¸æ€è¿›å–ã€‚å¦‚æœä½ è·³å‡ºç”µå½±çœ‹è¿™ä¹ˆä¸ªç”·äººï¼Œä¼°è®¡å“ªä¸ªå¥³çš„éƒ½ä¸æ„¿æ„è·Ÿä»–ï¼Œçªå›Šã€‚ ç„¶è€Œå°±åƒé˜¿å•è¯´çš„ï¼Œâ€œæœ‰æ—¶ä½ æƒ³è¯æ˜ç»™ä¸€ä¸‡ä¸ªäººçœ‹ï¼Œæœ€åå‘ç°ï¼Œåªæœ‰ä¸€ä¸ªäººæ‡‚ï¼Œè¿™å°±å¤Ÿäº†â€ï¼Œå¯¹äºæµ©æ±‰ï¼Œé‚£ä¸ªäººæ˜¯èƒ¡ç”Ÿï¼Œè€Œå¯¹äºæ±Ÿæ²³ï¼Œé‚£ä¸ªäººæ˜¯è‹ç±³ã€‚ ä¸‰å”é‚£æ¡çº¿ï¼ŒåŸè®¡åˆ’è¯¥æ˜¯â€œè­¦å¯Ÿâ€æŸ¥æˆ¿ï¼Œç„¶åæ‰å¥¸ï¼Œæ•²ä¸€ç¬”ç«¹æ ã€‚ä¸€å‘æ­£æ°”æµ©ç„¶çš„æ±Ÿæ²³è¡¨ç°å‡ºäº†ä¸€ç§å°‘æœ‰çš„éœ¸æ°”ï¼Œé”ä¸Šé—¨ï¼Œè¸¹å¼€çª—ï¼Œå¸¦ç€è‹ç±³å’Œæµ©æ±‰å¼€æºœã€‚è¿™ä¸€åˆ‡éƒ½æ˜¯ä¸ºäº†è‹ç±³é‚£å¥â€œä½ è¦ä¿æˆ‘â€ï¼Œç„¶è€Œåœ¨å…¨è¿‡ç¨‹ä¸­ï¼Œè¿™ç§éœ¸æ°”åªæ˜¯ä¸€ç§çœ‹ä¼¼å†·é™çš„éœ¸æ°”ã€‚å› ä¸ºä»–å®Œå…¨å¯ä»¥è®©è­¦å¯Ÿè¿›æ¥ï¼Œè¯´è¿™æ˜¯æˆ‘æœ‹å‹å’Œæˆ‘å¦»å­ï¼Œè¿™æ ·æˆ–è®¸èƒ¡ç”Ÿä¹Ÿå°±ä¸ä¼šæ¶ˆå¤±ã€‚åœ¨è‹ç±³â€œä½ è¦ä¿æˆ‘â€çš„å‚¬åŒ–ä¸‹ï¼Œæ±Ÿæ²³æ¿€å‘å‡ºçš„æ˜¯å¼ºçƒˆçš„ä¸ªäººè‹±é›„ä¸»ä¹‰æƒ…æ€€ï¼Œä¸ºäº†è¿™ä¸ªä¸€è§é’Ÿæƒ…çš„å¥³å­ï¼Œä¸€æ”¹ä»¥å¾€â€œåŠ¨å£ä¸åŠ¨æ‰‹â€çš„å„’å£«é£èŒƒï¼Œåšäº†å¸¦å¥¹ä¸€èµ·ä¸Šè·¯çš„å†²åŠ¨å†³å®šã€‚äºæ˜¯æ ¹æœ¬æ¥ä¸åŠæ€ç´¢ï¼Œå¤ºçª—è€Œé€ƒã€‚ä½†è¿™é€ƒä¹Ÿæ˜¯éå¸¸æœ‰è¶£çš„ï¼Œæ¥çœ‹çœ‹åœ¨â€œèº«è´¥åè£‚â€çš„å±æœºå…³å¤´æ±Ÿæ²³çš„æ•´å¥—ä¸‹æ„è¯†åŠ¨ä½œï¼šå…ˆé€è‹ç±³å‡ºï¼Œå†ç»™è‹ç±³é‹ï¼ŒæŒ‡äº†å¥¶è‰²çš„è½¦ï¼Œæ‰”å‡ºè¡Œæï¼Œå†æ©æŠ¤é˜Ÿå‹ç¦»å¼€ï¼Œéšåè‡ªå·±è·³çª—ï¼Œæ‹‰ä¸Šå¿ƒçˆ±çš„å¥³ç”Ÿï¼Œå†²ä¸Šè½¦ï¼Œå¹¶ä¸€åº¦åœ¨æƒŠå“ä¸­é©¾é©¶ä¸è‚¯è®©å‡ºæ–¹å‘ç›˜ã€‚è¿™å¥—åŠ¨ä½œè€ƒè™‘å…¨é¢å‡ è¿‘å®Œç¾ï¼Œå¦‚æœä¸æ˜¯é€ƒè·‘è¿™ä¸ªç›®çš„ï¼Œé‚£ç®€ç›´å¯ç®—ä½œã€Šå¦‚ä½•æˆä¸ºä¸€ä¸ªå¥³ç”Ÿå¿ƒä¸­çš„ç”·ç¥ã€‹çš„æ•™ç§‘ä¹¦èŒƒä¾‹ã€‚åœ¨è¿™æ ·æœ‰æƒ…æœ‰ä¹‰çš„ç”·å­é¢å‰ï¼Œæˆ‘æƒ³æ²¡æœ‰å“ªä¸ªå¥³ç”Ÿä¸ä¼šå¯¹ä»–äº§ç”Ÿå¥½æ„Ÿã€‚ æ­¤æ—¶é•œå¤´ä¸æ–­åˆ‡æ¢ä¼˜é›…çš„è‹ç±³ï¼Œç´§å¼ çš„æ±Ÿæ²³ï¼Œè…¿éº»è€Œé¾Ÿçˆ¬çš„æµ©æ±‰ï¼ŒèƒŒæ™¯éŸ³ä¹é‡å¤è‹ç±³æ•²é—¨è¿›å…¥æ—¶çš„è¯±æƒ‘éŸ³ä¹â€”â€”äºè‹ç±³è¿™åªæ˜¯ä¸€ä¸ªæ’æ¼”äº†ä¸çŸ¥å¤šå°‘éçš„å±€ï¼Œäºæ±Ÿæ²³æµ©æ±‰åˆ™å…³ä¹â€œèº«è´¥åè£‚â€ã€‚è¿™æ ·çš„å¯¹æ¯”å†²çªåŠ ä¸ŠèƒŒæ™¯éŸ³ä¹çš„çƒ˜æ‰˜æ­£æ”åˆ°è§‚ä¼—çš„Gç‚¹ï¼Œèˆ’æœçš„ä¸è¡Œã€‚ â€œæˆ‘å†³å®šçš„äº‹ï¼Œä¸ä¼šè¢«æ”¹å˜ã€‚â€ã€‚æ±Ÿæ²³è®¤çœŸäº†ï¼Œæˆ–è€…ï¼Œè¿˜æ²¡å›è¿‡ç¥ã€‚ä½†æ— è®ºå¦‚ä½•ï¼Œä»–å•çº¯çš„å¯çˆ±ã€‚ è°ˆè°ˆå³å°†åˆ†åˆ«çš„æ—¶å€™ã€‚é˜¿å•å¼€èµ°äº†æµ©æ±‰çš„è½¦ï¼Œä¸¤å…„å¼Ÿåœ¨ç»å†äº†ä¸€è·¯å’Œè°ä¹‹åï¼Œç»ˆäºåœ¨æœ€åæŠ‘åˆ¶ä¸ä½è‡ªå·±å†…å¿ƒçš„æƒ…ç»ªï¼Œäº§ç”Ÿäº†å¼ºçƒˆçš„çŸ›ç›¾ã€‚æ±Ÿæ²³è§‰å¾—ä»–ä¸€å®šæœ‰è‹¦è¡·ï¼Œæƒ…æœ‰å¯åŸã€‚æµ©æ±‰è§‰å¾—äº‹å®æ”¾åœ¨çœ¼å‰ï¼Œä½•å¿…ç”¨é‚£ç§è¯å®‰æ…°è‡ªå·±ã€‚è½¬è€Œäº§ç”Ÿäº†å½¼æ­¤ä»·å€¼è§‚çš„çŸ›ç›¾å’Œå†²çªï¼Œè°éƒ½åŠè¯´ä¸äº†è°ï¼Œäºæ˜¯ä¸€åœºæ²¡æœ‰ç»“æœçš„äº‰æ–—åœ¨ä¸€æœ›æ— å çš„é“è·¯ä¸Šå±•å¼€äº†ã€‚è¿™åœºé—¹å‰§è¶Šå‘å¼ºçƒˆâ€”â€”ç›´åˆ°nt3m5pè½°ç„¶å‡ç©ºï¼Œç¼“ç¼“ä¸Šæ‰¬ï¼Œåˆå¿½ç„¶çˆ†ç‚¸ã€‚ åœ¨æ±Ÿæ²³å¿ƒä¸­ï¼Œä»–è¢«é˜¿å•â€œä½ è¿ä¸–ç•Œéƒ½æ²¡è§‚è¿‡â€çš„è¯åˆºç—›ï¼Œå› ä¸ºè¯´åˆ°è‡ªå·±ç—›å¤„ï¼Œæ‰€ä»¥ä»–ç›¸ä¿¡é˜¿å•æ²¡æœ‰è¯´è°ï¼Œæœ‰è‹¦è¡·ã€‚ç„¶è€Œçœ‹åˆ°è¿é˜¿å•çš„æ¢¦â€œç ´ç¢â€äº†ï¼Œè¿˜æ²¡è¿ˆå‡ºç¬¬ä¸€æ­¥çš„è‡ªå·±ï¼Œåˆå»å’Œæµ©æ±‰äº‰è®ºä»€ä¹ˆå‘¢ï¼Ÿ åœ¨è¿™ä¸€åˆ»ï¼Œæˆ‘ç›¸ä¿¡ä¸æ­¢æˆ‘ä¸€ä¸ªäººæƒ³åˆ°ã€Šç§’é€Ÿ5å˜ç±³ã€‹çš„é‚£ä¸ªç‰‡æ®µã€‚åä¸ªæ§½ï¼Œä¸¤äººæ‰“å¾—å¾ˆå‡ºæˆï¼Œå³è§†æ„Ÿå…¨æ— ï¼Œæ ¹æœ¬ä¸åƒæ˜¯åŠ¨æ‰‹æ‰“äººï¼Œè¿™æ˜¯æˆ‘å”¯ä¸€æ‰¾å‡ºçš„ä¸¤ä¸ªç”·ä¸»æ¼”çš„ä¸å¥½çš„åœ°æ–¹ã€‚ åœ¨ç«ç®­æ®‹éª¸æ—ï¼Œä¸¤äººæœ€ç»ˆå‘Šåˆ«ã€‚æ­¤æ—¶æ±Ÿæ²³å·²ç»å‘ç”Ÿæ”¹å˜ï¼Œä»–ä»ä¸€å¼€å§‹å…³æ³¨â€œå…¥èŒâ€åˆ°å…³æ³¨â€œæ¨ªç©¿æ•´ä¸ªä¸­å›½â€ã€‚æ”¹å˜ä»–çš„ï¼Œæ˜¯é˜¿å•ï¼Œè€Œæµ©æ±‰ä¸ä¹‹åˆšåˆšç›¸åï¼Œä»–çš„å›å¤æ˜¯â€œé‚£æœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿâ€ã€‚æ­¤æ—¶æµ©æ±‰ä¹Ÿå·²å‘ç”Ÿæ”¹å˜ï¼Œä»–ä»å…³æ³¨â€œæ¨ªç©¿æ•´ä¸ªä¸­å›½â€åˆ°å…³æ³¨â€œæ„ä¹‰â€ã€‚æ”¹å˜ä»–çš„ï¼Œä¹Ÿæ˜¯é˜¿å•ã€‚ é©¬è¾¾ä¸€å®šä¼šé€‰æ‹©æ±Ÿæ²³ï¼Œå› ä¸ºç‹—æ¯”äººæ¸…æ¥šï¼Œåœ¨æ²¡æ°´ï¼Œæ²¡è½¦ï¼Œæ²¡æœ‹å‹çš„å¢ƒå†µä¸‹ï¼Œæµ©æ±‰åŸè·¯æŠ˜è¿”ï¼Œèƒ½ä¸èƒ½æ´»ç€èµ°å‡ºè¿™æˆˆå£ï¼Œéƒ½æ˜¯é—®é¢˜ã€‚è¿™æ˜¯é©¬è¾¾è®¾å®šçš„ç¬¬ä¸€ä¸ªå¿…è¦ã€‚ é©¬è¾¾è®¾å®šçš„ç¬¬äºŒä¸ªå¿…è¦ï¼Œå°±æ˜¯å°è¯æ±Ÿæ²³ä¹‹æ­»ã€‚ä¸€ä¼šå†è¯´è¿™ä¸ªé—®é¢˜ã€‚ è¯´è¯´è®©äººè§‰å¾—ç”šè‡³æœ‰äº›ç”Ÿç¡¬çš„â€œåæ¥â€ã€‚ ä¸€å‘¨ç›®çš„æ—¶å€™ï¼Œè§‰å¾—è¿™ç»“å±€ç®€ç›´è‰ç‡ã€‚ç›´åˆ°å››å‘¨ç›®çš„æ—¶å€™ï¼Œæˆ‘ä¼¼ä¹çœ‹æ˜ç™½äº†ç‚¹ã€‚ æ±Ÿæ²³å›åˆ°ä¸œæå²›æ—¶ï¼Œä¸‹ç€å¤§é›¨ã€‚ç„¶è€Œä¸œæå²›çš„æŸ´ä¼¯å…¬é›•åƒï¼Œå°±æ˜¯é‚£ä¸ªè‡ªç”±ç”·ç¥ï¼Œå±…ç„¶ä¸¾ç€ç‡ƒçƒ§çš„ç«ç‚¬ï¼ å¤§é›¨å’Œç«ï¼Œåœ¨ä¸œæå²›ä¹‹æ­Œçš„å°¾å£°å‡ºç°è¿‡çŸ­çŸ­ä¸€ç¬ï¼Œæ¯«æ— ç–‘é—®ï¼Œç«ç‡ƒçƒ§äº†ä¸€åˆ¹é‚£ï¼Œå°±ç†„ç­äº†ã€‚ç„¶è€Œåœ¨ç»“å°¾ï¼Œå¤§é›¨ä¹‹ä¸­ç«ç‚¬å±…ç„¶ç†Šç†Šç‡ƒçƒ§åœ¨å¤©é™…ã€‚ ç„¶åæ˜¯å¹½çµå¯¼æ¸¸çš„å‡ºç°ã€‚å…¨åœºæ™¯ï¼Œåªæœ‰æ±Ÿæ²³ä¸€ä¸ªäººåœ¨å±±ä¸Šèµ°ã€‚ æ¥ç€æ˜¯æ— å˜å¤´çš„â€œ80é›†ç”µè§†å‰§â€å’Œâ€œè§‚å½±ç‹‚æ½®â€ï¼Œä»¥åŠè¶…è¶Šã€Šç»§æ‰¿è€…ã€‹ã€‚è¿™é‡Œåˆæœ‰ä¸ªå¾ˆå¤§çš„çŸ›ç›¾ï¼Œç”µè§†è¿ç»­å‰§æ€ä¹ˆèƒ½ç”¨â€œè§‚å½±â€å‘¢ï¼Ÿè€Œä¸”ï¼Œè¿™æ ·å¤©é©¬è¡Œç©ºçš„ä»‹ç»ç”šè‡³æ‰¯åˆ°éŸ©å›½æ”¶è§†ï¼Œæœªå…ä¹Ÿå¤ªå¤©é©¬è¡Œç©ºäº†å§ï¼Ÿæœ€åå¯¼æ¸¸çš„è¯æ˜¯ï¼Œâ€œè¦ä¹°çºªå¿µå“çš„æœ‹å‹è¯·å¾€è¿™è¾¹èµ°â€ï¼Œæ•´ç»„ç”»é¢ä¾ç„¶æ˜¯æ±Ÿæ²³å’Œå±±å¤´ã€‚è«éæ˜¯å¹³è¡Œæ—¶ç©ºé‡Œå¤©ä¸Šçš„è¡—å¸‚ï¼Ÿæ˜¯å¦èƒ½è¿™æ ·å¤§èƒ†çŒœæµ‹ï¼Œå”¯ä¸€è§£é‡Šçš„æ˜¯ï¼Œâ€œåæ¥â€ä¸è¿‡æ˜¯æ±Ÿæ²³ã€Šæ—…è¡Œè€…ã€‹é‡Œçš„é•œåƒã€‚ä¹Ÿå°±æ˜¯æŠŠå°è¯´é‡Œçš„è±¡å¾æ€§æå†™è¯­è¨€ä»¥ç”»é¢çš„å½¢å¼å±•ç¤ºã€‚æŸ´ä¼¯å…¬çš„ç«ä»£è¡¨ç†æƒ³è‡ªç”±ä¸æ¢ç´¢ä¹‹ç«ï¼Œåœ¨ç°å®çš„æ»‚æ²±å¤§é›¨é¢å‰ä¾ç„¶ç†Šç†Šç‡ƒçƒ§ã€‚å¹½çµå¯¼æ¸¸åˆ™æ˜¯åæ˜ äº†ä¸œæå²›è¢«å»ºè®¾çš„ååˆ†ç¹åã€‚ äºæ˜¯åé¢çš„æƒ…èŠ‚ä¹Ÿé¡ºç•…äº†èµ·æ¥ã€‚åœ¨ã€Šæ—…è¡Œè€…ã€‹è¿™éƒ¨ä¹¦é‡Œï¼Œæ±Ÿæ²³ä¾æ—§æ²¡å¿˜è®°è‡ªå·±é’Ÿçˆ±çš„æ•™è‚²äº‹ä¸šï¼Œä¸œæå²›åˆæœ‰äº†å­¦æ ¡ï¼Œäºæ˜¯ä½ çœ‹åˆ°äº†å­©å­ä»¬æ»¡è¡—è·‘ã€‚èˆ¹ä¸Šç”µè§†é‡Œæ”¾ç€ç«äº†çš„å‘¨æ²«ï¼Œé‚£ä¸ªç†è§£ä»–ï¼Œå‘Šè¯‰ä»–äººå„æœ‰å¿—çš„å¥³å­(æµ©æ±‰åˆ™ä¸€ç›´å¯¹æ±Ÿæ²³å°æ•™12å¹´è¡¨ç¤ºä¸å±‘)ã€‚è·Ÿä»–ä¹‹å‰å‘æµ©æ±‰æ‰€æ‰¿è¯ºè¿‡çš„é‚£æ ·(å½“æ—¶ä¸¤ä¸ªäººåœ¨æ²¡æœ‰æŒ¡é£ç»ç’ƒçš„è½¦é‡Œï¼Œæœ€åè¿˜é£˜æ¥ä¸€å¼ æŠ¥çº¸ç ¸åœ¨æµ©æ±‰å¤´ä¸Š)ï¼Œä»–æ²¡æœ‰ç»™æµ©æ±‰ä¸€ä¸ªç»“å±€ï¼Œè€Œæ˜¯æŠŠæœ€åç•™ç»™äº†è‹ç±³ã€‚èˆ¹ä¸Šï¼Œè‹ç±³ä¾ååœ¨ä»–çš„è‚©å¤´ã€‚ è¿™æ˜¯ã€Šæ—…è¡Œè€…ã€‹çš„ç»“å±€ï¼Œä¸æ˜¯ã€Šåä¼šæ— æœŸã€‹çš„ç»“å±€ã€‚è‹ç±³è¦å‡ºå›½ç”Ÿå­©å­ï¼Œæ±Ÿæ²³åœ¨è¥¿è—æ”¯æ•™ï¼ŒåŒæ—¶ä¸¢å¤±äº†è‹ç±³çš„å¡ç‰‡ã€‚å¦‚æœæœ€åçš„â€œåæ¥â€æ˜¯çœŸæ­£çš„ç»“å±€ï¼Œé‚£ä¹ˆä¸¤äººç›¸é‡çš„æ¦‚ç‡æ˜¯å¤šå°‘ï¼Ÿè¿™éƒ¨ç”µå½±è¿˜ä¼šå«ã€Šåä¼šæ— æœŸã€‹ä¹ˆï¼Ÿ è¿™æˆ–è®¸å°±æ˜¯æ±Ÿæ²³çš„ä¸€åœºæ¢¦å§ï¼Œã€Šæ—…è¡Œè€…ã€‹ä¸­ï¼Œæ±Ÿæ²³çš„å¹»æƒ³çš„é•œåƒã€‚ æ±Ÿæ²³ç¯‡çš„æœ€åï¼Œè¯´è¯´æ±Ÿæ²³ä¹‹æ­»ã€‚ ä¸€å¼€å§‹ï¼Œæˆ‘ä»¥ä¸ºæ±Ÿæ²³ä¸ä¼šæ­»ï¼Œä»–ä¼šå®‰é™çš„åœ¨è¥¿è—å†™å­—ï¼Œæ•™ä¹¦ã€‚ç„¶åä¸€ä¸ªç»†èŠ‚è®©æˆ‘æ”¹å˜äº†è¿™ä¸ªæƒ³æ³•ã€‚ æ²¡é”™ï¼Œå°±æ˜¯ã€çŒ«ç‹—äººã€‘ã€‚ç”µå½±é‡Œä¸€ä¸ªå‡ºç°äº†2æ¬¡çš„npcã€‚æ‘˜å½•çŒ«ç‹—äººåŸè¯å¦‚ä¸‹ï¼š â€œæˆ‘åœ¨è¿™ä¸ªåŸå¸‚ç”Ÿæ´»6å¹´äº†ï¼Œå¯æ˜¯ä¸€ç›´æ²¡ä»€ä¹ˆæœ‹å‹ã€‚æˆ‘å…»äº†4åªçŒ«ï¼Œå¯æ˜¯å¤§å®¶éƒ½è¯´åº”è¯¥å…»ç‹—è¯¶ï¼Œç”·çš„å˜›ï¼Œæˆ‘è§‰å¾—ç‹—å•Šï¼Œæ˜¯ä¸€ç§éœ€è¦é™ªä¼´çš„åŠ¨ç‰©ï¼Œæˆ‘æ˜¯å¾ˆå–œæ¬¢ç‹—çš„ï¼Œä½†æ˜¯æˆ‘æ²¡æœ‰å‹‡æ°”å…»ï¼Œå¯æ˜¯åœ¨å¤œæ™šæ¥ä¸´çš„æ—¶å€™ï¼Œæˆ‘å°±çœ‹ç€çª—å¤–çš„è½¦æµï¼Œæˆ‘è§‰å¾—è¿™ä¸ªä¸–ä¸Šè¿™ä¹ˆå¤šäººï¼Œå¯æ˜¯æ²¡æœ‰äººæƒ³å¬æˆ‘è¯´è¯ã€‚â€ ç„¶åèŠ‚ç›®åˆ°ç‚¹ï¼ŒçŒ«ç‹—äººçš„è¯è¢«åœæ‰ã€‚ â€œä½ å¥½ä¸»æŒäººï¼Œæˆ‘ä»Šå¤©ç»ˆäºè¿ˆå‡ºäº†è¿™ä¸€æ­¥ï¼Œæˆ‘æŠŠé‚£4åªçŒ«é€ç»™æœ‹å‹äº†ã€‚æˆ‘å…»äº†1æ¡ç‹—ã€‚â€ â€œé‚£æˆ‘å¯ä»¥å†è¿ˆå‡ºä¸€æ­¥å—ï¼Ÿæˆ‘ä»¬ç°åœ¨åœ¨å¤©å°ä¸Šã€‚â€ è¿™å°±æ˜¯ä¸¤ä¸ªæ•…äº‹ï¼š4çŒ«æ¢1ç‹—+æŠ±ç‹—è‡ªæ€ã€‚ è¿™è¯´çš„ä¸å°±æ˜¯æ±Ÿæ²³ä¹ˆï¼šæ€ªï¼Œæ‰€ä»¥æ²¡æœ‹å‹ã€‚4åªçŒ«ï¼Œè‹ç±³ã€èƒ¡ç”Ÿã€æµ©æ±‰ã€é˜¿å•ï¼Œæ¢1åªç‹—ï¼Œé©¬è¾¾ã€‚è¿™ä¸å°±æ˜¯è¿™æ¡æ— æœŸä¹‹è·¯ä¹ˆï¼Ÿåˆ°äº†è¥¿è—ï¼Œä»–ç®—æ˜¯è¿ˆå‡ºäº†ä¸€æ­¥ï¼Œé‚£æˆ‘å¯ä»¥å†è¿ˆå‡ºä¸€æ­¥ä¹ˆï¼Ÿé‚£ä¸ªåœ°æ–¹ï¼Œé™¤äº†é©¬è¾¾ï¼Œä»¥ä»–çš„æ€ªå¼‚ï¼Œä¼¼ä¹å«ä¸åˆ°æœ‹å‹ï¼Œè€Œä¸”é‚£ä¸ªåœ°æ–¹ï¼Œæœ‰å‡ ä¸ªäººèƒ½é€šä»–åœ¨ä¸€ä¸ªæ°´å¹³çº¿ä¸Šäº¤æµï¼Ÿå†™å®Œäº†ã€Šæ—…è¡Œè€…ã€‹ï¼Œä»–ä¾¿æ²¡æœ‰ä»€ä¹ˆæœŸæœ›äº†ï¼Œè‹ç±³ä¸çŸ¥ä½•å¤„ï¼Œè€Œä»–åˆæ˜¯ä¸ªâ€œç­‰ç€åˆ†é…â€â€œä¸ä¼šäº‰å–â€â€œä¸å–œæ¬¢å¾€ä¸Šçˆ¬â€çš„äººï¼Œåœ¨æ²¡æœ‰ä»€ä¹ˆåŠ¨æœºï¼Œè®©ä»–ä¸Šè·¯ã€‚ äºæ˜¯è¿™ä¸ªä¸å–œæ¬¢å¾€ä¸Šçˆ¬çš„äººé€‰æ‹©ä¸‹è½ã€‚ â€œé‚£æˆ‘å¯ä»¥å†è¿ˆå‡ºä¸€æ­¥ä¹ˆï¼Ÿâ€â€œå½“ç„¶å¯ä»¥ã€‚â€â€œæˆ‘ä»¬ç°åœ¨åœ¨å¤©å°ä¸Šã€‚â€ æˆ‘ä»¬æ˜¯æ±Ÿæ²³ã€é©¬è¾¾ï¼Œå½“ç„¶ï¼Œè¿˜æœ‰ä»–ç´§æ¡ç€çš„ã€Šæ—…è¡Œè€…ã€‹é‡Œçš„æµ©æ±‰ã€é˜¿å•ã€èƒ¡ç”Ÿã€å‘¨æ²«ã€èºèºã€‚ä»¥åŠé åœ¨ä»–è‚©å¤´çš„ï¼Œä»–å†ä¹Ÿæ‰¾ä¸åˆ°çš„ï¼Œè‹ç±³ã€‚ æµ©æ±‰æµ©æ±‰å“¥ã€‚æ•´éƒ¨ç”µå½±çš„çµé­‚å’Œæ³ªç‚¹ï¼Œä»–æ˜¯å¾ˆå¤šå°è¯çš„æ³¨è§£ã€‚æ˜¯â€œåƒä½ åƒä»–åƒé‚£é‡è‰é‡èŠ±â€çš„æœ€å¥½æ³¨è§£ã€‚æœ‰æ—¶å€™ä½ çœŸè§‰å¾—ï¼Œè‡ªå·±æˆ–æ˜¯èº«è¾¹çš„äººï¼Œåƒæäº†æµ©æ±‰ã€‚ æµ©æ±‰è¿™ç«™ï¼Œå«ç»æƒ…ã€‚ ä»–ä¹Ÿæ˜¯éª—å­ï¼Œä¸è¿‡ä»–è‡ªä»¥ä¸ºæ˜¯çš„è§‰å¾—èƒ½éª—äº†æ‰€æœ‰äººï¼Œå…¶å®ï¼Œä»–åªæ˜¯éª—äº†è‡ªå·±ã€‚ åœ¨èƒ¡ç”Ÿçœ¼é‡Œï¼Œâ€œæµ©æ±‰å“¥æ˜¯ä¸ªåœ¨å¤–é¢é—¯è¡è¿‡çš„ç”·äººã€‚â€â€”â€”å¹¼å¹´ä¸§çˆ¶ï¼Œâ€œå‡ºæµ·æ•é±¼4å¹´ã€å‡ºç§Ÿè½¦å¸æœºå¼€äº†3å¹´ï¼Œè·‘è¿è¾“2å¹´ï¼Œå¹¼å„¿å›­ä¿å®‰å¹²äº†1å¹´ã€‚â€ã€‚äºæ˜¯ä»–ä¹°äº†ä¸€è¾†ç±³è‰²çš„è½¦(ä½†æ‰€æœ‰å¥³äººéƒ½ä¼šå«ï¼šå“‡ï¼Œå¥¶è‰²ã€Š1988ã€‹ä¹±å…¥)ï¼Œâ€œæƒ³å›å®¶ä¹¡å¤§å¹²ä¸€åœºâ€ã€‚ ç„¶åå°±å‘ç”Ÿäº†å¼€å§‹çš„é‚£ä¸€å¹•ã€‚ä¸œæå²›æœ€åçš„å²›æ°‘ä»¬å¼€äº†ä¸€åœºæ¼”å”±ä¼šï¼Œä¼°è®¡æ˜¯åº†ç¥â€œå¤§å²›å»ºå°å²›è¿â€çš„æ”¿ç­–ï¼Œä¸»é¢˜æ˜¯ç¦»ä¹¡æ­Œå”±æ™šä¼šï¼Œæ™šä¼šä¸Šï¼Œè¿˜å¾ˆå¯èƒ½æ¼”å”±äº†å²›æ°‘ä»¬ä¸ºäº†æ­Œé¢‚å°å²›è€Œåˆ›ä½œçš„ã€Šä¸œæå²›ä¹‹æ­Œã€‹ã€‚å°±å¦‚åŒç”µå½±é‡Œæ’­æ”¾ã€Šä¸œæå²›ä¹‹æ­Œã€‹æ—¶çš„ç”»é¢ä¸€æ ·ä¸€æ ·çš„ï¼Œç›®çš„å¾ˆç®€å•ï¼Œåè®½ã€‚ æµ©æ±‰å“¥åœ¨èƒ¡ç”Ÿçš„å™è¿°ä¸­å‡ºåœºï¼Œä»–åœ¨å°ä¸Šçš„ç¥æ¼”è®²ä¸€è¯­æˆè°¶ï¼šâ€œæˆ‘ä»Šå¤©ä¸Šäº†è¿™ä¸ªå°ï¼Œå°±ä¸æ€•è‡ªå·±ä¸‹ä¸äº†å°ï¼Œç°åœ¨æˆ‘è¦è¯´ï¼Œæˆ‘ä»¬è¦â€¦â€¦â€ å›å¤´å†çœ‹ï¼Œå‘ç°å‡ ä¹æ‰€æœ‰çš„å…³äºæµ©æ±‰çš„å‰§æƒ…ä¼¼ä¹éƒ½åœ¨è®²ï¼Œä»–æ€ä¹ˆå¨é£å‡›å‡›çš„ä¸Šå°ï¼Œåˆæ˜¯æ€ä¹ˆâ€œä¸æ€•è®©è‡ªå·±ä¸‹ä¸äº†å°â€çš„ã€‚ ç„¶åè¯ç­’æ‰©éŸ³æ–­äº†ã€‚è¿™æ˜¯å¿…ç„¶çš„ã€‚ç”µå½±åœºæ™¯é‡Œé‡Œï¼Œèˆå°ä¸Šçš„å·¥ä½œäººå‘˜å·²ç»æŠŠéŸ³ç®±éƒ½æ‹‰èµ°äº†ã€‚ ä»‹ç»ä¸€ä¸‹è¿™å‡ ç»„é•œå¤´çš„ç”µå½±åœºæ™¯ï¼Œå°ä¸Šæ˜¯è¯ç­’å’Œä¹è°±æ¶ï¼Œå°ä¸‹æ˜¯å°æ¿å‡³ã€‚æµ©æ±‰å“¥ç™»å°æ—¶ï¼Œå°ä¸‹è§‚ä¼—åç€å¡‘æ–™å°æ¿å‡³é¼“æŒï¼Œä»ä¸‹å°æ¼”å‘˜çš„è£…æŸå¯æ¨çŸ¥ï¼ŒèŠ‚ç›®ä¸æ˜¯å¤§åˆå”±å°±æ˜¯è¯—æœ—è¯µã€‚èƒ¡ç”Ÿè¯´äº†ï¼Œä»–å’Œä»–çš„ä¸¤ä¸ªå…„å¼Ÿï¼Œä¹Ÿå°±æ˜¯æ±Ÿæ²³æµ©æ±‰æ˜¯æœ€åç¦»å¼€ä¸œæå²›çš„ã€‚æ‰€ä»¥åŸºæœ¬å¯æ¨çŸ¥æ™šä¼šä¸»é¢˜å¯èƒ½ä¸è¿å±…ç¦»ä¹¡æœ‰å…³ã€‚ è‡³äºæµ©æ±‰ä¸Šå°æ²¡è¯´å®Œçš„é‚£å¥ï¼Œä»ä»–å’Œæ±Ÿæ²³èƒ¡ç”Ÿçš„å¯¹è¯å’Œé‡åˆ°é˜¿å•ä¹‹åé‚£å¤©æ™šä¸Šçš„å¯¹è¯å¯åŸºæœ¬è¡¥å…¨ï¼šâ€œç°åœ¨æˆ‘è¦è¯´ï¼Œæˆ‘ä»¬è¦é½å¿ƒååŠ›ï¼ŒæŠŠæˆ‘ä»¬çš„ä¸œæå²›å»ºè®¾æˆæµ·ä¸Šä¸½æ±Ÿï¼Œé‚£ç‰‡æµ·å²¸ä¸Šçš„æ²™æ»©ï¼Œå¯ä»¥å»ºæˆé˜³å…‰æ²™æ»©(Sun of beach)â€¦â€¦â€ã€‚ ç„¶è€Œï¼Œæ²¡äººé¸Ÿä»–ã€‚é™¤äº†èƒ¡ç”Ÿï¼šâ€œä»–å¾ˆåšå¼ºï¼Œæˆ‘å¾ˆæ¬£èµâ€ã€‚ èƒ¡ç”Ÿçš„æ¬£èµä¸æ˜¯æ²¡æœ‰é“ç†çš„ã€‚åœ¨æ•´ä¸ªå®¶ä¹¡éƒ½å·²ç»ç ´è½åˆ°æ— åŠ›å›å¤©çš„æ—¶å€™ï¼Œåœ¨å®¶ä¹¡çš„ä¸€æ¡è·¯è¿˜æ²¡æœ‰ä¸€è¾†è½¦å®½çš„æ—¶å€™ï¼Œæµ©æ±‰æ˜¯æ•´ä¸ªä¸œæå²›å”¯ä¸€æœ‰å‹‡æ°”é‡å»ºå®¶ä¹¡çš„äººï¼Œä»–çš„æ¢¦æƒ³æ˜¯ã€æŒ¯å…´å®¶ä¹¡çš„æ—…æ¸¸ä¸šã€‘ã€‚æ‰€ä»¥ï¼Œã€æµ©æ±‰æ˜¯ä¸€ä¸ªæœ‰ä¹¡åœŸæƒ…ç»“çš„äººï¼Œä»–çˆ±è‡ªå·±çš„å®¶ä¹¡ã€‘ã€‚ä¹Ÿå¯ä»¥æŠŠè¿™å½“åšæ­Œè¯é‡Œâ€œå½“æ¯ä¸ªç¹æ˜ŸæŠ›å¼ƒé“¶æ²³çš„å¤œé‡Œâ€çš„æ³¨è§£ï¼Œæµ©æ±‰ï¼Œå°±æ˜¯é‚£ä¸ªç¹æ˜Ÿã€‚ ç„¶è€Œäº‹å®æ˜¯ï¼šè™½ç„¶æµ©æ±‰æ»¡åœ°éƒ½æ˜¯â€œæœ‹å‹â€ï¼Œä»–è‡ªå·±è¿˜æ˜¯è¢«å®¶ä¹¡è½°èµ°ã€‚ä»¥é€æ±Ÿæ²³ä¹‹åä¸Šè·¯ï¼Œé¡ºè·¯æ‹œè®¿å‘¨æ²«ã€èºèºã€‚ è¿™è¿˜ä¸æ˜¯æµ©æ±‰ä¸Šè·¯çš„å…¨éƒ¨åŸå› ã€‚åœ¨æŒ¯å…´å®¶ä¹¡æ—…æ¸¸ä¸šè¿™ä¸ªæ¢¦æƒ³å—é˜»ä¹‹åï¼Œä»–å¸Œæœ›é€šè¿‡è¿™ä¸€è·¯çš„å†’é™©ï¼Œè®©è‡ªå·±æœ‰æ‰€æ”¶è·ï¼Œæœ‰æ‰€å†ç»ƒã€‚å¸Œæœ›å¯ä»¥é‡ä¸Šä¸€äº›äººå’Œäº‹è®©è‡ªå·±å¼ºå¤§ï¼Œç”šè‡³å¯ä»¥å¸®åŠ©è‡ªå·±ï¼ŒæŒ¯å…´å®¶ä¹¡æ—…æ¸¸ä¸šã€‚è€Œä¸”ï¼Œä»–çš„æ–°è½¦éœ€è¦ä¸Šè·¯ï¼Œä¸ç„¶ä¸æ˜¯ç™½ä¹°äº†ã€‚è¿™è¾†è½¦åœ¨ä»–çœ¼é‡Œï¼Œæ˜¯ä»–å¯ä»¥å¯¹æ±Ÿæ²³ã€èƒ¡ç”Ÿè‡­å±çš„èµ„æœ¬ã€‚ä½ çœ‹ï¼Œæ±Ÿè€å¸ˆï¼Œæˆ‘è‡³å°‘ç°åœ¨èƒ½ç”¨è¿™äº¤é€šå·¥å…·é€ä½ ä¸Šè·¯ï¼Œæˆ‘è¿˜åœ¨å¤–é¢è®¤è¯†ä¸å°‘äººï¼Œæ»¡åœ°éƒ½æ˜¯æˆ‘æœ‹å‹ï¼Œå“ªå„¿æ‹‰å±éƒ½æœ‰äººç»™æˆ‘é€çº¸ã€‚ è‡³å°‘åœ¨å‡ºå‘æ—¶ï¼Œä»–æ˜¯è¿™ä¹ˆæƒ³çš„ã€‚ å½“ç„¶ï¼Œä¹Ÿæœ‰ä¸€ä¸æ‚²å£®ã€‚â€œå¸¦çš„èµ°çš„ç•™ä¸ä¸‹ï¼Œç•™ä¸ä¸‹çš„åˆ«ç‰µæŒ‚â€ï¼Œæˆ–è®¸ä½ æ²¡çœ‹æ‡‚ä»–å†³å®šçƒ§æ‰è‡ªå·±çš„æˆ¿å­çš„æ„ä¹‰ã€‚è¿™ä¸ªè¡ŒåŠ¨çš„å°è¯æ˜¯ï¼šæ··ä¸å¥½ï¼Œå°±åˆ«å›æ¥äº†ï¼Œè¦åƒå‡ºæµ·æå‡»é£æµªçš„çˆ¶äº²ä¸€æ ·ï¼Œè¦ä¹ˆè¡£é”¦è¿˜ä¹¡ï¼Œè¦ä¹ˆå®¢æ­»ä»–ä¹¡ã€‚ä»åæ¥èºèºè°ˆåˆ°ä¿¡ä»¶ä¸­çš„å†…å®¹å¯æ¨çŸ¥ï¼Œæµ©æ±‰æœ‰è½»å¾®çš„æ‹çˆ¶å€¾å‘ï¼Œæˆ–è€…è¯´ï¼Œå´‡æ‹œçˆ¶äº²ã€‚ æˆå‰§çš„æ˜¯ï¼Œçˆ†ç‚¸è¿‡åï¼Œæµ©æ±‰çš„æˆ¿å­æ²¡æœ‰å€’ã€‚åå€’æ˜¯èƒ¡ç”Ÿå’Œå‘¨æ²«çš„æˆ¿å­å€’ä¸‹äº†ï¼Œä»ã€Šåä¼šæ— æœŸã€‹æ›²å­æ”¾å‡ºæ˜¯æµ©æ±‰å®‰æ…°èƒ¡ç”Ÿçš„åŠ¨ä½œå¯ä½è¯èƒ¡ç”Ÿçš„æˆ¿å­å€’äº†ï¼Œåé¢å’Œå‘¨æ²«çš„å¯¹è¯å¯ä½è¯å‘¨æ²«çš„æˆ¿å­ä¹Ÿå€’äº†ï¼Œæ‰€ä»¥å‰©ä¸‹æ²¡å€’çš„ï¼Œæ˜¯æµ©æ±‰çš„æˆ¿å­ã€‚ç„¶è€Œæˆ¿å­å€’äº†çš„ï¼Œå‘¨æ²«å’Œèƒ¡ç”Ÿï¼Œå®‰ç„¶æ— æ™ã€‚æˆ¿å­æ²¡å€’çš„æµ©æ±‰ï¼Œå´çœŸçš„å®¢æ­»ä»–ä¹¡ã€‚è¿™æˆ¿å­èƒ½ç•™ä¸‹ï¼Œä¹Ÿç®—æ˜¯ä¸€ä¸ªå¿µæƒ³ã€‚ä¾›è‹¥å¹²å¹´åï¼Œèƒ¡ç”Ÿã€èºèºã€å‘¨æ²«å‡­åŠæ•…äººç½¢ã€‚è¿™æˆ–è®¸å¯ä»¥å¾®å¾®ç®—ä½œä¸ºæµ©æ±‰ä¹‹æ­»åŸ‹ä¸‹çš„ç¬¬ä¸€æ¡çº¿ã€‚ ç„¶åä¸‰äººä¸Šè·¯ã€‚ å‘¨æ²«ç¯‡å·²ç»åˆ†æäº†äºŒäººçš„æ„Ÿæƒ…ï¼Œå‘¨æ²«å…¶å®æ˜¯å–œæ¬¢æµ©æ±‰çš„ã€‚ç„¶è€Œæ­¤æ—¶æµ©æ±‰å¿ƒé‡Œåªæœ‰èºèºï¼Œä»–æ¥æ‰¾å‘¨æ²«çš„åŸå› ï¼Œä¸€æ˜¯å•çº¯çœ‹å‘¨æ²«ï¼Œå› ä¸ºä¸¤äººå„¿æ—¶æ„Ÿæƒ…å¥½ï¼ŒäºŒæ˜¯çœ‹å‘¨æ²«æ··å¾—å¥½ä¸å¥½ï¼Œèƒ½å¦æˆä¸ºä»–æŒ¯å…´å®¶ä¹¡æ—…æ¸¸ä¸šçš„åˆä½œä¼™ä¼´ã€‚ç„¶è€Œå‘¨æ²«åªæ˜¯ä¸ªæ›¿èº«å°æ¼”å‘˜ã€‚åœ¨å½±è§†åŸºåœ°çš„è·¯ä¸Šï¼Œæµ©æ±‰ä¼¼ä¹æœ‰ç§æ’®åˆå‘¨æ²«å’Œæ±Ÿæ²³çš„æ„æ€ï¼Œä»”ç»†çœ‹ä¼šå‘ç°ï¼Œæ±Ÿæ²³ä¸€ç›´å’Œå‘¨æ²«è°ˆè®ºäººç”Ÿï¼Œæµ©æ±‰ä¸€ç›´åœ¨å’Œèƒ¡ç”Ÿå˜»å˜»å“ˆå“ˆï¼Œè€Œé™¤éå‘¨æ²«ä¸»åŠ¨è¯¢é—®ï¼Œæµ©æ±‰ä¸ä¼šä¸»åŠ¨æŒ‘èµ·è¯é¢˜ã€‚åŸå› å¯èƒ½æœ‰äºŒï¼Œä¸€æ˜¯å¿ƒæ€€æ„§ç–šï¼ŒäºŒæ˜¯é¿å«Œä¸æƒ³è®©å‘¨æ²«æ—§æƒ…é‡ç‡ƒã€‚ åœ¨æ±Ÿæ²³è‹ç±³çº¿é‡Œï¼Œæµ©æ±‰åˆ™ç»§ç»­æ‰®æ¼”æ’®åˆçš„æœˆè€è§’è‰²ã€‚å› ä¸ºä»–çŸ¥é“æ±Ÿæ²³æœ¨è®·æ€ªå¼‚ï¼Œæ»¡å£è¯´æ•™æƒ¹äººåŒçƒ¦ï¼Œèƒ½è®©æ±Ÿæ²³äº§ç”Ÿçˆ±æ„å¹¶ä¸”ä¹Ÿå¯¹ä»–äº§ç”Ÿçˆ±æ„çš„å¥³ç”Ÿä¸å¤šã€‚æµ©æ±‰å¤„å¤„ä¸ºå…„å¼Ÿæ±Ÿæ²³æ‰“åœ†åœºï¼šâ€œä½†æˆ‘è¦è·Ÿä½ è¯´çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸¤ä¸ªéƒ½åœ¨å¸®ä½ ï¼Œå°¤å…¶æ˜¯æˆ‘æ—è¾¹è¿™ä½ã€‚â€ï¼Œâ€œä»æ¥ä¸çŸ¥é“æ›¿è‡ªå·±äº‰å–ä¸€ä¸‹â€(ä¸ºå…„å¼Ÿé¸£ä¸å¹³ï¼ŒåŒæ—¶æ¨é“ä¸æˆé’¢)ï¼Œåœ¨ç™½å®¢è¿‡æ¥å¯»äº‹æ—¶â€œä¼‘æƒ³åŠ¨æˆ‘æœ‹å‹â€ï¼Œå°å£°æé†’æ±Ÿæ²³â€œæ˜¨å¤©æ™šä¸Šè¿™æ˜¯ä¸ªå±€â€ï¼Œæ‹‰å¼€ç™½å®¢â€œè®©ä»–ä»¬èŠâ€ï¼Œåœ¨å®¾é¦†å‘ç°çš„å¯ç–‘è½¦è¾†è¿½æ¥æ—¶å¿«æ­¥èµ¶å›åŠ æ²¹ç«™ï¼Œåœ¨æ±Ÿæ²³åŠ äº†æŸ´æ²¹åä¹Ÿæ²¡æ€ä¹ˆå‘ç«ï¼Œç”šè‡³å¿«æ­¥èµ°ä¸Šä¸‰å”é¢å‰â€œä½ è¿™æ ·ä¸å¯¹å•Šâ€è¦ç»™â€œä¸‰å”ä¸€ä¸ªå¿ å‘Šâ€ï¼Œåªä¸ºäº†ç»™æ±Ÿæ²³ä¸è‹ç±³åšå–ä¸€ç‚¹æœºä¼šï¼Œé‚£åŠå¥è¢«ä¸‰å”å¿ å‘Šæ‰“æ–­çš„è¯éå¸¸ç›´ç™½â€œä½ æ€ä¹ˆè¯´æˆ‘éƒ½å¯ä»¥ï¼Œä½†æˆ‘æœ‹å‹â€¦â€¦â€â€¦â€¦åœ¨ä¸è‡ªå·±æ— å…³çš„è¿™æ¡çº¿é‡Œæµ©æ±‰ä»æ²¡é…±æ²¹ï¼Œè€ŒåŒºåˆ«äºæµ©æ±‰èºèºçº¿é‡Œï¼Œæ±Ÿæ²³çš„é…±æ²¹ã€‚å› ä¸ºæµ©æ±‰çŸ¥é“ï¼Œæ±Ÿæ²³è¿™å‚»å°å­ï¼Œæ ¹æœ¬ä¸æ‡‚å¥³äººã€‚ç„¶è€Œæµ©æ±‰è¿™æ ·æ·¡æ·¡çš„å…³æ€€ä»¥åŠåŒ…å®¹ï¼Œå´ä¸æ¯«æ²¡æœ‰ï¼Œå……æ–¥ç€ç°ä¸‹ä¸»æµä»·å€¼è§‚çš„åŸºæƒ…å››å°„ã€‚è€Œå°±æ˜¯è®©ä½ ç®€å•çš„æ„Ÿè§‰ï¼Œæ¥è‡ªå…„å¼Ÿçš„é‚£ä¸€ç‚¹æ”¯æŒã€‚è¿™åœ¨äºäºŒäººçš„æ¼”æŠ€å’Œè¯­è¨€åŠ¨ä½œçš„è®¾å®šã€‚ä½ å•çº¯åˆ†æä¸¤äººçš„äººè®¾ï¼Œä¸€ä¸ªè‡­å±ï¼Œä¸€ä¸ªé—·éªšï¼Œè¿™ç‰¹ä¹ˆä¸å°±æ˜¯æ ‡å‡†çš„æ”»å—äºŒäººç»„ä¹ˆï¼Œä½†ä½ ä»£å…¥ç”µå½±å»çœ‹ï¼Œä½ å°±ä¸å¾—ä¸ä½©æœå°è¯ã€åŠ¨ä½œã€æ¼”å‘˜å¯¹è§’è‰²çš„æ‹¿æçš„åŠŸåŠ›ï¼Œå› ä¸ºè¿™ä¹ˆæ”»å—çš„äººè®¾ï¼Œä½ å´èƒ½çœ‹å‡ºå¾®å¾®çš„å…„å¼Ÿæƒ…ã€‚ç„¶è€Œå…„å¼Ÿæƒ…ä¸å°±æ˜¯è¿™æ ·çš„ä¹ˆï¼Œä¸éœ€è¦å¤ªæµ“ï¼Œæˆ‘æ‡‚ä½ å°±å¥½ã€‚ ä¸‰å”è¿™ä¸ªäººéå¸¸ç»å…¸ï¼Œå¯è°“å¥å¥æˆè°¶ã€‚æ˜å¤©å•ç‹¬æ‹¿æ¥åˆ†æã€‚ä»–é‚£å¥â€œæˆ‘ä¸€æ—©çŸ¥é“ä½ ä¸æ˜¯å¥½äººï¼Œæ²¡æƒ³åˆ°è¿åäººéƒ½ä¸æ˜¯ï¼Œä½ è¿™æ ·æ€ä¹ˆåœ¨ç¤¾ä¼šä¸Šæ··å•Šã€‚â€å’Œâ€œæ±½æ²¹è½¦ä¸èƒ½åŠ æŸ´æ²¹ã€‚â€ç»å¯¹æ˜¯å¯¹è¿™ä¸€è·¯æ—…ç¨‹çš„æ³¨è§£ã€‚ ç„¶åæ˜¯æµ©æ±‰çš„å¤±è¯¯ï¼Œåœ¨å›ç­”ç”µå°ä¸»æŒäººâ€œæ˜¯æ™ºéšœå—ï¼Ÿâ€è¿™ä¸ªé—®é¢˜æ—¶ï¼Œç»™å‡ºäº†â€œå•Šï¼Œæ˜¯ã€‚â€çš„å›å¤ã€‚å¯¼è‡´èƒ¡ç”Ÿå› ä¸æ„¿æ„æ¥å—è¿™ä¸ªç§°å‘¼è€Œæ”¾å¼ƒä¸ç”µå°å–å¾—è”ç³»ï¼Œä»è€Œå›åˆ°ä¸œæå²›çš„ç»“å±€ã€‚ æ¥ä¸‹æ¥æ˜¯æµ©æ±‰æ»¡åœ°æ¡é’±çš„æƒ…èŠ‚ï¼Œè¿™å°±æ˜¯è½¬æŠ˜çš„åˆ†ç•Œç‚¹ã€‚ææ‰‹æœºçš„ä¸€ä¸ªæ„å¤–ï¼Œå¯¼è‡´é’±æ‰ï¼Œå¯¼è‡´æ™’é’±æ™’å¡ç‰‡ï¼Œå¯¼è‡´è½¦æŒ¡é£ç»ç’ƒè¢«å·å’Œå¡ç‰‡ä¸¢å¤±ï¼Œå¯¼è‡´ä¸¤äººè€½è¯¯è¡Œç¨‹é‡ä¸Šé˜¿å•ï¼Œå¯¼è‡´è½¦è¢«å·ï¼Œå¯¼è‡´æµ©æ±‰é”å˜ï¼Œå¯¼è‡´äºŒäººåˆ†åˆ«ï¼Œå¯¼è‡´æµ©æ±‰ä¹‹æ­»ã€‚å¡ç‰‡ä¸¢å¤±ï¼Œå¯¼è‡´æ±Ÿæ²³ä¸è‹ç±³å¤±è”ï¼Œé—´æ¥å¯¼è‡´æ±Ÿæ²³ä¹‹æ­»ã€‚è¿™ä¹ˆä¸€çœ‹ï¼Œè¿™ä¸ªå°ç»†èŠ‚çš„è®¾è®¡ï¼Œå…³ç³»åˆ°åé¢ä¸€ç³»åˆ—çš„å¤§äº‹ä»¶å‘ç”Ÿã€‚å¯æ€•çš„è´è¶æ•ˆåº”ã€‚ ä¸¤äººå¸¦ä¸Šå¤´ç›”ç»§ç»­ä¸Šè·¯ã€‚æ±Ÿæ²³æå‡ºå†™ã€Šæ—…è¡Œè€…ã€‹çš„æƒ³æ³•ã€‚è¿™æ—¶æœ‰ä¸€æ®µå¾ˆå…³é”®çš„å¯¹è¯ã€‚æµ©æ±‰ï¼šâ€œè®°å¾—ç»“å°¾çš„åœ°æ–¹æŠŠæˆ‘ç¾åŒ–ä¸€ä¸‹ã€‚â€æ±Ÿæ²³ï¼šâ€œä¸ï¼Œæµ©æ±‰ï¼Œé‚£ä¸ªä½å­ä¸æ˜¯ç•™ç»™ä½ çš„ï¼Œæœ‰å¾ˆå¤šè¯æˆ‘ä»¬åœ¨ç”Ÿæ´»é‡Œè¯´ä¸å‡ºå£ï¼Œæ‰€ä»¥åœ¨ä¹¦çš„ç»“å°¾ï¼Œæˆ‘è¦å¯¹è‹ç±³è¯´ï¼šâ€ç„¶åæ˜¯å°¼ç›ä¸€å¼ æŠ¥çº¸ã€‚è¿™é‡Œé€šè¿‡ã€Šæ—…è¡Œè€…ã€‹çš„æš—ç¤ºï¼Œè¡¨æ˜åœ¨æœ€åï¼Œä¹Ÿå°±æ˜¯ç»“å±€ï¼Œæµ©æ±‰ä¸ä¼šå‡ºç°ã€‚ç»“åˆæœ€åä¸€å¹•ï¼Œé‚£æ®µâ€œæœ€åä¸€é¢â€â€œæœ€åä¸€å¥â€ï¼Œå¯åŸºæœ¬æ¨çŸ¥ï¼Œæµ©æ±‰æ­»äº†ã€‚ä½è¯è§ä¸‹æ–‡ã€‚ å¤¹è›‹é‚£æ®µåˆå¾ˆæœ‰å¯“æ„ã€‚æˆ‘ä»¬ç”¨è‡ªå·±ä¹ æƒ¯çš„æ–¹å¼å»è¾¾æˆç›®æ ‡ï¼Œå‘ç°ç»“æœæ˜¯å„ç§å¤±è´¥ã€‚å½“æˆåŠŸè¿‘åœ¨å’«å°ºï¼Œå´åŠŸäºä¸€ç¯‘ã€‚ä½ æ¢ä¸€ç§æ–¹å¼è¾¾åˆ°ç›®æ ‡ï¼Œç„¶è€Œè¿™æ—¶å€™ä½ æ‰å‘ç°ï¼Œè¿™ç›®æ ‡æ—©å·²ä¸æ˜¯ä½ æƒ³è¦çš„äº†ã€‚è¿™æ¦‚æ‹¬è¿™æ®µæ—…ç¨‹çš„æ„ä¹‰ã€‚ä¸‰äººä»¥ä¹ æƒ¯çš„æ–¹å¼ä¸Šè·¯ï¼Œå´ä¸€è·¯å›§é€”ï¼Œå„ç§å¤±è´¥ã€‚åœ¨ç¦»ç›®çš„åœ°ä¸è¿œçš„åœ°æ–¹ï¼ŒåŠŸäºä¸€ç¯‘è½¦è¢«å¼€èµ°äº†ã€‚æ¢ä½œæ­¥è¡Œèµ°åˆ°ç›®çš„åœ°çš„æ—¶å€™ä¸¤äººå‘ç°ï¼Œå’Œå½“åˆå„è‡ªæƒ³è¦çš„ç›¸å»ç”šè¿œã€‚æ±Ÿæ²³æƒ³å»å…¥èŒï¼Œå¯å´å—é˜¿å•å½±å“ï¼Œäº§ç”Ÿäº†â€œæ¨ªç©¿æ•´ä¸ªä¸­å›½â€çš„è±ªè¿ˆã€‚æµ©æ±‰æƒ³å»æ¢å¯»å†’é™©çš„æ„ä¹‰å’Œæƒ…ä¹‰çš„ä»·å€¼ï¼Œä¸€è·¯èµ°æ¥ï¼Œä»–å‘å‡ºäº†â€œé‚£ä¹Ÿæ¯”æƒ…ä¹‰è¿™ä¸¤ä¸ªå­—å¯¿å‘½é•¿â€çš„æ„Ÿå¹ã€‚ä¸è¿‡ï¼Œè¿™éƒ½æ˜¯åè¯äº†ã€‚ æ¥ç€æ˜¯è®©æµ©æ±‰ä¸‰è§‚ç¬¬ä¸€æ¬¡å´©åçš„19å¹´æ¬ºéª—ï¼Œåœ¨èºèºç¯‡é‡ŒåŸºæœ¬åˆ†ææ¸…æ¥šäº†ã€‚æµ©æ±‰çš„å¯¹èºèºçš„æ‰€æœ‰æƒ…æ„Ÿï¼Œéƒ½è¢«èºèºä¸€å¥â€œå–œæ¬¢å°±æ˜¯æ”¾è‚†â€æ¦‚æ‹¬äº†ï¼Œè€Œèºèºå¯¹æµ©æ±‰çš„æ‰€æœ‰æƒ…æ„Ÿï¼Œéƒ½è¢«èºèºä¸€å¥â€œå¸¦çˆ±å°±æ˜¯å…‹åˆ¶â€æ¦‚æ‹¬äº†ã€‚æµ©æ±‰è¿˜èƒ½è¯´ä»€ä¹ˆï¼Œåªèƒ½å°†æ”¾è‚†å…‹åˆ¶ï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªæ–°çš„ç¯å¢ƒï¼Œæ–°çš„å¿ƒæƒ…ã€‚ç¦»å¼€ã€‚èºèºçš„ç¦»å»ï¼Œæµ©æ±‰çš„ç¬¬ä¸€æ ¹æ”¯æŸ±å€’å¡Œã€‚ åœ¨è¿™é‡Œé¡ºè·¯æä¸€ä¸‹æµ©æ±‰çš„çˆ¶äº²ï¼Œâ€œå¸¦çš„èµ°çš„ç•™ä¸ä¸‹ï¼Œç•™ä¸ä¸‹çš„åˆ«ç‰µæŒ‚â€ï¼Œè¿™æ­£æ˜¯æµ©æ±‰çˆ¶äº²çš„å†™ç…§ï¼Œä»–å¸¦æµ©æ±‰æ¥åˆ°äº†ä¸œæå²›ï¼Œå´æ²¡èƒ½æŠŠæµ©æ±‰ç•™åœ¨èº«è¾¹ï¼Œæ‰€ä»¥æµ©æ±‰çˆ¶äº²ç¦»å¼€çš„æ—¶å€™ï¼Œèµ·åˆçš„æ‰“ç®—ä¸€å®šæ˜¯ä¸å†ç‰µæŒ‚æµ©æ±‰ã€‚ç„¶è€Œé‚£æ˜¯ä»–äº²ç”Ÿçš„å„¿å­ï¼Œæ€ä¹ˆèƒ½ä¸ç‰µæŒ‚ã€‚å­å¦‚çˆ¶ï¼Œä¸¤äººè™½ç„¶è¡¨é¢çœ‹ä¼¼æ´’è„±ï¼Œä½†å´éƒ½ä¸èƒ½åšåˆ°çœŸæ­£æ´’è„±ï¼Œå› ä¸ºæ­¤æ—¶æµ©æ±‰å¿ƒä¸­ï¼Œå°šæœ‰ã€æƒ…ä¹‰ã€‘äºŒå­—ç‰µç»Šã€‚ å½“æµ©æ±‰çŸ¥é“çˆ¶äº²å±…ç„¶æ˜¯è¿™æ ·ä¸€ä¸ªäººçš„æ—¶å€™ï¼Œç¬¬äºŒæ ¹æ”¯æŸ±å€’å¡Œã€‚å„¿æ—¶åšæŒçš„ï¼Œå´‡æ‹œçš„éƒ½æ˜¯å‡çš„è™šæ— çš„ï¼Œæ²¡æœ‰æå‡»é£æµªï¼Œåªæœ‰æ­»çš„çªå›Šã€‚ ä¹‹åæµ©æ±‰å¿ƒæƒ…ä½è½ï¼Œåœ¨æµ©æ±‰è®¡åˆ’çš„è¡Œç¨‹é‡Œï¼Œåœ¨ä»–æ²¡æŠŠæ¡çš„å‘¨æ²«å’Œæœ‰æŠŠæ¡çš„èºèºé‚£é‡Œï¼Œä»–éƒ½æ²¡æœ‰æ‰¾çš„ä»–æƒ³è¦çš„â€”ã€äº‹ä¸šã€‘å’Œã€æƒ…ä¹‰ã€‘ã€‚ä¸è¿‡æƒ³åˆ°æœªçŸ¥çš„è¿œæ–¹ï¼Œä»–åˆæ‚„æ‚„é¼“èµ·å‹‡æ°”ï¼Œå› ä¸ºä»–é™¤äº†ç›¸ä¿¡ä¸€å®šæœ‰è®©ä»–ä¸ºè¿™æ®µæ—…é€”çš„æ„ä¹‰ä½œæ³¨è§£çš„äººå’Œäº‹å‡ºç°ï¼Œå¯¹æ±Ÿæ²³çš„è¯¢é—®ï¼Œä»–åªæ˜¯æªå¡äº†ä¸€å¥â€œæ²¡äº‹ï¼Œè¿˜æ˜¯é€ä½ å»å…¥èŒè¦ç´§â€ã€‚è¿™å’Œä¹‹å‰â€œä½ å°±ç­‰ç€çœ‹å¥½æˆå§â€çš„èƒ¸æœ‰æˆç«¹å½¢æˆå·¨å¤§åå·®ã€‚æ„åœ¨ç‚¹åç»è¿‡æ­¤äº‹ï¼Œæµ©æ±‰å…ƒæ°”å¤§ä¼¤ï¼Œä½ çœ‹ï¼Œè¿™æ—¶çš„ä»–æ—©æ²¡æœ‰æˆ‘çš„æœ‹å‹æ»¡åœ°æ˜¯çš„è‡­å±å¾—æ„äº†ã€‚ æ‰€ä»¥è¿™æ—¶å€™ä»–å¸®æ±Ÿæ²³æƒ³äº†ä¸€ä¸ªç»“å°¾ï¼Œå°±æ˜¯ç”µå½±æœ€åçš„é‚£æ®µç»“å°¾ï¼Œæµ©æ±‰ç”¨æ¥ç”¨ä»¥è‡ªæˆ‘å®‰æ…°ï¼Œå´æ²¡æƒ³åˆ°è®©æ‰€æœ‰äººä¸ºè¿™å¥è¯åšäº†æ³¨è§£ã€‚ç”µå½±æ­¤æ—¶çš„åœºæ™¯ï¼Œå’Œç”µå½±ç»“å°¾çš„åœºæ™¯å®Œå…¨ä¸€è‡´ã€‚å¯æ–­å®šæ•…äº‹ç»“å°¾æ˜¯ä»è¿™é‡Œå‰ªå‡ºå»çš„ã€‚ï¼ˆæ¥¼ä¸»ä¹±å…¥ä¸€ä¸‹ï¼Œå…¶å®ä¸¤å¹•åœºæ™¯å¹¶ä¸ç›¸åŒï¼Œæœ€åçš„æ—¶å€™è½¦å¤–é£˜ç€å°é›ªï¼Œè€Œæ­¤æ—¶çš„åœºæ™¯æ²¡æœ‰ï¼Œæ‰€ä»¥å¿…ç„¶å…¶ä¸­ä¸€ä¸ªæ˜¯ç°å®ï¼Œå¦ä¸€ä¸ªæ˜¯å°è¯´ä¸­ï¼‰è¿˜æœ‰ä¸€ä¸ªè¯æ®å°±æ˜¯ã€Šå¥³å„¿æƒ…ã€‹è¿™é¦–æ­Œçš„ç”Ÿç¡¬æ’å…¥ï¼Œå°±åƒæ˜¯æ‰“æ–­åœºæ™¯ä¸€æ ·ã€‚è¿™æ˜¯ç”µå½±å™äº‹çš„æœ‰æ„ä¸ºä¹‹ã€‚ ã€Šå¥³å„¿æƒ…ã€‹è¿™é¦–æ­Œçš„æ’å…¥å…¶å®ä¹Ÿæ˜¯æœ‰æ·±æ„çš„ï¼Œåœ¨äººç‰©åˆ†æç¯‡ä¹‹åçš„bgmå’Œæ­Œæ›²åˆ†æç¯‡é‡Œï¼Œæˆ‘å°†ä¸€ä¸€é©³æ–¥æ‰€è°“çš„â€œbgmä¹±å…¥è¯´â€å’Œâ€œæŠ„è¢­éŸ³ä¹è£ç¼éƒ­æ•¬æ˜MVè¯´â€ã€‚ åœ¨ã€Šå¥³å„¿æƒ…ã€‹çš„è¿›ç¨‹ä¸­ï¼Œå¸æœºæ¢æˆäº†æ±Ÿæ²³ã€‚è€Œåæµ©æ±‰ä¸ºäº†ç»™è‡ªå·±æ‰“æ°”å”±èµ·äº†æ­Œï¼Œç»“æœé©¬è¾¾å‡ºåœºã€‚ è‡³äºé©¬è¾¾çš„æ„ä¹‰ï¼Œå·²åœ¨æ±Ÿæ²³ç¯‡åšäº†è¯´æ˜ï¼Œä¸å†èµ˜è¿°ã€‚ä»äºŒäººæ”¶ç•™é©¬è¾¾æ—¶ï¼Œé©¬è¾¾å°±æ³¨å®šé€‰æ±Ÿæ²³ï¼Œå› ä¸ºä½ æƒ³æƒ³çœ‹ï¼Œé©¬è¾¾æ˜¯æ€ä¹ˆé†’æ¥çš„ï¼Ÿæµ©æ±‰ä¸€å·´æŒæ‰‡é†’çš„ã€‚æˆ‘ä¸çŸ¥é“ç‹—è®°ä¸è®°ä»‡ï¼Œåæ­£å¦‚æœé»‘è¿™éƒ¨ç”µå½±çš„äººè¢«é†é†çŒé¡¶çš„æ‰‡äº†ä¸€å·´æŒï¼Œä»–ä»¬è‚¯å®šè®°ä»‡ã€‚ å¸¦é©¬è¾¾ä¸Šè·¯çš„æ—¶å€™ï¼Œä½ å·²ç»èƒ½æ˜æ˜¾æ„Ÿè§‰åˆ°æµ©æ±‰çš„æ— åŠ›æ„Ÿï¼šâ€œè¿å®¶ä¹¡éƒ½æ²¡äº†ï¼Œå“ªæ¥çš„ä»€ä¹ˆå®¶é—¨ï¼Œæˆ‘ä»¬è·Ÿé‡äººæœ‰ä»€ä¹ˆåŒºåˆ«ã€‚â€ä¹‹åæ˜¯æ›´å¤§çš„è¿·èŒ«ï¼Œä»–ä»¬è¿›äº†è¿·å®«ï¼Œâ€œä½ ç¡®å®šæ˜¯è¿™æ¡è·¯å—ï¼Ÿâ€ï¼Œâ€œæˆ‘ä»¬æ˜¯ä¸æ˜¯æ¥è¿‡è¿™é‡Œå•Šï¼Ÿâ€ã€‚è¿™é‡Œæ±Ÿæ²³é—®æµ©æ±‰ï¼Œå…¶å®éƒ½æ˜¯åœ¨æ‰“è‡ªå·±çš„è„¸ã€‚å¤§å®¶è¿˜è®°å¾—æ±Ÿæ²³å‡ºå‘å‰å¯¹èƒ¡ç”Ÿè¯´è¿‡ä»€ä¹ˆå—ï¼Ÿâ€œè‡³äºå…¶ä»–çš„ï¼Œæˆ‘éƒ½å®‰æ’å¥½äº†ã€‚â€ä½ çœ‹æ±Ÿæ²³æ˜¯åœ°ç†è€å¸ˆï¼Œä»–èƒ½å‡†ç¡®çš„è¯´å‡ºnt3m5pçš„å«ä¹‰ï¼Œç„¶è€Œè®©ä»–çœŸæ­£èµ°åœ¨è·¯ä¸Šï¼Œä»–å´åªèƒ½ä¸æ–­è¯¢é—®æµ©æ±‰è·¯èµ°å¯¹äº†æ²¡ã€‚ç„¶è€Œæµ©æ±‰å˜´ä¸Šä¸€ç›´è¯´â€œç¡®å®šâ€ï¼Œä½†äºŒäººå§‹ç»ˆåœ¨è¿·å®«é‡Œæ‰“è½¬ã€‚å…¶å®å°±æ˜¯åœ¨è¯´æ˜ï¼Œåœ¨äººç”Ÿæ—…é€”ä¸­ï¼Œæ±Ÿæ²³æµ©æ±‰è¿·å¤±äº†ï¼Œæ±Ÿæ²³çš„ç™¾ç§‘å…¨ä¹¦åœ¨ç°å®é¢å‰æ¯«æ— ç”¨åœºï¼Œæµ©æ±‰å¼€ç€è½¦åŸåœ°æ‰“åœˆåœˆï¼Œè¿˜ä¸æ‰¿è®¤è‡ªå·±è¿·å¤±ã€‚æƒ…èŠ‚è¿™ä¸ªæ—¶å€™å°±æ˜¯åœ¨æ”’å¤§æ‹›ï¼Œè®©äºŒäººä¸€ç›´æ‰è¡€ã€æ‰è¡€ã€æ‰è¡€ï¼Œåªä¸ºäº†æ§½æ»¡æ†‹ä¸€ä¸ªäººçš„ä¸Šçº¿ï¼Œå¸¦äºŒäººèµ°å‡ºè¿·èŒ«ã€‚ äºæ˜¯é˜¿å•åº”è¿è€Œç”Ÿã€‚è¿™ä¸ªäººå°±æ˜¯ä¸ºäº†è®©æ±Ÿæ²³æµ©æ±‰ä»â€œå¤±è½å¤±æœ›å¤±æ‰æ‰€æœ‰æ–¹å‘â€ä¸­æŒ£æ‰å‡ºæ¥çš„ç¥ä¸€èˆ¬çš„â€œéª—å­â€ã€‚è¿™ä¸ªè§’è‰²è®¾å®šçš„ææ€–å°±åœ¨äºï¼Œä»–è®©äºŒäººæ²¡æœ‰çœ‹åˆ°â€œçœ‹è§å¹³å‡¡æ‰æ˜¯å”¯ä¸€çš„è·¯â€ï¼Œè€Œæ˜¯æŠŠäºŒäººå¸¦åˆ°å·¨å¤§çš„ç²¾ç¥ç‹‚çƒ­ä¸­ï¼Œç„¶åä¸€éª‘ç»å°˜ã€‚ä½ çœ‹ï¼Œèµ°å‘å¹³å‡¡ä¹‹è·¯çš„äººéƒ½ä¼šæ´»å¾—å¥½å¥½çš„ï¼šå‘¨æ²«ã€èƒ¡ç”Ÿã€è‹ç±³ã€èºèºã€‚é˜¿å•å¸¦ç€æ±Ÿæ²³æµ©æ±‰éè¦åœ¨è¿™ä¹ˆä¸€æ¡å¹³å‡¡ä¹‹è·¯ä¸Šå¦è¾Ÿè¹Šå¾„ï¼Œä»€ä¹ˆå«æ˜Ÿå•Šï¼Œä¸€å·å•Šç¯ä¸­å›½å•Šä¹‹ç±»è™šæ— ç¼¥ç¼ˆçš„ï¼Œç»“æœè¿™ä¸‰ä¸ªäººï¼Œå°‘è¯´ç”Ÿæ­»æœªåœï¼ŒæŒ‰æˆ‘çš„çœ‹æ³•ï¼Œå¯¼æ¼”ç¼–è¾‘å°±æ˜¯æŠŠä»–ä»¬å¾€æ­»é‡Œå†™çš„ã€‚ ä¸ºä»€ä¹ˆã€‚ä½ ä»¬è¯´ï¼Œè¿™ä¸ªä¸–ç•Œï¼Œéœ€è¦é˜¿å•è¿™æ ·ç†æƒ³ä¸»ä¹‰å’Œæµªæ¼«ä¸»ä¹‰ä¹ˆï¼Ÿé˜¿å•å°±æ˜¯å¸¦ä»–ä»¬ä¸Šè·¯ï¼Œå¯æƒœå´æŠŠä»–ä»¬ä¸¢åœ¨åŠè·¯ï¼Œäºæ˜¯æ±Ÿæ²³æµ©æ±‰é™·å…¥äº†æ›´å¤§çš„å±æœºä¹‹ä¸­ï¼Œå°±æ˜¯æ‰€è°“çš„ä¿¡ä»°ç¼ºå¤±ã€‚è¿™éƒ¨ç”µå½±æœ¬èº«å°±æ˜¯åœ¨è‡ªå˜²ã€‚ å¥½äº†å…³äºä¸»é¢˜çš„è®¨è®ºæ—¥ååˆ†æã€‚ä»Šå¤©è¿™ç« çš„é‡ç‚¹åœ¨äººç‰©ï¼Œæˆ‘ä»¬ç»§ç»­ã€‚ å¾ˆæ˜æ˜¾ï¼Œæµ©æ±‰æ˜¯ä¸å–œæ¬¢è®©é˜¿å•åŒè¡Œçš„ã€‚ä½†é˜Ÿå‹é€äººå¤´ï¼Œæ²¡åŠæ³•ï¼Œé˜¿å•ä¸Šè½¦äº†ã€‚æµ©æ±‰å¼€å§‹å¼€å§‹ç§ä¸èµ·é˜¿å•çš„ï¼Œå› ä¸ºæˆ‘æœ‰è½¦ä½ æ²¡æœ‰ï¼Œæ‰€ä»¥ä»–è¯´â€œ14ä¸‡å…¬é‡Œç®—ä¸äº†ä»€ä¹ˆã€‚â€éšåï¼Œçš„è¿™ä¸ªå›ç­”ï¼Œè®©é˜¿å•ä¸€åº¦æˆä¸ºæ—…é€”çš„æŒæ§è€…ï¼šâ€œæˆ‘ä¸ºçš„æ˜¯è‡ªç”±ï¼Œè€Œä½ å´æ˜¯ä¸ºäº†ç”Ÿæ´»ã€‚â€è¿™ä¸€å¥ï¼Œè®©é˜¿å•é€¼æ ¼æˆ–è€…æƒ…æ€€ç«‹é©¬çˆ†æ£šã€‚åä¸ªæ§½ï¼Œè¿™å¥è¯çš„å¥å¼æ€ä¹ˆé‚£ä¹ˆåƒè‹è€å¸ˆçš„æŸå¥åè¨€å•Šã€‚æ­¤æ—¶æµ©æ±‰ä¾æ—§ä¸ä¾ä¸é¥¶ï¼Œé€¼é—®ä¹‹ä¸‹ï¼Œé˜¿å•è¯´å‡ºäº†æ‘©æ‰˜è½¦è¢«å·çš„çª˜å¢ƒã€‚è¯´çš„æ—¶å€™é˜¿å•è¿Ÿç–‘äº†ä¸€ä¸‹ï¼Œä¸çŸ¥é“æ˜¯ä¸å¥½æ„æ€ï¼Œè¿˜æ˜¯æœ‰æ‰€éšç’ã€‚ä¼°è®¡ä¸¤ç§è§£é‡Šéƒ½æœ‰é“ç†ã€‚å¯¹é˜¿å•çš„è§£è¯»ä¸€ç›´æ˜¯åŒçº¿å¹¶ä¸”äº’ä¸å†²çªçš„ï¼Œä½ å¯ä»¥è®¤ä¸ºé˜¿å•ä¸€ç›´è¯´çœŸè¯ï¼Œä¹Ÿå¯ä»¥è®¤ä¸ºä»–ä¸€ç›´è¯´å‡è¯ï¼Œä¹Ÿå¯ä»¥è®¤ä¸ºä»–ä¸€ä¼šè¯´çœŸè¯ä¸€ä¼šè¯´å‡è¯ã€‚åœ¨æ²¡æœ‰è‚¯å®šè¯æ®å’Œå®Œå–„æƒ³æ³•å‰ï¼Œä¸ªäººå€¾å‘æ˜¯é˜¿å•ä¸€ç›´è¯´çœŸè¯ï¼ŒåŠå¤œåœ¨è¡Œç¨‹ä¸Šä¸æ±Ÿæ²³äº§ç”ŸçŸ›ç›¾ï¼Œç„¶åå†³å®šå·è½¦å®Œæˆæ‰€è°“çš„ç†æƒ³ã€‚ è¿™é‡Œæœ‰ä¸ªåœ°æ–¹å…¶å®åœ¨å°è¯å…¶å®é˜¿å•è¯´çš„ä¸å…¨æ˜¯çœŸè¯ã€‚è¿‡éš§é“çš„æ—¶å€™ï¼Œé«˜å‘¼â€œæˆ‘ä¸åœ¨ä¹â€ï¼Œç„¶è€Œä»–æ ¹æœ¬ä¸çŸ¥é“è¿™ä¸ªéš§é“æœ‰å¤šé•¿ã€‚äºæ˜¯è¶Šè¿‡éš§é“åï¼Œç¼ºæ°§çš„ä»–è¯´äº†å¥ï¼šâ€œè¿™éš§é“æ€ä¹ˆè¿™ä¹ˆé•¿ã€‚â€è¯´æ˜ï¼Œå¯¹è¿™æ®µè·‘äº†6éçš„è·¯ï¼Œä»–ç¡®å®ä¸å¤ªç†Ÿæ‚‰ã€‚ä¹‹ååªå¬åˆ°æµ©æ±‰çš„ä¸€å¥è‹±æ–‡ï¼Œå°±è‡ªä¿¡æ–­å®šæµ©æ±‰æ˜¯æ•™ä¹¦çš„ï¼Œâ€œæˆ‘æ‚¬å´–éƒ½æ‘”è¿‡å¥½å‡ æ¬¡ï¼Œä¸€èˆ¬äººçš„èŒä¸šï¼Œæˆ‘ä¸€çœ¼å°±èƒ½çœ‹å‡ºæ¥â€ï¼Œè¿™å¥æ‰“è„¸ä¹Ÿèƒ½çœ‹å‡ºä»–å¹¶ä¸æ˜¯é‚£ä¹ˆçš„ç¥ã€‚ ä½†æ˜¯è¿™å¹¶ä¸å¦¨ç¢æµ©æ±‰çš„æ”¹å˜ã€‚å› ä¸ºé˜¿å•çš„å‡ºç°ï¼Œä»–å¼€å§‹å¯¹æ—…é€”é‡æ‹¾ä¿¡å¿ƒã€‚åŸå› æ˜¯ï¼Œä»–ä»¬åœ¨é˜¿å•çš„å¸¦é¢†ä¸‹æ‰¾åˆ°äº†è·¯ï¼Œæ³¨æ„è·¯æ˜¯åŒé‡å«ä¹‰ï¼Œåœ°ç†æ„ä¹‰å’Œäººç”Ÿæ„ä¹‰ä¸Šçš„ã€‚æµ©æ±‰ç”šè‡³åœ¨å°è§£åå¯¹é˜¿å•è¯´å‡ºäº†è¦å’Œä»–ä¸€èµ·éª‘æ‘©æ‰˜è½¦å›åˆ°ä¸œæå²›ä¸Šçš„æƒ³æ³•ã€‚â€œæ”¾å¿ƒå§ï¼Œæ˜å¤©ç­‰æˆ‘æŠŠæœ‹å‹é€åˆ°ç›®çš„åœ°ï¼Œæˆ‘ä»¬å°±éª‘æ‘©æ‰˜è½¦å›å»ã€‚â€æµ©æ±‰è¿™ä¹ˆè¯´ï¼Œå¯æ¨æµ‹ï¼Œä»–çš„è®¡åˆ’å°±è¯¥æ˜¯é€æ±Ÿæ²³åˆ°ç«™ï¼Œå–è½¦ä¹°æ‘©æ‰˜ï¼Œå’Œé˜¿å•ä¸€èµ·åšä¸€ä¸ªâ€œä¼Ÿå¤§çš„éª‘å£«â€ï¼Œæ‹ç…§ç‰‡ï¼Œå†™ç¨¿ä»¶ï¼Œè®©äººä»¬è®¤è¯†ä¸œæå²›ï¼Œè¿™æ ·å®¶ä¹¡çš„æ—…æ¸¸ä¸šå°±å¯ä»¥æŒ¯å…´äº†ã€‚ ä»æ­¤åˆ»èµ·ï¼Œæµ©æ±‰æ»¡è¡€å¤æ´»ã€‚ä½†è¿™æ¬¡çš„å¤æ´»ï¼Œå´æ˜¯ä¸ºæ®’å‘½åšé“ºå«ã€‚ åœ¨ç”µå°é‡Œï¼Œæœ‰ä¸ªè€å¥³äººé—®å¤§å¤«ç”·æ ¹å›ºæœ¬ä¸¸çš„äº‹ï¼Œæˆ‘æ›¾ç»ä¸€åº¦å°†ä¹‹ä¸é˜¿å•çš„é‚£å¥å‘½æ ¹å­è‚¯å®šç¡¬è”ç³»èµ·æ¥ï¼Œè®¤ä¸ºè¿™å¥³çš„æ˜¯é˜¿å•çš„å¤«äººã€‚ä½†é˜¿å•å¸®äºŒäººèµ°å‡ºäº†äº¤è­¦æ£€æŸ¥çš„å›°å¢ƒï¼Œè¿™è¯´æ˜é˜¿å•è·Ÿè¿™ä¸€å¸¦çš„äº¤è­¦å¾ˆç†Ÿï¼Œäºæ˜¯æˆ‘æ”¾å¼ƒäº†è¿™æ ·çš„åˆ†æã€‚è¦çŸ¥é“ï¼Œæµ©æ±‰å¼€çš„å¯æ˜¯æ— ç…§è½¦ï¼Œä¸€è·¯æ²¡èµ°è¿‡è½¦å¤šçš„è·¯ã€‚ æ¥ç€é˜¿å•ç»™æµ©æ±‰å’Œæ±Ÿæ²³è®²è¿°äº†åŒå­¦ä¼šå’Œè€å©†çš„æ•…äº‹ã€‚ç„¶åæµ©æ±‰å‘ç°ï¼Œè¿™ä¸ªäººå’Œè‡ªå·±æ˜¯å¤šä¹ˆæƒŠäººçš„ç›¸ä¼¼ï¼Œé˜¿å•çš„åŒå­¦ä¼šå’Œæµ©æ±‰çš„ä¸Šå°ä¸‹ä¸äº†å°ä¸è¿‡æ˜¯ä¸€ä¸ªæ•…äº‹çš„ä¸¤ä¸ªè®²æ³•è€Œå·²ï¼Œä½ å¤§å£°ç–¾å‘¼ï¼Œç»“æœæ˜¯ï¼Œæ ¹æœ¬æ²¡äººé¸Ÿä½ ã€‚æµ©æ±‰å°±æ˜¯é‚£ä¸ªæƒ³è¯æ˜ç»™ä¸€ä¸‡ä¸ªäººçœ‹çš„äººï¼Œç»“æœï¼ŒçœŸçš„åªæœ‰ä¸€ä¸ªäººæ‡‚ã€‚è€Œé‚£ä¸ªäººæ˜¯èƒ¡ç”Ÿã€‚ æ¥ç€æ˜¯é‚£æ®µnt3m5pã€‚è¿™ç©æ„æˆ‘åæ­£æ˜¯æ²¡ç™¾åº¦åˆ°ï¼Œä½†æ˜¯ç¡®å®æœ‰ç‚¹ç¥ï¼Œä½ æƒ³ï¼ŒèŠ¬å…°å«æ˜Ÿï¼Œå°åº¦å‘å°„ï¼Œè¿½èµ¶æ—…è¡Œè€…1å·ã€‚äº§åœ°ï¼Œå‘å°„åœ°ï¼Œç›®çš„åœ°çš„è”ç³»å¤ªå¾®å¼±äº†ã€‚æˆ–è®¸å†å²ä¸ŠçœŸçš„æœ‰ï¼Œæ•æˆ‘å­¤é™‹å¯¡é—»ã€‚å¯¹è¿™ç‚¹ï¼Œåšä¸ªæ ‡è®°ã€‚ç•™å¾…ä¹‹åæŸ¥è¯ã€‚è¿™ä¸ªæ™šä¸Šå¯¹ä¸»çº¿æ„æˆå½±å“çš„æ˜¯ä¸¤ä»¶äº‹ï¼Œæ—§çŸ›ç›¾çš„è§£å†³å’Œæ–°çŸ›ç›¾çš„äº§ç”Ÿã€‚æ—§çŸ›ç›¾æ˜¯å¤´ç›”äº‹ä»¶ï¼Œè¢«nt3m5pè§£å†³ã€‚æ–°çŸ›ç›¾æ˜¯è¡Œç¨‹å®‰æ’ï¼Œæ±Ÿæ²³é«˜å‘¼ï¼Œâ€œå¯æ˜¯æˆ‘æ˜å¤©è¦å…¥èŒè¯¶â€ï¼Œé˜¿å•æ ¹æœ¬ä¸é¸Ÿï¼Œâ€œæˆ‘è€å©†å¦‚æœèƒ½çœ‹åˆ°nt3m5på‘å°„ï¼Œä¸€å®šå¾ˆé«˜å…´â€ã€‚è½¦ä¸»æµ©æ±‰çš„å›ç­”å…¶å®å¾ˆæ˜ç¡®ï¼Œä¸çœ‹å«æ˜Ÿï¼Œé€æ±Ÿæ²³å…¥èŒï¼Œâ€œæˆ‘æ¢å¤å¾—å¾ˆå¿«ï¼Œç”·äººå˜›ï¼Œä¸è¦ä¸ºå„¿å¥³æƒ…é•¿çš„äº‹æƒ…æ‰€ç‰µç»Šï¼Œæœ€é‡è¦çš„æ˜¯äº‹ä¸šã€‚â€è¿™å°±æ˜¯åœ¨å‘Šè¯‰é˜¿å•ï¼Œåˆ«æƒ³ä½ è€å©†çš„äº‹äº†ï¼Œæ­ç€æˆ‘çš„è½¦ï¼Œè¦å¬æˆ‘çš„è¯ã€‚è¿™ä¸ªçŸ›ç›¾ç›´æ¥å¯¼è‡´äº†å·è½¦äº‹ä»¶ã€‚é˜¿å•ä¹Ÿç»™äº†äºŒäººç­”å¤ï¼šâ€œä»Šå¤©æ˜¯æ—…è¡Œè€…1å·ï¼Œå†²ç ´å¤ªé˜³ç³»ï¼Œè¿›å…¥æµ©ç€šå®‡å®™çš„æ—¥å­ã€‚â€â€œä»–è¿™æ ·åœ¨å¤ªç©ºå­¤ç‹¬çš„æ¼‚æµï¼Œåªä¸ºäº†è¿™æ ·ä¸€ä¸ªç®€å•çš„ç†ç”±ï¼Œå°±æ˜¯è¦åˆ°å¤–é¢çš„ä¸–ç•Œçœ‹ä¸€çœ¼â€æ‰€ä»¥ï¼Œæˆ‘ï¼Œå•è¡Œè€…2å·æ˜¯ä¸€å®šè¦å»çœ‹ä¸€çœ‹çš„ï¼Œä½ ä»¬è¿™äº›èœé¸Ÿï¼ŒæŒ¡ä¸ä½æˆ‘çš„ã€‚è¿™è¯é‡Œçš„æ·±æ„ï¼Œæµ©æ±‰æ˜¾ç„¶æ²¡å¬æ‡‚ã€‚ é˜¿å•è¿˜æœ‰ä¸€å¥æ˜¯è¯´ç»™æ±Ÿæ²³çš„â€œæœ‰äº›äººï¼Œä¸€è¾ˆå­åªèœ·åœ¨ä¸€ä¸ªè§’è½é‡Œï¼Œè¿çª—æˆ·éƒ½æ‡’å¾—å¼€ï¼Œæ›´åˆ«è¯´è¸å‡ºé—¨â€ã€‚æ­¤æ—¶éŸ³ä¹èµ°èµ·ï¼Œå¤©å…‰å¾®é†’ã€‚è¿™å¥è¯ç®—æ˜¯ç‚¹é†’äº†æ±Ÿæ²³ï¼Œè¿™ä¹Ÿå¯èƒ½æ˜¯æ±Ÿæ²³ä¸ºä»€ä¹ˆæ±Ÿæ²³ä¸€ç›´æ›¿é˜¿å•è¯´å¥½è¯çš„ä¸€ä¸ªåŸå› å§ã€‚ ç„¶åæ˜¯çŒ«ç‹—äººä¹‹æ­»ï¼Œå·²åˆ†æè¿‡ä¸èµ˜è¿°ã€‚ å¦‚æœä½ å¯¹åŠå¤œçš„çŸ›ç›¾æœ‰é¢„è®¾ï¼Œé˜¿å•æ¥ä¸‹æ¥çš„å·è½¦è®¡åˆ’å°±ç‰¹åˆ«æ˜æ˜¾äº†ã€‚å…ˆè®©äºŒäººä¼‘æ¯ä¸€ä¸‹ï¼Œè‡ªå·±å»è¯•è½¦ï¼Œè¯•äº†ä¸€ä¸‹ï¼Œæµ©æ±‰æ²¡å¯Ÿè§‰ï¼Œä»–å°±å¼€èµ°äº†ã€‚ä¸­é€”æ”¾ä¸‹ç…§ç‰‡ï¼Œé©¬è¾¾å’Œè¡Œæã€‚ä»–è¿˜ä¸æƒ³å®³æ­»ä¸¤äººã€‚ äºæ˜¯æµ©æ±‰å½“ç€æ±Ÿæ²³çš„é¢ï¼Œåˆä¸€æ¬¡é‡å¤äº†å¼€å¤´çš„æ‰“è„¸ç”»é¢ï¼Œå¨é£å‡›å‡›çš„è·‘ä¸Šå°ï¼Œé«˜å‘¼ç€è‡ªå·±ä¸æ€•ä¸‹ä¸äº†å°ï¼Œè¯´ç€è·¯é¥çŸ¥é©¬åŠ›æ—¥ä¹…è§äººå¿ƒçš„è±ªè¨€ï¼Œçœ‹ç€è¯ç­’æ²¡å£°â€”â€”è½¦è¢«å¼€èµ°ï¼Œä¸€å¥è¯éƒ½è¯´ä¸å‡ºæ¥ã€‚ è‡ªæ­¤æ»¡è¡€æµ©æ±‰å›åˆ°æ¿’æ­»çŠ¶æ€ã€‚è‡ªå·±åœ¨æ—…é€”ä¸­å»ºç«‹èµ·æ¥çš„ç¬¬ä¸‰æ ¹æ”¯æŸ±å€’å¡Œã€‚è½¦æ¢æ‘©æ‰˜çš„éª‘å£«äº‹ä¸šï¼Œå’Œåˆšåˆšå»ºç«‹èµ·ä¿¡ä»»çš„æƒ…ä¹‰é¡·åˆ»é—´åŒ–ä¸ºä¹Œæœ‰ã€‚è¦æ³¨æ„ï¼Œæµ©æ±‰ä¸€ç›´åœ¨å¼ºè°ƒçš„ä¸¤ä¸ªä¸œè¥¿ï¼Œäº‹ä¸šå’Œæƒ…ä¹‰ã€‚ç°åœ¨éƒ½æ²¡äº†ã€‚æ´»ç€å¯¹ä»–è€Œè¨€çš„æ„ä¹‰ï¼Œåªå‰©ä¸‹ä¸€ä¸ªï¼Œé€æ±Ÿæ²³ã€‚ æ±Ÿæ²³è¯´é˜¿å•æœ‰è‹¦å¤„ï¼Œé˜¿å•åˆ™è¯´è‡ªå·±æœ‰ç—›å¤„ã€‚å½“æƒ…ä¹‰ï¼Œäº‹ä¸šéƒ½æ¶ˆå¤±äº†ã€‚æµ©æ±‰åªå‰©ä¸‹ç–¼ç—›çš„è‡ªå·±ï¼Œè½¦æ²¡äº†ï¼Œè‡ªå·±å†æ²¡æœ‰è‡­å±çš„èµ„æ ¼äº†ã€‚ç”šè‡³ä¸€è´¯æ–¯æ–‡çš„ä»–åœ¨æ­¤æ—¶çˆ†å‡ºäº†ç¬¬ä¸€å¥ç²—ã€‚ æ±Ÿæ²³ä¾ç„¶å¯¹é˜¿å•çš„è¯å¥‰è‹¥ç¥æ˜ï¼Œé‡å¤ç€â€œäººçœŸçš„ä¸åº”è¯¥åªèœ·ç¼©åœ¨ä¸€ä¸ªè§’è½çš„ã€‚â€éª—äº†è‡ªå·±é‚£ä¹ˆä¹…ï¼Œæµ©æ±‰ä¹Ÿç¬¬ä¸€æ¬¡æ‰¿è®¤è‡ªå·±â€œæˆ‘æ˜¯æ²¡ä»€ä¹ˆäº‹ä¸šçš„â€ã€‚â€œä½†æˆ‘ä¸ä¼šå‡ºæ¥ä½œå­½â€ï¼Œæˆ‘ç€è°æƒ¹è°äº†ï¼Ÿå‡­ä»€ä¹ˆæˆ‘çš„è½¦è¢«å·â€ã€‚è¿™å¥è¯æ›´åƒæ˜¯åœ¨å¸®å¯¼æ¼”è¯´ã€‚éŸ©å¯’æ—¢è§†æ„Ÿï¼šæˆ‘æ˜¯æ²¡ä»€ä¹ˆäº‹ä¸šï¼Œä½†ä¹Ÿæ²¡å‡ºæ¥ä½œå­½ï¼Œå‡­ä»€ä¹ˆæˆ‘å°±ä»£ç¬”äº†ï¼Ÿäºæ˜¯æˆ‘å°±æ‹äº†è¿™éƒ¨ç”µå½±ï¼Œç„¶åå‘Šè¯‰é»‘é»‘ä»¬ï¼ŒéŸ©ä»å‡å…ˆç”Ÿå°±è—åœ¨ç‰‡åœºå·¥ä½œå°çš„æŠ½å±‰é‡Œï¼Œæˆ‘åªè¦ä¸çŸ¥é“è¯¥æ€ä¹ˆæ‹äº†ï¼Œå°±æ‰“å¼€æŠ½å±‰é—®éŸ©ä»å‡å…ˆç”Ÿè¿™æ˜¯è¯¥ç”¨ä»°æ‹å•Šè¿˜æ˜¯ä¿¯æ‹å•Šï¼ŒéŸ©ä»å‡å…ˆç”Ÿå°±ä¼šå‘Šè¯‰æˆ‘ï¼Œä¸–äº‹éš¾æ–™å•Šï¼Œéš¾æ–™å•Šï¼Œéš¾æ–™å•Šâ€”â€”568åŒ…é’Ÿï¼Œ868åŒ…å¤œã€‚ å¥½äº†ï¼Œå¤§åŠå¤œç å­—å¤ªå›°å¤ªçƒ­äº†ï¼Œå¯å®¤æ²¡ç©ºè°ƒï¼Œåªèƒ½è‡ªå·±ç¼–ä¸ªå†·ç¬‘è¯é™é™æ¸©è§£è§£ä¹ï¼Œé¡ºä¾¿è°ƒæˆä¸€ä¸‹æ— è„‘é»‘é»‘ä»¬ã€‚ç»§ç»­ã€‚ æ±Ÿæ²³ç»§ç»­ä¸ºé˜¿å•è¾©æŠ¤ï¼Œæµ©æ±‰ç›´æ¥å½’å› äºä¸¤äººä¸–ç•Œè§‚ä¸åŒã€‚æ±Ÿæ²³é‚£å¥æ²¡è®²å®Œçš„â€œå¯æ˜¯â€ç¬”è€…ä¼°è®¡æ˜¯æƒ³è¯´ï¼Œâ€œå¯æ˜¯é˜¿å•è¯´çš„å¯¹ï¼Œæˆ‘è¿ä¸–ç•Œéƒ½æ²¡è§‚è¿‡ï¼Œæ ¹æœ¬æ²¡æœ‰ä¸–ç•Œè§‚â€ ç„¶åæ˜¯å‘¼åº”å¼€å¤´çš„æ¡¥æ®µï¼Œç…§ç‰‡æ´—å‡ºæ¥äº†ã€‚ä¸Šè·¯æ—¶æµ©æ±‰è¯´â€œæœªçŸ¥æ—…ç¨‹ï¼Œåˆå½±ç•™å¿µã€‚â€ç„¶è€Œç»“æœæ˜¯â€”â€”â€œå¥½ä¸å®¹æ˜“æ‹å¼ åˆå½±è¿˜æ²¡æœ‰è„¸â€¦â€¦â€ã€‚å“ï¼Œæ²¡æœ‰è„¸ã€‚ ç„¶åæ˜¯æµ©æ±‰å¾ˆæ²¡æœ‰ç†æ™ºçš„æŠŠè´£ä»»æ¨ç»™æ±Ÿæ²³ï¼Œæµ©æ±‰ä»€ä¹ˆéƒ½æ²¡äº†ï¼Œä¹Ÿåªèƒ½åœ¨æ±Ÿæ²³é¢å‰ï¼Œå½“ä¸€å›é©¬åç‚®æ•™è®­ä»–ä¸€ç•ªäº†ã€‚â€œæˆ‘å¥½å¿ƒé€ä½ ï¼Œä½ ä¹±å‹¾æ­å¥³äººï¼ŒæŠŠèƒ¡ç”Ÿç»™ä¸¢äº†ï¼Œä¹±ä¿¡ä»»ç”·äººï¼ŒæŠŠè½¦ç»™ä¸¢äº†ï¼Œè¿˜æ›¿åˆ«äººè¯´è¯â€å¹³å¿ƒè€Œè®ºï¼Œè¿™ä¸€ç³»åˆ—çš„äº‹æƒ…çš„å‘ç”Ÿï¼Œä¸¤äººéƒ½æœ‰è´£ä»»ã€‚ ä¸¤äººçš„äº‰æ‰§éå¸¸åˆç†ï¼Œè¢«çœŸå–„ç¾å’Œé˜¿å•æ´—è„‘çš„æ±Ÿæ²³å…šä»¬æ˜¯é˜¿å•çš„å¿ å®ç²‰ä¸ï¼Œè€Œè½¦è¢«å·äº†æƒ…ä¹‰äº‹ä¸šéƒ½æ²¡äº†ä¸€æ— æ‰€æœ‰å°±ç­‰ç€æ…·æ…¨èµ´æ­»çš„æµ©æ±‰æ´¾æ˜¯é˜¿å•çš„é“æ†é»‘é»‘ã€‚è°ˆåˆ°å¦“å¥³é—®é¢˜ï¼Œä¸¤æ–¹åŠ¨èµ·æ‰‹æ¥ã€‚ è¿™æ—¶ç§’é€Ÿ5å˜ç±³ä¸Šæ˜ ã€‚ç„¶åç‚¸äº†ã€‚è¿™ä¸ªç‚¸ä¸æ˜¯ä¸¤ä¸ªç‹ä¹Ÿä¸æ˜¯å››ä¸ªäºŒï¼Œæ˜¯ä¸€å®šå…·æœ‰è±¡å¾æ„ä¹‰çš„ã€‚é˜¿å•çš„ç†æƒ³ç ´ç¢äº†ï¼Œè¿™å°±åƒæ˜¯ä½ æ‹‰ç€ä½ è€å©†å»çœ‹èƒ¸å£ç¢å¤§çŸ³ï¼Œç»“æœå´çœ‹åˆ°äº†å¤§çŸ³ç¢èƒ¸å£ä¸€æ ·ã€‚ è¿™ç§å¤±è½ï¼Œç›¸ä¿¡æ±Ÿæ²³æµ©æ±‰éƒ½æ„Ÿå—åˆ°äº†ã€‚ äºæ˜¯æ‰“æ–—ä¼¼ä¹éƒ½å˜å¾—æ²¡æœ‰æ„ä¹‰ï¼Œè·‘åˆ°è¿™å¤§æˆˆå£å›¾çš„æ˜¯ä»€ä¹ˆï¼Œéš¾é“æ˜¯å’ŒåŒè¡Œä¼™ä¼´soloä¹ˆï¼Ÿæ˜¾ç„¶ä¸æ˜¯ï¼Œè¿™ä¸ªçˆ†ç‚¸ï¼Œè®©äºŒäººé‡æ–°å›åˆ°ï¼Œå®šä¹‰ç›®çš„çš„é—®é¢˜ä¸Šã€‚ å½“ç„¶ï¼Œæ±Ÿæ²³çš„ç›®çš„ä¼¼ä¹æ˜¯è¾¾åˆ°äº†ï¼Œç¿»è¿‡å±±å¤´å°±æ˜¯å…¥èŒåœ°ã€‚ä½†ä»–å´å˜å¾—éå¸¸ä¸å®‰ï¼Œä½ çœ‹æ±Ÿæ²³ä¸æ–­é‡å¤çš„é‚£å¥è¯ï¼šâ€œäººçœŸçš„ä¸åº”è¯¥åªèœ·ç¼©åœ¨ä¸€ä¸ªè§’è½çš„ã€‚â€å®Œè›‹ï¼Œè¿™è’å‡‰æˆˆå£æˆ‘æ¥æ•™ä¹¦ï¼Œä¸å°±æ˜¯æœ‰æŠŠæˆ‘åœˆåœ¨ä¸€ä¸ªè§’è½ä¹ˆã€‚æ‰€ä»¥åœ¨è¿™ä¸ªè§’åº¦ä¸Šï¼Œæ±Ÿæ²³è‡ªæ€çš„å¯èƒ½æ€§éå¸¸å¤§ã€‚ è€Œæµ©æ±‰çš„ç›®çš„å‘¢ï¼Ÿå‘¨æ²«æ˜¯ä¸ªä¼ªåæ²¡èµ·æ¥ï¼Œèºèºæ‰“é‡æ‰“åºŸäº†ï¼Œæœ¬æ¥ä»¥ä¸ºæœ‰ä¸ªå¾ˆç‰›çˆ¶äº²å…‰ç¯å±…ç„¶æ˜¯ä¸ªæ¯’buffã€‚æ‰“é’±ä¸å®¹æ˜“ï¼ŒåŠè·¯é¸Ÿè¢«æ€äº†è£…å¤‡ç›´æ¥è®©æ•Œäººè¿å›è¡€æ± ã€‚å…ˆçŸ¥æ±Ÿæ²³è·‘å»é€äººå¤´ï¼Œè¯·é—®æµ©æ±‰æ€ä¹ˆæ‰“ï¼Ÿè°ˆä¸ªæ±‚ç›®çš„ã€‚ æ¸©æ°´ç…®é’è›™ï¼Œã€Š1988ã€‹é‡Œçš„ç»å…¸æ¡¥æ®µï¼Œè¡¨è¾¾ä¸¤äººå¯¹ç°å®å’Œè‡ªèº«çš„ä¸åŒçœ‹æ³•ï¼Œæ˜¯ä¸ªäººå°±æ‡‚ä¸è§£é‡Šã€‚ ç»“å±€å¾ˆå¥½ç†è§£ã€‚ç„¦èºçš„æ±Ÿæ²³å’Œç»æœ›çš„æµ©æ±‰ã€‚ä¸€ä¸ªä»æ²‰ç¡çš„ä¸–ç•Œè§‚é‡Œå†³å®šè‹é†’å´æ³¨å®šåªèƒ½ç»§ç»­æ²‰ç¡ï¼Œå¦ä¸€ä¸ªè¿ä¸–ç•Œè§‚æ˜¯ä»€ä¹ˆéƒ½ä¸çŸ¥é“äº†ã€‚é©¬è¾¾æ³¨å®šé€‰æ±Ÿæ²³ï¼Œå› ä¸ºæµ©æ±‰æ²¡æ°´æ²¡é£Ÿç‰©æ²¡äº¤é€šå·¥å…·ï¼ŒåŸè·¯è¿”å›ï¼ŒåŸºæœ¬å°±æŒ‚åœ¨æˆˆå£é‡Œäº†ã€‚æ±Ÿæ²³è¿™ä¸ªè¿ä¸–ç•Œéƒ½æ²¡è§‚è¿‡çš„äººï¼Œæ—©å¿˜è®°æµ©æ±‰æ€ä¹ˆå›å»è¿™æ¡£å­äº‹äº†ã€‚ä»–ç°åœ¨æ»¡è„‘å­å°±æ˜¯ï¼Œå®Œè›‹äº†ï¼Œæˆ‘è¢«åœˆä½äº†ï¼Œäººä¸åº”è¯¥æ°¸è¿œèœ·åœ¨ä¸€ä¸ªè§’è½çš„ï¼Œæ€ä¹ˆåŠï¼Œå®Œè›‹äº†ã€‚ æµ©æ±‰æœ€åè¯´çš„å‡ å¥è¯å¾ˆè€äººå¯»å‘³ï¼šâ€œæˆ‘è¦å»å¿™æˆ‘çš„å¤±ä¸šäº†â€ç„¶è€Œä»–è‡ªå·±ä¹Ÿè¯´äº†â€œæˆ‘æ˜¯æ²¡ä»€ä¹ˆäº‹ä¸šâ€ä»–è¿˜åœ¨ä¸é—ä½™åŠ›çš„éª—è‡ªå·±ï¼Œæˆ–è®¸åªä¸è¿‡æ˜¯åœ¨èµ´æ­»å‰ä¿ç•™ä»–ä¸€è´¯è‡­å±çš„é«˜å§¿æ€ã€‚â€œå¯é‚£åˆæœ‰ä»€ä¹ˆæ„ä¹‰å‘¢â€ï¼Œè¿™æ—¶å€™çš„æµ©æ±‰å·²ç»å¿ƒåŠ›äº¤ç˜äº†ï¼Œæ ¹æœ¬ä¸å†å»æƒ³å‡ºå‘å‰â€œæ¨ªç©¿æ•´ä¸ªå›½å®¶â€çš„è±ªè¨€å£®è¯­ï¼Œæ›´åˆ«è°ˆæ„ä¹‰äº†ï¼Œèƒ½å½“é¥­åƒä¹ˆï¼Œèƒ½å½“è½¦å¼€ä¹ˆã€‚â€œä½ ä¸é€‚åˆåœ¨è¿™ä¸ªç¤¾ä¼šä¸Šæ··â€ï¼Œæ­¤æ—¶çš„æµ©æ±‰ä¾ç„¶æ‡‚æ±Ÿæ²³å†…å¿ƒçœŸæ­£çš„æƒ³æ³•ï¼Œæµ©æ±‰çŸ¥é“æ±Ÿæ²³é™·å…¥äº†æ¸©æ°´ç…®é’è›™çš„ç»å¢ƒä¸­ï¼Œè¢«ç°å®çš„é”…ç›–æ­»æ­»ç›–åœ¨è’å‡‰æˆˆå£ï¼Œå´ç”Ÿå‡ºäº†ä¸€é¢—è·³å‡ºèœ·ç¼©ä¹‹åœ°çš„å¿ƒã€‚æ‰€ä»¥ç‹—ç»™ä½ å§ï¼Œè‡³å°‘å¯ä»¥äº’ç›¸é™ªä¼´ã€‚äºæ˜¯ä»–æ”¾ä¸‹ç‹—ï¼Œå¤´ä¹Ÿä¸å›å°±èµ°äº†ã€‚ä»–çŸ¥é“ç‹—ä¸ä¼šé™ªä»–ä¸€èµ·èµ´æ­»ã€‚æ‰€ä»¥ä¸€çœ¼éƒ½æ²¡å›å¤´çœ‹è¿‡ã€‚ å½“ç„¶æµ©æ±‰åœ¨æ­»ä¹‹å‰ä¾ç„¶é€‰æ‹©æ¬ºéª—è‡ªå·±ï¼Œæˆ‘è¿™ç§äººï¼Œå“ªéƒ½æ˜¯æœ‹å‹ï¼Œç‹—ä½ ç•™ç€å§ï¼Œæˆ‘èµ°äº†ã€‚ æµ©æ±‰çœŸçš„å°±èµ°äº†ï¼Œä»–æ²¡æœ‰å¹³å‡¡ä¹‹è·¯å¯èµ°ï¼Œä»–æ— è·¯å¯èµ°ï¼Œåœ¨ä¸€æ— æ‰€æœ‰çš„æˆˆå£é‡Œï¼Œå’Œæ‰€æœ‰äººï¼Œåä¼šæ— æœŸã€‚ äº”å‘¨ç›®çœ‹åˆ°ä¸œæå²›èƒ¡ç”Ÿç›®ç¹ä¸œæå²›å¼€å‡ºç»šçƒ‚çƒŸèŠ±çš„é‚£ä¸€åˆ»ï¼Œæˆ‘ä¸çŸ¥é“æ˜¯ä¸æ˜¯æœ‰äººåƒæˆ‘ä¸€æ ·ï¼Œè§‰å¾—è¿™å°±åƒæ˜¯ã€Šé£å±‹ã€‹é‡Œï¼Œæœ€åé‚£ä¸ªæˆ¿å­è½åœ¨è€äººè®¾è®¡çš„é‚£ä¸ªåœ°æ–¹ã€‚è™½ç„¶æ±Ÿæ²³æµ©æ±‰éƒ½å·²é•¿é€ï¼Œä¸œæå²›è¿™ä¸ªåœ¨æµ©æ±‰çœ¼ä¸­â€œå¤šå¥½çš„æ¦‚å¿µâ€è¿˜æ˜¯æˆä¸ºæ—…æ¸¸èƒœåœ°ã€‚æµ©æ±‰ã€æŒ¯å…´å®¶ä¹¡çš„æ—…æ¸¸ä¸šã€‘ä¹‹æ¢¦ï¼Œç»ˆäºæˆä¸ºç°å®ã€‚æˆ‘æƒ³èƒ¡ç”Ÿå¿…æ˜¯ä»£æ›¿æµ©æ±‰çœ‹åˆ°äº†ä¸œæå²›çš„ç¹è£ï¼Œå¦‚æ­¤ä¹æ³‰ä¹‹ä¸‹ï¼Œæµ©æ±‰ä¹Ÿå¯ç‘ç›®äº†ç½¢ã€‚ç„¶è€Œèƒ¡ç”Ÿï¼Œå´åªèƒ½åœ¨ä¸œæå²›ä¸Šï¼Œç­‰æ±Ÿæ²³æµ©æ±‰ï¼Œä¸€ä¸ªåˆä¸€ä¸ªä¸‰å¹´ã€‚ äº”å‘¨ç›®çœ‹å®Œï¼Œå¬ã€Šåä¼šæ— æœŸã€‹ã€Šå¹³å‡¡ä¹‹è·¯ã€‹ã€Šå¥³å„¿æƒ…ã€‹ã€ŠQSSã€‹ï¼ŒçœŸçš„ï¼Œå¯ä»¥é£™æ³ªã€‚ é¦–å…ˆæˆ‘å¿…é¡»é“æ­‰ã€‚é™¤äº†1å‘¨ç›®æ˜¯åœ¨ç”µå½±é™¢çœ‹çš„ï¼Œ2-5å‘¨ç›®éƒ½æ˜¯çœ‹çš„tsã€‚è¯·åŸè°…ä¸€ä¸ªå­¦ç”Ÿå…šæ²¡æ”¶å…¥çš„è‹¦è¡·ã€‚ç”µå½±é™¢çœ‹å®Œ1å‘¨ç›®ï¼Œæˆ‘çœŸå¿ƒè§‰å¾—è¿™ç‰‡å­æ²¡æ•…äº‹æ€§ï¼Œä½†æ˜¯å¾ˆè½»æ¾ï¼Œå¾ˆèƒ½é€—ä¹ã€‚æˆ‘æƒ³å°±ç®—æ˜¯ä¸€éƒ¨å–œå‰§ç‰‡ï¼Œä»–ä¹Ÿè‡³å°‘å¯ä»¥åŠæ ¼äº†ã€‚åœ¨2014å¹´ï¼Œä½ æˆ–è®¸è¿˜çœŸæ‰¾ä¸å‡ºå‡ éƒ¨èƒ½è®©ä½ ä»å¤´ä¼šå¿ƒç¬‘åˆ°å°¾çš„ç”µå½±ã€‚å½“ç„¶ï¼Œè¿™åªæ˜¯1å‘¨ç›®çš„æ„Ÿå—ï¼Œå½“æ—¶æˆ‘åªå¯¹æŸ´ä¼¯å…¬é›•åƒå¤§é›¨ä¸­çš„ç„å†¥ç«è€¿è€¿äºæ€€ã€‚äºæ˜¯æ‰‹è´±æƒ³tsæ±‚è¯ä¸€ä¸‹ã€‚ä½†æ˜¯çœ‹çš„æ—¶å€™å°±å„ç§è„ŠèƒŒå‘å‡‰äº†ã€‚ æ˜¨å¤©å’Œä»Šå¤©å‡Œæ™¨æ›´å®Œçš„ä¸»çº¿äººç‰©ç¯‡åœ¨ã€é˜¿å•ã€‘ã€æ±Ÿæ²³ã€‘ã€‘ã€æµ©æ±‰ã€‘è¿™ä¸‰ç¯‡ä¸­æœ‰å¾ˆå¤šå†…å®¹ä¸Šçš„é”™ç»¼é—®é¢˜ï¼Œç»“æ„å’Œæƒ…æ„Ÿä¹Ÿæ²¡æœ‰ã€èƒ¡ç”Ÿã€‘ã€å‘¨æ²«ã€‘ã€èºèºã€‘è¿™ä¸‰ç¯‡æ‹¿æçš„åˆ°ä½ï¼Œè€Œä¸”å› ä¸ºçƒ­é¥¿å›°çš„å½±å“ï¼Œå¾ˆå¤šæ—¶å€™å†™ç€å†™ç€å°±å¿˜äº†ä¹‹å‰çš„ç¯‡ç« é‡Œå†™æ²¡å†™äº†ï¼Œé€ æˆäº†ä¸€å®šçš„é—®é¢˜ï¼Œä»Šå¤©ä¹Ÿæ˜¯è¦æŠŠäººç‰©ç¯‡åšä¸€ä¸ªæ•´åˆã€‚ åœ¨å››ã€äº”å‘¨ç›®çš„é€å¸§åˆ†æé‡Œï¼Œæˆ‘çš„wordé‡Œé¢æ˜¯æˆªå›¾äº†çš„ã€‚é‰´äºç”µå½±ä¸Šæ˜ é—®é¢˜ï¼Œæš‚ä¸å‘æˆªå›¾ã€‚ç­‰ä¸€åˆ‡å°˜åŸƒè½å®šï¼Œæˆ‘è‡ªä¼šæ–°å¼€ä¸€è´´ï¼Œå¯¹æ‰€æœ‰ç»†èŠ‚ä¸€ä¸€åˆ†æã€‚ æˆ–è®¸è¿™çœŸçš„æ˜¯ä¸€éƒ¨ç¬¬ä¸€éç¬‘ï¼Œç¬¬äºŒéç¬‘ä¸ç²—æ„Ÿåˆ°æ²‰é‡ï¼Œåˆ°ç¬¬ä¸‰éæ³ªç›®çš„ç”µå½±å§ã€‚ä¹Ÿæˆ–è®¸è¿™å°±æ˜¯å¯¼æ¼”æƒ³è¦è¾¾åˆ°çš„æ•ˆæœã€‚ å¯¹äºæ™®é€šé’å¹´ï¼Œå®ƒå°±æ˜¯ä¸€éƒ¨å–œå‰§ï¼›å¯¹äºæ–‡è‰ºé’å¹´ï¼Œå®ƒå°±æ˜¯ä¸€éƒ¨æ–‡è‰ºç‰‡ï¼›å¯¹äºå–œæ¬¢ä½œæ­»ç£•ç»†èŠ‚çš„2Bé’å¹´ï¼Œå®ƒå°±æ˜¯ä¸€éƒ¨é»‘è‰²å¹½é»˜çš„å…¬è·¯ç‰‡ã€‚å¯¹äºä¸æ˜¯é’å¹´çš„äººï¼Œè¯·å‡ºé—¨å·¦æ‹ï¼Œã€Šå°3æ—¶ä»£ã€‹ç­‰ä½ ã€‚ ç„¶è€Œé‚£äº›è‡ªä»¥ä¸ºæ˜¯æ–‡è‰ºé’å¹´å´æ²¡è®¤çœŸçœ‹å‡ éå°±çå–·çš„ï¼Œè¿˜æ˜¯åˆ°å¹¼å„¿å›­å­¦å­¦æ€ä¹ˆåˆ·ç‰™å’Œåšçœ¼ä¿å¥æ“å§ã€‚ æ¬¢è¿è®¨è®ºã€‚æ¥¼ä¸»è¦å¼€å§‹6åˆ·äº†ã€‚tsæ¸…æ™°åº¦å¤ªå·®ï¼Œè€Œä¸”å°‘äº†éƒ¨åˆ†æƒ…èŠ‚ï¼Œæœ‰äº›åœ°æ–¹å†™çš„ä¸åˆ°ä½ï¼Œè¿˜æœ›å„ä½å§å‹æµ·æ¶µã€‚ ï¼ˆä»¥ä¸Šå°±æ˜¯åŸä½œè€…æˆªæ­¢åˆ°ç›®å‰ä¸ºæ­¢çš„å…¨æ–‡ï¼Œæ¥¼ä¸»å°šæœ‰ä¸‰ä¸ªç–‘æƒ‘ä½œè€…å¹¶æœªè§£ç­”ï¼š1ã€æµ©ç„¶å’Œé˜¿åŠ›åœ¨å“ªï¼Ÿç»“å°¾æ¼”å‘˜è¡¨ä¸Šæœ‰ä¸¤ä¸ªäººçš„åå­—ï¼Œè€Œç”µå½±ä¸­å§‹ç»ˆæ²¡æœ‰å‡ºç°ã€‚2ã€ä»èºèºé‚£å‡ºæ¥ç‰‡ä¸­å’Œç»“å°¾åˆ°åº•å“ªä¸ªæ˜¯çœŸå®å“ªä¸ªæ˜¯å°è¯´ï¼Ÿ3ã€ç”·æ ¹å›ºæœ¬ä¸¸çš„å¹¿å‘Šåˆ°åº•æ˜¯çº¯ç²¹ä¸ºäº†æç¬‘è¿˜æ˜¯å¦æœ‰å¯“æ„ï¼Ÿï¼‰ â€”- è½¬è‡ªåä¼šæ— æœŸå§åŸæ–‡é“¾æ¥","tags":[{"name":"åä¼šæ— æœŸ","slug":"åä¼šæ— æœŸ","permalink":"https://www.limuyang.cc/tags/åä¼šæ— æœŸ/"},{"name":"å½±è¯„","slug":"å½±è¯„","permalink":"https://www.limuyang.cc/tags/å½±è¯„/"}]},{"title":"vue-routerä¸­ä½¿ç”¨EventBusä¼ å€¼éœ€è¦æ³¨æ„åˆ°çš„é—®é¢˜","date":"2018-03-31T22:26:58.000Z","path":"2018/03/31/vue-routerä¸­ä½¿ç”¨EventBusä¼ å€¼éœ€è¦æ³¨æ„åˆ°çš„é—®é¢˜/","text":"æœ€è¿‘è´Ÿè´£å¼€å‘ä¸€ä¸ªè§†é¢‘ç›¸å…³çš„é¡¹ç›®ï¼Œè¦ç”¨åˆ°vue-routerï¼ŒåŒæ—¶æ¶‰åŠåˆ°ä¸€äº›å…±æœ‰çŠ¶æ€ç®¡ç†ï¼Œä½†æ˜¯å°‘é‡çš„çŠ¶æ€åˆä¸æƒ³ç”¨vuexï¼Œäºæ˜¯ç”¨åˆ°äº†EventBusï¼Œä¸€èˆ¬æ¥è¯´ï¼Œ æˆ‘ä»¬ç”¨EventBusçš„æ­¥éª¤å¦‚ä¸‹ï¼š é¦–å…ˆæ–°å»ºä¸€ä¸ªjsç”¨æ¥åˆ›å»ºæˆ‘ä»¬çš„EventBusï¼Œå¦‚Bus.js 123import Vue from 'vue'; ...export default new Vue(); æ¥ç€ï¼Œæˆ‘ä»¬åœ¨éœ€è¦çš„åœ°æ–¹é€šè¿‡$emitè§¦å‘è‡ªå®šä¹‰äº‹ä»¶ï¼Œæ¯”å¦‚æˆ‘è¿™ä¸ªæ—¶å€™æœ‰ä¸€ä¸ªè§†é¢‘å½“å‰æ’­æ”¾æ—¶é—´çš„çŠ¶æ€éœ€è¦ä¼ é€’ 123import Bus from '../components/Bus.js'...Bus.$emit('currentTime', 'time') å†ç„¶åå°±æ˜¯æˆ‘ä»¬åœ¨å¦ä¸€ä¸ªè·¯ç”±é¡µé¢(å°±åˆ†åˆ«å«é¡µé¢Aå’ŒBå§)é€šè¿‡$onç›‘å¬è‡ªå®šä¹‰äº‹ä»¶ 123import Bus from '../components/Bus.js'...Bus.$on('currentTime', (time) =&gt; console.log(time)) é€šå¸¸æƒ…å†µä¸‹è¿™ä¸ªæ˜¯åº”è¯¥å¯ä»¥æ‰“å°å‡ºæˆ‘ä»¬æƒ³è¦çš„æ•°æ®ï¼Œä½†æ˜¯ç»æˆ‘å®éªŒå‘ç°ï¼Œå½“ç¬¬ä¸€æ¬¡é€šè¿‡è·¯ç”±è·³è½¬é¡µé¢çš„æ—¶å€™æ§åˆ¶å°æ˜¯æ²¡æœ‰ä»»ä½•è¾“å‡ºçš„ï¼Œåªæœ‰ç¬¬äºŒæ¬¡è·³è½¬å¼€å§‹æ§åˆ¶å°æ‰æœ‰è¾“å‡ºï¼Œç„¶åæˆ‘å°±å»æŸ¥äº†ä¸‹èµ„æ–™ï¼Œå‘ç°æœ‰è¿™ä¹ˆä¸€ç§è¯´æ³•: vue-routeråˆ‡æ¢çš„æ—¶å€™ï¼Œä¼šå…ˆåŠ è½½æ–°çš„ç»„ä»¶ï¼Œå½“æ–°çš„ç»„ä»¶æ¸²æŸ“å¥½ä½†æ˜¯è¿˜æ²¡mountçš„æ—¶å€™ï¼Œé”€æ¯æ—§ç»„ä»¶ï¼Œç„¶åå†æŒ‚è½½æ–°ç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´å½“Bé¡µé¢çš„ç”Ÿå‘½å‘¨æœŸè¿›è¡Œåˆ°beforeMountçš„æ—¶å€™ï¼Œä¸‹ä¸€æ­¥èµ°åˆ°çš„å°±æ˜¯Aé¡µé¢çš„beforeDestoryæ–¹æ³•å’Œæ¥ä¸‹å»çš„destroyedæ–¹æ³• è¦çŸ¥é“æˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯åœ¨Bé¡µé¢çš„createdæ–¹æ³•é‡Œé¢å»ä½¿ç”¨$onç›‘å¬è‡ªå®šä¹‰äº‹ä»¶ï¼Œä½†æ˜¯é€šè¿‡ä¸Šé¢é‚£æ®µè¯æˆ‘ä»¬çŸ¥é“ï¼Œå½“æˆ‘ä»¬åœ¨createæ–¹æ³•é‡Œé¢ç›‘å¬äº‹ä»¶çš„æ—¶å€™$emitäº‹ä»¶å·²ç»å‘å‡ºå»äº†ï¼Œæ­¤æ—¶ç›‘å¬å™¨è¿˜æ²¡æœ‰æ³¨å†Œï¼Œé‚£ä¹ˆè¦è®©$onç›‘å¬åˆ°Aé¡µé¢çš„$emitå‘å‡ºçš„äº‹ä»¶ï¼Œå¯ä»¥åœ¨Aé¡µé¢çš„beforeDestoryæˆ–destroyedå»æ‰§è¡Œ$emitï¼Œé™„ä¸Švue-routeråˆ‡æ¢æ—¶å€™ç›¸å…³çš„ç”Ÿå‘½å‘¨æœŸé¡ºåºå›¾ï¼š å›¾ç‰‡å‡ºè‡ª ä½†æ˜¯æˆ‘è¿™ä¸ªé¡¹ç›®å’Œè¿™ä¸ªäººæœ‰ä¸ä¸€æ ·çš„åœ°æ–¹ï¼Œå› ä¸ºæˆ‘éœ€è¦ç•™å­˜ä¸Šä¸€ä¸ªè·¯ç”±é¡µé¢çš„çŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘åœ¨router-viewçš„å¤–é¢ç”¨äº†keep-aliveå±æ€§ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸å­˜åœ¨Aé¡µé¢ä¼šèµ°åˆ°beforeDestoryå’Œdestoryedçš„è¯´æ³•ï¼Œé‚£ä¹ˆè¿™æ—¶å€™è¯¥æ€ä¹ˆåšï¼Œæˆ‘ä¸€å¼€å§‹æ˜¯åšäº†å®éªŒï¼Œæ—¢ç„¶æˆ‘ç›´æ¥$emité‚£è¾¹æ¥æ”¶ä¸åˆ°ï¼Œé‚£æˆ‘å°±å»¶è¿Ÿå»$emitï¼Œä¸€å¼€å§‹æˆ‘ç”¨äº†ä¸ª2sçš„å»¶è¿Ÿ: 12345import Bus from '../components/Bus.js'...setTimeout(() =&gt; &#123; Bus.$emit('currentTime', 'time')&#125;, 2000) ç›®çš„å°±æ˜¯è®©Bé¡µé¢$onæ‰§è¡Œå¼€å§‹ç›‘å¬äº‹ä»¶çš„æ—¶å€™æˆ‘å†å»$emitï¼Œå‘ç°æ˜¯å¯ä»¥çš„ï¼Œæˆ‘åˆæŠŠæ—¶é—´å‡å°‘åˆ°1sï¼Œä¾ç„¶æ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬è¦å»ç²¾ç¡®è®¡ç®—ä¸¤ä¸ªé¡µé¢çš„åˆ‡æ¢æ—¶é—´å²‚ä¸æ˜¯å¤ªè ¢ï¼Œåæ¥æˆ‘å°±æƒ³åˆ°äº†vueè‡ªå¸¦çš„ä¸€ä¸ªæ–¹æ³•ï¼Œæ•²é»‘æ¿vm.$nextTick( [callback] )ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å°±æ˜¯åœ¨domæ›´æ–°ä¹‹åå¼‚æ­¥æ‰§è¡Œå›è°ƒæ–¹æ³•ï¼Œæˆ‘åœ¨è¿™ä¸ªæ—¶å€™å»$emitæœç„¶èƒ½å¤ŸæˆåŠŸè·å–åˆ°æ•°æ®ï¼Œå¤§åŠŸå‘Šæˆã€‚ é¡ºä¾¿è¯´ä¸€å¥ï¼Œå¦‚æœè·¯ç”±å¤–é¢æ²¡æœ‰ä½¿ç”¨keep-aliveçš„è¯ï¼Œä½ ä¼šå‘ç°éšç€åˆ‡æ¢æ¬¡æ•°å¢å¤š$onç›‘å¬äº‹ä»¶æ‰§è¡Œçš„æ¬¡æ•°ä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œå’Œä½ åˆ‡æ¢é¡µé¢çš„æ¬¡æ•°æˆæ­£æ¯”ï¼Œå°¤å¤§åœ¨issueé‡Œé¢è¯´è¿™æ˜¯å› ä¸º$onäº‹ä»¶æ˜¯ä¸ä¼šè‡ªåŠ¨æ¸…é™¤çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ åˆ‡æ¢çš„æ¬¡æ•°è¶Šå¤š$onç›‘å¬ä¹Ÿä¼šè¶Šæ¥è¶Šå¤šï¼Œè§£å†³çš„æ–¹æ³•æ˜¯éœ€è¦åœ¨Bé¡µé¢çš„beforeDestroyé‡Œé¢æ‰‹åŠ¨ä½¿ç”¨$offå»å…³é—­ç›‘å¬: 1234import Bus from '../components/Bus.js'beforeDestory() &#123; Bus.$off('currentTime', (time) =&gt; console.log(time))&#125; ä»¥ä¸Š å‚è€ƒé“¾æ¥vue2 eventbus æ±‚è§£æƒ‘vueä¸­eventbusè¢«å¤šæ¬¡è§¦å‘ï¼ˆvueä¸­ä½¿ç”¨eventbusè¸©è¿‡çš„å‘ï¼‰","tags":[{"name":"vue-router","slug":"vue-router","permalink":"https://www.limuyang.cc/tags/vue-router/"},{"name":"eventbus","slug":"eventbus","permalink":"https://www.limuyang.cc/tags/eventbus/"}]},{"title":"ä¸å¹ä¸é»‘èŠèŠå‰ç«¯æ¡†æ¶--å°¤é›¨æºªLiveæ•´ç†","date":"2017-11-10T22:58:38.000Z","path":"2017/11/10/ä¸å¹ä¸é»‘èŠèŠå‰ç«¯æ¡†æ¶-å°¤é›¨æºªLiveæ•´ç†/","text":"æœ€è¿‘ä¹°äº†å°¤é›¨æºªå¤§å¤§çš„Liveï¼šä¸å¹ä¸é»‘èŠèŠå‰ç«¯æ¡†æ¶ï¼Œè¿™åœºLiveè®©æˆ‘çš„å‰ç«¯æ€ç»´åˆ°äº†å‰æ‰€æœªæœ‰çš„é«˜åº¦ï¼šå½“æˆ‘ä»¬èº«ä¸ºå‰ç«¯å¼€å‘èŒæ–°ï¼Œåœ¨å‰ç«¯äººæ‰é‡‘å­—å¡”çš„æµ®åŠ¨ä¸æŒ£æ‰ä¸­æ€è€ƒè¯¥å­¦ä»€ä¹ˆæ¡†æ¶ã€è¯¥å¦‚ä½•å…¥é—¨å‰ç«¯ã€åˆé‡åˆ°å­¦ä¹ ç“¶é¢ˆæ€ä¹ˆåŠçš„æ—¶å€™ï¼Œæ­£æ˜¯è¿™äº›ä¸šç•Œå¤§ç‰›ä»¬ç”¨è‡ªå·±çš„è¡ŒåŠ¨å¼•å¯¼ç€æˆ‘ä»¬ï¼Œæœ‰å¦‚å°¤å¤§æ‰€è¯´ï¼šå¤šæ€è€ƒåœºæ™¯éœ€æ±‚ï¼Œå¤šçœ‹çœ‹æŠ€æœ¯åˆ°åº•åšäº†æ€æ ·çš„å–èˆï¼Œç°åœ¨æŠŠç›¸å…³çš„ä¸œè¥¿ä½œä¸ºç¬”è®°æ•´ç†ä¸‹æ¥ï¼Œå¸Œæœ›å¯¹å‰ç«¯å¼€å‘æœ‰å…´è¶£çš„åŒå­¦éƒ½å¯ä»¥å»æ”¯æŒä¸€ä¸‹å°¤å¤§ ç»„ä»¶å¯ä»¥æ˜¯å‡½æ•°æƒ³è±¡ä¸€ä¸‹æ•´ä¸ªåº”ç”¨æ˜¯ä¸€ä¸ªå¤§çš„å‡½æ•°ï¼Œå‡½æ•°é‡Œé¢å¯ä»¥è°ƒç”¨åˆ«çš„å‡½æ•°ï¼Œæ¯ä¸€ä¸ªç»„ä»¶æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªç»„ä»¶å¯ä»¥è°ƒç”¨å…¶ä»–çš„å‡½æ•°ï¼Œæ•´ä¸ªä¸€ä¸ªæ ‘çŠ¶ç»“æ„ ç»„ä»¶æ˜¯æœ‰åˆ†ç±»çš„ çº¯å±•ç¤ºå‹çš„ç»„ä»¶ï¼Œæ•°æ®è¿›ï¼ŒDOMå‡ºï¼Œç›´è§‚æ˜äº† æ¥å…¥å‹ç»„ä»¶ï¼Œåœ¨Reactåœºæ™¯ä¸‹çš„container componentï¼Œè¿™ç§ç»„ä»¶ä¼šè·Ÿæ•°æ®å±‚çš„serviceæ‰“äº¤é“ï¼Œä¼šåŒ…å«ä¸€äº›è·ŸæœåŠ¡å™¨æˆ–è€…è¯´æ•°æ®æºæ‰“äº¤é“çš„é€»è¾‘ï¼Œcontainerä¼šæŠŠæ•°æ®å‘ä¸‹ä¼ é€’ç»™å±•ç¤ºå‹ç»„ä»¶ äº¤äº’å‹ç»„ä»¶ï¼Œå…¸å‹çš„ä¾‹å­æ˜¯å¯¹äºè¡¨å•ç»„ä»¶çš„å°è£…å’ŒåŠ å¼ºï¼Œå¤§éƒ¨åˆ†çš„ç»„ä»¶åº“éƒ½æ˜¯ä»¥äº¤äº’å‹ç»„ä»¶ä¸ºä¸»ï¼Œæ¯”å¦‚è¯´Element UIï¼Œç‰¹ç‚¹æ˜¯æœ‰æ¯”è¾ƒå¤æ‚çš„äº¤äº’é€»è¾‘ï¼Œä½†æ˜¯æ˜¯æ¯”è¾ƒé€šç”¨çš„é€»è¾‘ï¼Œå¼ºè°ƒç»„ä»¶çš„å¤ç”¨ åŠŸèƒ½å‹ç»„ä»¶ï¼Œä»¥Vueçš„åº”ç”¨åœºæ™¯ä¸¾ä¾‹ï¼Œè·¯ç”±çš„router-viewç»„ä»¶ã€transitionç»„ä»¶ï¼Œæœ¬èº«å¹¶ä¸æ¸²æŸ“ä»»ä½•å†…å®¹ï¼Œæ˜¯ä¸€ä¸ªé€»è¾‘å‹çš„ä¸œè¥¿ï¼Œä½œä¸ºä¸€ç§æ‰©å±•æˆ–è€…æ˜¯æŠ½è±¡æœºåˆ¶å­˜åœ¨ JSXå’Œæ¨¡ç‰ˆçš„å¯¹æ¯”JSXæœ¬è´¨å°±æ˜¯Javascriptï¼Œå®ƒå®Œå…¨è·å¾—äº†Javascriptçš„çµæ´»åº¦ï¼Œå®ƒæœ€å¤§çš„ä»·å€¼åœ¨äºä¹¦å†™åŠŸèƒ½å‹ç»„ä»¶çš„æ—¶å€™æ¯”çº¯æ¨¡ç‰ˆæ›´å¥½ï¼Œä½†æ˜¯æ¨¡ç‰ˆåœ¨å±•ç¤ºå‹å’Œå…¶ä»–çš„ç”¨ä¾‹ä¸Šä¹Ÿæ˜¯ä¸å·®çš„ï¼Œæ¨¡ç‰ˆä¼šè®©ä½ æ›´å°‘çš„æŠŠé€»è¾‘æ”¾åœ¨è§†å›¾é‡Œé¢ï¼Œå±•ç¤ºå‹çš„ç»„ä»¶è™½ç„¶åœ¨é€»è¾‘ä¸Šæ¯”è¾ƒç®€å•ä½†æ˜¯åœ¨æ ·å¼ä¸Šè¿˜æ˜¯å…·æœ‰ä¸€å®šçš„å¤æ‚åº¦ ä»£ç çš„æ‹†åˆ†(colocation)æŠŠåº”è¯¥æ”¾ä¸€èµ·çš„ä¸œè¥¿æ”¾ä¸€èµ·ï¼Œæ¯”å¦‚è¯´åœ¨vueçš„å•æ–‡ä»¶ç»„ä»¶é‡Œé¢æˆ‘ä»¬æŠŠæ¨¡ç‰ˆã€æ ·å¼å’Œjavascriptçš„é€»è¾‘éƒ½æ˜¯æ”¾åœ¨ä¸€èµ·çš„ï¼Œç›®å‰ä¸»æµæ¡†æ¶éƒ½æ˜¯è¿™ä¹ˆåšçš„ï¼Œå¦‚æœè¿™æ¦‚å¿µæ‰©å±•å¼€æ¥ï¼Œç»„ä»¶çš„æ–‡æ¡£ä¹Ÿæ˜¯å¯ä»¥å’Œç»„ä»¶çš„å…¶ä»–ä¸œè¥¿æ”¾ä¸€èµ·çš„ï¼Œç»„ä»¶åŒ–ä¹‹åå’Œä¼ ç»Ÿçš„Separation of concernå°±æœ‰åŒºåˆ«äº†ï¼Œä¼ ç»Ÿçš„Separation of concernæ˜¯ä»¥è¯­è¨€ä¸ºå•ä½ä½œåˆ‡åˆ†ï¼Œç»„ä»¶æ˜¯ä»¥ç»„ä»¶æœ¬èº«ä½œä¸ºä¸€ä¸ªåˆ‡åˆ†çš„æŠ½è±¡ å˜åŒ–ä¾¦æµ‹å’Œæ¸²æŸ“æœºåˆ¶ æ¸²æŸ“æœºåˆ¶ ç°ä»£çš„å‰ç«¯æ¡†æ¶é‡Œé¢æ¸²æŸ“è¿™å—æœ€é‡è¦çš„æ˜¯å£°æ˜å¼(Declarative)ï¼Œç›¸æ¯”è¾ƒä¹‹ä¸‹çš„æ¦‚å¿µæ˜¯å‘½ä»¤å¼(Imperative)ï¼ŒImperativeæœ€ç›´æ¥çš„ä¾‹å­æ˜¯æˆ‘ä»¬ä½¿ç”¨Jqueryæ—¶å€™æ‹¿åˆ°ä¸€ä¸ªé€‰æ‹©å™¨â€ç›´æ¥å¹²â€ï¼Œä½¿ç”¨å‘½ä»¤å»è¿›è¡Œæ“ä½œï¼Œç›´æˆªäº†å½“ï¼Œä½†æ˜¯å¾ˆå¿«å°±ä¼šé‡åˆ°ç»´æŠ¤æ€§çš„é—®é¢˜ï¼Œè‹±æ–‡é‡Œé¢æœ‰ä¸ªè¯å«åšjQuery Spaghettiï¼ŒSpaghettiçš„æ„æ€æ˜¯æ„å¤§åˆ©é¢ï¼Œè¿™ä¸ªè¯çš„æ„æ€å°±æ˜¯è¯´ä½ çš„ä»£ç å†™åˆ°åé¢ä¼šåƒä¸€å¨æ„å¤§åˆ©é¢ä¸€æ ·ï¼Œç»´æŠ¤èµ·æ¥å¾ˆå›°éš¾ï¼Œå£°æ˜å¼çš„å¥½å¤„å°±æ˜¯è¯´æˆ‘ä»¬ç›´æ¥æè¿°è¯´æ•°æ®å’ŒDOMç»“æ„ä¹‹é—´çš„æ˜ å°„å…³ç³»åº”è¯¥æ˜¯æ€ä¹ˆæ ·çš„ï¼Œä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»åšè¿™äº›æ“ä½œ Reacté‡Œé¢æœ‰ä¸€ä¸ªç­‰å¼ view = render(state) ï¼Œè¿™é‡Œrenderå°±æ˜¯æˆ‘ä»¬åœ¨Reacté‡Œé¢å†™çš„renderå‡½æ•°ï¼Œvueçš„æ¨¡ç‰ˆå…¶å®ä¹Ÿæ˜¯ç¼–è¯‘æˆæ¸²æŸ“å‡½æ•°çš„ï¼Œæ‰€ä»¥æ¨¡ç‰ˆå’ŒJSXä¹‹é—´çš„æœ¬è´¨æ˜¯ç›¸ä¼¼çš„ï¼Œè¾“å…¥stateï¼Œè¾“å‡ºDOMï¼Œç†æƒ³æƒ…å†µä¸‹æˆ‘ä»¬å°±æ˜¯æè¿°äº†è¿™æ ·ä¸€ç§å…³ç³»ï¼Œé‚£è¾“å…¥å˜äº†è¾“å‡ºä¹Ÿä¼šè·Ÿç€å˜ï¼Œæˆ‘ä»¬ä¸éœ€è¦é¡¾è™‘è¾“å…¥å’Œè¾“å‡ºä¹‹é—´å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…ï¼Œå…·ä½“åˆ°åº•å±‚å®ç°å¯ä»¥æ˜¯Virtual DOMï¼Œä½†å¹¶ä¸ä¸€å®šå¾—æ˜¯Virtual DOMï¼Œå¯ä»¥æ˜¯ç»†ç²’åº¦çš„ç»‘å®š å˜åŒ–ä¾¦æµ‹ ç”¨è¿‡vueçš„æœ‹å‹çŸ¥é“vueçš„æ•°æ®æ˜¯å“åº”å¼çš„ï¼Œvueä¼šæŠŠä½ ä¼ é€’çš„æ•°æ®è¿›è¡Œè½¬åŒ–ï¼Œè½¬åŒ–è¿‡åå½“ä½ æ”¹å˜ä¸€äº›å±æ€§çš„å€¼çš„æ—¶å€™ï¼Œvueå°±ä¼šè¿›è¡Œç›¸åº”çš„æ›´æ–°ï¼Œé™„ä¸Šå°¤å¤§ç›¸å…³çš„æ¼”è®²PPTï¼Œé‡Œé¢æœ‰è¯¦ç»†çš„è¿‡ç¨‹ï¼šppt Liveæé—®ï¼šé—®ï¼šä¸€ç›´æœ‰ä¸€ä¸ªç–‘é—®ï¼Œä»¥å‰ è¢«äººè¯Ÿç—…ï¼Œä¸ºå•¥ vue çš„å£°æ˜å¼å†™æ³•å°±æ˜¯æ¨å´‡çš„ï¼Ÿç­”ï¼šHTMLé‡Œé¢è¿™ä¸ªonclické‡Œé¢çš„Javascriptçš„ä½œç”¨åŸŸæ˜¯å…¨å±€çš„ï¼Œå½“ä½ åœ¨vueé‡Œé¢è¿™ä¹ˆå†™çš„æ—¶å€™æ˜¯æœ‰å¾ˆæ˜ç¡®çš„Javascriptä½œç”¨åŸŸçš„ï¼Œä½ çš„ç»‘å®šä»¥åŠä½ çš„methodæ‰€èƒ½è§¦åŠçš„å½±å“èŒƒå›´æ˜¯è®¾å®šå¥½çš„ï¼Œè¿™ä¸ªè·Ÿå…¨å±€çš„Javascriptæœ‰æœ¬è´¨çš„åŒºåˆ«ï¼Œå¦å¤–å½“æˆ‘ä»¬åœ¨vueæˆ–è€…Reacé‡Œé¢è¿™ä¹ˆå†™çš„æ—¶å€™ä½ çš„Javascripté€»è¾‘å’Œä½ çš„æ¨¡ç‰ˆæˆ–è€…è¯´ä½ çš„JSXæ˜¯åœ¨ä¸€èµ·çš„ï¼Œå¯ä»¥è”æƒ³æˆ‘ä»¬ä¹‹å‰æåˆ°çš„colocationçš„æ¦‚å¿µï¼Œæ‰€ä»¥å¹¶ä¸ä¼šé€ æˆä¸€ä¸ªç»´æŠ¤ä¸Šçš„å›°éš¾ï¼Œä½†æ˜¯å¦‚æœä½ åœ¨å…¨å±€çš„Htmlé‡Œé¢è¿™æ ·ç›´æ¥è£¸å†™ï¼Œä½ å®Œå…¨ä¸çŸ¥é“ä½ è¿™æ®µJavascriptå¯èƒ½ä¼šå¼•ç”¨åˆ°å“ªé‡Œçš„å˜é‡æˆ–è€…æ˜¯è°ƒç”¨çš„å“ªé‡Œçš„æ–¹æ³• ç®€å•çš„æ€»ç»“ï¼Œå˜åŒ–ä¾¦æµ‹ä¸»è¦åˆ†ä¸ºä¸¤ç§ï¼š pullæ‰€è°“pullï¼Œç³»ç»Ÿä¸çŸ¥é“æ•°æ®ä»€ä¹ˆæ—¶å€™å˜äº†ï¼Œå®ƒéœ€è¦ä¸€ä¸ªä¿¡å·å»å‘Šè¯‰å®ƒè¯´æ•°æ®æœ‰å¯èƒ½å˜äº†ï¼Œåœ¨è¿™ä¸ªç³»ç»Ÿæ‰ä¼šå»è¿›è¡Œä¸€æ¬¡æ¯”è¾ƒæš´åŠ›çš„æ¯”å¯¹ï¼Œåœ¨Reacté‡Œé¢çš„è¡¨ç°æ˜¯Virtual Dom Diffï¼Œåœ¨Angularé‡Œé¢å°±æ˜¯æ•´ä¸ªè„æ£€æŸ¥çš„æµç¨‹ï¼Œèƒ½å¤Ÿè¿™ä¹ˆåšçš„å‰ææ˜¯ç°åœ¨Javascriptè¶³å¤Ÿå¿«ï¼Œè™½ç„¶æœ‰æµªè´¹ä½†æ˜¯æ€§èƒ½ä¸Šä¹Ÿå¯ä»¥æ¥å— pushç›¸æ¯”ä¹‹ä¸‹ï¼Œvueçš„å“åº”å¼æ•°æ®æˆ–è€…RXJSçš„æ•°æ®æœºåˆ¶ï¼Œåœ¨æ•°æ®å˜åŠ¨ä¹‹åç«‹åˆ»å°±å¯ä»¥çŸ¥é“æ•°æ®å˜åŠ¨äº†ï¼Œè€Œä¸”ä¸€å®šç¨‹åºä¸Šæˆ‘ä»¬ä¼šçŸ¥é“å“ªäº›æ•°æ®å˜äº†ï¼Œè¿™æ ·å°±å¯ä»¥è¿›è¡Œç›¸å¯¹æ›´ç»†ç²’åº¦çš„æ›´æ–°ï¼Œpullçš„è¿™ç§æ›´æ–°æ˜¯æœ€ç²—ç²’åº¦çš„ï¼Œæ‰€ä»¥åœ¨å¤§å‹åº”ç”¨é‡Œé¢æˆ‘ä»¬è¦å¸®åŠ©ç³»ç»Ÿæ¥å‡å°‘ä¸€äº›æ— ç”¨åŠŸï¼Œä½†æ˜¯pushçš„å½¢å¼ä¹Ÿæœ‰å®ƒçš„ç¼ºé™·ï¼Œç²’åº¦è¶Šç»†ï¼Œä½ çš„æ¯ä¸€ä¸ªç»‘å®šéƒ½ä¼šéœ€è¦ä¸€ä¸ªobservabel/watcherï¼Œè¿™æ ·ä¼šå¸¦æ¥ç›¸åº”çš„å†…å­˜ä»¥åŠä¾èµ–è¿½è¸ªçš„å¼€é”€ï¼Œæ‰€ä»¥åœ¨vue2é‡Œé¢é€‰æ‹©çš„æ˜¯ä¸€ä¸ªæ¯”è¾ƒä¸­ç­‰ç²’åº¦çš„æ–¹æ¡ˆï¼Œåœ¨ç»„ä»¶çº§åˆ«æ˜¯pushï¼Œæ¯ä¸€ä¸ªç»„ä»¶æ˜¯ä¸€ä¸ªå“åº”å¼çš„watcherï¼Œå½“æ•°æ®å˜åŠ¨æ—¶å€™æˆ‘ä»¬å¯ä»¥å¯¹ç»„ä»¶è¿›è¡Œæ›´æ–°ï¼Œåœ¨æ¯ä¸ªç»„ä»¶å†…éƒ¨åˆ™æ˜¯ç”¨Virtual Domè¿›è¡Œæ¯”å¯¹ï¼Œpushå’Œpullä¹‹é—´çš„æœ¬è´¨åŒºåˆ«æ˜¯åœ¨äºç”¨ä¾¦æµ‹æˆæœ¬æ¢å–ä¸€å®šç¨‹åº¦çš„è‡ªåŠ¨ä¼˜åŒ– çŠ¶æ€ç®¡ç†çŠ¶æ€ç®¡ç†è¿™ä¸ªæ¦‚å¿µå…¶å®ä¹Ÿæ˜¯åœ¨FBæå‡ºäº†Fluxä¹‹åæ‰æ¬åˆ°å°é¢ä¸Šæ¥è®²ï¼ŒFluxåœ¨ç»å†äº†åˆæœŸçš„æ··ä¹±ç«äº‰ä¹‹åæ…¢æ…¢çš„åˆæµåˆ°äº†Reduxä¸Šï¼Œvuxåœ¨ä¸€å®šç¨‹åº¦å—åˆ°äº†Reduxçš„å½±å“ï¼ŒçŠ¶æ€ç®¡ç†çš„æœ¬è´¨æ˜¯ä»æºäº‹ä»¶(source event)æ˜ å°„åˆ°çŠ¶æ€çš„è¿ç§»å’Œæ”¹å˜ï¼Œç„¶ååœ¨æ˜ å°„åˆ°UIçš„å˜åŒ–ï¼Œå£°æ˜å¼çš„æ¸²æŸ“å·²ç»å¸®æˆ‘ä»¬è§£å†³äº†ä»çŠ¶æ€åˆ°UIçš„æ˜ å°„ï¼Œè¿™ä¸€å—ï¼Œæ‰€ä»¥çŠ¶æ€ç®¡ç†è¿™äº›åº“ä»–ä»¬åšçš„å®é™…ä¸Šæ˜¯å¦‚ä½•ç®¡ç†å°†äº‹ä»¶æºæ˜ å°„åˆ°çŠ¶æ€å˜åŒ–çš„è¿‡ç¨‹ï¼Œå¦‚ä½•å°†è¿™ä¸ªæ˜ å°„çš„è¿‡ç¨‹ä»è§†å›¾ç»„ä»¶ä¸­å‰¥ç¦»å‡ºæ¥ï¼Œå¦‚ä½•ç»„ç»‡è¿™ä¸€éƒ¨åˆ†ä»£ç æ¥æé«˜å¯ç»´æŠ¤æ€§ï¼Œæ˜¯çŠ¶æ€ç®¡ç†è¦è§£å†³çš„æœ¬è´¨é—®é¢˜ æŠŠ Vue å½“ Redux ç”¨æŠŠ Vue å½“ MobX ç”¨ ç°åœ¨çš„çŠ¶æ€ç®¡ç†æ–¹æ¡ˆè¿˜é¢ä¸´ä¸€äº›å…¶ä»–çš„å…±åŒçš„å°´å°¬ï¼Œä¸€ä¸ªæ˜¯ç»„ä»¶çš„å±€éƒ¨çŠ¶æ€å’Œå…¨å±€çŠ¶æ€å¦‚ä½•åŒºåˆ†ï¼Œç°åœ¨æ˜¯å±€éƒ¨çŠ¶æ€å’Œå…¨å±€çŠ¶æ€å¹¶æ²¡æœ‰å¾ˆæ˜æ˜¾çš„åŒºåˆ†ï¼Œå¦ä¸€ä¸ªæ˜¯å…¨å±€çŠ¶æ€å’ŒæœåŠ¡ç«¯æ•°æ®ä¹‹é—´ï¼Œç°æœ‰çš„æ–¹æ¡ˆæ˜¯æŠŠæœåŠ¡ç«¯æŠ“è¿‡æ¥çš„æ•°æ®å¡åˆ°storeé‡Œé¢å» è·¯ç”±è·¯ç”±æ˜¯åªæœ‰åœ¨å¤§å‹çš„å•é¡µåº”ç”¨æ‰ä¼šé‡åˆ°çš„ä¸€ä¸ªé—®é¢˜ï¼Œä¼ ç»Ÿçš„è·¯ç”±æ€æƒ³æ˜¯æ¯”è¾ƒæœ‰ä¾µå…¥å¼çš„ï¼Œæ¯ä¸ªè·¯ç”±æœ‰è‡ªå·±çš„æ•°æ®æ¨¡å‹ï¼Œæœ‰è‡ªå·±çš„æ¨¡æ¿ç­‰ï¼Œä½†æ˜¯å½“Reacå’Œvueå‡ºç°ä¹‹åäººä»¬å‘ç°æŠŠè·¯ç”±å’Œç»„ä»¶è§£è€¦æ˜¯å¯è¡Œçš„å¹¶ä¸”è¿˜æ›´åŠ çµæ´»ï¼Œæ¯”å¦‚Reacç›´æ¥ç”¨ä¸å¸¦è·¯ç”±æ˜¯å®Œå…¨æ²¡é—®é¢˜çš„ï¼Œå¦ä¸€ä¸ªå¯ç¤ºæ˜¯ï¼Œå¦‚æœä»ç»„ä»¶å‡ºå‘å»æ€è€ƒè·¯ç”±ï¼Œæœ¬è´¨ä¸Šå°±å˜æˆäº†æŠŠä¸€ä¸ªurlæ˜ å°„åˆ°ç»„ä»¶æ ‘ç»“æ„çš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œurlåˆ°ç»„ä»¶çš„æ˜ å°„ä¼šæœ‰ä¸€äº›å°çš„åˆ†æ­§ï¼Œæˆ‘ä»¬åˆ°åº•æ˜¯åº”è¯¥ä»urlå‡ºå‘ï¼Œè¿˜æ˜¯ä»è¿™ä¸ªçŠ¶æ€å‡ºå‘ï¼Œå…¶å®æœ¬è´¨æ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºurlå°±æ˜¯ä¸€ä¸ªåºåˆ—åŒ–çš„çŠ¶æ€ã€‚ å½“å®é™…åœ¨SPAä¸­å»åšä¸€ä¸ªä½ ä¼šå‘ç°è·¯ç”±ä¼šæ¶‰åŠåˆ°è®¸å¤šå…¶ä»–é—®é¢˜ï¼Œæ¯”å¦‚è¯´hashæ¨¡å¼å’Œhistoryæ¨¡å¼å¦‚ä½•å…¼å®¹ï¼Œé‡å®šå‘ï¼Œåˆ«åï¼Œæ‡’åŠ è½½ï¼Œç„¶åæœ€å¤æ‚çš„æ˜¯è·³è½¬ï¼Œè·¯ç”±ä¹‹é—´çš„è·³è½¬éœ€è¦æä¾›å„ç§â€é’©å­â€ï¼Œç„¶åè¿™äº›â€é’©å­â€é‡Œé¢åˆå¯èƒ½åšå¼‚æ­¥æ“ä½œï¼Œâ€é’©å­â€é‡Œé¢ä¹Ÿæœ‰å¯èƒ½å–æ¶ˆè¿™æ¬¡è·³è½¬ï¼Œä½¿å¾—è¿™æ¬¡è·³è½¬æ— æ•ˆç­‰ç­‰ã€‚ æ•´ä½“æ¥è¯´ç°åœ¨ä¸»è¦çš„è·¯ç”±æ–¹æ¡ˆéƒ½æœ‰ç‚¹ç›¸ä¼¼ï¼Œæ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯æœ€æ–°çš„reat-router4ï¼Œä»–æ¨å´‡çš„æ˜¯ä¸€ç§ç”¨ç»„ä»¶æœ¬èº«æ¥åšè·¯ç”±çš„ä¸€ç§æ€è·¯ï¼Œè¿™é‡Œå¾ˆå¤§ç¨‹åº¦ä¸Šåˆ©ç”¨äº†ä¸Šè¿°ç¬¬å››å¤§ç»„ä»¶â€åŠŸèƒ½å‹ç»„ä»¶â€ï¼Œåœ¨çˆ¶ç»„ä»¶é‡Œé¢å£°æ˜å¼çš„æ¸²æŸ“å…¶ä»–ç»„ä»¶ï¼Œè·Ÿä¼ ç»Ÿçš„è·¯ç”±ç»„ä»¶æ–¹æ¡ˆçš„åŒºåˆ«æ˜¯â€å»ä¸­å¿ƒåŒ–â€ï¼Œä»–ä¸æ˜¯æŠŠæ•´ä¸ªè·¯ç”±è¡¨å†™åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œæ˜¯åˆ†æ•£çš„å†™åœ¨å„ä¸ªç»„ä»¶é‡Œå¤´ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯çµæ´»æ€§éå¸¸å¥½ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›é—®é¢˜ï¼Œé¦–å…ˆï¼Œé›†ä¸­å¼çš„è·¯ç”±è¡¨å¯¹äºç†è§£æ•´ä¸ªåº”ç”¨çš„ç»“æ„æ˜¯æœ‰å¸®åŠ©çš„ï¼Œå¦ä¸€æ–¹é¢ï¼Œå»ä¸­å¿ƒåŒ–çš„è·¯ç”±å¯¹äºè·³è½¬çš„ç®¡ç†ä¼šå¼±ä¸€äº›ï¼Œä»–å¯¹äºè·³è½¬çš„ç®¡ç†æ˜¯ç›´æ¥ç”¨ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå»åšçš„ã€‚ webè·¯ç”±å’Œappè·¯ç”±çš„åŒºåˆ«ï¼šç›®å‰webè·¯ç”±æ•´ä½“æ€è·¯ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œå°†urlæ˜ å°„åˆ°ç»„ä»¶æ ‘ï¼Œä»ä¸€ä¸ªurlè·³è½¬åˆ°å¦ä¸€ä¸ªurlï¼Œæˆ‘ä»¬æŠŠæ–°çš„url pushåˆ°å†å²çš„stacké‡Œé¢å»äº†ï¼Œä½†æ˜¯stackå‰ä¸€ä¸ªä½ç½®æ‰€å¯¹åº”çš„ä½ç½®æ˜¯è¢«æˆ‘ä»¬ä¸¢å¼ƒæ‰çš„ï¼Œæˆ‘ä»¬ä»ä¸€ä¸ªçŠ¶æ€è¿ç§»åˆ°å¦ä¸€ä¸ªçŠ¶æ€æˆ‘ä»¬æ•´ä¸ªåº”ç”¨ç•Œé¢è¿ç§»åˆ°å¦ä¸€ä¸ªçŠ¶æ€äº†ï¼ŒåŸç”Ÿåº”ç”¨ä¸Šçš„è·³è½¬å°±åƒä¸€å å¡ç‰‡ä¸€æ ·ï¼Œæ–°çš„ç•Œé¢ä¼šç›–åœ¨ç°æœ‰çš„ç•Œé¢ä¸Šï¼Œå½“ä½ é€€å›å»çš„æ—¶å€™åªæ˜¯æŠŠå½“å‰çš„å¡ç‰‡æ‹¿æ‰ï¼Œä¹‹å‰çš„å¡ç‰‡å°±ä¼šå‡ºç°ï¼Œwebç”¨çš„è·¯ç”±æ–¹æ¡ˆåšappä¼šæ¯”è¾ƒåˆ«æ‰­ã€‚ CSSæ–¹æ¡ˆä¸»æµçš„ CSS æ–¹æ¡ˆ è·Ÿ JS å®Œå…¨è§£è€¦ï¼Œé é¢„å¤„ç†å™¨å’Œæ¯”å¦‚ BEM è¿™æ ·çš„è§„èŒƒæ¥ä¿æŒå¯ç»´æŠ¤æ€§ï¼Œåä¼ ç»Ÿ CSS Modulesï¼Œä¾ç„¶æ˜¯ CSSï¼Œä½†æ˜¯é€šè¿‡ç¼–è¯‘æ¥é¿å… CSS ç±»åçš„å…¨å±€å†²çª å„ç±» CSS-in-JS æ–¹æ¡ˆï¼ŒReact ç¤¾åŒºä¸ºä»£è¡¨ï¼Œæ¯”è¾ƒæ¿€è¿› Vue çš„å•æ–‡ä»¶ç»„ä»¶ CSSï¼Œæˆ–æ˜¯ Angular çš„ç»„ä»¶ CSSï¼ˆå†™åœ¨è£…é¥°å™¨é‡Œé¢ï¼‰ï¼Œä¸€ç§æ¯”è¾ƒæŠ˜ä¸­çš„æ–¹æ¡ˆ æ¯”è¾ƒ CSS æ–¹æ¡ˆæ—¶é¦–å…ˆè¦æ˜ç¡®åœºæ™¯çš„é—®é¢˜ï¼Œå¦‚æœåº”ç”¨é€»è¾‘å·²ç»ç»„ä»¶åŒ–äº†ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚åº”ç”¨çš„å¼€å‘ï¼Œä¼ ç»Ÿçš„ CSS æ–¹å¼å¯ç»´æŠ¤æ€§å°±æœ‰é—®é¢˜äº†react-css-in-jsåå¯¹css-in-jsçš„æ–‡ç«  ä¼ ç»Ÿ css çš„ä¸€äº›é—®é¢˜ï¼š ä½œç”¨åŸŸ Critical CSS Atomic CSS åˆ†å‘å¤ç”¨ è·¨å¹³å°å¤ç”¨ css-in-jsæœ‰å¾ˆå¤šä¸åŒçš„æ–¹æ¡ˆï¼Œè¿™äº›æ–¹æ¡ˆå„è‡ªè§£å†³äº†ä¸Šè¿°çš„ä¸€äº›é—®é¢˜ï¼Œä½†æ˜¯å¹¶ä¸å®Œç¾ï¼š CSS Modulesï¼ŒInline-Stylesï¼Œvueçš„å•æ–‡ä»¶ç»„ä»¶é‡Œé¢ç›´æ¥åŠ ä¸€ä¸ªscopedéƒ½å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ æ‰€è°“çš„Critical ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬ç›´å‡ºä¸€ä¸ªé¡µé¢ï¼Œå¯èƒ½æˆ‘ä»¬æ•´ä¸ªåº”ç”¨æœ‰å‡ åä¸ªé¡µé¢ï¼Œä½†æ˜¯æˆ‘ä»¬ç›´å‡ºçš„æ°¸è¿œæ˜¯ç¬¬ä¸€ä¸ªé¡µé¢ï¼Œå¦‚æœæ²¡ä¸€ä¸ªé¡µé¢éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„CSSçš„è¯ï¼Œç†è®ºä¸Šæ¸²æŸ“é¦–å±æˆ‘ä»¬åªéœ€è¦é¦–å±çš„CSSå°±å¤Ÿäº†ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„Critical CSSï¼Œåœ¨æœåŠ¡ç«¯æ¸²æŸ“å°¤ä¸ºé‡è¦ï¼Œè§£å†³çš„åŠæ³•æ˜¯åœ¨æœåŠ¡ç«¯æ¸²æŸ“çš„æ—¶å€™ä¾¦æµ‹åˆ°æ¸²æŸ“è¦ç”¨åˆ°å“ªäº›CSSï¼Œcss-in-jså’Œvue2.3+æœ‰ä¸€ä¸ªè¿è¡Œæ—¶çš„åŠŸèƒ½ï¼Œåœ¨ç¼–è¯‘è¿‡ç¨‹é‡Œé¢å¯ä»¥æŠŠCSSçš„æ’å…¥è·Ÿç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸæŒ‚é’©ï¼ŒåŒæ ·å¯ä»¥èµ·åˆ°æ”¶é›†Critical CSSçš„æ•ˆæœ Liveæé—®ï¼šé—®ï¼šåœ¨vueé‡Œ ä½¿ç”¨CSS Modules ä¼šä¸ä¼šæ¯” ä½¿ç”¨ scoped å¥½ï¼Ÿç­”ï¼šæˆ‘ä¸ªäººè§‰å¾—æ²¡æœ‰ä»€ä¹ˆæœ¬è´¨çš„åŒºåˆ«ï¼Œscopedçš„æˆæœ¬ä¼šæ›´ä½ä¸€ç‚¹ï¼ŒCSS Modulesä¼šæœ‰ä¸€å®šçš„è¿è¡Œæ—¶çš„ä»£ä»·ï¼Œå› ä¸ºéœ€è¦ç”¨åŠ¨æ€çš„classç»‘å®š Atomic CSSçš„æ¦‚å¿µï¼šæ¯”å¦‚è¯´æˆ‘ä»¬æœ‰ä¸¤æ¡CSSè§„åˆ™ï¼Œä¸€æ¡æ˜¯colorï¼šredï¼Œä¸€æ¡æ˜¯colorï¼šgreenï¼Œæˆ‘ä»¬å†™ä¸¤ä¸ªbuttonçš„æ ·å¼ï¼Œä¸€ä¸ªæŒ‰é’®æ˜¯çº¢çš„ï¼Œä¸€ä¸ªæŒ‰é’®æ˜¯ç»¿çš„ï¼ŒåŸå­ç±»çš„è¯å°±ä¼šæŠŠcolorï¼šredå•ç‹¬æ‹†æˆä¸€ä¸ªç±»ï¼šAï¼ŒæŠŠcolorï¼šgreenå•ç‹¬æ‹†æˆä¸€ä¸ªç±»ï¼šBï¼Œç„¶åæ‰€æœ‰buttonå…±äº«çš„å†æ‹†æˆä¸€ä¸ªç±»ï¼šCï¼Œç„¶åçº¢è‰²çš„buttonå¯ä»¥è¯´æ˜¯ACï¼Œç»¿è‰²çš„buttonæ˜¯BCï¼Œæ€»è€Œè¨€ä¹‹å°±æ˜¯æŠŠå°½å¯èƒ½å¤šçš„å…±äº«çš„ä¸€äº›å•ç‹¬çš„è§„åˆ™éƒ½æ‹†æˆä¸€ä¸ªå¾ˆå°å¾ˆå°çš„ç±»ï¼Œè¿™æ ·å‡ºæ¥çš„æœ€åçš„ç»“æœæ˜¯ä½ çš„CSSå¯å‹ç¼©æ€§æ›´å¥½äº†ï¼Œå¯ä»¥å˜å¾—æ›´å°ï¼Œå¯¹åº”äºcss-in-jsé‡Œé¢çš„Style Chunk åˆ†å‘å¤ç”¨çš„è®ºç‚¹æ˜¯è¯´css-in-jséƒ½æ˜¯Javascriptï¼Œæ‰€ä»¥å¯ä»¥è·Ÿæ™®é€šçš„Javascriptæ¨¡å—ä¸€æ ·ç›´æ¥å‘åŒ…åˆ°npmä¸Šå»å¤ç”¨ï¼Œç¡®å®Javascriptæ¯”çº¯CSSæ›´å®¹æ˜“å»ç»„åˆå¤ç”¨ï¼Œä½†æ˜¯cssä½ ä¹Ÿå¯ä»¥å‘åˆ°npmä¸Šç„¶åwebpackç›´æ¥å¼•ç”¨ï¼Œè¿™ä¸€ç‚¹ä¸Šå¹¶ä¸ç®—å®Œå…¨çš„ä¼˜åŠ¿ è·¨å¹³å°å¤ç”¨ï¼šVueXé‡Œé¢å°±æ˜¯æŠŠé™æ€çš„cssåœ¨parseä¹‹åç¼–è¯‘æˆJavascriptï¼Œå°±å¯ä»¥è·¨å¹³å°å¤ç”¨äº† æ„å»ºå·¥å…·æ„å»ºå·¥å…·è§£å†³çš„å…¶å®æ˜¯å‡ æ–¹é¢çš„é—®é¢˜ï¼š ä»»åŠ¡çš„è‡ªåŠ¨åŒ– å¼€å‘ä½“éªŒå’Œæ•ˆç‡ï¼ˆæ–°çš„è¯­è¨€åŠŸèƒ½ï¼Œè¯­æ³•ç³–ï¼Œhot reload ç­‰ç­‰ï¼‰ éƒ¨ç½²ç›¸å…³çš„éœ€æ±‚ ç¼–è¯‘æ—¶ä¼˜åŒ– å¤§å…¬å¸é‡Œæ€æ ·å¼€å‘å’Œéƒ¨ç½²å‰ç«¯ä»£ç  è™½ç„¶ Vue æœ¬èº«ç”¨ flowï¼Œä½†å»ºè®®ä½¿ç”¨ TypeScript çš„ flowï¼Œä¸»è¦ä»å¼€å‘ä½“éªŒã€ç”Ÿæ€å®Œå–„åº¦ä¸Šè€ƒè™‘ æœåŠ¡ç«¯æ•°æ®é€šä¿¡é•¿ä¹…ä»¥æ¥æˆ‘ä»¬ä¼ ç»Ÿçš„åšæ³•éƒ½æ˜¯å›´ç»•Restï¼ŒæœåŠ¡ç«¯å¦‚æœæš´éœ²çš„æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ ‡å‡†çš„Rest APIï¼Œé‚£æˆ‘ä»¬å®¢æˆ·ç«¯å°±å¯ä»¥ç›´æ¥æ‹¿ä¸€ä¸ªfetchç›´æ¥å»æŠ“ï¼Œæˆ–è€…å›´ç»•Restæ¥åšä¸€ä¸ªèµ„æºçš„æŠ½è±¡/å°è£…ï¼Œç‰¹å®šçš„åº”ç”¨ä¼šé‡åˆ°æ¯”è¾ƒå¤æ‚çš„åœºæ™¯ï¼Œä¸€ç§æ˜¯ï¼Œæ•°æ®ç›´è¿ï¼Œæ•°æ®ä¹‹é—´æœ‰å¤§é‡çš„å…³è”æ€§ï¼Œå¦ä¸€ç±»æ˜¯æœ‰å®æ—¶æ¨é€åŒæ­¥çš„éœ€æ±‚ï¼Œè¿™ç§æƒ…å†µä¸‹ä¼ ç»Ÿçš„Reståšæ³•ä¼šæ¯”è¾ƒç—›è‹¦ã€‚Vue.js æœåŠ¡å™¨ç«¯æ¸²æŸ“æŒ‡å— è·¨å¹³å°æ¸²æŸ“ä»å‰ç«¯æ¡†æ¶çš„è§’åº¦å»çœ‹ï¼Œè·¨å¹³å°æ¸²æŸ“çš„æœ¬è´¨æ˜¯åœ¨è®¾è®¡æ¡†æ¶çš„æ—¶å€™è¦è®©æ¡†æ¶çš„æ¸²æŸ“æœºåˆ¶å’ŒDOMè§£è€¦ï¼Œè¿™é‡Œé¢æœ‰å¾ˆå¤šç§å®ç°æ–¹å¼ï¼Œå¹¶ä¸ä¸€å®šéœ€è¦Virtual Domï¼Œæœ¬è´¨ä¸Šåªè¦æŠŠæ¡†æ¶æ›´æ–°æ—¶å€™çš„ä¸€äº›èŠ‚ç‚¹æ“ä½œå°è£…èµ·æ¥ï¼Œä½ å°±å¯ä»¥åšåˆ°è·¨å¹³å°ï¼Œä¸€ä¸ªåŸç”Ÿçš„æ¸²æŸ“å¼•æ“ï¼Œæ¯”å¦‚ React Native å’Œ VueXæœ¬è´¨éƒ½æ˜¯åœ¨åº•å±‚é’ˆå¯¹æ¯ä¸ªå¹³å°æœ‰ä¸€ä¸ªé€‚é…çš„æ¸²æŸ“å¼•æ“ï¼Œåªè¦æŠŠæ¸²æŸ“å¼•æ“æš´éœ²çš„ç»“ç‚¹æ“ä½œçš„ APIï¼Œè·Ÿæ¡†æ¶è¿è¡Œæ—¶å¯¹æ¥ä¸€ä¸‹ï¼Œå°±å¯ä»¥å®ç°å°†æ¡†æ¶é‡Œé¢çš„ä»£ç æ¸²æŸ“åˆ°åŸç”Ÿçš„ç›®çš„ã€‚è¿™é‡Œçš„è§£è€¦å¾ˆæ¸…æ™°ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆèƒ½çœ‹åˆ° NG å¯ä»¥æ¥ React Nativeï¼ŒVueX å¯ä»¥è·‘ Vue æ–‡ä»¶ï¼ŒVueX å¯ä»¥è·‘åœ¨ NativeScript ä¸Šç­‰ç­‰ã€‚ æ–°è§„èŒƒ Web ComponentWeb Component å’Œç±» Reactã€Angularã€Vue ç»„ä»¶åŒ–æŠ€æœ¯è°ä¼šæˆä¸ºæœªæ¥ï¼Ÿ WebAssemblyæ˜¯é¢å‘ Web çš„é€šç”¨äºŒè¿›åˆ¶å’Œæ–‡æœ¬æ ¼å¼ï¼Œå¯ä»¥è·‘åœ¨æµè§ˆå™¨é‡Œé¢ã€‚ä½†æ˜¯åœ¨ç›®å‰çš„å½¢åŠ¿ä¸‹ï¼ŒWebAssembly æš‚æ—¶è¿˜æ“ä½œä¸äº† DOMï¼Œå¯¹äºæ¡†æ¶çš„å½±å“æš‚æ—¶æ¯”è¾ƒæœ‰é™ï¼Œå¾…è§‚æœ› æ€»ç»“æ€»ç»“ä¸€ä¸‹å§ï¼Œæˆ‘ä»¬èŠäº†å¾ˆå¤šä¸œè¥¿ï¼Œå¯èƒ½æ¯”è¾ƒæ‚ï¼Œä½†æˆ‘å¸Œæœ›å¤§å®¶å‘ç°å…¶ä¸­ä¸€äº›å…±æ€§çš„ä¸œè¥¿ï¼šæŠ€æœ¯æ–¹æ¡ˆéƒ½æ˜¯å…ˆæœ‰é—®é¢˜ï¼Œå†æœ‰æ€è·¯ï¼ŒåŒæ—¶ä¼´éšç€å–èˆã€‚åœ¨é€‰æ‹©è¡¡é‡æŠ€æœ¯çš„æ—¶å€™ï¼Œå°½é‡å»æ€è€ƒè¿™ä¸ªæŠ€æœ¯èƒŒåæ˜¯åœ¨è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Œå®ƒåšäº†æ€æ ·çš„å–èˆã€‚è¿™æ ·ä¸€æ–¹é¢å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„ç†è§£å’Œä½¿ç”¨è¿™äº›æŠ€æœ¯ï¼Œä¹Ÿä¸ºä»¥åå“ªå¤©ä½ é‡åˆ°ä¸šåŠ¡ä¸­çš„ç‰¹æ®Šæƒ…å†µï¼Œéœ€è¦è‡ªå·±åšæ–¹æ¡ˆçš„æ—¶å€™æ‰“å¥½åŸºç¡€ã€‚","tags":[{"name":"å‰ç«¯æ¡†æ¶","slug":"å‰ç«¯æ¡†æ¶","permalink":"https://www.limuyang.cc/tags/å‰ç«¯æ¡†æ¶/"},{"name":"çŸ¥ä¹Live","slug":"çŸ¥ä¹Live","permalink":"https://www.limuyang.cc/tags/çŸ¥ä¹Live/"},{"name":"å°¤é›¨æºª","slug":"å°¤é›¨æºª","permalink":"https://www.limuyang.cc/tags/å°¤é›¨æºª/"}]},{"title":"javascriptä¸­callã€applyã€bindæ–¹æ³•çš„ä½¿ç”¨","date":"2017-11-08T20:50:19.000Z","path":"2017/11/08/javascriptä¸­callã€applyã€bindæ–¹æ³•çš„ä½¿ç”¨/","text":"contextçš„æ¦‚å¿µåœ¨çŸ¥é“æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ä½¿ç”¨callã€applyã€bindæ–¹æ³•ä¹‹å‰ï¼Œæˆ‘è§‰å¾—æœ‰å¿…è¦å…ˆäº†è§£ä¸€ä¸‹contextçš„ç›¸å…³æ¦‚å¿µï¼Œé€šå¸¸contextçš„ä½œç”¨æ˜¯å–å†³äºå‡½æ•°å°†å¦‚ä½•è¢«è°ƒç”¨ï¼Œå½“å‡½æ•°ä½œä¸ºå¯¹è±¡çš„æ–¹æ³•è°ƒç”¨æ—¶ï¼Œthiså°±ä¼šè¢«è®¾ç½®ä¸ºè°ƒç”¨æ–¹æ³•çš„å¯¹è±¡ï¼š1234567var object = &#123; foo: function()&#123; console.log(this === object); &#125; &#125;; object.foo(); // true å½“é€šè¿‡newä¸€ä¸ªå¯¹è±¡çš„å®ä¾‹çš„æ–¹å¼æ¥è°ƒç”¨ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œthisçš„å€¼å°†è¢«è®¾ç½®ä¸ºæ–°åˆ›å»ºçš„å®ä¾‹ï¼š123456function foo()&#123; console.log(this); &#125; foo() // window new foo() // foo&#123;&#125; å½“ä½œä¸ºæœªç»‘å®šå¯¹è±¡è¢«è°ƒç”¨æ—¶ï¼Œthisé»˜è®¤æŒ‡å‘å…¨å±€ä¸Šä¸‹æ–‡æˆ–è€…æµè§ˆå™¨ä¸­çš„windowå¯¹è±¡ã€‚ç„¶è€Œï¼Œå¦‚æœå‡½æ•°åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹è¢«æ‰§è¡Œï¼Œä¸Šä¸‹æ–‡å°†è¢«é»˜è®¤ä¸ºundefined åŠ¨æ€æ”¹å˜thisçš„å€¼ç„¶è€Œcallã€applyã€bindæ–¹æ³•å…è®¸ä½ åœ¨è‡ªå®šä¹‰çš„contextä¸­æ‰§è¡Œå‡½æ•°ï¼Œä»€ä¹ˆæ„æ€å‘¢ï¼Œé€šä¿—çš„è¯´å°±æ˜¯å¯ä»¥ä¸éµå¾ªä¸Šé¢ç»™å‡ºçš„éƒ¨åˆ†å®šä¹‰ï¼Œå¯ä»¥åŠ¨æ€çš„æ”¹å˜thisï¼Œæˆ‘ä»¬ç›´æ¥å¼•å‡ºMDNå…³äºcallæ–¹æ³•çš„å®šä¹‰ï¼š call() æ–¹æ³•è°ƒç”¨ä¸€ä¸ªå‡½æ•°, å…¶å…·æœ‰ä¸€ä¸ªæŒ‡å®šçš„thiså€¼å’Œåˆ†åˆ«åœ°æä¾›çš„å‚æ•°(å‚æ•°çš„åˆ—è¡¨) ä¸¾ä¸ªä¾‹å­ï¼š123456789// éä¸¥æ ¼æ¨¡å¼ä¸‹function add(args) &#123; console.log(this); &#125; function sub(args) &#123; console.log(this); &#125; add(); // Window &#123;frames: Window, postMessage: Æ’, blur: Æ’, focus: Æ’, close: Æ’, â€¦&#125; sub(); // Window &#123;frames: Window, postMessage: Æ’, blur: Æ’, focus: Æ’, close: Æ’, â€¦&#125; ç»“æœæ˜¯ç¬¦åˆé¢„æœŸçš„ï¼š å½“ä½œä¸ºæœªç»‘å®šå¯¹è±¡è¢«è°ƒç”¨æ—¶ï¼Œthisé»˜è®¤æŒ‡å‘å…¨å±€ä¸Šä¸‹æ–‡æˆ–è€…æµè§ˆå™¨ä¸­çš„windowå¯¹è±¡ æˆ‘ä»¬ç»™ä»–åŠ ä¸Šcallæ–¹æ³•ï¼š1234567891011// éä¸¥æ ¼æ¨¡å¼ä¸‹ function add(args) &#123; console.log(this); &#125; function sub(args) &#123; console.log(this); &#125; add(); // Window &#123;frames: Window, postMessage: Æ’, blur: Æ’, focus: Æ’, close: Æ’, â€¦&#125; sub(); // Window &#123;frames: Window, postMessage: Æ’, blur: Æ’, focus: Æ’, close: Æ’, â€¦&#125; add.call(sub,1); // Æ’ sub(args) &#123; ... &#125; sub.call(add,1); // Æ’ add(args) &#123; ... &#125; è¿™æ—¶å€™thisçš„å€¼æœ‰ç‚¹ç±»ä¼¼äºç¬¬ä¸€ç§æƒ…å†µï¼š å½“å‡½æ•°ä½œä¸ºå¯¹è±¡çš„æ–¹æ³•è°ƒç”¨æ—¶ï¼Œthiså°±ä¼šè¢«è®¾ç½®ä¸ºè°ƒç”¨æ–¹æ³•çš„å¯¹è±¡ çœ‹èµ·æ¥æˆ‘ä»¬è°ƒç”¨callæ–¹æ³•çš„æ—¶å€™å¥½åƒå®é™…ä¸Šæ˜¯è¿›è¡Œäº†å¯¹è±¡æ–¹æ³•çš„è°ƒç”¨ï¼š 12345678sub.call(add,1); //sub=&gt;var sub = &#123; add: function()&#123; console.log(this); &#125;&#125;;sub.add(); // sub è¿™å°±æ˜¯åŠ¨æ€çš„æ”¹å˜äº†thisè¿˜æœ‰ä¸€ç‚¹è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œcallå’Œapplyæ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°çš„thiså€¼å¹¶ä¸ä¸€å®šæ˜¯è¯¥å‡½æ•°æ‰§è¡Œæ—¶çœŸæ­£çš„thiså€¼ï¼Œæ¯”å¦‚åœ¨éä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬ä¼ å…¥nullæˆ–undefinedä¼šè‡ªåŠ¨æŒ‡å‘å…¨å±€å¯¹è±¡ï¼Œåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­å°±æ˜¯windowï¼Œåœ¨nodeç¯å¢ƒä¸­å°±æ˜¯globalï¼Œå¦å¤–æˆ‘ä»¬è¿˜å¯ä»¥ä¼ å…¥ä¸€äº›åŸå§‹å€¼(æ•°å­—ï¼Œå­—ç¬¦ä¸²ï¼Œå¸ƒå°”å€¼)ï¼Œè¿™æ—¶å€™çš„thisä¼šæŒ‡å‘è¿™äº›åŸå§‹å€¼çš„åŒ…è£…å¯¹è±¡ï¼Œæ¯”å¦‚ä¼ å…¥çš„æ˜¯æ•°å­—ï¼Œä¼šæŒ‡å‘Numberã€‚ callå’Œapplyçš„åŒºåˆ«æ—¢ç„¶callå’Œapplyæ–¹æ³•èƒ½å¤ŸåŠ¨æ€çš„æ”¹å˜thisçš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§æ¥å®ç°ç®€å•çš„ç»§æ‰¿ï¼Œæ¯”å¦‚æ­¤æ—¶æˆ‘ä»¬æœ‰ä¸€ä¸ªçˆ¶æ„é€ å‡½æ•°ï¼š1234567function Product(name, age) &#123; this.name = name; this.age = age; this.say = function() &#123; console.log(this.name+\"is\"+this.age+\"years old\"); &#125; &#125; å¦‚æœæˆ‘ä»¬æƒ³å†™ä¸€ä¸ªå­æ„é€ å‡½æ•°ï¼Œåªéœ€è¦åœ¨å­æ„é€ å‡½æ•°é‡Œé¢è°ƒç”¨çˆ¶æ„é€ å‡½æ•°çš„callæ–¹æ³•å°±å¯ä»¥å®ç°ç»§æ‰¿ï¼š1234function Toy(name, price) &#123; Product.call(this, name, price); this.self = \"single\"; &#125; å®ç°ç»§æ‰¿çš„åŒæ—¶çˆ¶å­æ„é€ å‡½æ•°è¿˜éƒ½èƒ½åˆ†åˆ«æœ‰è‡ªå·±çš„å±æ€§ï¼Œæ¯”å¦‚è¿™é‡Œçš„selfå±æ€§ã€‚è¿™é‡Œä½¿ç”¨äº†callæ–¹æ³•ä½œä¸ºæ¼”ç¤ºï¼Œå…¶å®applyæ–¹æ³•çš„ä½¿ç”¨å’Œcallæ–¹æ³•å¹¶æ— å¤šå¤§åŒºåˆ«ï¼Œé‡ç‚¹åœ¨å‚æ•°ä¸Šï¼Œä»–ä»¬çš„ç¬¬ä¸€ä¸ªå‚æ•°éƒ½æ˜¯ä¸€ä¸ªæŒ‡å®šçš„thiså€¼ï¼Œè¿™ä¸ªå€¼å¯ä»¥æ˜¯ä»»æ„jså¯¹è±¡ï¼Œä½†æ˜¯ç¬¬äºŒä¸ªå‚æ•°æœ‰åŒºåˆ«ï¼Œcallæ–¹æ³•æ¥å—çš„æ˜¯è‹¥å¹²ä¸ªå‚æ•°çš„åˆ—è¡¨ï¼Œè€Œapplyæ–¹æ³•æ¥å—çš„æ˜¯ä¸€ä¸ªåŒ…å«å¤šä¸ªå‚æ•°çš„æ•°ç»„ï¼Œå¦‚æœä¸Šé¢çš„ä¾‹å­ç”¨applyæ¥å†™çš„è¯å°±æ˜¯è¿™æ ·ï¼š123456789101112function Product(name, age) &#123; this.name = name; this.age = age; this.say = function() &#123; console.log(this.name+\"is\"+this.age+\"years old\"); &#125; &#125; function Toy(name, price) &#123; Product.apply(this, [name, price]); this.self = \"single\"; &#125; bindæ–¹æ³•çš„ç‰¹æ®Šæ€§ä¹‹æ‰€ä»¥æŠŠbindæ–¹æ³•å•ç‹¬æ”¾å‡ºæ¥æ˜¯å› ä¸ºbindæ–¹æ³•å’Œå‰é¢ä¸¤è€…è¿˜æ˜¯æœ‰ä¸å°çš„åŒºåˆ«çš„ï¼Œè™½ç„¶éƒ½æ˜¯åŠ¨æ€æ”¹å˜thisçš„å€¼ï¼Œä¸¾ä¸ªä¾‹å­ï¼š123456789101112var obj = &#123; x: 81, &#125;; var foo = &#123; getX: function() &#123; return this.x; &#125; &#125; console.log(foo.getX.bind(obj)()); //81 console.log(foo.getX.call(obj)); //81 console.log(foo.getX.apply(obj)); //81 æœ‰æ²¡æœ‰æ³¨æ„åˆ°ä½¿ç”¨bindæ–¹æ³•æ—¶å€™åé¢è¿˜è¦å¤šåŠ ä¸Šä¸€å¯¹æ‹¬å·ï¼Œå› ä¸ºä½¿ç”¨bindåªæ˜¯è¿”å›äº†å¯¹åº”å‡½æ•°å¹¶æ²¡æœ‰ç«‹å³æ‰§è¡Œï¼Œè€Œcallå’Œapplyæ–¹æ³•æ˜¯ç«‹å³æ‰§è¡Œçš„ï¼Œå¹¶ä¸”MDNè¿˜æåˆ°ï¼Œå½“ä½¿ç”¨newæ“ä½œç¬¦è°ƒç”¨ç»‘å®šå‡½æ•°æ—¶æŒ‡å®šçš„thiså‚æ•°ä¼šå˜æ— æ•ˆï¼š1234567891011var obj = &#123; x: 81, &#125;; var foo = &#123; getX: function() &#123; return this.x; &#125; &#125; var result = foo.getX.bind(obj); console.log(new result()); //getX bindæ–¹æ³•çš„å¦ä¸€ä¸ªåº”ç”¨æ˜¯ä½¿ä¸€ä¸ªå‡½æ•°æ‹¥æœ‰é¢„è®¾çš„åˆå§‹å‡½æ•°ï¼Œè¿™äº›å‚æ•°ä½œä¸ºbindçš„ç¬¬äºŒä¸ªå‚æ•°è·Ÿåœ¨this(æˆ–å…¶ä»–å¯¹è±¡)åé¢ï¼Œä¹‹åå®ƒä»¬ä¼šè¢«æ’å…¥åˆ°ç›®æ ‡å‡½æ•°çš„å‚æ•°åˆ—è¡¨çš„å¼€å§‹ä½ç½®ï¼Œä¼ é€’ç»™ç»‘å®šå‡½æ•°çš„å‚æ•°ä¼šè·Ÿåœ¨å®ƒä»¬çš„åé¢ï¼š1234567891011function list() &#123; return Array.prototype.slice.call(arguments);&#125;var list1 = list(1, 2, 3); // [1, 2, 3]// Create a function with a preset leading argumentvar leadingThirtysevenList = list.bind(undefined, 37);var list2 = leadingThirtysevenList(); // [37]var list3 = leadingThirtysevenList(1, 2, 3); // [37, 1, 2, 3] å‚è€ƒé“¾æ¥Understanding Scope and Context in JavaScript Function.prototype.call()","tags":[{"name":"javascript","slug":"javascript","permalink":"https://www.limuyang.cc/tags/javascript/"},{"name":"call","slug":"call","permalink":"https://www.limuyang.cc/tags/call/"},{"name":"apply","slug":"apply","permalink":"https://www.limuyang.cc/tags/apply/"},{"name":"bind","slug":"bind","permalink":"https://www.limuyang.cc/tags/bind/"}]},{"title":"javascriptç«‹å³æ‰§è¡Œå‡½æ•°(IIFE)","date":"2017-09-11T21:46:54.000Z","path":"2017/09/11/javascriptç«‹å³æ‰§è¡Œå‡½æ•°-IIFE/","text":"é€šå¸¸æˆ‘ä»¬å£°æ˜ä¸€ä¸ªå‡½æ•°æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š12345678910111213141516171819202122// å£°æ˜å‡½æ•°f1function f1() &#123; console.log(\"f1\");&#125;// é€šè¿‡()æ¥è°ƒç”¨æ­¤å‡½æ•°f1();//ä¸€ä¸ªåŒ¿åå‡½æ•°çš„å‡½æ•°è¡¨è¾¾å¼ï¼Œè¢«èµ‹å€¼ç»™å˜é‡f2:var f2 = function() &#123; console.log(\"f2\");&#125;//é€šè¿‡()æ¥è°ƒç”¨æ­¤å‡½æ•°f2();//ä¸€ä¸ªå‘½åä¸ºf3çš„å‡½æ•°çš„å‡½æ•°è¡¨è¾¾å¼(è¿™é‡Œçš„å‡½æ•°åå¯ä»¥éšæ„å‘½åï¼Œå¯ä»¥ä¸å¿…å’Œå˜é‡f3é‡å)ï¼Œè¢«èµ‹å€¼ç»™å˜é‡f3:var f3 = function f3() &#123; console.log(\"f3\");&#125;//é€šè¿‡()æ¥è°ƒç”¨æ­¤å‡½æ•°f3(); å¦‚æœä½ çœ‹è¿‡ä¸€äº›è‡ªå®šä¹‰æ§ä»¶çš„è¯ä½ ä¼šå‘ç°ä»–ä»¬å¤§å¤šæ•°éƒ½æ˜¯æ²¿ç”¨è¿™ç§å†™æ³•ï¼š 1234(function() &#123; ... // è¿™é‡Œå¼€å§‹å†™åŠŸèƒ½éœ€æ±‚ &#125;)(); è¿™æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ç«‹å³æ‰§è¡Œå‡½æ•°(IIFE)ï¼Œé¡¾åæ€ä¹‰ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªå‡½æ•°æ˜¯ç«‹å³æ‰§è¡Œå‡½æ•°ä½“çš„ï¼Œä¸éœ€è¦ä½ é¢å¤–å»ä¸»åŠ¨çš„å»è°ƒç”¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬åªå¯¹åŒ¿åå‡½æ•°ä½¿ç”¨IIFEï¼Œè¿™ä¹ˆåšæœ‰ä¸¤ä¸ªç›®çš„ï¼š ä¸€æ˜¯ä¸å¿…ä¸ºå‡½æ•°å‘½åï¼Œé¿å…äº†æ±¡æŸ“å…¨å±€å˜é‡ äºŒæ˜¯IIFEå†…éƒ¨å½¢æˆäº†ä¸€ä¸ªå•ç‹¬çš„ä½œç”¨åŸŸï¼Œå¯ä»¥å°è£…ä¸€äº›å¤–éƒ¨æ— æ³•è¯»å–çš„ç§æœ‰å˜é‡ã€‚ å¦‚æœçœ‹åˆ°è¿™ä¸¤å¥è¯æ— æ³•ç†è§£ï¼Œé‚£ä¹ˆå…ˆä»IIFEçš„è¿è¡ŒåŸç†è¯´èµ·ã€‚ å› ä¸ºIIFEé€šå¸¸ç”¨äºåŒ¿åå‡½æ•°ï¼Œè¿™é‡Œå°±ç”¨ç®€å•çš„åŒ¿åå‡½æ•°ä½œä¸ºæ —å­ï¼š 1234var f = function()&#123; console.log(\"f\");&#125;f(); æˆ‘ä»¬å‘ç°è¿™é‡Œfåªæ˜¯è¿™ä¸ªåŒ¿åå‡½æ•°çš„ä¸€ä¸ªå¼•ç”¨å˜é‡ï¼Œé‚£ä¹ˆæ—¢ç„¶f()èƒ½å¤Ÿè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œæˆ‘æŠŠfæ›¿æ¢æˆå‡½æ•°æœ¬èº«å¯ä»¥ä¹ˆï¼š 123function()&#123; console.log(\"f\");&#125;(); è¿è¡Œä¹‹åå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š 1Uncaught SyntaxError: Unexpected token ( äº§ç”Ÿè¿™ä¸ªé”™è¯¯çš„åŸå› æ˜¯ï¼ŒJavascriptå¼•æ“çœ‹åˆ°functionå…³é”®å­—ä¹‹åï¼Œè®¤ä¸ºåé¢è·Ÿçš„æ˜¯å‡½æ•°å£°æ˜è¯­å¥ï¼Œä¸åº”è¯¥ä»¥åœ†æ‹¬å·ç»“å°¾ã€‚è§£å†³æ–¹æ³•å°±æ˜¯è®©å¼•æ“çŸ¥é“ï¼Œåœ†æ‹¬å·å‰é¢çš„éƒ¨åˆ†ä¸æ˜¯å‡½æ•°å®šä¹‰è¯­å¥ï¼Œè€Œæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå¯ä»¥å¯¹æ­¤è¿›è¡Œè¿ç®—ï¼Œè¿™é‡ŒåŒºåˆ†ä¸€ä¸‹å‡½æ•°å£°æ˜å’Œå‡½æ•°è¡¨è¾¾å¼ï¼š 12345671ã€å‡½æ•°å£°æ˜(å³æˆ‘ä»¬é€šå¸¸ä½¿ç”¨function x()&#123;&#125;æ¥å£°æ˜ä¸€ä¸ªå‡½æ•°)function myFunction () &#123; /* logic here */ &#125;2ã€å‡½æ•°è¡¨è¾¾å¼(ç±»ä¼¼ä»¥è¿™ç§çš„å½¢å¼)var myFunction = function () &#123; /* logic here */ &#125;;var myObj = &#123; myFunction: function () &#123; /* logic here */ &#125;&#125;; å°å­¦æˆ‘ä»¬å°±å­¦è¿‡ç”¨()æ‹¬èµ·æ¥çš„è¡¨è¾¾å¼ä¼šå…ˆæ‰§è¡Œï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š 11+(2+3) //è¿™é‡Œå…ˆè¿è¡Œå°æ‹¬å·é‡Œé¢çš„å†…å®¹æ²¡æœ‰æ„è§æ’’ å…¶å®åœ¨javascriptä¸­å°æ‹¬å·ä¹Ÿæœ‰ç›¸ä¼¼çš„ä½œç”¨ï¼ŒJavascriptå¼•æ“çœ‹åˆ°functionå…³é”®å­—ä¼šè®¤ä¸ºæ˜¯å‡½æ•°å£°æ˜è¯­å¥ï¼Œé‚£ä¹ˆå¦‚æœJavascriptå¼•æ“ä¼˜å…ˆçœ‹åˆ°å°æ‹¬å·ä¼šæ€ä¹ˆæ ·ï¼š 1234//ç”¨å°æ‹¬å·æŠŠå‡½æ•°åŒ…è£¹èµ·æ¥(function()&#123; console.log(\"f\");&#125;)(); å‡½æ•°æˆåŠŸæ‰§è¡Œäº†ï¼š 1f //æ§åˆ¶å°è¾“å‡º è¿™ç§æƒ…å†µä¸‹Javascriptå¼•æ“å°±ä¼šè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè€Œä¸æ˜¯å‡½æ•°å£°æ˜ï¼Œå½“ç„¶è¦è®©Javascriptå¼•æ“è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼çš„æ–¹æ³•è¿˜æœ‰å¾ˆå¤šï¼š 1234567!function()&#123;&#125;();+function()&#123;&#125;();-function()&#123;&#125;();~function()&#123;&#125;();new function()&#123; /* code */ &#125;new function()&#123; /* code */ &#125;() // åªæœ‰ä¼ é€’å‚æ•°æ—¶ï¼Œæ‰éœ€è¦æœ€åé‚£ä¸ªåœ†æ‹¬å·ã€‚... å›åˆ°å‰é¢çš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆè¯´IIFEè¿™ç§å½¢å¼é¿å…äº†æ±¡æŸ“å…¨å±€å˜é‡ï¼Œå¦‚æœä½ è§è¿‡åˆ«äººå†™çš„jqueryæ’ä»¶ï¼Œé‡Œé¢é€šå¸¸ä¼šæœ‰ç±»ä¼¼è¿™æ ·çš„ä»£ç ï¼š 1234(function($)&#123; ... //æ’ä»¶å®ç°ä»£ç &#125;)(jQuery); è¿™é‡Œçš„jqueryå…¶å®æ˜¯è¯¥åŒ¿åå‡½æ•°çš„å‚æ•°ï¼Œè”æƒ³ä¸€ä¸‹æˆ‘ä»¬è°ƒç”¨åŒ¿åå‡½æ•°æ—¶å€™æ˜¯ç”¨f()é‚£ä¹ˆåŒ¿åå¸¦å‚æ•°çš„å°±æ˜¯f(args)å¯¹å§ï¼Œè¿™é‡ŒæŠŠjqueryä½œä¸ºå‚æ•°ä¼ å…¥è¯¥å‡½æ•°ï¼Œé‚£ä¹ˆåœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨å½¢å‚$çš„æ—¶å€™å°±ä¸ä¼šå½±å“åˆ°å¤–éƒ¨ç¯å¢ƒï¼Œå› ä¸ºæœ‰äº›æ’ä»¶ä¹Ÿä¼šç”¨åˆ°$è¿™ä¸ªé™å®šç¬¦ï¼Œä½ åœ¨è¿™ä¸ªå‡½æ•°å†…éƒ¨å¯ä»¥éšæ„æŠ˜è…¾ã€‚ ä»¥ä¸Šï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­å‚è€ƒäº†ä»¥ä¸‹ä¸¤ç¯‡æ–‡ç« ï¼š javascriptç«‹å³æ‰§è¡ŒæŸä¸ªå‡½æ•°ï¼šæ’ä»¶ä¸­function(){}()å†æ€è€ƒ JavaScriptä¸­çš„ç«‹å³æ‰§è¡Œå‡½æ•°","tags":[{"name":"javascript","slug":"javascript","permalink":"https://www.limuyang.cc/tags/javascript/"},{"name":"IIFE","slug":"IIFE","permalink":"https://www.limuyang.cc/tags/IIFE/"}]},{"title":"å‘Šåˆ«äº”æœˆ","date":"2017-06-01T22:06:01.000Z","path":"2017/06/01/å‘Šåˆ«äº”æœˆ/","text":"2017å¹´6æœˆ1å·è½¬çœ¼å°±è·‘åˆ°é‚£ä¼¼æ°´æµå¹´é‡Œå»äº†ï¼Œç„¶è€Œèº«è¾¹çš„äººéƒ½ä¸çè§†è‡ªå·±çš„ä¼¼æ°´æµå¹´æˆ‘è¦å‘Šåˆ«5æœˆ è¯‰ä¸€æ•´ä¸ª5æœˆæ˜¯æˆ‘æˆé•¿æœ€å¿«çš„æ—¥å­æˆ‘å¿ƒé‡Œå¾ˆä¹±ï¼Œå½“æˆ‘æ²¿ç€è¿™æ¡è·¯èµ°ä¸‹å»çš„æ—¶å€™å¿ƒé‡Œæ€»æƒ³ç€å¦ä¸€æ¡è·¯ä¸Šçš„äº‹å¥½åƒç‹å°æ³¢åœ¨ã€Šé»„é‡‘æ—¶ä»£ã€‹ä¸­æè¿°åˆ°çš„ï¼šâ€é‚£ä¸€å¹´æˆ‘äºŒåä¸€å²ï¼Œåœ¨æˆ‘ä¸€ç”Ÿçš„é»„é‡‘æ—¶ä»£ï¼Œæˆ‘æœ‰å¥½å¤šå¥¢æœ›ã€‚æˆ‘æƒ³çˆ±ï¼Œæƒ³åƒï¼Œè¿˜æƒ³åœ¨ä¸€ç¬é—´å˜æˆå¤©ä¸ŠåŠæ˜åŠæš—çš„äº‘ã€‚â€ åˆ«åœ¨2017-06-01è¿™ä¸ªèŠ‚ç‚¹æˆ‘æŠŠå¤šè¯´æ¢æˆäº†æœç‹ç•…è¨€è®©æˆ‘å’Œä½ å‘Šä¸ªåˆ«å¼€æºä¸æ˜“ï¼Œä¸”è¡Œä¸”çæƒœ ç¦»æˆ‘åªæ„¿è“¬å‹ƒçš„ç”Ÿæ´»åœ¨æ­¤æ—¶æ­¤åˆ»æˆä¸ºä¸€åçœŸæ­£æ„ä¹‰ä¸Šçš„ç§»åŠ¨WEBå‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆâ€œç§»åŠ¨â€ä¸¤å­—æ˜¯æˆ‘åˆ»æ„åŠ ä¸Šå»çš„ï¼Œå¾ˆå¥½çš„æ˜¾éœ²å‡ºæˆ‘æ²¡æœ‰å¦‚æ„¿æˆä¸ºä¸€åç§»åŠ¨å¼€å‘å·¥ç¨‹å¸ˆçš„ä¸å¿¿æœ€åï¼Œæˆ‘å‘ç°æˆ‘çœŸçš„èƒ–äº†ã€‚","tags":[{"name":"å‘Šåˆ«","slug":"å‘Šåˆ«","permalink":"https://www.limuyang.cc/tags/å‘Šåˆ«/"}]},{"title":"è‡ªå§‹è‡³ç»ˆ","date":"2017-02-17T22:25:29.000Z","path":"2017/02/17/è‡ªå§‹è‡³ç»ˆ/","text":"æˆ‘å·²ç»å¿«å¿˜äº†æ¥è¿™åº§åŸå¸‚çš„åˆè¡· æˆ‘æ€»æ˜¯æ²¡æœ‰å‹‡æ°”æŠŠç”Ÿæ´»è¿‡çš„æ³¢æ¾œå£®é˜” 2016-6-26ï¼Œæˆ‘ç»ˆäºç¦»å¼€äº†ç”Ÿæ´»å’Œå­¦ä¹ äº†å››å¹´çš„åŸå¸‚ï¼Œè¿™ä¸ªåŸå¸‚å«ç€ä¸æˆ‘è®°å¿†æ— å…³çš„ç¹åï¼Œå°±è¿™ä¹ˆèµ°äº†ä¹Ÿæ²¡æä¸Šä¸€å¥ä¸å’¸ä¸æ·¡çš„é—®å€™ äººæœ€å¯æ‚²çš„å¿ƒç”˜æƒ…æ„¿ç”¨ä¸çŸ¥é“å¤šå°‘ä¸ªæ—¥å¤œçš„äº¤æ›¿å»æ‰§ç€è‡ªå·±ä¸è¯¥æ‰§ç€çš„äº‹ç‰©,ç„¶è€Œæ—©å·²ç™½éœ²ä¸æ˜¯æƒŠè›°ï¼Œä¸–é—´ä¹Ÿä¸å­˜åœ¨é‚£å£¶è®©äººé†‰ç”Ÿæ¢¦æ­»çš„é…’æˆ‘åªçŸ¥é“è¿™ä¸ªåŸå¸‚æœ‰æˆ‘æ— æ³•å‰²èˆçš„è®°å¿†å’Œæ— æ³•å¿˜å´çš„æ•…äººâ€¦ 2017å¹´å…ƒæ—¦å»äº†ä¸€è¶Ÿä¸œæä¹‹ä¸œï¼Œé‚£é‡Œæ™šéœä¸­çš„é£è½¦é˜µå¤ªç¾,å‚æ™šçš„æš®éœ­æ¸æ¸åŒ–æˆç²‰è‰²çš„æ¸©æŸ”â€¦å…¶å®ä¸œæè¿˜æœ‰å¦ä¸€ç§å®é™ï¼Œé‚£æ˜¯å¤§å®¶å¯ç¨‹è¿”èˆªçš„æ—¶å€™ï¼Œæˆ‘ä»¬æ‡ˆæ€ äº†ä¸€ç‚¹ï¼Œäºæ˜¯çœ‹åˆ°çš„ä¹Ÿå¤šä¸€ç‚¹ï¼Œé‚£æ—¶å€™çš„ä¸œææ‰æ˜¯çœŸæ­£çš„ä¸œæâ€¦ ä½ å¾ˆéš¾æ‰¾åˆ°è·Ÿä½ æ€§æƒ…ç›¸é€šçš„äººï¼Œä½ å‘ç°ä½ åªæ˜¯ä¸€ä¸ªå­˜åœ¨ï¼Œ åˆæˆ–è€…åœ¨åˆ«äººçœ¼é‡Œæ ¹æœ¬å°±çœ‹ä¸è§ä½ ã€‚","tags":[{"name":"è‡ªå§‹è‡³ç»ˆ","slug":"è‡ªå§‹è‡³ç»ˆ","permalink":"https://www.limuyang.cc/tags/è‡ªå§‹è‡³ç»ˆ/"}]},{"title":"Handleræœºåˆ¶ä»å…¥é—¨åˆ°æ”¾å¼ƒ(äºŒ)","date":"2016-10-29T22:48:19.000Z","path":"2016/10/29/Handleræœºåˆ¶ä»å…¥é—¨åˆ°æ”¾å¼ƒ-äºŒ/","text":"ä»æ³¨é‡Šçœ‹èµ·Handerçš„æºç åªæœ‰ä¸åˆ°800è¡Œï¼Œè€Œä¸”å¤§å¤šæ•°ä»£ç ç›¸å¯¹æ¥è¯´è¿˜æ˜¯æ¯”è¾ƒå¥½ç†è§£çš„ï¼Œå°¤å…¶æ˜¯ç›¸å¯¹äºå…¶ä»–æ›´åŠ æ¥è¿‘åº•å±‚çš„ä»£ç æ¥è¯´ï¼Œåœ¨çœ‹æºç æ—¶å€™æœ‰ä¸€ç‚¹æŒºé‡è¦çš„å°±æ˜¯ä¸è¦å¿½ç•¥æ³¨é‡Šçš„ä½œç”¨ï¼ŒHandlerç±»å¼€å¤´æœ‰è¿™ä¹ˆå‡ è¡Œæ³¨é‡Šï¼š 123&lt;p&gt;There are two main uses for a Handler: (1) to schedule messages and runnables to be executed as some point in the future; and (2) to enqueue an action to be performed on a different thread than your own. å½’çº³ä¸€ä¸‹å°±æ˜¯ï¼š- å®‰æ’æ¶ˆæ¯å’Œä»»åŠ¡åœ¨å°†æ¥çš„æŸä¸€ä¸ªç‚¹æ‰§è¡Œ- ä½¿ä¸€ä¸ªåŠ¨ä½œè¿›å…¥é˜Ÿåˆ—ä¸ºäº†èƒ½å¤Ÿåœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œå›é¡¾ä¸€ä¸‹æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ç”¨Handlerï¼š&gt; åœ¨Androidä¸­ï¼Œå½“è¦æ›´æ–°UIçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¿…é¡»è¦åœ¨ä¸»çº¿ç¨‹ä¸­è¿›è¡Œæ›´æ–°ï¼ŒåŸå› æ—¶å½“ä¸»çº¿ç¨‹è¢«é˜»å¡äº†5sä»¥ä¸Šå°±ä¼šå‡ºç°ANRå¼‚å¸¸ï¼Œä¼šå¯¼è‡´ç¨‹åºå´©æºƒã€‚æ‰€ä»¥ä¸€äº›è€—æ—¶çš„æ“ä½œå¿…é¡»è¦æ”¾åœ¨å­çº¿ç¨‹ä¸­ï¼Œä½†æ˜¯åœ¨å­çº¿ç¨‹ä¸­åˆä¸èƒ½åšæ›´æ–°UIçš„æ“ä½œï¼Œæ‰€ä»¥ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒAndroidè®¾è®¡äº†handleræœºåˆ¶ã€‚è¿™ä¹ˆä¸€å¯¹æ¯”ï¼Œå¾ˆå®¹æ˜“çš„å°è¯äº†è¿™æ®µè¯ï¼šä½¿ä¸€ä¸ªåŠ¨ä½œè¿›å…¥é˜Ÿåˆ—åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œï¼šè¿™ä¸å°±æ˜¯å¼‚æ­¥æ‰§è¡Œè€—æ—¶ä»»åŠ¡ä¹ˆï¼›å®‰æ’æ¶ˆæ¯å’Œä»»åŠ¡åœ¨å°†æ¥çš„æŸä¸€ä¸ªç‚¹æ‰§è¡Œï¼šè”æƒ³ä¸€ä¸‹postDelayedä¹‹ç±»çš„å»¶æ—¶æ“ä½œçš„æ–¹æ³•ï¼Œæˆ–è€…ç»™å‡ºä¸€ä¸ªå¾ˆå¸¸è§çš„ä¾‹å­ï¼Œæ¯”å¦‚è¯´å¼•å¯¼é¡µå»¶æ—¶å¯åŠ¨ï¼š12345678910111213141516171819new Handler().postDelayed(new Runnable() &#123; @Override public void run() &#123; Log.d(\"ThreadName 1\",Thread.currentThread().getName()); //ç¬¬ä¸€æ¬¡ç™»é™†æ‰«ææœ¬åœ°éŸ³ä¹ if (SPUtils.getValue(SplashActivity.this, \"isFirst\", \"First\", true)) &#123; new Thread(new Runnable() &#123; @Override public void run() &#123; //è€—æ—¶æ“ä½œ //æ¸…ç©ºè¡¨ Log.d(\"ThreadName 2\",Thread.currentThread().getName()); DataSupport.deleteAll(MusicInfoDetail.class); MusicUtils.scanMusic(SplashActivity.this, musicInfo); DataSupport.saveAll(musicInfo); SPUtils.putValue(SplashActivity.this, \"isFirst\", \"First\", false); &#125; &#125;).start(); &#125;, 2000); è¿™é‡Œæ˜¯æˆ‘è‡ªå·±çš„Demoé‡Œé¢çš„ä¸€éƒ¨åˆ†ä»£ç ï¼Œè¿™é‡Œä½¿ç”¨postDelayedå»¶æ—¶2så¯åŠ¨ï¼Œç„¶ååœ¨å­çº¿ç¨‹æ‰§è¡Œæ›´æ–°æ•°æ®åº“çš„æ“ä½œï¼Œå¾ˆå¥½çš„å°è¯äº†ä¸Šé¢ä¸¤ç‚¹ã€‚ åˆ›å»ºHandleråœ¨ä¸Šä¸€ç¯‡æ–‡ç« Handleræœºåˆ¶ä»å…¥é—¨åˆ°æ”¾å¼ƒ(ä¸€)é‡Œé¢æˆ‘ä»¬å·²ç»æ¼”ç¤ºäº†ä¸¤ç§åˆ›å»ºHandlerçš„æ–¹æ³•å¹¶ä¸”ç»™å‡ºäº†éƒ¨åˆ†å®é™…æ“ä½œçš„ä»£ç ï¼Œä½†æ˜¯éƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹ä¹Ÿå°±æ˜¯UIçº¿ç¨‹åˆ›å»ºçš„ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä¸€ä¸‹åœ¨å­çº¿ç¨‹ä¸­åˆ›å»ºHandlerï¼š 1234567891011121314151617public class MainActivity extends AppCompatActivity &#123; private Handler mainHandler; private Handler childHandler; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); mainHandler=new Handler(); new Thread(new Runnable() &#123; @Override public void run() &#123; childHandler=new Handler(); &#125; &#125;).start(); &#125;&#125; è¿è¡Œä¸€ä¸‹ï¼Œæœä¸å…¶ç„¶ä»£ç è¹¦äº†ï¼š æŠ¥é”™ä¿¡æ¯ï¼š 1java.lang.RuntimeException: Can&apos;t create handler inside thread that has not called Looper.prepare() å‘Šè¯‰æˆ‘ä»¬è¯´åœ¨Threadé‡Œé¢åˆ›å»ºHandleréœ€è¦è°ƒç”¨Looper.prepare( )ï¼Œé‚£æŠŠè¿™ä¸€å¥åŠ ä¸Šè¯•è¯•ï¼š 123456789101112131415161718public class MainActivity extends AppCompatActivity &#123; private Handler mainHandler; private Handler childHandler; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); mainHandler=new Handler(); new Thread(new Runnable() &#123; @Override public void run() &#123; Looper.prepare(); childHandler=new Handler(); &#125; &#125;).start(); &#125;&#125; æœç„¶å¾ˆæˆåŠŸçš„è¿è¡Œäº†ï¼Œä½†æ˜¯è¿™æ˜¯ä¸ºä»€ä¹ˆï¼Œæ¥çœ‹ä¸€ä¸‹Handlerçš„æºç ï¼š è¿™é‡Œæä¾›ä¸€ä¸ªç®€ä¾¿çš„æ–¹æ³•ï¼Œä¸ºäº†å¿«é€Ÿæ‰¾åˆ°åŸå› å¯ä»¥åœ¨æ‰“å¼€çš„æºç (æˆ‘è¿™é‡Œä½¿ç”¨sublimeTextæŸ¥çœ‹)é‡Œä½¿ç”¨ctrl+få¿«æ·é”®æœç´¢Looper.prepare( )å‡ºç°çš„åœ°æ–¹ï¼š 123456789101112131415161718public Handler(Callback callback, boolean async) &#123; if (FIND_POTENTIAL_LEAKS) &#123; final Class&lt;? extends Handler&gt; klass = getClass(); if ((klass.isAnonymousClass() || klass.isMemberClass() || klass.isLocalClass()) &amp;&amp; (klass.getModifiers() &amp; Modifier.STATIC) == 0) &#123; Log.w(TAG, \"The following Handler class should be static or leaks might occur: \" + klass.getCanonicalName()); &#125; &#125; mLooper = Looper.myLooper(); if (mLooper == null) &#123; throw new RuntimeException( \"Can't create handler inside thread that has not called Looper.prepare()\"); &#125; mQueue = mLooper.mQueue; mCallback = callback; mAsynchronous = async; &#125; è¿™æ˜¯Handlerçš„å…¶ä¸­ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œçœ‹åˆ°è¿™ä¹ˆä¸€æ®µï¼š 12345mLooper = Looper.myLooper(); if (mLooper == null) &#123; throw new RuntimeException( \"Can't create handler inside thread that has not called Looper.prepare()\"); &#125; åœ¨æ„é€ æ–¹æ³•é‡Œé€šè¿‡Looper.myLooper()è·å–åˆ°ä¸€ä¸ªLooperå¯¹è±¡mLooperï¼Œå¦‚æœä¸ºç©ºåˆ™æŠ¥é”™ï¼Œæ‰¾åˆ°Looper.myLooper()æ–¹æ³•ï¼š 1234567/** * Return the Looper object associated with the current thread. Returns * null if the calling thread is not associated with a Looper. */ public static @Nullable Looper myLooper() &#123; return sThreadLocal.get(); &#125; æ³¨é‡Šç»™å‡ºçš„è§£é‡Šæ˜¯è¿™ä¸ªæ–¹æ³•å›è¿”å›è·Ÿå½“å‰çº¿ç¨‹ç›¸å…³è”çš„Looperå¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿”å›ç©ºï¼Œè¿˜æ˜¯æ²¡æ‰¾åˆ°ç­”æ¡ˆï¼Œæ¥ç€æ‰¾Looperç±»é‡Œé¢å¯¹sThreadLocalçš„å®šä¹‰ï¼š 12// sThreadLocal.get() will return null unless you've called prepare(). static final ThreadLocal&lt;Looper&gt; sThreadLocal = new ThreadLocal&lt;Looper&gt;(); åˆæ˜¯æ³¨é‡Šé‡Œé¢å‘Šè¯‰äº†æˆ‘ä»¬é‡è¦ä¿¡æ¯ï¼Œè¿™é‡Œå‘Šè¯‰æˆ‘ä»¬åªæœ‰ä½ è°ƒç”¨äº†Looper.prepare()æ–¹æ³•sThreadLocal.get()æ‰ä¸ä¼šè¿”å›ç©ºï¼Œé‚£ä¹ˆè¯´æ¥è¯´å»è¿˜æ˜¯è¦çœ‹Looper.prepare()çš„ä»£ç ï¼š 12345678910111213141516/** Initialize the current thread as a looper. * This gives you a chance to create handlers that then reference * this looper, before actually starting the loop. Be sure to call * &#123;@link #loop()&#125; after calling this method, and end it by calling * &#123;@link #quit()&#125;. */ public static void prepare() &#123; prepare(true); &#125; private static void prepare(boolean quitAllowed) &#123; if (sThreadLocal.get() != null) &#123; throw new RuntimeException(\"Only one Looper may be created per thread\"); &#125; sThreadLocal.set(new Looper(quitAllowed)); &#125; çœ‹ä¸‹é¢é‚£ä¸ªï¼ŒLooper.prepare()è°ƒç”¨äº†prepare()çš„é‡è½½æ–¹æ³•prepare(boolean quitAllowed)å¹¶ä¸”ä¼ å…¥äº†trueå‚æ•°ï¼Œè¿™ä¸ªæ–¹æ³•åˆ¤æ–­sThreadLocal.get()æ˜¯å¦ä¼šè¿”å›ä¸€ä¸ªLooperå¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰çš„è¯å°±setä¸€ä¸ªæ–°çš„Looperè¿›å»ï¼Œå¦‚æœå·²ç»æœ‰äº†å†è°ƒç”¨prepare()æ–¹æ³•çš„è¯å°±ä¼šæŠ¥é”™ï¼Œä¸ä¿¡é‚ªçš„å¯ä»¥åœ¨mainHandleråˆ›å»ºä¹‹å‰ä¹Ÿè°ƒç”¨ä¸€ä¸ªLooper.prepare()ï¼Œæ§åˆ¶å°å°±ä¼šå‡ºç°è¿™ä¸ªé”™è¯¯ï¼š é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨ä¸»çº¿ç¨‹åˆ›å»ºHandlerä¸éœ€è¦è°ƒç”¨Looper.prepare()ï¼Œè€Œåœ¨å­çº¿ç¨‹ä¸­éœ€è¦å‘¢ï¼Œå¯ä»¥åˆç†çš„çŒœæƒ³æ˜¯ä¸æ˜¯ç³»ç»Ÿç»™æˆ‘ä»¬ä¸»åŠ¨è°ƒç”¨äº†ï¼Œæ¯•ç«Ÿæˆ‘ä»¬å¤§éƒ¨åˆ†çš„æ“ä½œè¿˜æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸Šï¼Œæ¯æ¬¡éƒ½è¦é‚£ä¹ˆLooper.prepare()æ¥ä¸€æ¬¡å¤šéº»çƒ¦ï¼Œæœ‰äº†çŒœæƒ³è¿˜è¦å»æºç å¯»æ±‚éªŒè¯ï¼Œä¸»çº¿ç¨‹æ˜¯ActivityThreadï¼Œä»ActivityThreadç±»é‡Œæœç´¢ç›¸å…³ä¿¡æ¯ï¼Œç”¨è·Ÿä¸Šé¢ä¸€æ ·çš„æ–¹æ³•ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940public static void main(String[] args) &#123; Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, \"ActivityThreadMain\"); SamplingProfilerIntegration.start(); // CloseGuard defaults to true and can be quite spammy. We // disable it here, but selectively enable it later (via // StrictMode) on debug builds, but using DropBox, not logs. CloseGuard.setEnabled(false); Environment.initForCurrentUser(); // Set the reporter for event logging in libcore EventLogger.setReporter(new EventLoggingReporter()); // Make sure TrustedCertificateStore looks in the right place for CA certificates final File configDir = Environment.getUserConfigDirectory(UserHandle.myUserId()); TrustedCertificateStore.setDefaultUserDirectory(configDir); Process.setArgV0(\"&lt;pre-initialized&gt;\"); Looper.prepareMainLooper(); ActivityThread thread = new ActivityThread(); thread.attach(false); if (sMainThreadHandler == null) &#123; sMainThreadHandler = thread.getHandler(); &#125; if (false) &#123; Looper.myLooper().setMessageLogging(new LogPrinter(Log.DEBUG, \"ActivityThread\")); &#125; // End of event ActivityThreadMain. Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER); Looper.loop(); throw new RuntimeException(\"Main thread loop unexpectedly exited\"); &#125; æŠ“é‡ç‚¹ï¼š 1Looper.prepareMainLooper(); æ‰¾åˆ°Looperç±»ä¸­å…³äºè¿™ä¸ªæ–¹æ³•çš„å®šä¹‰ï¼š 123456789101112131415/** * Initialize the current thread as a looper, marking it as an * application&apos;s main looper. The main looper for your application * is created by the Android environment, so you should never need * to call this function yourself. See also: &#123;@link #prepare()&#125; */public static void prepareMainLooper() &#123; prepare(false); synchronized (Looper.class) &#123; if (sMainLooper != null) &#123; throw new IllegalStateException(&quot;The main Looper has already been prepared.&quot;); &#125; sMainLooper = myLooper(); &#125; &#125; è¿™é‡Œåˆä¼šä¸»åŠ¨è°ƒç”¨prepare(boolean quitAllowed)æ–¹æ³•ï¼Œé€šè¿‡æ³¨é‡Šä¹Ÿäº†è§£åˆ°æˆ‘ä»¬ä¸éœ€è¦ä¸»åŠ¨å»åˆ›å»ºUIçº¿ç¨‹çš„looperï¼Œç³»ç»Ÿè‡ªåŠ¨ä¼šç»™æˆ‘ä»¬åˆ›å»ºå¥½äº†ï¼Œè¿™é‡Œå°è¯äº†å‰é¢çš„çŒœæƒ³ã€‚ è¿™é‡Œå¾—å‡ºä¸€ä¸ªç»“è®ºï¼š åœ¨ä¸»çº¿ç¨‹ä¸­å¯ä»¥ç›´æ¥åˆ›å»ºHandlerå¯¹è±¡ï¼Œè€Œåœ¨å­çº¿ç¨‹ä¸­éœ€è¦å…ˆè°ƒç”¨Looper.prepare()æ‰èƒ½åˆ›å»ºHandlerå¯¹è±¡ã€‚ è¿™é‡Œå…ˆä¸ç®¡Looperæ˜¯ä»€ä¹ˆï¼Œæš‚æ—¶çŸ¥é“æœ‰è¿™ä¸ªä¸œè¥¿ï¼Œä¸‹é¢å¯ä»¥çœ‹ä¸€ä¸‹å¦‚ä½•å‘é€æ¶ˆæ¯ã€‚ å¦‚ä½•å‘é€æ¶ˆæ¯è¿™é‡Œå°±ç”¨åˆ°äº†ç¬¬äºŒç§åˆ›å»ºHandlerçš„æ–¹æ³•ï¼š 1234567891011Handler myHandler = new Handler() &#123; public void handleMessage(Message msg) &#123; switch (msg.what) &#123; //æ ¹æ®å‚æ•°è¿›è¡Œæ“ä½œ break; &#125; super.handleMessage(msg); &#125; &#125;; //å…¶ä»–åœ°æ–¹è°ƒç”¨myHandler.sendMessage(xxx); è¿™é‡Œçš„å…¶ä»–åœ°æ–¹è°ƒç”¨æŒ‡çš„å°±æ˜¯åœ¨å­çº¿ç¨‹é‡Œé¢ï¼Œå½“æˆ‘ä»¬åœ¨å­çº¿ç¨‹é‡Œé¢æ‰§è¡Œå®Œè€—æ—¶æ“ä½œä¹‹åå¦‚æœéœ€è¦ä¼ é€’ä¸€äº›æ•°æ®ç»™ä¸»çº¿ç¨‹ï¼Œæ¯”å¦‚é€šçŸ¥ä¸»çº¿ç¨‹æ›´æ–°UIä¹‹ç±»çš„ï¼Œå°±å¯ä»¥è¿™ä¹ˆåšï¼š 12345678910111213141516171819202122final Handler myHandler = new Handler() &#123; public void handleMessage(Message msg) &#123; switch (msg.what) &#123; //æ ¹æ®å‚æ•°è¿›è¡Œæ“ä½œ &#125; &#125; &#125;; new Thread(new Runnable() &#123; @Override public void run() &#123; Message msg=new Message(); //whatæ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„è¯†åˆ«ç  msg.what=1; //é€šè¿‡arg1å’Œarg2å¯ä»¥ç»™Messageä¼ é€’ç®€å•çš„intå‹æ•°æ® msg.arg1=123; msg.arg2=456; //é€šè¿‡ç»™objèµ‹å€¼Objectç±»å‹ä¼ é€’å‘Messageä¼ å…¥ä»»æ„æ•°æ® msg.obj=null; myHandler.sendMessage(msg); &#125; &#125;).start(); å½“ç„¶é™¤äº†ä¼ é€’è¿™äº›ç®€å•æ•°æ®ä¹‹å¤–Messageç±»è¿˜èƒ½ä»¥setDataæ–¹å¼æºå¸¦Bundleæ•°æ®ï¼š 123Bundle bundle = new Bundle(); bundle.putString(\"data\", \"data\"); message.setData(bundle); æˆ‘ä»¬çœ‹åˆ°è¿™é‡Œæ˜¯åœ¨å­çº¿ç¨‹ä¸­è°ƒç”¨äº†sendMessage(msg)æ–¹æ³•ï¼Œç„¶è€Œæˆ‘ä»¬å´åœ¨ä¸»çº¿ç¨‹ä¸­ä½¿ç”¨handleMessage(Message msg)æ¥å—æ¶ˆæ¯ï¼Œè¿™ä¹‹é—´ä¸€å®šå‘ç”Ÿäº†ä¸€äº›ä¸å¯æè¿°çš„äº‹æƒ…ï¼Œè®©æˆ‘ä»¬æ¥æ‰¾æ‰¾çœ‹ï¼Œå½“ç„¶é™¤äº†sendMessage(msg)æ–¹æ³•Messageç±»è¿˜æœ‰è®¸å¤šå…¶ä»–å‘é€æ¶ˆæ¯çš„æ–¹æ³•ï¼š 1234567891011121314151617181920212223public final boolean sendMessage(Message msg) &#123; return sendMessageDelayed(msg, 0); &#125; public final boolean sendEmptyMessage(int what) &#123; return sendEmptyMessageDelayed(what, 0); &#125; public final boolean sendEmptyMessageDelayed(int what, long delayMillis) &#123; Message msg = Message.obtain(); msg.what = what; return sendMessageDelayed(msg, delayMillis); &#125; public final boolean sendEmptyMessageAtTime(int what, long uptimeMillis) &#123; Message msg = Message.obtain(); msg.what = what; return sendMessageAtTime(msg, uptimeMillis); &#125; ..... å·§çš„æ˜¯ï¼Œè¿™äº›æ–¹æ³•æ— è®ºè½¬æŠ˜å¤šå°‘æ¬¡éƒ½èµ°å‘äº†åŒä¸€ä¸ªæ–¹æ³•ï¼š 1234567891011121314151617181920212223242526272829/** * Enqueue a message into the message queue after all pending messages * before the absolute time (in milliseconds) &lt;var&gt;uptimeMillis&lt;/var&gt;. * &lt;b&gt;The time-base is &#123;@link android.os.SystemClock#uptimeMillis&#125;.&lt;/b&gt; * Time spent in deep sleep will add an additional delay to execution. * You will receive it in &#123;@link #handleMessage&#125;, in the thread attached * to this handler. * * @param uptimeMillis The absolute time at which the message should be * delivered, using the * &#123;@link android.os.SystemClock#uptimeMillis&#125; time-base. * * @return Returns true if the message was successfully placed in to the * message queue. Returns false on failure, usually because the * looper processing the message queue is exiting. Note that a * result of true does not mean the message will be processed -- if * the looper is quit before the delivery time of the message * occurs then the message will be dropped. */ public boolean sendMessageAtTime(Message msg, long uptimeMillis) &#123; MessageQueue queue = mQueue; if (queue == null) &#123; RuntimeException e = new RuntimeException( this + \" sendMessageAtTime() called with no mQueue\"); Log.w(\"Looper\", e.getMessage(), e); return false; &#125; return enqueueMessage(queue, msg, uptimeMillis); &#125; è¿™ä¸ªæ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œmsgå’ŒuptimeMillisï¼Œmsgå°±æ˜¯æˆ‘ä»¬éœ€è¦ä¼ é€’çš„æ¶ˆæ¯ï¼ŒuptimeMillisåˆ™æ˜¯å‘é€æ¶ˆæ¯æ—¶å€™çš„ç»å¯¹æ—¶åˆ»ï¼Œå®ƒçš„å€¼ç­‰äºè‡ªç³»ç»Ÿå¼€æœºåˆ°å½“å‰æ—¶é—´çš„æ¯«ç§’æ•°å†åŠ ä¸Šå»¶è¿Ÿæ—¶é—´ï¼Œè¿™ä¸ªå»¶è¿Ÿæ—¶é—´å°±æ˜¯æˆ‘ä»¬è°ƒç”¨sendxxxDelayedé‡Œé¢ä¼ å…¥çš„æ—¶é—´å‚æ•°ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šæŠŠä¸€ä¸ªæ¶ˆæ¯æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—(message queue)ï¼Œç„¶åæŠŠè¿™ä¸ªæ–¹æ³•çš„ä¸¤ä¸ªå‚æ•°åŠ ä¸Šæ–°å»ºçš„MessageQueue å¯¹è±¡ä¼ å…¥enqueueMessage(queue, msg, uptimeMillis)æ–¹æ³•é‡Œï¼Œä»å­—é¢ä¸Šç†è§£MessageQueue æ˜¯ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œé‚£ä¹ˆé˜Ÿåˆ—å°±ä¼šæœ‰å…¥é˜Ÿå’Œå‡ºé˜Ÿçš„æ–¹æ³•ï¼Œè¿™ä¸ªenqueueMessage(queue, msg, uptimeMillis)åº”è¯¥å°±æ˜¯å…¥é˜Ÿçš„æ–¹æ³•ï¼š 1234567private boolean enqueueMessage(MessageQueue queue, Message msg, long uptimeMillis) &#123; msg.target = this; if (mAsynchronous) &#123; msg.setAsynchronous(true); &#125; return queue.enqueueMessage(msg, uptimeMillis); &#125; æ²¡æœ‰å‘ç°ä»€ä¹ˆï¼Œè¿™é‡Œåˆè°ƒç”¨äº†enqueueMessage(msg, uptimeMillis)æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨MessageQueueç±»é‡Œé¢ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253boolean enqueueMessage(Message msg, long when) &#123; if (msg.target == null) &#123; throw new IllegalArgumentException(\"Message must have a target.\"); &#125; if (msg.isInUse()) &#123; throw new IllegalStateException(msg + \" This message is already in use.\"); &#125; synchronized (this) &#123; if (mQuitting) &#123; IllegalStateException e = new IllegalStateException( msg.target + \" sending message to a Handler on a dead thread\"); Log.w(TAG, e.getMessage(), e); msg.recycle(); return false; &#125; msg.markInUse(); msg.when = when; Message p = mMessages; boolean needWake; if (p == null || when == 0 || when &lt; p.when) &#123; // New head, wake up the event queue if blocked. msg.next = p; mMessages = msg; needWake = mBlocked; &#125; else &#123; // Inserted within the middle of the queue. Usually we don't have to wake // up the event queue unless there is a barrier at the head of the queue // and the message is the earliest asynchronous message in the queue. needWake = mBlocked &amp;&amp; p.target == null &amp;&amp; msg.isAsynchronous(); Message prev; for (;;) &#123; prev = p; p = p.next; if (p == null || when &lt; p.when) &#123; break; &#125; if (needWake &amp;&amp; p.isAsynchronous()) &#123; needWake = false; &#125; &#125; msg.next = p; // invariant: p == prev.next prev.next = msg; &#125; // We can assume mPtr != 0 because mQuitting is false. if (needWake) &#123; nativeWake(mPtr); &#125; &#125; return true; &#125; ä»£ç æœ‰ç‚¹é•¿ï¼Œä¸€æ­¥ä¸€æ­¥çœ‹ï¼Œå…ˆçœ‹å‰é¢ä¸€éƒ¨åˆ†ï¼š 123456if (msg.target == null) &#123; throw new IllegalArgumentException(\"Message must have a target.\"); &#125; if (msg.isInUse()) &#123; throw new IllegalStateException(msg + \" This message is already in use.\"); &#125; è¿™é‡Œåˆ¤æ–­äº†ä¸€ä¸‹msg.targetå¯¹è±¡æ˜¯å¦ä¸ºç©ºï¼Œè¿˜è®°å¾—ä¹‹å‰çš„enqueueMessage(queue, msg, uptimeMillis)æ–¹æ³•å—ï¼š 1234567private boolean enqueueMessage(MessageQueue queue, Message msg, long uptimeMillis) &#123; msg.target = this; if (mAsynchronous) &#123; msg.setAsynchronous(true); &#125; return queue.enqueueMessage(msg, uptimeMillis); &#125; è¿™ä¸ªæ–¹æ³•æ˜¯åœ¨Handlerä¸­æ‰§è¡Œçš„ï¼Œè¿™é‡ŒæŠŠä¸€ä¸ªthiså¯¹è±¡èµ‹å€¼ç»™msg.targetï¼Œé‚£ä¹ˆä»Messageç±»æ‰¾ä¸€ä¸‹è¿™ä¸ªtargetåˆ°åº•æ˜¯ä»€ä¹ˆï¼Œæ‰¾åˆ°è¿™ä¸ªï¼š 1/*package*/ Handler target; è¿™æ ·è„‰ç»œå°±å¾ˆæ¸…æ™°äº†ï¼Œè¿™é‡Œæ˜¯æŠŠHandlerè·ŸMessageå¯¹è±¡ç»‘å®šèµ·æ¥ï¼Œæ¥ç€å¾€ä¸‹çœ‹ï¼š 12345678910111213141516171819202122232425262728293031323334msg.markInUse(); msg.when = when; Message p = mMessages; boolean needWake; if (p == null || when == 0 || when &lt; p.when) &#123; // New head, wake up the event queue if blocked. msg.next = p; mMessages = msg; needWake = mBlocked; &#125; else &#123; // Inserted within the middle of the queue. Usually we don't have to wake // up the event queue unless there is a barrier at the head of the queue // and the message is the earliest asynchronous message in the queue. needWake = mBlocked &amp;&amp; p.target == null &amp;&amp; msg.isAsynchronous(); Message prev; for (;;) &#123; prev = p; p = p.next; if (p == null || when &lt; p.when) &#123; break; &#125; if (needWake &amp;&amp; p.isAsynchronous()) &#123; needWake = false; &#125; &#125; msg.next = p; // invariant: p == prev.next prev.next = msg; &#125; // We can assume mPtr != 0 because mQuitting is false. if (needWake) &#123; nativeWake(mPtr); &#125; &#125; è¿™ä¸ªmsg.whenå°±æ˜¯ç”¨ä¼ å…¥çš„uptimeMilliså‚æ•°èµ‹å€¼ï¼Œè¡¨ç¤ºå…¥é˜Ÿæ—¶é—´ï¼Œçœ‹åˆ°è¿™ä¸ªifåˆ¤æ–­ï¼š 12345678if (p == null || when == 0 || when &lt; p.when) &#123; // New head, wake up the event queue if blocked. msg.next = p; mMessages = msg; needWake = mBlocked; &#125; else &#123; ... &#125; æœ‰äººå¯èƒ½ä¼šå¥½å¥‡è¿™ä¸ªwhenæ€ä¹ˆä¼šä¸º0å‘¢ï¼Œè¿™é‡Œæä¸€å˜´ï¼ŒHandleré™¤äº†æœ‰æ­£å¸¸çš„sendMessageä¹‹æµçš„æ–¹æ³•è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„æ–¹æ³•ï¼š 12345678910public final boolean sendMessageAtFrontOfQueue(Message msg) &#123; MessageQueue queue = mQueue; if (queue == null) &#123; RuntimeException e = new RuntimeException( this + \" sendMessageAtTime() called with no mQueue\"); Log.w(\"Looper\", e.getMessage(), e); return false; &#125; return enqueueMessage(queue, msg, 0); &#125; è¿™ä¸ªæ–¹æ³•ç‰¹æ®Šåœ¨ä»€ä¹ˆåœ°æ–¹å‘¢ï¼Œæ‰“ä¸ªæ¯”æ–¹ï¼Œå¦‚æœè¯´æˆ‘ä»¬æ­£å¸¸çš„sendMessageä¹‹æµçš„æ–¹æ³•æ˜¯ä¸€ç¾¤æ­£å¸¸æ’é˜Ÿçš„äººï¼ŒæŒ‰ç…§æ¥çš„æ—¶é—´å…ˆåæœ‰åºæ’é˜Ÿï¼Œä½†æ˜¯sendMessageAtFrontOfQueueå°±æ˜¯é‚£ç§ä¸ªåˆ«ä¸è€å®çš„ï¼Œå®ƒèƒ½ç›´æ¥æ’é˜Ÿåˆ°æœ€å‰é¢ï¼Œç„¶åä»–ä¼ é€’çš„uptimeMillisä¸º0ï¼Œè¿™ä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ªç‰¹æ®Šçš„å‘é€æ¶ˆæ¯çš„æ–¹æ³•ã€‚ è¿™ä¸ªåˆ¤æ–­è¯­å¥æˆç«‹çš„æ¡ä»¶æœ‰ä¸‰ç‚¹ï¼šp == null || when == 0 || when &lt; p.when p == nullè¯´æ˜å½“å‰looperå¤„äºç©ºé—²çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰ä»€ä¹ˆæ¶ˆæ¯éœ€è¦å¤„ç† when == 0è¯´æ˜æœ‰æ¶ˆæ¯æ’é˜Ÿæ’åˆ°äº†MessageQueueæœ€å‰é¢ when &lt; p.whenæŒ‡çš„æ˜¯æ–°å…¥é˜Ÿçš„æ¶ˆæ¯é˜Ÿåˆ—éœ€è¦æ’é˜Ÿçš„æ—¶é—´æ¯”æ­£åœ¨æ‰§è¡Œçš„æ¶ˆæ¯æ’é˜Ÿçš„æ—¶é—´çŸ­ ç»¼åˆæ¥è¯´å°±æ˜¯ï¼Œå¦‚æœè¿™æ—¶å€™æ–°è¿›æ¥ä¸€ä¸ªæ¶ˆæ¯ï¼Œè¿™æ—¶å€™æ¶ˆæ¯é˜Ÿåˆ—é‡Œé¢æ²¡æœ‰éœ€è¦æ‰§è¡Œçš„æ¶ˆæ¯ï¼Œæˆ–è€…æ–°è¿›æ¥çš„è¿™ä¸ªæ¶ˆæ¯æ˜¯é€šè¿‡sendMessageAtFrontOfQueue(Message msg)æ–¹æ³•ä¼ è¿›æ¥çš„ï¼Œæˆ–è€…è¯´æ–°è¿›æ¥çš„è¿™ä¸ªæ¶ˆæ¯éœ€è¦ç­‰å¾…çš„æ—¶é—´æ¯”ä¹‹å‰åœ¨ç­‰å¾…çš„æ¶ˆæ¯ç­‰å¾…çš„æ—¶é—´çŸ­ï¼Œé‚£ä¹ˆå°±æŠŠè¿™ä¸ªæ¶ˆæ¯æ’å…¥é“¾è¡¨çš„è¡¨å¤´ï¼Œæ­¤æ—¶ç³»ç»Ÿä¼šå”¤é†’è¿™ä¸ªæ¶ˆæ¯é˜Ÿåˆ—æ— è®ºé˜Ÿåˆ—æ˜¯å¦å µå¡ã€‚ 12// Got a message. mBlocked = false; è¿™ä¸€è¡Œä»£ç è¯´æ˜åªè¦æ¶ˆæ¯é˜Ÿåˆ—æœ‰æ¶ˆæ¯ï¼Œè¿™ä¸ªé˜Ÿåˆ—å°±ä¸é˜»å¡ï¼Œç„¶åæŠŠè¿™ä¸ªå¸ƒå°”å€¼ä¼ é€’ï¼š 12boolean needWakeneedWake = mBlocked; é‚£ä¹ˆè¿™ä¸€å—ä»£ç å°±æ‰“é€šäº†ï¼Œä¸‹é¢è¿™å—elseè¯­å¥å—ï¼š 12345678910111213141516171819else &#123; // Inserted within the middle of the queue. Usually we don't have to wake // up the event queue unless there is a barrier at the head of the queue // and the message is the earliest asynchronous message in the queue. needWake = mBlocked &amp;&amp; p.target == null &amp;&amp; msg.isAsynchronous(); Message prev; for (;;) &#123; prev = p; p = p.next; if (p == null || when &lt; p.when) &#123; break; &#125; if (needWake &amp;&amp; p.isAsynchronous()) &#123; needWake = false; &#125; &#125; msg.next = p; // invariant: p == prev.next prev.next = msg; &#125; è®²çš„æ˜¯å¦‚ä½•æŠŠæ¶ˆæ¯æ’å…¥é“¾è¡¨çš„å†…éƒ¨ï¼Œè¿™æ—¶å€™å°±ä¸éœ€è¦å»è°ƒæ•´å”¤é†’æ¶ˆæ¯é˜Ÿåˆ—çš„æ—¶é—´ï¼Œå› ä¸ºå”¤é†’çš„æ—¶é—´æ˜¯è·Ÿè¡¨å¤´æœ‰å…³çš„ï¼Œè¿™æ ·æ•´ä¸ªå…¥é˜Ÿçš„æ“ä½œå·®ä¸å¤šå°±è¿‡äº†ä¸€é. å‡ºé˜Ÿæ“ä½œæ—¢ç„¶æœ‰å…¥é˜Ÿæ“ä½œé‚£ä¹ˆè‚¯å®šä¹Ÿæœ‰å‡ºé˜Ÿæ“ä½œï¼Œå¦‚æœä½ è¿˜è®°å¾—æˆ‘ä»¬æœ€å¼€å§‹ä½¿ç”¨çš„Looperç±»çš„è¯ï¼Œé‚£ä¹ˆè¿™é‡Œä¸å¦¨ç›´æ¥å‘Šè¯‰ä½ ï¼Œå‡ºé˜Ÿçš„æ–¹æ³•å°±åœ¨Looperç±»é‡Œé¢ï¼Œè¿™é‡Œæœ‰ä¸ªloop()æ–¹æ³•ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455/** * Run the message queue in this thread. Be sure to call * &#123;@link #quit()&#125; to end the loop. */ public static void loop() &#123; final Looper me = myLooper(); if (me == null) &#123; throw new RuntimeException(\"No Looper; Looper.prepare() wasn't called on this thread.\"); &#125; final MessageQueue queue = me.mQueue; // Make sure the identity of this thread is that of the local process, // and keep track of what that identity token actually is. Binder.clearCallingIdentity(); final long ident = Binder.clearCallingIdentity(); //æ­»å¾ªç¯ for (;;) &#123; //æŠŠæ¶ˆæ¯ä»é˜Ÿåˆ—å–å‡º Message msg = queue.next(); // might block if (msg == null) &#123; // No message indicates that the message queue is quitting. return; &#125; // This must be in a local variable, in case a UI event sets the logger final Printer logging = me.mLogging; if (logging != null) &#123; logging.println(\"&gt;&gt;&gt;&gt;&gt; Dispatching to \" + msg.target + \" \" + msg.callback + \": \" + msg.what); &#125; final long traceTag = me.mTraceTag; if (traceTag != 0) &#123; Trace.traceBegin(traceTag, msg.target.getTraceName(msg)); &#125; try &#123; msg.target.dispatchMessage(msg); &#125; finally &#123; if (traceTag != 0) &#123; Trace.traceEnd(traceTag); &#125; &#125; if (logging != null) &#123; logging.println(\"&lt;&lt;&lt;&lt;&lt; Finished to \" + msg.target + \" \" + msg.callback); &#125; // Make sure that during the course of dispatching the // identity of the thread wasn't corrupted. final long newIdent = Binder.clearCallingIdentity(); if (ident != newIdent) &#123; Log.wtf(TAG, \"Thread identity changed from 0x\" + Long.toHexString(ident) + \" to 0x\" + Long.toHexString(newIdent) + \" while dispatching to \" + msg.target.getClass().getName() + \" \" + msg.callback + \" what=\" + msg.what); &#125; msg.recycleUnchecked(); &#125; &#125; æ³¨æ„è¿™ä¸¤æ®µä»£ç ï¼š 12final Looper me = myLooper();final MessageQueue queue = me.mQueue; ä¹‹å‰è¯´è¿‡ä¸€ä¸ªçº¿ç¨‹å¿…é¡»æœ‰ä¸€ä¸ªLooperï¼Œè¿™é‡Œä¸ä»…è·å–åˆ°äº†Looperï¼Œè¿˜è·å–åˆ°äº†å½“å‰çº¿ç¨‹ç»‘å®šçš„MessageQueueä¹Ÿå°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç„¶åloop()æ–¹æ³•æœ€å¼€å§‹æ˜¯åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦æœ‰Looperå¯¹è±¡ï¼Œä¹‹åè¿›å…¥ä¸€ä¸ªæ­»å¾ªç¯ï¼Œåœ¨å¾ªç¯ä½“å†…ä¸æ–­çš„ä»æ¶ˆæ¯é˜Ÿåˆ—(Message queue)ä¸­å–å‡ºæ¶ˆæ¯å¯¹è±¡ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Œçœ‹è¿™ä¸ªnext()æ–¹æ³•ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283Message next()&#123; int pendingIdleHandlerCount = -1; // -1 only during first iteration int nextPollTimeoutMillis = 0; for (;;) &#123; . . . . . . nativePollOnce(mPtr, nextPollTimeoutMillis); // é˜»å¡äºæ­¤ . . . . . . // è·å–nextæ¶ˆæ¯ï¼Œå¦‚èƒ½å¾—åˆ°å°±è¿”å›ä¹‹ã€‚ final long now = SystemClock.uptimeMillis(); Message prevMsg = null; Message msg = mMessages; // å…ˆå°è¯•æ‹¿æ¶ˆæ¯é˜Ÿåˆ—é‡Œå½“å‰ç¬¬ä¸€ä¸ªæ¶ˆæ¯ if (msg != null &amp;&amp; msg.target == null) &#123; // å¦‚æœä»é˜Ÿåˆ—é‡Œæ‹¿åˆ°çš„msgæ˜¯ä¸ªâ€œåŒæ­¥åˆ†å‰²æ â€ï¼Œé‚£ä¹ˆå°±å¯»æ‰¾å…¶åç¬¬ä¸€ä¸ªâ€œå¼‚æ­¥æ¶ˆæ¯â€ do &#123; prevMsg = msg; msg = msg.next; &#125; while (msg != null &amp;&amp; !msg.isAsynchronous()); &#125; if (msg != null) &#123; if (now &lt; msg.when) &#123; // Next message is not ready. Set a timeout to wake up when it is ready. nextPollTimeoutMillis = (int) Math.min(msg.when - now, Integer.MAX_VALUE); &#125; else &#123; // Got a message. mBlocked = false; if (prevMsg != null) &#123; prevMsg.next = msg.next; &#125; else &#123; mMessages = msg.next; // é‡æ–°è®¾ç½®ä¸€ä¸‹æ¶ˆæ¯é˜Ÿåˆ—çš„å¤´éƒ¨ &#125; msg.next = null; if (false) Log.v(\"MessageQueue\", \"Returning message: \" + msg); msg.markInUse(); return msg; // è¿”å›å¾—åˆ°çš„æ¶ˆæ¯å¯¹è±¡ &#125; &#125; else &#123; // No more messages. nextPollTimeoutMillis = -1; &#125; // Process the quit message now that all pending messages have been handled. if (mQuitting) &#123; dispose(); return null; &#125; if (pendingIdleHandlerCount &lt; 0 &amp;&amp; (mMessages == null || now &lt; mMessages.when)) &#123; pendingIdleHandlerCount = mIdleHandlers.size(); &#125; if (pendingIdleHandlerCount &lt;= 0) &#123; // No idle handlers to run. Loop and wait some more. mBlocked = true; continue; &#125; . . . . . . // å¤„ç†idle handlerséƒ¨åˆ† for (int i = 0; i &lt; pendingIdleHandlerCount; i++) &#123; final IdleHandler idler = mPendingIdleHandlers[i]; mPendingIdleHandlers[i] = null; // release the reference to the handler boolean keep = false; try &#123; keep = idler.queueIdle(); &#125; catch (Throwable t) &#123; Log.wtf(\"MessageQueue\", \"IdleHandler threw exception\", t); &#125; if (!keep) &#123; synchronized (this) &#123; mIdleHandlers.remove(idler); &#125; &#125; &#125; pendingIdleHandlerCount = 0; nextPollTimeoutMillis = 0; &#125;&#125; æ³¨é‡Šå·²ç»å¾ˆè¯¦ç»†äº†ï¼Œç°åœ¨çŸ¥é“äº†å“ªé‡ŒæŠŠæ¶ˆæ¯å–å‡ºæ¥ï¼Œä½†æ˜¯è¿˜ä¸çŸ¥é“æ¶ˆæ¯æ˜¯å“ªé‡Œå¤„ç†çš„ï¼Œæ¥ç€ä¸Šé¢çš„loop()æ–¹æ³•çš„ä»£ç å¾€ä¸‹çœ‹ï¼š 1msg.target.dispatchMessage(msg); è¿™ä¸€è¡Œå¾ˆå…³é”®ï¼Œå­—é¢æ„æ€éƒ½å¯ä»¥çœ‹å‡ºæ¥è¿™é‡Œæ˜¯åˆ†å‘æ¶ˆæ¯ï¼Œæ‰¾åˆ°æºç æŸ¥çœ‹ä¸€ä¸‹ï¼Œä¹‹å‰è¯´è¿‡msg.targetå°±æ˜¯ä¸Messageç»‘å®šçš„Handlerï¼Œæ‰€ä»¥åœ¨Handlerçš„æºç é‡Œé¢æ‰¾ï¼š 123456789101112131415/** * Handle system messages here. */ public void dispatchMessage(Message msg) &#123; if (msg.callback != null) &#123; handleCallback(msg); &#125; else &#123; if (mCallback != null) &#123; if (mCallback.handleMessage(msg)) &#123; return; &#125; &#125; handleMessage(msg); &#125; &#125; ä»£ç å¾ˆç®€å•ï¼Œä½†æ˜¯ç­”æ¡ˆå°±å¿«æ­æ™“äº†ï¼ŒHandleré€šè¿‡postå’ŒsendMessageä¹‹ç±»çš„æ–¹æ³•æŠŠæ¶ˆæ¯å‘å‡ºå»ï¼Œç»•äº†ä¸€å¤§åœˆåˆå›åˆ°äº†Handlerï¼Œå…ˆåˆ«æ¿€åŠ¨ï¼Œçœ‹çœ‹ä»£ç åˆ°åº•è¯´äº†ä»€ä¹ˆï¼š 12if (msg.callback != null) &#123; handleCallback(msg); è¿™é‡Œçš„msg.callbackå…¶å®å°±æ˜¯ä¸€ä¸ªRunnableå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹Messageæºç å‘ç°ï¼š 1234567891011121314/** * Same as &#123;@link #obtain(Handler)&#125;, but assigns a callback Runnable on * the Message that is returned. * @param h Handler to assign to the returned Message object's &lt;em&gt;target&lt;/em&gt; member. * @param callback Runnable that will execute when the message is handled. * @return A Message object from the global pool. */ public static Message obtain(Handler h, Runnable callback) &#123; Message m = obtain(); m.target = h; //åˆ›å»ºMessageç±»æ—¶å€™ç³»ç»Ÿå»ºè®®ä½¿ç”¨Message msg=Message.obtain()ï¼›å½¢å¼ m.callback = callback; return m; &#125; ä½ æƒ³åˆ°äº†ä»€ä¹ˆï¼Œåœ¨å›æƒ³ä¸€éæˆ‘ä»¬ä½¿ç”¨Handlerçš„ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯post(Runnable r)çš„å½¢å¼ï¼Œä¸€ç§æ˜¯sendMessage(Message msg)å½¢å¼ï¼Œç¬¬ä¸€ç§æ–¹å¼åˆšå¥½ä¼ é€’çš„å°±æ˜¯ä¸€ä¸ªRunnableå¯¹è±¡ï¼Œçœ‹ä¸€ä¸‹è¿™ä¸ªhandleCallback(msg)æ–¹æ³•ï¼š 123private static void handleCallback(Message message) &#123; message.callback.run();&#125; ç®€å•ç²—æš´ï¼Œèµ°çš„å°±æ˜¯post(Runnable r) æ‰€ä¼ é€’å‚æ•°çš„ run()æ–¹æ³•ï¼Œé‚£ä¹ˆç¬¬äºŒç§å½¢å¼å‘¢ï¼š 12345if (mCallback != null) &#123; if (mCallback.handleMessage(msg)) &#123; return; &#125; &#125; è¿™ä¸ªmCallbackæ˜¯Hanlder.Callbackç±»å¯¹è±¡ï¼Œè¿™ä¸ªCallbackæ˜¯Handlerçš„å†…éƒ¨çš„ä¸€ä¸ªæ¥å£ï¼š 123public interface Callback &#123; public boolean handleMessage(Message msg);&#125; è¿™å°±å¯¹åº”äº†sendMessage(Message msg)çš„å½¢å¼ï¼Œåˆ°æ­¤ï¼ŒçœŸç›¸å¤§ç™½ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€ç‚¹è¦æ³¨æ„çš„æ˜¯ï¼ŒActivityThreadä¹Ÿå°±æ˜¯UIçº¿ç¨‹æ˜¯è‡ªåŠ¨è°ƒç”¨äº†Looper.loop()æ–¹æ³•çš„æ‰€ä»¥åœ¨ä¸»çº¿ç¨‹ä½¿ç”¨Handleræ˜¯ä¸éœ€è¦å†å»è°ƒç”¨äº†ï¼Œä½†æ˜¯åœ¨å­çº¿ç¨‹ä¸­å´æ˜¯è¦è‡ªå·±è°ƒç”¨çš„ï¼Œå¦åˆ™ä¸ä¼šè¿›å…¥MessageQueueï¼Œè€Œä¸”Handlerä¸ä»…ä»…åªæœ‰æ›´æ–°UIçš„ä½œç”¨ï¼Œå®ƒæ˜¯ä¸æ‰€åˆ›å»ºçš„çº¿ç¨‹æ‰€ç»‘å®šçš„ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨å®ƒåœ¨ä¸»çº¿ç¨‹å‘å­çº¿ç¨‹å‘é€æ¶ˆæ¯ï¼Œåè¿‡æ¥ä¹Ÿä¸€æ ·ï¼Œå…³äºè¿™ç‚¹çš„ä½¿ç”¨è¯¦è§ Androidä¸»çº¿ç¨‹.å­çº¿ç¨‹é€šä¿¡ï¼ˆThread+handlerï¼‰ æ€»ç»“ä»æœ€å¼€å§‹çš„ä½¿ç”¨åˆ°ä»æºç çš„è§’åº¦å»åˆ†æï¼Œå†™è¿™ç¯‡åšå®¢èŠ±äº†å¾ˆé•¿çš„æ—¶é—´ï¼Œæœ€ååšä¸ªæ€»ç»“ï¼š åœ¨æ•´ä¸ªAndroidå†…éƒ¨é€šä¿¡è¿›ç¨‹ä¸­ï¼ŒHandleræœºåˆ¶å¦‚æœæ‹é¡ºäº†ç›¸äº’ä¹‹é—´çš„å…³ç³»çš„è¯å…¶å®ä¸éš¾ç†è§£ å¥—ç”¨ä¸€æ®µå¾ˆå½¢è±¡çš„è¯è§£é‡Šè¿™å¹…å›¾ï¼š æˆ‘ä»¬å¯ä»¥æŠŠä¼ é€å¸¦ä¸Šçš„è´§ç‰©çœ‹åšæ˜¯ä¸€ä¸ªä¸ªçš„Messageï¼Œè€Œæ‰¿è½½è¿™äº›è´§ç‰©çš„ä¼ é€å¸¦å°±æ˜¯è£…è½½Messageçš„æ¶ˆæ¯é˜Ÿåˆ—MessageQueueã€‚ä¼ é€å¸¦æ˜¯é å‘é€æœºæ»šè½®å¸¦åŠ¨èµ·æ¥è½¬åŠ¨çš„ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå‘é€æœºæ»šè½®çœ‹åšæ˜¯Looperï¼Œè€Œå‘åŠ¨æœºçš„è½¬åŠ¨æ˜¯éœ€è¦ç”µæºçš„ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠç”µæºçœ‹åšæ˜¯çº¿ç¨‹Threadï¼Œæ‰€æœ‰çš„æ¶ˆæ¯å¾ªç¯çš„ä¸€åˆ‡æ“ä½œéƒ½æ˜¯åŸºäºæŸä¸ªçº¿ç¨‹çš„ã€‚ä¸€åˆ‡å‡†å¤‡å°±ç»ªï¼Œæˆ‘ä»¬åªéœ€è¦æŒ‰ä¸‹ç”µæºå¼€å…³å‘åŠ¨æœºå°±ä¼šè½¬åŠ¨èµ·æ¥ï¼Œè¿™ä¸ªå¼€å…³å°±æ˜¯Looperçš„loopæ–¹æ³•ï¼Œå½“æˆ‘ä»¬æŒ‰ä¸‹å¼€å…³çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±ç›¸å½“äºæ‰§è¡Œäº†Looperçš„loopæ–¹æ³•ï¼Œæ­¤æ—¶Looperå°±ä¼šé©±åŠ¨ç€æ¶ˆæ¯é˜Ÿåˆ—å¾ªç¯èµ·æ¥ã€‚ é‚£Hanlderåœ¨ä¼ é€å¸¦æ¨¡å‹ä¸­ç›¸å½“äºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥å°†Handlerçœ‹åšæ˜¯æ”¾å…¥è´§ç‰©ä»¥åŠå–èµ°è´§ç‰©çš„ç®¡é“ï¼šè´§ç‰©ä»ä¸€ç«¯é¡ºç€ç®¡é“åˆ’å…¥ä¼ é€å¸¦ï¼Œè´§ç‰©åˆä»å¦ä¸€ç«¯é¡ºç€ç®¡é“åˆ’å‡ºä¼ é€å¸¦ã€‚æˆ‘ä»¬åœ¨ä¼ é€å¸¦çš„ä¸€ç«¯æ”¾å…¥è´§ç‰©çš„æ“ä½œå°±ç›¸å½“äºæˆ‘ä»¬è°ƒç”¨äº†Handlerçš„sendMessageXXXã€sendEmptyMessageXXXæˆ–postXXXæ–¹æ³•ï¼Œè¿™å°±æŠŠMessageå¯¹è±¡æ”¾å…¥åˆ°äº†æ¶ˆæ¯é˜Ÿåˆ—MessageQueueä¸­äº†ã€‚å½“è´§ç‰©ä»ä¼ é€å¸¦çš„å¦ä¸€ç«¯é¡ºç€ç®¡é“åˆ’å‡ºæ—¶ï¼Œæˆ‘ä»¬å°±ç›¸å½“äºè°ƒç”¨äº†Hanlderçš„dispatchMessageæ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­æˆ‘ä»¬å®Œæˆå¯¹Messageçš„å¤„ç†ã€‚ è¿™æ®µè¯å‡ºè‡ª å‚è€ƒåšå®¢ æ·±å…¥æºç è§£æAndroidä¸­çš„Handler,Message,MessageQueue,Looper ä»Handler+Message+Looperæºç å¸¦ä½ åˆ†æAndroidç³»ç»Ÿçš„æ¶ˆæ¯å¤„ç†æœºåˆ¶ Androidå¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶å®Œå…¨è§£æï¼Œå¸¦ä½ ä»æºç çš„è§’åº¦å½»åº•ç†è§£ èŠä¸€èŠAndroidçš„æ¶ˆæ¯æœºåˆ¶","tags":[{"name":"Android","slug":"Android","permalink":"https://www.limuyang.cc/tags/Android/"},{"name":"Handler","slug":"Handler","permalink":"https://www.limuyang.cc/tags/Handler/"},{"name":"æºç åˆ†æ","slug":"æºç åˆ†æ","permalink":"https://www.limuyang.cc/tags/æºç åˆ†æ/"}]},{"title":"Handleræœºåˆ¶ä»å…¥é—¨åˆ°æ”¾å¼ƒ(ä¸€)","date":"2016-10-29T22:41:23.000Z","path":"2016/10/29/Handleræœºåˆ¶ä»å…¥é—¨åˆ°æ”¾å¼ƒ-ä¸€/","text":"é—²æ¥æ— äº‹ï¼Œå‡†å¤‡å¥½å¥½æ¢³ç†ä¸€ä¸‹Handleræœºåˆ¶ï¼Œä¹‹å‰åˆ†æè¿‡æ²¡æœ‰å†™æˆåšå®¢ï¼Œç»“æœå°±æ˜¯æ…¢æ…¢çš„æ·¡å¿˜äº†ï¼Œè¿™æ¬¡è¶ç€åˆšåˆ†æå®Œï¼Œèµ¶ç´§å†™ä¸‹æ¥ã€‚ åœ¨å¼€å§‹åˆ†æä¹‹å‰å…ˆæ‰“æ‰“åŸºç¡€ï¼Œç†è§£ç†è§£ä»€ä¹ˆæ˜¯çº¿ç¨‹ä»¥åŠä»€ä¹ˆæ˜¯Handlerï¼Œè¿™é‡Œå¤§éƒ¨åˆ†å†…å®¹å¼•ç”¨ä¸€ç¯‡æ¥è‡ªä¼¯ä¹åœ¨çº¿çš„æ–‡ç« ï¼Œå› ä¸ºçœ‹æ¥çœ‹å»å…³äºåŸºç¡€çš„éƒ¨åˆ†è¿™ä¸ªäººå·²ç»è¯´å¾—å¾ˆå¥½äº†ï¼Œæˆ‘å°±è´Ÿè´£æŠŠä¸»è¦çš„éƒ¨åˆ†æŠ½å–å‡ºæ¥ã€‚ åŸæ–‡åœ°å€ï¼šAndroidçº¿ç¨‹å’ŒHandleråŸºç¡€å…¥é—¨ ç°åœ¨å¤§å¤šæ•°çš„ç§»åŠ¨è®¾å¤‡å·²ç»å˜å¾—è¶Šæ¥è¶Šå¿«ï¼Œä½†æ˜¯å®ƒä»¬å…¶å®ä¹Ÿä¸ç®—æ˜¯éå¸¸å¿«ã€‚å¦‚æœä½ æƒ³è®©ä½ çš„APPæ—¢å¯ä»¥æ‰¿å—ä¸€äº›ç¹æ‚çš„å·¥ä½œè€Œåˆä¸å½±å“ç”¨æˆ·ä½“éªŒçš„è¯ï¼Œé‚£ä¹ˆå¿…é¡»æŠŠä»»åŠ¡å¹¶è¡Œæ‰§è¡Œã€‚åœ¨Androidä¸Šï¼Œæˆ‘ä»¬ä½¿ç”¨çº¿ç¨‹ã€‚ ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿçº¿ç¨‹æˆ–è€…çº¿ç¨‹æ‰§è¡Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸²å‘½ä»¤ï¼ˆä¹Ÿæ˜¯ç¨‹åºä»£ç ï¼‰ï¼Œç„¶åæˆ‘ä»¬æŠŠå®ƒå‘é€ç»™æ“ä½œç³»ç»Ÿæ‰§è¡Œã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬çš„CPUåœ¨ä»»ä½•æ—¶å€™ä¸€ä¸ªæ ¸åªèƒ½å¤„ç†ä¸€ä¸ªçº¿ç¨‹ã€‚å¤šæ ¸å¤„ç†å™¨ï¼ˆç›®å‰å¤§å¤šæ•°Androidè®¾å¤‡å·²ç»éƒ½æ˜¯å¤šæ ¸ï¼‰é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¯ä»¥åŒæ—¶å¤„ç†å¤šçº¿ç¨‹ï¼ˆé€šä¿—åœ°è®²å°±æ˜¯å¯ä»¥åŒæ—¶å¤„ç†å¤šä»¶äº‹ï¼‰ã€‚ å¤šæ ¸å¤„ç†ä¸å•æ ¸å¤šä»»åŠ¡å¤„ç†çš„å®è´¨ä¸Šé¢æˆ‘è¯´çš„æ˜¯ä¸€èˆ¬æƒ…å†µï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„æè¿°éƒ½æ˜¯ä¸€å®šæ­£ç¡®çš„ã€‚å› ä¸ºå•æ ¸ä¹Ÿå¯ä»¥ç”¨å¤šä»»åŠ¡æ¨¡æ‹Ÿå‡ºå¤šçº¿ç¨‹ã€‚ æ¯ä¸ªè¿è¡Œåœ¨çº¿ç¨‹ä¸­çš„ä»»åŠ¡éƒ½å¯ä»¥åˆ†è§£æˆå¤šæ¡æŒ‡ä»¤ï¼Œè€Œä¸”è¿™äº›æŒ‡ä»¤ä¸ç”¨åŒæ—¶æ‰§è¡Œã€‚æ‰€ä»¥ï¼Œå•æ ¸è®¾å¤‡å¯ä»¥é¦–å…ˆåˆ‡æ¢åˆ°çº¿ç¨‹1å»æ‰§è¡ŒæŒ‡ä»¤1Aï¼Œç„¶ååˆ‡æ¢åˆ°çº¿ç¨‹2å»æ‰§è¡ŒæŒ‡ä»¤2Aï¼Œæ¥ç€è¿”å›åˆ°çº¿ç¨‹1å†å»æ‰§è¡Œ1Bã€1Cã€1Dï¼Œç„¶åç»§ç»­åˆ‡æ¢åˆ°çº¿ç¨‹2ï¼Œæ‰§è¡Œ2Bã€2Cç­‰ç­‰ï¼Œä»¥æ­¤ç±»æ¨ã€‚ è¿™ä¸ªçº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢ååˆ†è¿…é€Ÿï¼Œä»¥è‡³äºåœ¨å•æ ¸çš„è®¾å¤‡ä¸­ä¹Ÿä¼šå‘ç”Ÿã€‚å‡ ä¹æ‰€æœ‰çš„çº¿ç¨‹éƒ½åœ¨ç›¸åŒçš„æ—¶é—´å†…è¿›è¡Œä»»åŠ¡å¤„ç†ã€‚å…¶å®ï¼Œè¿™éƒ½æ˜¯å› ä¸ºé€Ÿåº¦å¤ªå¿«é€ æˆçš„å‡è±¡ï¼Œå°±åƒç”µå½±ã€Šé»‘å®¢å¸å›½ã€‹é‡Œçš„ç‰¹å·¥Brownä¸€æ ·ï¼Œå¯ä»¥å˜å¹»å‡ºå¾ˆå¤šçš„å¤´å’Œæ‰‹ã€‚ Javaæ ¸å¿ƒé‡Œçš„çº¿ç¨‹åœ¨Javaä¸­ï¼Œå¦‚æœè¦æƒ³åšå¹³è¡Œä»»åŠ¡å¤„ç†çš„è¯ï¼Œä¼šåœ¨Runnableé‡Œé¢æ‰§è¡Œä½ çš„ä»£ç ã€‚å¯ä»¥ç»§æ‰¿Threadç±»ï¼Œæˆ–è€…å®ç°Runnableæ¥å£ï¼š 1234567891011121314151617181920212223242526// 1public class IAmAThread extends Thread &#123; public IAmAThread() &#123; super(\"IAmAThread\"); &#125; @Override public void run() &#123;// your code (sequence of instructions) &#125;&#125;// to execute this sequence of instructions in a separate thread.new IAmAThread().start();// 2public class IAmARunnable implements Runnable &#123; @Override public void run() &#123;// your code (sequence of instructions) &#125;&#125;// to execute this sequence of instructions in a separate thread.IAmARunnable myRunnable = new IAmARunnable();new Thread(myRunnable).start(); è¿™ä¸¤ä¸ªæ–¹æ³•åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ã€‚ç¬¬ä¸€ä¸ªç‰ˆæœ¬æ˜¯åˆ›å»ºä¸€ä¸ªThreadç±»ï¼Œç¬¬äºŒä¸ªç‰ˆæœ¬æ˜¯éœ€è¦åˆ›å»ºä¸€ä¸ªRunnableå¯¹è±¡ï¼Œç„¶åä¹Ÿéœ€è¦ä¸€ä¸ªThreadç±»æ¥è°ƒç”¨å®ƒã€‚ Androidä¸Šçš„çº¿ç¨‹æ— è®ºä½•æ—¶å¯åŠ¨APPï¼Œæ‰€æœ‰çš„ç»„ä»¶éƒ½ä¼šè¿è¡Œåœ¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ä¸­ï¼ˆé»˜è®¤çš„ï¼‰â€”-å«åšä¸»çº¿ç¨‹ã€‚è¿™ä¸ªçº¿ç¨‹ä¸»è¦ç”¨äºå¤„ç†UIçš„æ“ä½œå¹¶ä¸ºè§†å›¾ç»„ä»¶å’Œå°éƒ¨ä»¶åˆ†å‘äº‹ä»¶ç­‰ï¼Œå› æ­¤ä¸»çº¿ç¨‹ä¹Ÿè¢«ç§°ä½œUIçº¿ç¨‹(Main Thread)ã€‚é™¤äº†Main Threadä¹‹å¤–çš„çº¿ç¨‹éƒ½å¯ç§°ä¸ºWorker Threadã€‚Main Threadä¸»è¦è´Ÿè´£æ§åˆ¶UIé¡µé¢çš„æ˜¾ç¤ºã€æ›´æ–°ã€äº¤äº’ç­‰ã€‚ å› æ­¤æ‰€æœ‰åœ¨UIçº¿ç¨‹ä¸­çš„æ“ä½œè¦æ±‚è¶ŠçŸ­è¶Šå¥½ï¼Œåªæœ‰è¿™æ ·ç”¨æˆ·æ‰ä¼šè§‰å¾—æ“ä½œæ¯”è¾ƒæµç•…ã€‚ä¸€ä¸ªæ¯”è¾ƒå¥½çš„åšæ³•æ˜¯æŠŠä¸€äº›æ¯”è¾ƒè€—æ—¶çš„æ“ä½œï¼Œä¾‹å¦‚ç½‘ç»œè¯·æ±‚ã€æ•°æ®åº“æ“ä½œã€ å¤æ‚è®¡ç®—ç­‰é€»è¾‘éƒ½å°è£…åˆ°å•ç‹¬çš„çº¿ç¨‹ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼Œè¿™æ ·å°±éœ€è¦ç”¨åˆ°äº†Androidçš„Handleræœºåˆ¶ã€‚ è¿™é‡Œåˆ’é‡ç‚¹ï¼šHandlerè´Ÿè´£ä¸å­çº¿ç¨‹è¿›è¡Œé€šè®¯ï¼Œä»è€Œè®©å­çº¿ç¨‹ä¸ä¸»çº¿ç¨‹ä¹‹é—´å»ºç«‹èµ·åä½œçš„æ¡¥æ¢ï¼Œä½¿Androidçš„UIæ›´æ–°çš„é—®é¢˜å¾—åˆ°å®Œç¾çš„è§£å†³ æ€ä¹ˆåˆ›å»ºHandleræ—¢ç„¶Handleræœ‰è¿™æ ·çš„å¥½å¤„ï¼Œé‚£ä¹ˆçœ‹Handleræ€ä¹ˆç”¨ï¼Œå®˜æ–¹ç»™å‡ºäº†ä¸¤ç§æ–¹å¼åˆ›å»ºä¸€ä¸ªHandlerï¼š 1ã€ä½¿ç”¨é»˜è®¤çš„æ„é€ æ–¹æ³•ï¼šnew Handler()ã€‚ 2ã€ä½¿ç”¨å¸¦å‚çš„æ„é€ æ–¹æ³•ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªRunnableå¯¹è±¡æˆ–è€…å›è°ƒå¯¹è±¡ã€‚ 12345678910111213141516171819202122//ç¬¬ä¸€ç§æ–¹æ³•private Handler handler = new Handler(); private Runnable myRunnable= new Runnable() &#123; public void run() &#123; //ä¸€äº›è€—æ—¶æ“ä½œ &#125; &#125;; //å…¶ä»–åœ°æ–¹è°ƒç”¨ handler.post(xxx); è¿™é‡Œå°±å†™ä¸€ä¸ªpostæ–¹æ³•ï¼Œå®é™…ä¸Šè¿˜æœ‰å¾ˆå¤šï¼Œè¯¸å¦‚postDelayedã€postAtTime//ç¬¬äºŒç§æ–¹æ³•Handler myHandler = new Handler() &#123; public void handleMessage(Message msg) &#123; switch (msg.what) &#123; //æ ¹æ®å‚æ•°è¿›è¡Œæ“ä½œ break; &#125; super.handleMessage(msg); &#125; &#125;; //å…¶ä»–åœ°æ–¹è°ƒç”¨myHandler.sendMessage(xxx); å¦‚ä½•ä½¿ç”¨Handlerè¿™é‡Œä½¿ç”¨ä¸€ä¸ªç®€å•çš„Demoæ¥æ¼”ç¤ºHandlerçš„ç”¨æ³•ï¼Œç•Œé¢åç®€å•å°±ä¸è´´äº†ï¼Œç›´æ¥è´´ä»£ç ï¼Œæ¨¡æ‹Ÿçš„æ˜¯ç‚¹å‡»Buttonæ‰§è¡Œä¸‹è½½ï¼Œä¸‹è½½å®Œæˆåæ›´æ–°UIã€‚ 1234567891011121314151617181920212223242526272829303132333435public class MainActivity extends Activity implements Button.OnClickListener &#123; private TextView statusTextView = null; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); statusTextView = (TextView)findViewById(R.id.statusTextView); Button btnDownload = (Button)findViewById(R.id.btnDownload); btnDownload.setOnClickListener(this); &#125; @Override public void onClick(View v) &#123; DownloadThread downloadThread = new DownloadThread(); downloadThread.start(); &#125; class DownloadThread extends Thread&#123; @Override public void run() &#123; try&#123; System.out.println(\"å¼€å§‹ä¸‹è½½æ–‡ä»¶\"); //æ­¤å¤„è®©çº¿ç¨‹DownloadThreadä¼‘çœ 5ç§’ä¸­ï¼Œæ¨¡æ‹Ÿæ–‡ä»¶çš„è€—æ—¶è¿‡ç¨‹ Thread.sleep(5000); System.out.println(\"æ–‡ä»¶ä¸‹è½½å®Œæˆ\"); //æ–‡ä»¶ä¸‹è½½å®Œæˆåæ›´æ–°UI MainActivity.this.statusTextView.setText(\"æ–‡ä»¶ä¸‹è½½å®Œæˆ\"); &#125;catch (InterruptedException e)&#123; e.printStackTrace(); &#125; &#125; &#125;&#125; æŒ‰ç…§ä»¥å‰å†™Javaçš„æ€è·¯çš„è¯å¯èƒ½ä¼šè¿™ä¹ˆå†™ï¼Œä½†æ˜¯è¿è¡Œç¨‹åºæ—¶å€™ä¼šå‘ç°æ§åˆ¶å°æŠ¥é”™ï¼š 1android.view.ViewRootImpl$CalledFromWrongThreadException: Only the original thread that created a view hierarchy can touch its views. é”™è¯¯çš„æ„æ€æ˜¯åªæœ‰åˆ›å»ºViewçš„åŸå§‹çº¿ç¨‹æ‰èƒ½æ›´æ–°Viewã€‚å‡ºç°è¿™æ ·é”™è¯¯çš„åŸå› æ˜¯Androidä¸­çš„Viewä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸‹é¢ç»™å‡ºåˆç†çš„è§£é‡Šï¼š å› ä¸ºUIè®¿é—®æ˜¯æ²¡æœ‰åŠ é”çš„ï¼Œåœ¨å¤šä¸ªçº¿ç¨‹ä¸­è®¿é—®UIæ˜¯ä¸å®‰å…¨çš„ï¼Œå¦‚æœæœ‰å¤šä¸ªå­çº¿ç¨‹éƒ½å»æ›´æ–°UIï¼Œä¼šå¯¼è‡´ç•Œé¢ä¸æ–­æ”¹å˜è€Œæ··ä¹±ä¸å ªã€‚æ‰€ä»¥æœ€å¥½çš„è§£å†³åŠæ³•å°±æ˜¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹æœ‰æ›´æ–°UIçš„æƒé™ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™å°±åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æŒ¯è‡‚é«˜å‘¼ï¼šæ”¾å¼€é‚£å¥³å­©ï¼Œè®©æˆ‘æ¥ï¼é‚£ä¹ˆæœ€åˆé€‚çš„äººé€‰åªèƒ½æ˜¯ä¸»çº¿ç¨‹ã€‚ æ¥è‡ªâ€”Androidä¸­çº¿ç¨‹é‚£äº›äº‹ é‚£ä¹ˆä¸ºäº†è§„é¿Androidçš„è¿™ç§æœºåˆ¶ï¼Œæˆ‘ä»¬è¿™é‡Œåˆ†åˆ«é‡‡ç”¨Handlerçš„ä¸¤ç§æ–¹å¼æ¥å®ç°ä¸Šé¢çš„ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118Aã€ä½¿ç”¨postæ–¹å¼public class MainActivity extends Activity implements Button.OnClickListener &#123; private TextView statusTextView = null; //uiHandleråœ¨ä¸»çº¿ç¨‹ä¸­åˆ›å»ºï¼Œæ‰€ä»¥è‡ªåŠ¨ç»‘å®šä¸»çº¿ç¨‹ private Handler uiHandler = new Handler(); @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); statusTextView = (TextView)findViewById(R.id.statusTextView); Button btnDownload = (Button)findViewById(R.id.btnDownload); btnDownload.setOnClickListener(this); &#125; @Override public void onClick(View v) &#123; DownloadThread downloadThread = new DownloadThread(); downloadThread.start(); &#125; class DownloadThread extends Thread&#123; @Override public void run() &#123; try&#123; System.out.println(\"å¼€å§‹ä¸‹è½½æ–‡ä»¶\"); //æ­¤å¤„è®©çº¿ç¨‹DownloadThreadä¼‘çœ 5ç§’ä¸­ï¼Œæ¨¡æ‹Ÿæ–‡ä»¶çš„è€—æ—¶è¿‡ç¨‹ Thread.sleep(5000); System.out.println(\"æ–‡ä»¶ä¸‹è½½å®Œæˆ\"); //æ–‡ä»¶ä¸‹è½½å®Œæˆåæ›´æ–°UI Runnable runnable = new Runnable() &#123; @Override public void run() &#123; MainActivity.this.statusTextView.setText(\"æ–‡ä»¶ä¸‹è½½å®Œæˆ\"); &#125; &#125;; uiHandler.post(runnable); &#125;catch (InterruptedException e)&#123; e.printStackTrace(); &#125; &#125; &#125;&#125;Bã€ä½¿ç”¨sendMessageæ–¹å¼å®ç°public class MainActivity extends Activity implements Button.OnClickListener &#123; private TextView statusTextView = null; //uiHandleråœ¨ä¸»çº¿ç¨‹ä¸­åˆ›å»ºï¼Œæ‰€ä»¥è‡ªåŠ¨ç»‘å®šä¸»çº¿ç¨‹ private Handler uiHandler = new Handler()&#123; @Override public void handleMessage(Message msg) &#123; switch (msg.what)&#123; case 1: System.out.println(\"msg.arg1:\" + msg.arg1); System.out.println(\"msg.arg2:\" + msg.arg2); MainActivity.this.statusTextView.setText(\"æ–‡ä»¶ä¸‹è½½å®Œæˆ\"); break; &#125; &#125; &#125;; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); statusTextView = (TextView)findViewById(R.id.statusTextView); Button btnDownload = (Button)findViewById(R.id.btnDownload); btnDownload.setOnClickListener(this); System.out.println(\"Main thread id \" + Thread.currentThread().getId()); &#125; @Override public void onClick(View v) &#123; DownloadThread downloadThread = new DownloadThread(); downloadThread.start(); &#125; class DownloadThread extends Thread&#123; @Override public void run() &#123; try&#123; System.out.println(\"å¼€å§‹ä¸‹è½½æ–‡ä»¶\"); //æ­¤å¤„è®©çº¿ç¨‹DownloadThreadä¼‘çœ 5ç§’ä¸­ï¼Œæ¨¡æ‹Ÿæ–‡ä»¶çš„è€—æ—¶è¿‡ç¨‹ Thread.sleep(5000); System.out.println(\"æ–‡ä»¶ä¸‹è½½å®Œæˆ\"); //æ–‡ä»¶ä¸‹è½½å®Œæˆåæ›´æ–°UI Message msg = new Message(); //è™½ç„¶Messageçš„æ„é€ å‡½æ•°å¼publicçš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼é€šè¿‡å¾ªç¯å¯¹è±¡è·å–Message //msg = Message.obtain(uiHandler); //msg = uiHandler.obtainMessage(); //whatæ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ä¸€ä¸ªMessageçš„è¯†åˆ«ç ï¼Œä»¥ä¾¿äºåœ¨Handlerçš„handleMessageæ–¹æ³•ä¸­æ ¹æ®whatè¯†åˆ« //å‡ºä¸åŒçš„Messageï¼Œä»¥ä¾¿æˆ‘ä»¬åšå‡ºä¸åŒçš„å¤„ç†æ“ä½œ msg.what = 1; //æˆ‘ä»¬å¯ä»¥é€šè¿‡arg1å’Œarg2ç»™Messageä¼ å…¥ç®€å•çš„æ•°æ® msg.arg1 = 123; msg.arg2 = 321; //æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ç»™objèµ‹å€¼Objectç±»å‹ä¼ é€’å‘Messageä¼ å…¥ä»»æ„æ•°æ® //msg.obj = null; //æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡setDataæ–¹æ³•å’ŒgetDataæ–¹æ³•å‘Messageä¸­å†™å…¥å’Œè¯»å–Bundleç±»å‹çš„æ•°æ® //msg.setData(null); //Bundle data = msg.getData(); //å°†è¯¥Messageå‘é€ç»™å¯¹åº”çš„Handler uiHandler.sendMessage(msg); &#125;catch (InterruptedException e)&#123; e.printStackTrace(); &#125; &#125; &#125;&#125; ä»¥ä¸Šä»£ç æ¥è‡ªåšå®¢ï¼šAndroidä¸­Handlerçš„ä½¿ç”¨ ä¸Šé¢è¿™ä¸¤ç§å½¢å¼éƒ½èƒ½è¾¾åˆ°æˆ‘ä»¬çš„è¦æ±‚ï¼Œåœ¨æ­¤ä¸ä¸€ä¸€æµ‹éªŒï¼Œæ³¨é‡Šå†™çš„å¾ˆè¯¦ç»†äº†ï¼Œçœ‹åˆ°è¿™é‡Œåº”è¯¥å·²ç»å¤§è‡´çŸ¥é“äº†å¦‚ä½•ä½¿ç”¨Handlerï¼Œä½†æ˜¯æˆ‘æƒ³æˆ‘ä»¬åº”è¯¥è¿œè¿œä¸æ»¡è¶³äºæ­¤ï¼Œä¸‹ä¸€ç¯‡åšå®¢å°†å¸¦ç€å¤§å®¶ä»æºç ä¸€èµ·çœ‹çœ‹Handleræœºåˆ¶åˆ°åº•æ˜¯æ€ä¹ˆå®ç°çš„ã€‚","tags":[{"name":"Android","slug":"Android","permalink":"https://www.limuyang.cc/tags/Android/"},{"name":"Handler","slug":"Handler","permalink":"https://www.limuyang.cc/tags/Handler/"}]},{"title":"äººç”Ÿè‹¦çŸ­ï¼Œæˆ‘ç”¨Python--åˆ†åˆ†é’Ÿä¸‹è½½çŸ¥ä¹ç¾å›¾ç»™ä½ çœ‹","date":"2016-08-11T19:45:46.000Z","path":"2016/08/11/äººç”Ÿè‹¦çŸ­ï¼Œæˆ‘ç”¨Python-åˆ†åˆ†é’Ÿä¸‹è½½çŸ¥ä¹ç¾å›¾ç»™ä½ çœ‹/","text":"èµ·ä¸Šæ¬¡è¯´äº†è¦çˆ¬çŸ¥ä¹çš„å›¾ç‰‡ï¼Œäºæ˜¯èŠ±äº†ä¸€ä¸‹åˆçš„æ—¶é—´å»å®Œæˆè¿™ä»¶äº‹ï¼Œå‘ç°æš‚æ—¶æ¥è§¦åˆ°çš„çˆ¬è™«æ€»æ˜¯é€ƒè„±ä¸äº†ä¸€ä¸ªè§„å¾‹ï¼š æ¨¡æ‹Ÿç™»é™† è·å–çœŸå®ç½‘é¡µHTMLæºä»£ç  è§£æè·å–åˆ°çš„ç½‘é¡µæºä»£ç  è·å–æƒ³è¦çš„èµ„æº(ä¸‹è½½åˆ°æŸä¸ªæ–‡ä»¶å¤¹æˆ–è€…è¾“å‡ºåˆ°è¡¨æ ¼ä¸­æ•´åˆèµ·æ¥) ä¹Ÿè®¸å’Œæˆ‘è¯´çš„æœ‰ä¸€äº›å‡ºå…¥ï¼Œåº”è¯¥æ˜¯åˆšå­¦è¿™ä¸ªä¸œè¥¿çš„åŸå› ï¼Œæ¥ä¸‹æ¥è¿˜æƒ³ç ”ç©¶ä¸€ä¸‹å¤šçº¿ç¨‹çˆ¬è™«ã€æ·»åŠ ä»£ç†ã€çˆ¬å–æµ·é‡æ•°æ®å¹¶æ•´åˆæˆå›¾è¡¨å½¢å¼ï¼Œå…ˆæŠŠèƒ½åšçš„åšäº†ã€‚ æ‰¿å› ä¸ºæ˜¯åœ¨ä¸Šä¸€æ¬¡çš„åŸºç¡€ä¸Šè¿›è¡Œçš„ï¼Œæ‰€ä»¥æ²¡æœ‰çœ‹ä¸Šä¸€ç¯‡æ–‡ç« çš„å¯ä»¥å…ˆçœ‹ä¸€ä¸‹ï¼Œè¿™é‡Œç”¨åˆ°çš„å·¥å…·è·Ÿä¹‹å‰ä¸€æ ·ï¼š win7 64ä½ æ——èˆ°ç‰ˆ Python 3.5 64-bit PyCharm è¿™é‡Œæ¨¡æ‹Ÿç™»é™†æ˜¯è·Ÿä¹‹å‰ä¸€æ ·çš„ä»£ç ï¼Œç›´æ¥è´´å°±æ˜¯ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576logn_url = 'http://www.zhihu.com/#signin'session = requests.session()headers = &#123; 'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.82 Safari/537.36',&#125;content = session.get(logn_url, headers=headers).contentsoup = BeautifulSoup(content, 'html.parser')def getxsrf(): return soup.find('input', attrs=&#123;'name': \"_xsrf\"&#125;)['value'] # è·å–éªŒè¯ç def get_captcha(): t = str(int(time.time() * 1000)) captcha_url = 'http://www.zhihu.com/captcha.gif?r=' + t + \"&amp;type=login\" r = session.get(captcha_url, headers=headers) with open('captcha.jpg', 'wb') as f: f.write(r.content) f.close() # ç”¨pillow çš„ Image æ˜¾ç¤ºéªŒè¯ç  # å¦‚æœæ²¡æœ‰å®‰è£… pillow åˆ°æºä»£ç æ‰€åœ¨çš„ç›®å½•å»æ‰¾åˆ°éªŒè¯ç ç„¶åæ‰‹åŠ¨è¾“å…¥ try: im = Image.open('captcha.jpg') im.show() im.close() except: print(u'è¯·åˆ° %s ç›®å½•æ‰¾åˆ°captcha.jpg æ‰‹åŠ¨è¾“å…¥' % os.path.abspath('captcha.jpg')) captcha = input(\"please input the captcha\\n&gt;\") return captchadef isLogin(): # é€šè¿‡æŸ¥çœ‹ç”¨æˆ·ä¸ªäººä¿¡æ¯æ¥åˆ¤æ–­æ˜¯å¦å·²ç»ç™»å½• url = \"https://www.zhihu.com/settings/profile\" login_code = session.get(url, allow_redirects=False).status_code if int(x=login_code) == 200: return True else: return Falsedef login(secret, account): # é€šè¿‡è¾“å…¥çš„ç”¨æˆ·ååˆ¤æ–­æ˜¯å¦æ˜¯æ‰‹æœºå· if re.match(r\"^1\\d&#123;10&#125;$\", account): print(\"æ‰‹æœºå·ç™»å½• \\n\") post_url = 'http://www.zhihu.com/login/phone_num' postdata = &#123; '_xsrf': getxsrf(), 'password': secret, 'remember_me': 'true', 'phone_num': account, &#125; else: print(\"é‚®ç®±ç™»å½• \\n\") post_url = 'http://www.zhihu.com/login/email' postdata = &#123; '_xsrf': getxsrf(), 'password': secret, 'remember_me': 'true', 'email': account, &#125; try: # ä¸éœ€è¦éªŒè¯ç ç›´æ¥ç™»å½•æˆåŠŸ login_page = session.post(post_url, data=postdata, headers=headers) login_code = login_page.text print(login_page.status) print(login_code) except: # éœ€è¦è¾“å…¥éªŒè¯ç åæ‰èƒ½ç™»å½•æˆåŠŸ postdata[\"captcha\"] = get_captcha() login_page = session.post(post_url, data=postdata, headers=headers) login_code = eval(login_page.text) print(login_code['msg']) è¿™é‡Œçš„ä»£ç æ¥è‡ªGitHubä¸Šçš„fuck-loginé¡¹ç›®ï¼Œåœ¨æ­¤è¡¨ç¤ºæ„Ÿè°¢ï¼Œæˆ‘åœ¨åŸå§‹ä»£ç ä¸Šè¿›è¡Œäº†æ”¹è¿›ï¼ŒåŸå§‹ä»£ç æ˜¯é€‚é…äº†Python2.xå’ŒPython3.xï¼Œä½†æ˜¯æˆ‘å­¦çš„æ˜¯Python3.xæ‰€ä»¥å»æ‰äº†ä¸€äº›æˆ‘æ²¡ç”¨è¿‡çš„æ¨¡å—ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘æ”¹è¿›äº†åçš„ä»£ç æ˜¯é€‚ç”¨äºPython3.xçš„ã€‚ ä¸‹é¢å°±æ˜¯å‡†å¤‡è·å–å›¾ç‰‡äº†ï¼Œå…ˆæ‰¾ä¸€ä¸ªç›®æ ‡ï¼Œæœ€è¿‘æœ‰ä¸€ä¸ªé—®é¢˜å¾ˆç«ï¼š é•¿å¾—å¥½çœ‹ï¼Œä½†æ²¡æœ‰ç”·æœ‹å‹æ˜¯æ€æ ·çš„ä½“éªŒ è¿˜è®°å¾—æˆ‘åˆ—å‡ºæ¥çš„æ­¥éª¤ä¹ˆï¼Œæ¨¡æ‹Ÿç™»é™†ä¹‹åæ˜¯è·å–çœŸå®çš„ç½‘é¡µæºä»£ç ï¼Œä»€ä¹ˆå«çœŸå®çš„ï¼Œè¿™ä¸ªé—®é¢˜é—®å¾—å¥½ï¼Œä½ æ²¡å‘ç°çŸ¥ä¹å¾ˆå–œæ¬¢ç”¨åŠ¨æ€åŠ è½½æŠ€æœ¯ä¹ˆï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ çœ‹åˆ°çš„åªæ˜¯è¡¨è±¡ï¼Œè¿™é‡Œä¹Ÿä¸€æ ·ã€‚ è½¬ æ¥ï¼Œæˆ‘ä»¬å…ˆç‚¹å¼€ç‚¹èµæ•°æœ€é«˜çš„å¦¹å­ä¸Šä¼ çš„å›¾ç‰‡ï¼š å’³å’³å’³ï¼Œå¥½åƒè·‘åäº†ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ˜Ÿè¾°å¤§æµ·ï¼Œæ­£ç¡®çš„åšæ³•æ˜¯é¼ æ ‡å³é”®æŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼š æ˜¯ä¸æ˜¯çœ‹åˆ°äº†å¾ˆå¤šå›¾ç‰‡é“¾æ¥ï¼Œå½“ç„¶æˆ‘ä»¬è¦æ‰¾.jpgã€.jpegã€.pngåç¼€çš„ï¼š 1&lt;img data-rawwidth=\"1632\" data-rawheight=\"2040\" src=\"//zhstatic.zhihu.com/assets/zhihu/ztext/whitedot.jpg\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"1632\" data-original=\"https://pic2.zhimg.com/b6274542f3785c27ab4a38d4db906efd_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/b6274542f3785c27ab4a38d4db906efd_b.jpg\"&gt; è¿™é‡Œæœ‰ä¸¤ä¸ªï¼šdata-originalå’Œdata-actualsrcï¼Œå®é™…æŸ¥çœ‹çš„å›¾ç‰‡æ˜¯data-originalçš„å›¾ç‰‡æ¯”data-actualsrcçš„å¤§ï¼Œä¸‹è½½ä¸‹æ¥ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œä½†æ˜¯å› ä¸ºæ˜¯ä½¿ç”¨æ­£åˆ™å»åŒ¹é…è§„åˆ™ï¼Œè€Œdata-originalæœ‰å¤šé¡¹ï¼Œä¸Šé¢ä»£ç åªæ˜¯è´´å‡ºæ¥çš„ä¸€éƒ¨åˆ†ï¼Œå®é™…åŒ¹é…çš„ç»“æœç±»ä¼¼è¿™æ ·ï¼š data-actualsrc12data-actualsrc=&quot;https://pic2.zhimg.com/be7600989233bdf438e5ba23f2cdb685_b.jpg&quot;&gt;data-actualsrc=&quot;https://pic2.zhimg.com/b6274542f3785c27ab4a38d4db906efd_b.jpg&quot;&gt; data-original 12345data-original=&quot;https://pic2.zhimg.com/be7600989233bdf438e5ba23f2cdb685_r.jpg&quot;&gt;data-original=&quot;https://pic2.zhimg.com/be7600989233bdf438e5ba23f2cdb685_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/be7600989233bdf438e5ba23f2cdb685_b.jpg&quot;&gt;data-original=&quot;https://pic2.zhimg.com/b6274542f3785c27ab4a38d4db906efd_r.jpg&quot;&gt;data-original=&quot;https://pic2.zhimg.com/b6274542f3785c27ab4a38d4db906efd_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/b6274542f3785c27ab4a38d4db906efd_b.jpg&quot;&gt;data-original=&quot;https://pic2.zhimg.com/0930549116d22ffce22e98c32683d621_r.jpg&quot;&gt; è¿™æ˜¯åœ¨åŒä¸€æ®µç½‘é¡µæºç æµ‹è¯•ä¸‹çš„ç»“æœï¼ŒåŒ¹é…åä¸€ç§ä¼šå¾—åˆ°å¤šä¸ªç›¸åŒçš„urlåœ°å€ï¼Œè§£æèµ·æ¥ä¹Ÿæ›´éº»çƒ¦ï¼Œè¿™ä¹Ÿè·Ÿæ­£åˆ™å†™çš„ç®€å•æœ‰å…³ç³»ï¼Œæœ‰å…´è¶£çš„å¯ä»¥åˆ°æ—¶å€™è‡ªå·±ä¿®æ”¹ä¸€ä¸‹æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¿™æ ·ä¸‹ä¸‹æ¥çš„å›¾ç‰‡ä¹Ÿæ›´é«˜æ¸…çš„å¤šã€‚ åˆ†æäº†æ­£åˆ™ï¼Œä¸‹é¢è¦è·å–æ‰€æœ‰çš„å›¾ç‰‡è¯¥åˆ†æChromeå¼€å‘è€…é¢æ¿çš„Postæ•°æ®ï¼Œå› ä¸ºçŸ¥ä¹é»˜è®¤åªæ˜¾ç¤ºéƒ¨åˆ†å›ç­”ï¼Œæˆ‘ä»¬å¯ä»¥ä¸æ–­å¾€ä¸‹æ‹‰ï¼Œç›´åˆ°çœ‹åˆ°è¿™ä¸ªï¼š ç‚¹å‡»çš„æ—¶å€™æ³¨æ„è§‚å¯Ÿå¼€å‘è€…é¢æ¿ï¼š ç®€ç›´å®Œç¾ï¼Œä¼ é€’çš„æ•°æ®ï¼š 12method:nextparams:&#123;&quot;url_token&quot;:37709992,&quot;pagesize&quot;:10,&quot;offset&quot;:30&#125; å¾ˆçœ¼ç†Ÿï¼Œurl_tokenå°±æ˜¯é—®é¢˜åé¢é‚£ä¸²æ•°å­—ï¼š 1https://www.zhihu.com/question/37709992 pagesizeæ˜¯å›ºå®šçš„10ï¼Œæœ€åä¸€ä¸ªoffsetåç§»é‡åŒæ ·å¾ˆå¥½ç†è§£ï¼Œè¿™é‡Œæ˜¾ç¤º10åº”è¯¥è¯´çš„å°±æ˜¯é»˜è®¤æ˜¾ç¤ºçš„10ä¸ªç­”æ¡ˆï¼Œåé¢è¿˜æŸ¥çœ‹åˆ°å¦‚ä¸‹æ•°æ®ï¼š12method:nextparams:&#123;&quot;url_token&quot;:37709992,&quot;pagesize&quot;:10,&quot;offset&quot;:20&#125; 12method:nextparams:&#123;&quot;url_token&quot;:37709992,&quot;pagesize&quot;:10,&quot;offset&quot;:30&#125; ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸Šæ¯ç¿»è¿‡10ä¸ªç­”æ¡ˆæµè§ˆå™¨å°±ä¼šå‘æœåŠ¡å™¨å‘é€Postè¯·æ±‚åœ¨åŠ è½½åä¸ªç­”æ¡ˆï¼Œæ©å·®ä¸å¤šå¯ä»¥å¼€å§‹å†™ä»£ç äº†ã€‚ åˆæ¨¡æ‹Ÿç™»é™†ä¹‹åçš„æ“ä½œæ˜¯æ‰¾åˆ°Postçš„çœŸå®åœ°å€æ¨¡æ‹Ÿæµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼š 1234567891011121314url = 'https://www.zhihu.com/node/QuestionAnswerListV2'header = &#123; 'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.82 Safari/537.36', 'Referer': 'https://www.zhihu.com/question/37709992', 'Origin': 'https://www.zhihu.com', 'Accept-Encoding': 'gzip, deflate, br',&#125;data = &#123; 'method': 'next', 'params': '&#123;\"url_token\":' + str(37709992) + ',\"pagesize\": \"10\",' + \\ '\"offset\":' + str(offset) + \"&#125;\", '_xsrf': getxsrf(),&#125; æ³¨æ„ å‘é€Postè¯·æ±‚æ—¶å€™è¯·åŠ ä¸Š&#39;_xsrf&#39;: getxsrf()è¿™ä¸€è¡Œï¼Œå¦åˆ™çš„è¯è¿”å›çš„åªä¼šæ˜¯404 Forbiddenï¼Œåº”è¯¥æ˜¯åšäº†é˜²ä¼ªç™»é™†çš„ç¼˜æ•… ç„¶åæ˜¯å†™æ­£åˆ™ï¼Œè¿™é‡Œå‘ç°å›¾ç‰‡éƒ½æ˜¯è¢«åŒ…å«åœ¨è¿™é‡Œé¢ï¼š 1234&lt;div class=\"zm-editable-content clearfix\"&gt;......&lt;/div&gt; æ‰€ä»¥å…ˆåŒ¹é…åˆ°è¿™ä¸€å¤§ä¸²å†…å®¹ï¼š 12pattern = re.compile('&lt;a class=\"author-link\".*?&lt;span title=.*?&lt;div class=\"zh-summary.*?' + '&lt;div class=\"zm-editable-content.*?&gt;(.*?)&lt;/div&gt;', re.S) ç„¶ååœ¨åŒ¹é…data-actualsrcé‡Œé¢çš„å›¾ç‰‡é“¾æ¥ï¼š 1pattern = re.compile('data-actualsrc=\"(.*?)\"&gt;', re.S) è¿˜æœ‰ä¸€ç‚¹è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬è¯·æ±‚ä¹‹åè¿”å›æ¥çš„æ˜¯jsonæ ¼å¼çš„æ•°æ®ï¼Œæ‰€ä»¥è¿™é‡Œè¿˜è¦ç”¨åˆ°jsonæ¨¡å—ï¼š 123question = session.post(url, headers=header, data=data)dic = json.loads(question.content.decode('ISO-8859-1'))li = dic['msg'][0] ç„¶åå¯¹å…¶è¿›è¡Œè§£æï¼š 12345678910# è¿™é‡Œä½¿ç”¨çš„æ˜¯ç¬¬ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼items = re.findall(pattern, li)# æ¥ä¸‹æ¥items = re.findall(pattern, li)# å­˜å‚¨å›¾ç‰‡é“¾æ¥imagesurl = []pattern = re.compile('data-actualsrc=\"(.*?)\"&gt;', re.S)for item in items: urls = re.findall(pattern, item) imagesurl.extend(urls) æ‰§è¡Œä¸‹è½½æ“ä½œï¼š 123456789101112131415161718192021222324252627282930# å­˜æ”¾å›¾ç‰‡çš„åœ°å€PWD = \"D:/work/python/zhihu/\" for url in imagesurl: myurl = url filename = PWD + str(count) + '.jpg' if os.path.isfile(filename): print(\"æ–‡ä»¶å­˜åœ¨ï¼š\", filename) count += 1 continue else: # æ‰§è¡Œä¸‹è½½æ“ä½œçš„æ–¹æ³• downpic(filename, myurl) count += 1 photoNum += 1 print(\"ä¸€å…±ä¸‹è½½äº†&#123;0&#125; å¼ ç…§ç‰‡\".format(photoNum)) if not os.path.exists(PWD): os.makedirs(PWD) # é€’å½’è°ƒç”¨ change(offset, count, photoNum)# downpicæ–¹æ³•æºç def downpic(filename, url): print(\"æ­£åœ¨ä¸‹è½½ \" + url) try: r = requests.get(url, stream=True) with open(filename, 'wb') as fd: for chunk in r.iter_content(): fd.write(chunk) except Exception as e: print(\"ä¸‹è½½å¤±è´¥äº†\", e) è¿è¡Œç»“æœ è¿™åªæ˜¯ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä¹‹å‰ä¸‹äº†å››äº”ç™¾å¼ è¿˜åœ¨ä¸‹~å½“ç„¶è¿™æ˜¯åè¯ï¼Œæ„Ÿè§‰ç°åœ¨å†™çš„ä¸œè¥¿éƒ½å¾ˆç®€å•ï¼Œå¸Œæœ›ä¸‹ä¸€æ¬¡èƒ½å†™å‡ºéš¾ä¸€ç‚¹çš„ä¸œè¥¿å‡ºæ¥ã€‚ è¿™é‡Œæ­£åˆ™éƒ¨åˆ†å‚è€ƒäº†è¿™é‡Œï¼š é€šè¿‡Pythonçˆ¬è™«çˆ¬å–çŸ¥ä¹æŸä¸ªé—®é¢˜ä¸‹çš„å›¾ç‰‡ æœ€åæ˜¯æºç  æºç ä¸­æ³¨é‡Šéƒ¨åˆ†åªèƒ½ä¸‹è½½å‰åä¸ªç­”æ¡ˆé‡ŒåŒ…å«çš„å›¾ç‰‡çš„æ–¹æ³•ï¼Œè¿˜æœ‰ä¸€äº›æƒ³æ³•æœªå®Œæˆï¼Œæœ¬æ¥æ˜¯æƒ³æ‰“å°ä¸€ä¸‹æ­£åœ¨ä¸‹è½½å“ªä¸ªç­”ä¸»çš„å›ç­”ï¼Œç„¶åæŠŠå›¾ç‰‡åˆ†åˆ«ä¿å­˜åˆ°ç›¸åº”çš„å•ç‹¬æ–‡ä»¶å¤¹ï¼Œå®ç°èµ·æ¥æœ‰ç‚¹éº»çƒ¦å°±æ²¡å»æï¼Œä»…ä¾›å‚è€ƒã€‚ äº²æµ‹å¦‚æœéœ€è¦ä¸‹è½½å¦ä¸€ä¸ªé—®é¢˜çš„ç­”æ¡ˆï¼Œåªéœ€è¦åœ¨:1234567data = &#123; &apos;method&apos;: &apos;next&apos;, &apos;params&apos;: &apos;&#123;&quot;url_token&quot;:&apos; + str(37709992) + &apos;,&quot;pagesize&quot;: &quot;10&quot;,&apos; + \\ &apos;&quot;offset&quot;:&apos; + str(offset) + &quot;&#125;&quot;, &apos;_xsrf&apos;: getxsrf(), &#125; æ›´æ¢é‚£ä¸²æ•°å­—å°±è¡Œï¼Œå°±å¥½æ¯”è¿™æ ·çš„å½¢å¼ï¼š https://www.zhihu.com/question/48720845 ä½†æ˜¯è¿™ç§å½¢å¼çš„æŠŠæ•°å­—æ¢ä¸Šå»ä¸èµ·æ•ˆï¼š https://www.zhihu.com/question/49078894#answer-41776282 è¿™ä¸ªå¥½åƒæ˜¯çŸ¥ä¹çƒ­é—¨é—®ç­”çš„é“¾æ¥å½¢å¼ï¼Œæš‚æ—¶æ²¡æœ‰æ·±ç©¶","tags":[{"name":"çŸ¥ä¹","slug":"çŸ¥ä¹","permalink":"https://www.limuyang.cc/tags/çŸ¥ä¹/"},{"name":"çˆ¬è™«","slug":"çˆ¬è™«","permalink":"https://www.limuyang.cc/tags/çˆ¬è™«/"},{"name":"æ•°æ®é‡‡é›†","slug":"æ•°æ®é‡‡é›†","permalink":"https://www.limuyang.cc/tags/æ•°æ®é‡‡é›†/"}]},{"title":"äººç”Ÿè‹¦çŸ­ï¼Œæˆ‘ç”¨Python--ä¸€èµ·æ¥çˆ¬çŸ¥ä¹å¨˜","date":"2016-08-09T19:14:46.000Z","path":"2016/08/09/äººç”Ÿè‹¦çŸ­ï¼Œæˆ‘ç”¨Python-ä¸€èµ·æ¥çˆ¬çŸ¥ä¹å¨˜/","text":"ä¸Šæ¬¡çˆ¬äº†æ•™åŠ¡å¤„çš„æˆç»©ï¼Œæ¥ä¸‹æ¥æƒ³å»çˆ¬ä¸€çˆ¬çŸ¥ä¹å¨˜ï¼Œå¥½åƒå¤§å®¶éƒ½å¾ˆå–œæ¬¢çˆ¬çŸ¥ä¹å¨˜ï¼ŒGitHubä¸Šè²Œä¼¼å·²ç»æœ‰äººæŠŠè·å–å„ç§çŸ¥ä¹æ•°æ®çš„æ“ä½œå°è£…å¥½äº†ï¼šzhihu-python ï¼Œä½†æ˜¯è‰¯è¾°è¡¨ç¤ºè¿˜æ˜¯æƒ³è‡ªå·±è¯•ä¸€è¯•ï¼Œæˆ‘å°±çˆ¬ç‚¹ç®€å•çš„ï¼Œéš¾åº¦å¤§çš„æˆ‘ä¹Ÿä¸ä¼šï¼Œæˆ‘ç„å‡†çš„æ˜¯æˆ‘è‡ªå·±å…³æ³¨çš„äººçš„æ•°æ®ï¼Œå·®ä¸å¤šå°±è¿™äº›ä¸œè¥¿ï¼š å…³æ³¨è€… / æé—® / å›ç­” / èµåŒ é‚£ä¹ˆä¸‹é¢å¼€å§‹åˆ†æï¼Œè¦æ‹¿åˆ°è¿™ä¸ªæ•°æ®è‚¯å®šæ˜¯è¦å…ˆç™»é™†çš„ï¼Œé‚£ä¹ˆå…ˆæ‰¾åˆ°ç™»é™†ç•Œé¢ï¼š è¿™ç®—æ˜¯æ¯”è¾ƒæ­£å¸¸çš„ç•Œé¢ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆæœ‰çš„æ—¶å€™ä¼šå‡ºç°æ–°çš„éªŒè¯ç å½¢å¼ï¼š è¿™ç§å½¢å¼ç™»é™†çš„è¯æˆ‘çœ‹ä¼ é€’çš„è¡¨å•æ•°æ®æ˜¯ä½ é¼ æ ‡ç‚¹å‡»çš„åæ ‡ï¼Œè¿™ç§æƒ…å†µæš‚æ—¶ä¸çŸ¥é“æ€ä¹ˆåŠï¼Œç•™ç»™é«˜æ‰‹ï¼Œæˆ‘ä»¬åˆ†æä¸Šé¢é‚£ç§ï¼ŒçŸ¥ä¹ç™»é™†åˆ†ä¸ºæ‰‹æœºå·ç™»é™†æˆ–è€…é‚®ç®±ç™»é™†ï¼Œå…ˆè¯•è¯•é‚®ç®±ç™»é™†ï¼ŒæŸ¥çœ‹Postæ•°æ®ï¼š ç„¶åæ˜¯æ‰‹æœºå·ç™»é™†çš„: ç°åœ¨ç†ä¸€ä¸‹æ€è·¯ï¼Œæˆ‘ä»¬è¦ç™»å½•çŸ¥ä¹è¦ä¼ é€’çš„æ•°æ®å¦‚ä¸‹ï¼š _xsrf() ç”¨äºé˜²ä¼ªç™»é™† password captcha éªŒè¯ç  phone_num/email ä¸åŒç™»é™†æ–¹å¼ä¼ é€’çš„ä¸œè¥¿ä¸åŒ phone_num/emailä»¥åŠpassswordéƒ½éœ€è¦è‡ªå·±è¾“å…¥ï¼Œè¿™ä¸ªå¥½åŠï¼Œæˆ‘ä»¬éœ€è¦è§£å†³å¦‚ä½•è·å– _xsrfå’Œcaptcha çš„é—®é¢˜ï¼Œå…ˆè§£å†³ _xsrfï¼Œè¿™ä¸ªæ›´ç®€å•ä¸€ç‚¹ï¼Œæˆ‘ä»¬åœ¨çŸ¥ä¹ç™»é™†é¡µé¢ å³é”®æŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼Œç›´æ¥æœ_xsrfï¼š 1234&lt;div class=\"view view-signin\" data-za-module=\"SignInForm\"&gt;&lt;form&gt;&lt;input type=\"hidden\" name=\"_xsrf\" value=\"cf1ee28f15cea5dba3243a1c31a1b284\"/&gt;&lt;div class=\"group-inputs\"&gt; æˆ‘ä»¬è¦åšçš„å°±æ˜¯è§£æå‡ºè¿™ä¸ªå…ƒç´ ï¼Œç›´æ¥ä¸Šä»£ç ï¼š 12345678910logn_url = 'http://www.zhihu.com/#signin'session = requests.session()headers = &#123; 'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.82 Safari/537.36',&#125;content = session.get(logn_url, headers=headers).contentsoup = BeautifulSoup(content, 'html.parser')def getxsrf(): return soup.find('input', attrs=&#123;'name': \"_xsrf\"&#125;)['value'] ä¸‹é¢è·å–éªŒè¯ç ï¼Œ æˆ‘å‘ç°æ— è®ºæ˜¯ä½¿ç”¨å“ªä¸€ç§ç™»é™†æ–¹å¼ï¼ŒChromeçš„å¼€å‘è€…é¢æ¿éƒ½ä¼šæœ‰è¿™ä¹ˆä¸€è¡Œï¼š å½“æˆ‘æŠŠè¿™ä¸ªRequest URLè¾“å…¥æµè§ˆå™¨ä¸­å°±ä¼šè½¬åˆ°è¿™ä¸ªéªŒè¯ç å›¾ç‰‡çš„ç•Œé¢ï¼Œè¯´æ˜è¿™ä¸ªéªŒè¯ç æ˜¯æˆ‘ä»¬åŠ è½½è¿™ä¸ªé¡µé¢æ—¶å€™ï¼Œæµè§ˆå™¨å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ç„¶åä¸‹è½½ä¸‹æ¥çš„ï¼Œé‚£ä¹ˆç°åœ¨æˆ‘ä»¬æœ‰äº†URLåœ°å€ï¼š è¿™è¿˜æ˜¯ä¸€ä¸ªGETè¯·æ±‚ï¼Œè¿™é‡Œæ³¨æ„è¿™ä¸ªä¼ é€’çš„rå‚æ•°æ˜¯ä¼šä¸æ–­å˜åŒ–çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªå½“å‰Unixçš„æ—¶é—´æˆ³ï¼ŒçŸ¥é“äº†è¿™äº›å¯ä»¥ç€æ‰‹è·å–éªŒè¯ç ç„¶åè®©ç”¨æˆ·è‡ªå·±è¾“å…¥ï¼š 12345678910111213141516171819202122try: from PIL import Imageexcept: pass# è·å–éªŒè¯ç def get_captcha(): t = str(int(time.time() * 1000)) captcha_url = 'http://www.zhihu.com/captcha.gif?r=' + t + \"&amp;type=login\" r = session.get(captcha_url, headers=headers) with open('captcha.jpg', 'wb') as f: f.write(r.content) f.close() # ç”¨pillow çš„ Image æ˜¾ç¤ºéªŒè¯ç  # å¦‚æœæ²¡æœ‰å®‰è£… pillow åˆ°æºä»£ç æ‰€åœ¨çš„ç›®å½•å»æ‰¾åˆ°éªŒè¯ç ç„¶åæ‰‹åŠ¨è¾“å…¥ try: im = Image.open('captcha.jpg') im.show() im.close() except: print(u'è¯·åˆ° %s ç›®å½•æ‰¾åˆ°captcha.jpg æ‰‹åŠ¨è¾“å…¥' % os.path.abspath('captcha.jpg')) captcha = input(\"please input the captcha\\n&gt;\") return captcha è¿™é‡Œè·å–éªŒè¯ç çš„ä»£ç æ¥è‡ªGitHubä¸Šçš„fuck-loginé¡¹ç›®ï¼Œåœ¨æ­¤è¡¨ç¤ºæ„Ÿè°¢ï¼Œæ¥ä¸‹é‡Œå°±æ˜¯å†™ä¸€ä¸ªæ–¹æ³•åˆ¤æ–­ç”¨æˆ·æ˜¯ä½¿ç”¨äº†å“ªä¸€ç§ç™»é™†æ–¹å¼ï¼Œç„¶åä¼ é€’ç›¸åº”çš„æ•°æ®ï¼š 12345678910111213141516171819202122232425262728293031323334def login(secret, account): # é€šè¿‡è¾“å…¥çš„ç”¨æˆ·ååˆ¤æ–­æ˜¯å¦æ˜¯æ‰‹æœºå· if re.match(r&quot;^1\\d&#123;10&#125;$&quot;, account): print(&quot;æ‰‹æœºå·ç™»å½• \\n&quot;) post_url = &apos;http://www.zhihu.com/login/phone_num&apos; postdata = &#123; &apos;_xsrf&apos;: getxsrf(), &apos;password&apos;: secret, &apos;remember_me&apos;: &apos;true&apos;, &apos;phone_num&apos;: account, &#125; else: print(&quot;é‚®ç®±ç™»å½• \\n&quot;) post_url = &apos;http://www.zhihu.com/login/email&apos; postdata = &#123; &apos;_xsrf&apos;: getxsrf(), &apos;password&apos;: secret, &apos;remember_me&apos;: &apos;true&apos;, &apos;email&apos;: account, &#125; try: # ä¸éœ€è¦éªŒè¯ç ç›´æ¥ç™»å½•æˆåŠŸ login_page = session.post(post_url, data=postdata, headers=headers) login_code = login_page.text print(login_page.status) print(login_code) except: # éœ€è¦è¾“å…¥éªŒè¯ç åæ‰èƒ½ç™»å½•æˆåŠŸ postdata[&quot;captcha&quot;] = get_captcha() login_page = session.post(post_url, data=postdata, headers=headers) login_code = eval(login_page.text) print(login_code[&apos;msg&apos;])# è¿™éƒ¨åˆ†ä»£ç åŒæ ·æ¥è‡ª[**fuck-login**](https://github.com/xchaoinfo/fuck-login)é¡¹ç›®,æˆ‘å·äº†å¾ˆå¤šæ‡’,å›§ è¿™ä¸ªæ—¶å€™åˆ¤æ–­æ˜¯å¦ç™»é™†æˆåŠŸå¯ä»¥éšä¾¿æŸ¥çœ‹ä¸€ä¸ªé¡µé¢å‘é€GETè¯·æ±‚çœ‹æ˜¯å¦è¿”å›200ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´ï¼Œæ¥ä¸‹æ¥æ‰æ˜¯å…³é”®ï¼Œä¸ºäº†è·å–æˆ‘å…³æ³¨çš„äººçš„ä¿¡æ¯ï¼Œå…ˆæ‰“å¼€å¼€å‘è€…é¢æ¿ï¼Œè¿™ä¸ªåœ°æ–¹æ‰“é’©ï¼š å› ä¸ºç½‘é¡µæœ‰æ—¶å€™ä¼šè·³è½¬ï¼Œè¿™é‡Œæ‰“é’©ä¹‹åæ–°è·³è½¬çš„é¡µé¢çš„ä¿¡æ¯å°±ä¸ä¼šè¦†ç›–ä¹‹å‰æ¥å—åˆ°çš„ä¿¡æ¯ï¼Œç„¶åæ‰¾åˆ°æˆ‘å…³æ³¨çš„äººï¼ŒURLåœ°å€æ˜¯ï¼š https://www.zhihu.com/people/GitSmile/followees æœ€å¼€å§‹æˆ‘èµ°äº†å¼¯è·¯ï¼Œæˆ‘ä»¥ä¸ºç›´æ¥åœ¨è¿™ä¸ªé¡µé¢è§£æå‡ºæˆ‘å…³æ³¨çš„äººçš„ä¿¡æ¯å°±è¡Œï¼Œæ‰€ä»¥ä¸€å¼€å§‹æˆ‘æ˜¯è¿™ä¹ˆåšçš„ï¼ŒæŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼Œè¿™é‡Œéšä¾¿æ‰¾ä¸€ä¸ªæˆ‘å…³æ³¨çš„äººçš„ä¿¡æ¯ï¼š 1234567891011121314151617181920212223&lt;a title=\"æ­»è€…ä»£è¨€äºº\"data-hovercard=\"p$t$forensic\"class=\"zm-item-link-avatar\"href=\"/people/forensic\"&gt;&lt;img src=\"https://pic1.zhimg.com/be39d110759e68f389b7d2934d7353bc_m.jpg\" class=\"zm-item-img-avatar\"&gt;&lt;/a&gt;&lt;div class=\"zm-list-content-medium\"&gt;&lt;h2 class=\"zm-list-content-title\"&gt;&lt;a data-hovercard=\"p$t$forensic\" href=\"https://www.zhihu.com/people/forensic\" class=\"zg-link author-link\" title=\"æ­»è€…ä»£è¨€äºº\"&gt;æ­»è€…ä»£è¨€äºº&lt;/a&gt;&lt;span class=\"icon icon-badge-best_answerer icon-badge\" data-tooltip=\"s$b$ä¼˜ç§€å›ç­”è€…\"&gt;&lt;/span&gt;&lt;/h2&gt;&lt;div class=\"ellipsis\"&gt;&lt;span class=\"badge-summary\"&gt;ä¼˜ç§€å›ç­”è€…&lt;/span&gt;&lt;span class=\"bio\"&gt;ä¸å…»å–µçš„çˆ±å–µæ³•åŒ»ã€‚&lt;/span&gt;&lt;/div&gt;&lt;div class=\"details zg-gray\"&gt;&lt;a target=\"_blank\" href=\"/people/forensic/followers\" class=\"zg-link-gray-normal\"&gt;35968 å…³æ³¨è€…&lt;/a&gt;/&lt;a target=\"_blank\" href=\"/people/forensic/asks\" class=\"zg-link-gray-normal\"&gt;2 æé—®&lt;/a&gt;/&lt;a target=\"_blank\" href=\"/people/forensic/answers\" class=\"zg-link-gray-normal\"&gt;305 å›ç­”&lt;/a&gt;/&lt;a target=\"_blank\" href=\"/people/forensic\" class=\"zg-link-gray-normal\"&gt;51278 èµåŒ&lt;/a&gt;&lt;/div&gt; ç„¶ååœ¨å¯¹æ¯”å¦ä¸€æ¡ï¼š 1234567891011121314151617181920212223&lt;a title=\"é™ˆäº¦é£˜\"data-hovercard=\"p$t$chen-yi-piao\"class=\"zm-item-link-avatar\"href=\"/people/chen-yi-piao\"&gt;&lt;img src=\"https://pic2.zhimg.com/d495751efbf837b1b5b08571add7df3d_m.jpg\" class=\"zm-item-img-avatar\"&gt;&lt;/a&gt;&lt;div class=\"zm-list-content-medium\"&gt;&lt;h2 class=\"zm-list-content-title\"&gt;&lt;a data-hovercard=\"p$t$chen-yi-piao\" href=\"https://www.zhihu.com/people/chen-yi-piao\" class=\"zg-link author-link\" title=\"é™ˆäº¦é£˜\"&gt;é™ˆäº¦é£˜&lt;/a&gt;&lt;/h2&gt;&lt;div class=\"ellipsis\"&gt;&lt;span class=\"bio\"&gt;éŸ³ä¹å’Œç”µå½±æ˜¯æˆ‘çš„çˆ±ä¸æ…ˆæ‚²&lt;/span&gt;&lt;/div&gt;&lt;div class=\"details zg-gray\"&gt;&lt;a target=\"_blank\" href=\"/people/chen-yi-piao/followers\" class=\"zg-link-gray-normal\"&gt;74469 å…³æ³¨è€…&lt;/a&gt;/&lt;a target=\"_blank\" href=\"/people/chen-yi-piao/asks\" class=\"zg-link-gray-normal\"&gt;0 æé—®&lt;/a&gt;/&lt;a target=\"_blank\" href=\"/people/chen-yi-piao/answers\" class=\"zg-link-gray-normal\"&gt;80 å›ç­”&lt;/a&gt;/&lt;a target=\"_blank\" href=\"/people/chen-yi-piao\" class=\"zg-link-gray-normal\"&gt;315971 èµåŒ&lt;/a&gt;&lt;/div&gt; è¦åˆ†è§£å‡ºè¿™äº›å…ƒç´ ï¼Œåªè¦æ‰¾å‡ºä»–ä»¬çš„å…±åŒç‚¹ï¼Œå½“æ—¶æœºæ™ºå¦‚æˆ‘ä¸€çœ¼å°±å‘ç°æ¯ä¸€ä¸ªæˆ‘å…³æ³¨çš„äººçš„åå­—éƒ½æœ‰è¿™ä¹ˆä¸€è¡Œå…ƒç´ ï¼š 1class=&quot;zm-item-link-avatar&quot; è€Œä¸”éƒ½åŒ…å«åœ¨ä¸€ä¸ª&lt;a&gt;&lt;/a&gt;æ ‡ç­¾é‡Œé¢ï¼Œè¿™å°±å¥½åŠäº†ï¼Œä½¿ç”¨BeautifulSoupå…ˆåˆ†è§£å‡ºæ¯ä¸€ä¸ªæˆ‘å…³æ³¨çš„äººçš„åå­—ï¼š 123456789101112def getdetial(): followees_url = &apos;https://www.zhihu.com/people/GitSmile/followees&apos; followees_headers = &#123; &apos;User-Agent&apos;: &apos;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.82 Safari/537.36&apos;, &apos;Referer&apos;: &apos;https://www.zhihu.com/people/GitSmile/about&apos;, &apos;Upgrade-Insecure-Requests&apos;: &apos;1&apos;, &apos;Accept-Encoding&apos;: &apos;gzip, deflate, sdch, br&apos; &#125; myfollowees = session.get(followees_url, headers=followees_headers) mysoup = BeautifulSoup(myfollowees.content, &apos;html.parser&apos;) print(mysoup.find(&apos;span&apos;, attrs=&#123;&apos;class&apos;: &apos;zm-profile-section-name&apos;&#125;).text) ç„¶åç»§ç»­è§‚å¯Ÿï¼Œçªç ´ç‚¹ä¾ç„¶åœ¨è¿™ä¸ª&lt;a&gt;&lt;/a&gt;æ ‡ç­¾ï¼Œæ‹¿â€é™ˆäº¦é£˜â€çš„ä¿¡æ¯åšä¸ªä¾‹å­ï¼Œçœ‹å®˜ä»¬çœ‹è¿™é‡Œé¢æ˜¯ä¸æ˜¯æœ‰ä¸ªhref=&quot;/people/chen-yi-piaoï¼Œç„¶åçœ‹ä¸€ä¸‹å¥¹çš„ç›¸å…³ä¿¡æ¯ï¼š 1234567&lt;a target=\"_blank\" href=\"/people/chen-yi-piao/followers\" class=\"zg-link-gray-normal\"&gt;74469 å…³æ³¨è€…&lt;/a&gt;/&lt;a target=\"_blank\" href=\"/people/chen-yi-piao/asks\" class=\"zg-link-gray-normal\"&gt;0 æé—®&lt;/a&gt;/&lt;a target=\"_blank\" href=\"/people/chen-yi-piao/answers\" class=\"zg-link-gray-normal\"&gt;80 å›ç­”&lt;/a&gt;/&lt;a target=\"_blank\" href=\"/people/chen-yi-piao\" class=\"zg-link-gray-normal\"&gt;315971 èµåŒ&lt;/a&gt; å‘ç°æ²¡æœ‰ï¼Œæ¯ä¸€ä¸ªä¿¡æ¯é‡Œé¢çš„hrefå…ƒç´ éƒ½æ˜¯æˆ‘ä»¬æœ€å¼€å§‹çœ‹åˆ°çš„/people/chen-yi-piaoå…ƒç´ åŠ ä¸Šä¸€äº›å­—ç¬¦ä¸²ç»„æˆçš„ï¼Œé‚£ä¹ˆæˆ‘å°±å¯ä»¥åœ¨è¿™ä¸Šé¢åšç‚¹æ–‡ç« ï¼š 12345678910111213141516171819202122232425è·å–è¯¦ç»†ä¿¡æ¯def getdetial(): followees_url = 'https://www.zhihu.com/people/GitSmile/followees' followees_headers = &#123; 'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.82 Safari/537.36', 'Referer': 'https://www.zhihu.com/people/GitSmile/about', 'Upgrade-Insecure-Requests': '1', 'Accept-Encoding': 'gzip, deflate, sdch, br' &#125; myfollowees = session.get(followees_url, headers=followees_headers) mysoup = BeautifulSoup(myfollowees.content, 'html.parser') print(mysoup.find('span', attrs=&#123;'class': 'zm-profile-section-name'&#125;).text) for result in mysoup.findAll('a', attrs=&#123;'class': 'zm-item-link-avatar'&#125;): print(result.get('title')) # è§£æå‡ºhrefå…ƒç´ ä¿¡æ¯ href = str(result.get('href')) # å…³æ³¨è€… print(mysoup.find('a', attrs=&#123;'href': href + '/followers'&#125;).text) # æé—® print(mysoup.find('a', attrs=&#123;'href': href + '/asks'&#125;).text) # å›ç­” print(mysoup.find('a', attrs=&#123;'href': href + '/answers'&#125;).text) # èµåŒ print(mysoup.find('a', attrs=&#123;'href': href, 'class': 'zg-link-gray-normal'&#125;).text + '\\n') ä¸Šé¢çš„ä»£ç åº”è¯¥å¾ˆç®€å•äº†ï¼Œçœ‹ä¸€çœ‹å°±èƒ½çœ‹æ‡‚ï¼Œç„¶åå°±æˆ‘ä¿¡å¿ƒæ»¡æ»¡åœ°åœ¨PyCharmä¸Šè¾“å‡ºçš„æ—¶å€™ï¼Œå‘ç°æ¥æ¥å›å›åªè¾“å‡º20æ¡ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘å…³æ³¨äº†26äººï¼Œä½†æ˜¯æ§åˆ¶å°åªè¾“å‡ºäº†20ä¸ªäººçš„ä¿¡æ¯ï¼Œç„¶åæˆ‘å°±ä¸Šç½‘æŸ¥ï¼Œå‘ç°ä¸æ­¢ä¸€ä¸ªäººæœ‰æˆ‘è¿™æ ·çš„ç–‘é—®ï¼Œå½“ç„¶ä¹Ÿå¤šäºäº†å‰äººè¸©å‘ï¼Œç½‘ä¸Šç»™å‡ºæ¥çš„ç­”æ¡ˆæ˜¯çŸ¥ä¹è·å–å…³æ³¨çš„äººçš„æ—¶å€™ä½¿ç”¨äº†AJAXæŠ€æœ¯ï¼Œä¹Ÿå°±æ˜¯åŠ¨æ€åŠ è½½ï¼Œä½†æ˜¯è¿™ä¸€éƒ¨åˆ†ä»£ç ä¸ä¼šå†ç½‘é¡µHtmlä»£ç ä¸­æ˜¾ç¤ºå‡ºæ¥ï¼Œæ‰€ä»¥ä¸ºäº†è·å–å…¶ä»–å…³æ³¨çš„äººçš„ä¿¡æ¯æˆ‘è¿™é‡Œè¦å¦è¾Ÿè¹Šå¾„ã€‚ ç„¶åæˆ‘ç¿»çœ‹æˆ‘å…³æ³¨çš„äººçš„ä¿¡æ¯çš„æ—¶å€™ï¼Œåœ¨å¼€å‘è€…é¢æ¿æŠ“åˆ°è¿™ä¹ˆä¸€æ¡POSTä¿¡æ¯ï¼š è¿™æ¡POSTä¹‹åä¸‹é¢åˆ·å‡ºæ¥çš„å›¾ç‰‡æ˜¯æˆ‘å…³æ³¨çš„äººçš„å¤´åƒå¹¶ä¸”è¿™äº›å¤´åƒåœ¨æˆ‘ä¹‹å‰çœ‹åˆ°çš„20æ¡æ•°æ®é‡Œé¢æ˜¯æ²¡æœ‰çš„ï¼ŒåŠ ä¸Šæˆ‘æ€»å…±å°±å…³æ³¨äº†27ä¸ªäººï¼Œæ‰€ä»¥æˆ‘æœ‰ç†ç”±ç›¸ä¿¡è¿™ä¸ªPostå°±æ˜¯æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€è¯·æ±‚çš„Postï¼Œçœ‹ä¸€ä¸‹Postçš„ä¿¡æ¯ï¼š ä¸€ä¸ªåç§»é‡(offset)ï¼Œä¸€ä¸ªå“ˆå¸Œå€¼(hash_id)å¤–åŠ ä¸€ä¸ªâ€order_byâ€:â€createdâ€çš„é”®å€¼å¯¹ï¼Œè¿™é‡Œåç§»é‡å¾ˆå¥½ç†è§£ï¼Œè¿™ä¸ªâ€hash_idâ€æ®æˆ‘å¤šæ¬¡ç™»é™†å‘ç°æ˜¯ä¸€ä¸ªä¸å˜çš„å€¼ï¼Œæˆ–è€…è¯´æ¯ä¸€å°ç”µè„‘æˆ–è®¸ç²¾ç¡®ä¸€ç‚¹æ¯ä¸€ä¸ªæµè§ˆå™¨éƒ½ä¼šæœ‰è¿™ä¹ˆä¸€ä¸ªç»™å®šçš„å€¼ï¼Œç…§æŠ„ï¼Œé‚£ä¹ˆæ”¹è¿›åçš„ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536# è·å–æ‰€æœ‰å…³æ³¨çš„äººçš„ä¿¡æ¯def getallview(): nums = 27 # è¿™ä¸ªæ˜¯æˆ‘å…³æ³¨çš„äººæ•° followees_headers = &#123; &apos;User-Agent&apos;: &apos;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.82 Safari/537.36&apos;, &apos;Referer&apos;: &apos;https://www.zhihu.com/people/GitSmile/followees&apos;, &apos;Origin&apos;: &apos;https://www.zhihu.com&apos;, &apos;Accept-Encoding&apos;: &apos;gzip, deflate, br&apos;, &apos;CG - Sid&apos;: &apos;57226ad5 - 793b - 4a9d - 9791 - 2a9a17e682ef&apos;, &apos;Accept&apos;: &apos;* / *&apos; &#125; # åºå· count = 0 for index in range(0, nums): fo_url = &apos;https://www.zhihu.com/node/ProfileFolloweesListV2&apos; m_data = &#123; &apos;method&apos;: &apos;next&apos;, &apos;params&apos;: &apos;&#123;&quot;offset&quot;:&apos; + str( index) + &apos;,&quot;order_by&quot;:&quot;created&quot;,&quot;hash_id&quot;:&quot;de2cb64bc1afe59cf8a6e456ee5eaebc&quot;&#125;&apos;, &apos;_xsrf&apos;: str(getxsrf()) &#125; result = session.post(fo_url, data=m_data, headers=followees_headers) dic = json.loads(result.content.decode(&apos;utf-8&apos;)) li = dic[&apos;msg&apos;][0] mysoup = BeautifulSoup(li, &apos;html.parser&apos;) for result in mysoup.findAll(&apos;a&apos;, attrs=&#123;&apos;class&apos;: &apos;zm-item-link-avatar&apos;&#125;): print(index + 1) print(result.get(&apos;title&apos;)) href = str(result.get(&apos;href&apos;)) print(mysoup.find(&apos;a&apos;, attrs=&#123;&apos;href&apos;: href + &apos;/followers&apos;&#125;).text) print(mysoup.find(&apos;a&apos;, attrs=&#123;&apos;href&apos;: href + &apos;/asks&apos;&#125;).text) print(mysoup.find(&apos;a&apos;, attrs=&#123;&apos;href&apos;: href + &apos;/answers&apos;&#125;).text) print(mysoup.find(&apos;a&apos;, attrs=&#123;&apos;href&apos;: href, &apos;class&apos;: &apos;zg-link-gray-normal&apos;&#125;).text + &apos;\\n&apos;) count += 1 print(&apos;ä¸€å…±å…³æ³¨äº† %däºº&apos; % count) æ”¾ä¸Šç¨‹åºçš„å…¥å£ï¼š 123456789if __name__ == &apos;__main__&apos;: if isLogin(): print(&apos;æ‚¨å·²ç»ç™»å½•&apos;) else: account = input(&apos;è¯·è¾“å…¥ä½ çš„ç”¨æˆ·å\\n&gt; &apos;) secret = input(&quot;è¯·è¾“å…¥ä½ çš„å¯†ç \\n&gt; &quot;) login(secret, account) getallview() çœ‹ä¸€ä¸‹å®é™…æ•ˆæœï¼š å†™åœ¨ç»“å°¾ è™½ç„¶ç®€å•ï¼Œä½†æ˜¯æä¾›äº†ä¸€äº›åˆå­¦è€…çš„æ€è·¯ï¼Œä¸‹ä¸€æ¬¡å‡†å¤‡çˆ¬ä¸€äº›çŸ¥ä¹ä¸Šçš„å›¾ç‰‡ï¼Œå¥½åƒå¾ˆå¤šäººéƒ½çƒ­è¡·äºè¿™ç§äº‹ï¼Œå˜»å˜»ï¼Œè†è½²åˆºç§¦ç‹ã€‚ æºç ","tags":[{"name":"çŸ¥ä¹","slug":"çŸ¥ä¹","permalink":"https://www.limuyang.cc/tags/çŸ¥ä¹/"},{"name":"çˆ¬è™«","slug":"çˆ¬è™«","permalink":"https://www.limuyang.cc/tags/çˆ¬è™«/"},{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"https://www.limuyang.cc/tags/ç½‘ç»œ/"}]},{"title":"äººç”Ÿè‹¦çŸ­ï¼Œæˆ‘ç”¨Python--çˆ¬è™«æ¨¡æ‹Ÿç™»é™†æ•™åŠ¡å¤„å¹¶ä¸”ä¿å­˜æ•°æ®åˆ°æœ¬åœ°","date":"2016-08-04T19:26:46.000Z","path":"2016/08/04/äººç”Ÿè‹¦çŸ­ï¼Œæˆ‘ç”¨Python-çˆ¬è™«æ¨¡æ‹Ÿç™»é™†æ•™åŠ¡å¤„å¹¶ä¸”ä¿å­˜æ•°æ®åˆ°æœ¬åœ°/","text":"åˆšå¼€å§‹æ¥è§¦Pythonï¼Œçœ‹å¾ˆå¤šäººç©çˆ¬è™«æˆ‘ä¹Ÿæƒ³ç©ï¼Œæ‰¾æ¥æ‰¾å»å‘ç°å¾ˆå¤šäººç”¨ç½‘ç»œçˆ¬è™«å¹²çš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯æ¨¡æ‹Ÿç™»é™†ï¼Œå¢åŠ ç‚¹éš¾åº¦å°±æ˜¯æ¨¡æ‹Ÿç™»é™†ååœ¨è·å–æ•°æ®ï¼Œä½†æ˜¯ç½‘ä¸Šå¥½å°‘æœ‰Python 3.xçš„æ¨¡æ‹Ÿç™»é™†Demoå¯ä»¥å‚è€ƒï¼ŒåŠ ä¸Šè‡ªå·±ä¹Ÿä¸æ€ä¹ˆæ‡‚HTMLï¼Œæ‰€ä»¥è¿™ç¬¬ä¸€ä¸ªPythonçˆ¬è™«å†™çš„å¼‚å¸¸è‰°éš¾ï¼Œä¸è¿‡æœ€ç»ˆç»“æœè¿˜æ˜¯å°½å¦‚äººæ„çš„ï¼Œä¸‹é¢æŠŠè¿™æ¬¡å­¦ä¹ çš„è¿‡ç¨‹æ•´ç†ä¸€ä¸‹ã€‚å·¥å…· ç³»ç»Ÿï¼šwin7 64ä½ç³»ç»Ÿ æµè§ˆå™¨ï¼šChrome Pythonç‰ˆæœ¬ï¼šPython 3.5 64-bit IDEï¼šJetBrains PyCharm (è²Œä¼¼å¾ˆå¤šäººéƒ½ç”¨è¿™ä¸ª) æˆ‘æŠŠç›®æ ‡ç„å‡†äº†æˆ‘ä»¬çš„æ•™åŠ¡å¤„ï¼Œè¿™æ¬¡çˆ¬è™«çš„ç›®çš„æ˜¯ä»æ•™åŠ¡å¤„è·å–æˆç»©å¹¶ä¸”æŠŠæˆç»©è¾“å…¥Excelè¡¨æ ¼ä¸­ä¿å­˜èµ·æ¥ï¼Œ æˆ‘ä»¬å­¦æ ¡æ•™åŠ¡å¤„çš„åœ°å€æ˜¯ï¼šhttp://jwc.ecjtu.jx.cn/ ï¼Œå¾€å¸¸æ¯æ¬¡æˆ‘ä»¬è·å–æˆç»©éƒ½éœ€è¦å…ˆè¿›å…¥æ•™åŠ¡å¤„ï¼Œç„¶åç‚¹å‡»æˆç»©æŸ¥è¯¢ï¼Œè¾“å…¥å…¬å…±çš„è´¦å·å¯†ç è¿›å…¥ï¼Œæœ€åè¾“å…¥ç›¸å…³ä¿¡æ¯è·å–æˆç»©è¡¨æ ¼ï¼Œè¿™é‡Œç™»é™†ä¸éœ€è¦éªŒè¯ç çœäº†æˆ‘ä¸€ç•ªåŠŸå¤«ï¼Œè¿™æ ·æˆ‘ä»¬å…ˆè¿›å…¥æˆç»©æŸ¥è¯¢ç³»ç»Ÿç™»é™†ç•Œé¢ï¼Œå…ˆçœ‹çœ‹æ€ä¹ˆæ¨¡æ‹Ÿç™»é™†è¿™ä¸ªè¿‡ç¨‹ï¼Œåœ¨Chromeæµè§ˆå™¨ä¸‹æŒ‰F12æ‰“å¼€å¼€å‘è€…é¢æ¿ï¼š è¿™é‡Œæˆ‘ä»¬å­¦æ ¡çš„æ•™åŠ¡å¤„æŸ¥è¯¢ç³»ç»Ÿçš„å¯†ç æ˜¯å…¬å…±çš„jwcä¹Ÿå°±æ˜¯æ‹¼éŸ³ç¼©å†™ï¼Œæˆ‘ä»¬è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ç‚¹å‡»ç™»é™†ï¼Œè¿™æ—¶å€™æ³¨æ„POSTè¯·æ±‚ï¼š å‘ç°äº†ä»€ä¹ˆï¼Œå¥½åƒChromeå¹¶æ²¡æœ‰æŠŠPostæäº¤çš„è¡¨å•ä¿¡æ¯ä¿ç•™ä¸‹æ¥ç›´æ¥è·³è½¬åˆ°äº†å¦ä¸€ä¸ªç•Œé¢ç„¶åå±•ç¤ºå¦ä¸€ä¸ªç•Œé¢çš„æ•°æ®ï¼Œè¿™é‡Œå°±éœ€è¦æˆ‘ä»¬è‡ªå·±åŠ¨æ‰‹æ“ä½œä¸€ä¸‹ï¼Œæ³¨æ„å¼€å‘è€…é¢æ¿å·¦ä¸Šè§’çš„å°çº¢ç‚¹è¡¨ç¤ºè¿™æ—¶å€™æ­£åœ¨æŠ“å–æ•°æ®ï¼Œå¦‚æœç‚¹å‡»ä¸€ä¸‹å°±ä¼šå˜æˆç°è‰²ï¼Œå°±å¯ä»¥å˜ç›¸åœ°ä¿å­˜ä¸‹å½“æ—¶æŠ“å–åˆ°çš„åŒ…ï¼Œæˆ‘åœ¨ç‚¹å‡»ç™»é™†åæ–°ç•Œé¢æœªåˆ·æ–°å‡ºæ¥ä¹‹å‰ç‚¹å‡»äº†è¿™ä¸ªå°çº¢ç‚¹ï¼Œå¦‚æ„¿ä»¥å¿çš„å¾—åˆ°äº†Postçš„è¡¨å•æ•°æ®ï¼š è¿™æ ·å°±è·å–äº†æµè§ˆå™¨åœ¨ç™»é™†æ—¶å€™å‘æœåŠ¡å™¨ä¼ é€’çš„è¡¨å•æ•°æ®ï¼Œçœ‹ä¸€ä¸‹è¿™ä¸ªè¡¨å•éƒ½æœ‰äº›ä»€ä¹ˆï¼š è¿™é‡Œçœ‹åˆ°æˆ‘ä»¬éœ€è¦ä¼ é€’ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ï¼šuserã€passã€Submitï¼Œå¯ä»¥å¾ˆå®¹æ˜“çš„ç†è§£è¿™å‡ ä¸ªå•è¯çš„å­—é¢æ„æ€ï¼Œè¿™æ ·æœ‰äº†æ€è·¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥å†™å‡ºè¿™æ¬¡ä»£ç çš„ç¬¬ä¸€æ­¥ï¼šæ¨¡æ‹Ÿç™»é™†æ•™åŠ¡å¤„ ç›´æ¥ä¸Šä»£ç : 1234567891011121314151617#!/usr/bin/env python3# -*- coding: utf-8 -*-import requestsurl = 'http://jwc.ecjtu.jx.cn/mis_o/login.php'datas = &#123;'user': 'jwc', 'pass': 'jwc', 'Submit': '%CC%E1%BD%BB' &#125;headers = &#123;'Referer': 'http://jwc.ecjtu.jx.cn/mis_o/login.htm', 'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 ' '(KHTML, like Gecko) Chrome/52.0.2743.82 Safari/537.36', 'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8', 'Accept-Language': 'zh-CN,zh;q=0.8', &#125;sessions = requests.session()response = sessions.post(url, headers=headers, data=datas)print(response.status_code) ä»£ç è¾“å‡ºï¼š 1200 è¯´æ˜æˆ‘ä»¬æ¨¡æ‹Ÿç™»é™†æˆåŠŸäº†ï¼Œè¿™é‡Œç”¨åˆ°äº†Requestsæ¨¡å—ï¼Œè¿˜ä¸ä¼šä½¿ç”¨çš„å¯ä»¥æŸ¥çœ‹ä¸­æ–‡æ–‡æ¡£ ï¼Œå®ƒç»™è‡ªå·±çš„å®šä¹‰æ˜¯ï¼šHTTP for Humansï¼Œå› ä¸ºç®€å•æ˜“ç”¨æ˜“ä¸Šæ‰‹ï¼Œæˆ‘ä»¬åªéœ€è¦ä¼ å…¥Urlåœ°å€ï¼Œæ„é€ è¯·æ±‚å¤´ï¼Œä¼ å…¥postæ–¹æ³•éœ€è¦çš„æ•°æ®ï¼Œå°±å¯ä»¥æ¨¡æ‹Ÿæµè§ˆå™¨ç™»é™†äº†ï¼Œè¿™é‡Œå› ä¸ºæœ‰è¿›ä¸€æ­¥è·å–æˆç»©çš„æ“ä½œæ‰€ä»¥ä½¿ç”¨äº†sessionæ¥ä¿æŒè¿æ¥ï¼Œè¿™é‡Œå•çœ‹æœ€åçš„è¿”å›ç çš„è¯æˆ‘ä»¬æ˜¯æˆåŠŸäº†çš„ï¼Œå…·ä½“å¦‚ä½•è¿˜è¦çœ‹ä¸‹ä¸€æ­¥æ“ä½œï¼Œæ¥ä¸‹æ¥ï¼š è¿™é‡Œä¸ºäº†ç®€ä¾¿ä»£ç æˆ‘ä»¬è®¾å®šè¾“å…¥å­¦å·æŸ¥è¯¢æ‰€æœ‰æˆç»©ï¼Œå‡å°‘å…¶ä»–åˆ¤æ–­ï¼ŒåŒæ ·å¯¹Postæ•°æ®è¿›è¡ŒæŠ“åŒ…ï¼š åŒæ ·æŸ¥çœ‹Postçš„æ•°æ®ï¼š å› ä¸ºè¿™é‡Œå°±åˆ†æè¾“å…¥å­¦å·çš„æƒ…å†µæ‰€ä»¥å…¶ä»–éƒ½ä¸ºç©ºï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å†™å‡ºæŸ¥è¯¢æˆç»©çš„ä»£ç ï¼š 1234567891011121314151617181920212223score_healders = &#123;'Connection': 'keep-alive', 'User - Agent': 'Mozilla/5.0 (Windows NT 6.1; WOW64) ' 'AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.82 Safari/537.36', 'Content - Type': 'application / x - www - form - urlencoded', 'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8', 'Content - Length': '69', 'Host': 'jwc.ecjtu.jx.cn', 'Referer': 'http: // jwc.ecjtu.jx.cn / mis_o / main.php', 'Upgrade - Insecure - Requests': '1', 'Accept - Language': 'zh - CN, zh;q = 0.8' &#125;score_url = 'http://jwc.ecjtu.jx.cn/mis_o/query.php?start=' + str( pagenum) + '&amp;job=see&amp;=&amp;Name=&amp;Course=&amp;ClassID=&amp;Term=&amp;StuID=' + numscore_data = &#123;'Name': '', 'StuID': num, 'Course': '', 'Term': '', 'ClassID': '', 'Submit': '%B2%E9%D1%AF' &#125;score_response = sessions.post(score_url, data=score_data, headers=score_healders)content = score_response.content è¿™é‡Œè§£é‡Šä¸€ä¸‹ä¸Šé¢çš„ä»£ç ï¼Œä¸Šé¢çš„score_url å¹¶ä¸æ˜¯æµè§ˆå™¨ä¸Šæ˜¾ç¤ºçš„åœ°å€ï¼Œæˆ‘ä»¬è¦è·å–çœŸæ­£çš„åœ°å€ï¼Œåœ¨Chromeä¸‹å³é”®â€“æŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼Œæ‰¾åˆ°è¿™ä¹ˆä¸€è¡Œï¼š 1a href=query.php?start=1&amp;job=see&amp;=&amp;Name=&amp;Course=&amp;ClassID=&amp;Term=&amp;StuID=xxxxxxx è¿™ä¸ªæ‰æ˜¯çœŸæ­£çš„åœ°å€ï¼Œç‚¹å‡»è¿™ä¸ªåœ°å€è½¬å…¥çš„æ‰æ˜¯çœŸæ­£çš„ç•Œé¢ï¼Œå› ä¸ºè¿™é‡Œæˆç»©æ•°æ®è¾ƒå¤šï¼Œæ‰€ä»¥è¿™é‡Œé‡‡ç”¨äº†åˆ†é¡µæ˜¾ç¤ºï¼Œè¿™ä¸ªstart=1è¯´æ˜æ˜¯ç¬¬ä¸€é¡µï¼Œè¿™ä¸ªå‚æ•°æ˜¯å¯å˜çš„éœ€è¦æˆ‘ä»¬ä¼ å…¥ï¼Œè¿˜æœ‰StuIDåé¢çš„æ˜¯æˆ‘ä»¬è¾“å…¥çš„å­¦å·ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ‹¼æ¥å‡ºUrlåœ°å€ï¼š 1score_url = &apos;http://jwc.ecjtu.jx.cn/mis_o/query.php?start=&apos; + str(pagenum) + &apos;&amp;job=see&amp;=&amp;Name=&amp;Course=&amp;ClassID=&amp;Term=&amp;StuID=&apos; + num åŒæ ·ä½¿ç”¨Postæ–¹æ³•ä¼ é€’æ•°æ®å¹¶è·å–å“åº”çš„å†…å®¹ï¼š 12score_response = sessions.post(score_url, data=score_data,headers=score_healders)content = score_response.content è¿™é‡Œé‡‡ç”¨Beautiful Soup 4.2.0æ¥è§£æè¿”å›çš„å“åº”å†…å®¹ï¼Œå› ä¸ºæˆ‘ä»¬è¦è·å–çš„æ˜¯æˆç»©ï¼Œè¿™é‡Œåˆ°æ•™åŠ¡å¤„æˆç»©æŸ¥è¯¢ç•Œé¢ï¼ŒæŸ¥çœ‹è·å–åˆ°çš„æˆç»©åœ¨ç½‘é¡µä¸­æ˜¯ä»¥è¡¨æ ¼çš„å½¢å¼å­˜åœ¨ï¼š è§‚å¯Ÿè¡¨æ ¼çš„ç½‘é¡µæºä»£ç ï¼š 12345678910111213&lt;table align=center border=1&gt;&lt;tr&gt;&lt;td bgcolor=009999&gt;å­¦æœŸ&lt;/td&gt;&lt;td bgcolor=009999&gt;å­¦å·&lt;/td&gt;&lt;td bgcolor=009999&gt;å§“å&lt;/td&gt;&lt;td bgcolor=009999&gt;è¯¾ç¨‹&lt;/td&gt;&lt;td bgcolor=009999&gt;è¯¾ç¨‹è¦æ±‚&lt;/td&gt;&lt;td bgcolor=009999&gt;å­¦åˆ†&lt;/td&gt;&lt;td bgcolor=009999&gt;æˆç»©&lt;/td&gt;&lt;td bgcolor=009999&gt;é‡è€ƒä¸€&lt;/td&gt;&lt;td bgcolor=009999&gt;é‡è€ƒäºŒ&lt;/td&gt;&lt;/tr&gt;......&lt;/tr&gt;&lt;/table&gt; è¿™é‡Œæ‹¿å‡ºç¬¬ä¸€è¡Œä¸¾ä¾‹ï¼Œè™½ç„¶æˆ‘ä¸å¤ªæ‡‚Htmlä½†æ˜¯ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºæ¥&lt;tr&gt; ä»£è¡¨çš„æ˜¯ä¸€è¡Œï¼Œè€Œ&lt;td&gt;åº”è¯¥æ˜¯ä»£è¡¨è¿™ä¸€è¡Œä¸­çš„æ¯ä¸€åˆ—ï¼Œè¿™æ ·å°±å¥½åŠäº†ï¼Œå–å‡ºæ¯ä¸€è¡Œç„¶ååˆ†è§£å‡ºæ¯ä¸€åˆ—ï¼Œæ‰“å°è¾“å‡ºå°±å¯ä»¥å¾—åˆ°æˆ‘ä»¬è¦çš„ç»“æœï¼š 1234from bs4 import BeautifulSoupsoup = BeautifulSoup(content, 'html.parser')# æ‰¾åˆ°æ¯ä¸€è¡Œtarget = soup.findAll('tr') è¿™é‡Œåˆ†è§£æ¯ä¸€åˆ—çš„æ—¶å€™è¦å°å¿ƒï¼Œå› ä¸ºè¿™é‡Œè¡¨æ ¼åˆ†æˆäº†ä¸‰é¡µæ˜¾ç¤ºï¼Œæ¯é¡µæœ€å¤šæ˜¾ç¤º30æ¡æ•°æ®ï¼Œè¿™é‡Œå› ä¸ºåªæ˜¯æ”¶é›†å·²ç»æ¯•ä¸šçš„å­¦ç”Ÿçš„æˆç»©æ•°æ®æ‰€ä»¥ä¸å¯¹å…¶ä»–æ•°æ®é‡ä¸è¶³çš„å­¦ç”Ÿæˆç»©çš„æƒ…å†µåšç»Ÿè®¡ï¼Œé»˜è®¤æ”¶é›†çš„éƒ½æ˜¯å¤§å››æ¯•ä¸šçš„å­¦ç”Ÿæˆç»©æ•°æ®ã€‚è¿™é‡Œé‡‡ç”¨ä¸¤ä¸ªå˜é‡iå’Œjåˆ†åˆ«ä»£è¡¨è¡Œå’Œåˆ—ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445# æ³¨:è¿™é‡Œçš„printå•çº¯æ˜¯æˆ‘ä¸ºäº†éªŒè¯ç»“æœæ‰“å°åœ¨PyCharmçš„æ§åˆ¶å°ä¸Šè€Œå·²i=0, j=0for tag in target[1:]: tds = tag.findAll('td') # æ¯ä¸€æ¬¡éƒ½æ˜¯ä»åˆ—å¤´å¼€å§‹è·å– j = 0 # å­¦æœŸ semester = str(tds[0].string) if semester == 'None': break else: print(semester.ljust(6) + '\\t\\t\\t', end='') # å­¦å· studentid = tds[1].string print(studentid.ljust(14) + '\\t\\t\\t', end='') j += 1 # å§“å name = tds[2].string print(name.ljust(3) + '\\t\\t\\t', end='') j += 1 # è¯¾ç¨‹ course = tds[3].string print(course.ljust(20, ' ') + '\\t\\t\\t', end='') j += 1 # è¯¾ç¨‹è¦æ±‚ requirments = tds[4].string print(requirments.ljust(10, ' ') + '\\t\\t', end='') j += 1 # å­¦åˆ† scredit = tds[5].string print(scredit.ljust(2, ' ') + '\\t\\t', end='') j += 1 # æˆç»© achievement = tds[6].string print(achievement.ljust(2) + '\\t\\t', end='') j += 1 # é‡è€ƒä¸€ reexaminef = tds[7].string print(reexaminef.ljust(2) + '\\t\\t', end='') j += 1 # é‡è€ƒäºŒ reexamines = tds[8].string print(reexamines.ljust(2) + '\\t\\t') j += 1 i += 1 è¿™é‡ŒæŸ¥äº†å¾ˆå¤šåˆ«äººçš„åšå®¢éƒ½æ˜¯ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥åˆ†è§£æ•°æ®ï¼Œè¡¨ç¤ºè‡ªå·±çš„æ­£åˆ™å†™çš„å¹¶ä¸å¥½ä¹Ÿå°è¯•äº†ä½†æ˜¯æ²¡æˆåŠŸï¼Œæ‰€ä»¥æ— å¥ˆé€‰æ‹©è¿™ç§æ–¹å¼ï¼Œå¦‚æœæœ‰äººæœ‰æµ‹è¯•æˆåŠŸçš„æ­£åˆ™æ¬¢è¿è·Ÿæˆ‘è¯´ä¸€å£°ï¼Œæˆ‘ä¹Ÿå­¦ä¹ å­¦ä¹ ã€‚ æŠŠæ•°æ®ä¿å­˜åˆ°Excel å› ä¸ºå·²ç»æ¸…æ¥šäº†è¿™ä¸ªç½‘é¡µä¿å­˜æˆç»©çš„å…·ä½“ç»“æ„ï¼Œæ‰€ä»¥é¡ºç€æ¯æ¬¡å¾ªç¯è§£æå°†æ•°æ®ä¸æ–­åŠ ä»¥ä¿å­˜å°±æ˜¯äº†ï¼Œè¿™é‡Œä½¿ç”¨xlwtå†™å…¥æ•°æ®åˆ°Excelï¼Œå› ä¸ºxlwtæ¨¡å—æ‰“å°è¾“å‡ºåˆ°Excelä¸­çš„æ ·å¼å®½åº¦åå°ï¼Œå½±å“è§‚çœ‹ï¼Œæ‰€ä»¥è¿™é‡Œè¿˜åŠ å…¥äº†ä¸€ä¸ªæ–¹æ³•å»æ§åˆ¶æ‰“å°åˆ°Excelè¡¨æ ¼ä¸­çš„æ ·å¼: 123456789101112file = xlwt.Workbook(encoding='utf-8')table = file.add_sheet('achieve')# è®¾ç½®Excelæ ·å¼def set_style(name, height, bold=False): style = xlwt.XFStyle() # åˆå§‹åŒ–æ ·å¼ font = xlwt.Font() # ä¸ºæ ·å¼åˆ›å»ºå­—ä½“ font.name = name # 'Times New Roman' font.bold = bold font.color_index = 4 font.height = height style.font = font return style è¿ç”¨åˆ°ä»£ç ä¸­ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354for tag in target[1:]: tds = tag.findAll(&apos;td&apos;) j = 0 # å­¦æœŸ semester = str(tds[0].string) if semester == &apos;None&apos;: break else: print(semester.ljust(6) + &apos;\\t\\t\\t&apos;, end=&apos;&apos;) table.write(i, j, semester, set_style(&apos;Arial&apos;, 220)) # å­¦å· studentid = tds[1].string print(studentid.ljust(14) + &apos;\\t\\t\\t&apos;, end=&apos;&apos;) j += 1 table.write(i, j, studentid, set_style(&apos;Arial&apos;, 220)) table.col(i).width = 256 * 16 # å§“å name = tds[2].string print(name.ljust(3) + &apos;\\t\\t\\t&apos;, end=&apos;&apos;) j += 1 table.write(i, j, name, set_style(&apos;Arial&apos;, 220)) # è¯¾ç¨‹ course = tds[3].string print(course.ljust(20, &apos; &apos;) + &apos;\\t\\t\\t&apos;, end=&apos;&apos;) j += 1 table.write(i, j, course, set_style(&apos;Arial&apos;, 220)) # è¯¾ç¨‹è¦æ±‚ requirments = tds[4].string print(requirments.ljust(10, &apos; &apos;) + &apos;\\t\\t&apos;, end=&apos;&apos;) j += 1 table.write(i, j, requirments, set_style(&apos;Arial&apos;, 220)) # å­¦åˆ† scredit = tds[5].string print(scredit.ljust(2, &apos; &apos;) + &apos;\\t\\t&apos;, end=&apos;&apos;) j += 1 table.write(i, j, scredit, set_style(&apos;Arial&apos;, 220)) # æˆç»© achievement = tds[6].string print(achievement.ljust(2) + &apos;\\t\\t&apos;, end=&apos;&apos;) j += 1 table.write(i, j, achievement, set_style(&apos;Arial&apos;, 220)) # é‡è€ƒä¸€ reexaminef = tds[7].string print(reexaminef.ljust(2) + &apos;\\t\\t&apos;, end=&apos;&apos;) j += 1 table.write(i, j, reexaminef, set_style(&apos;Arial&apos;, 220)) # é‡è€ƒäºŒ reexamines = tds[8].string print(reexamines.ljust(2) + &apos;\\t\\t&apos;) j += 1 table.write(i, j, reexamines, set_style(&apos;Arial&apos;, 220)) i += 1file.save(&apos;demo.xls&apos;) æœ€åç¨åŠ æ•´åˆï¼Œå†™æˆä¸€ä¸ªæ–¹æ³•ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687# è·å–æˆç»©# è¿™é‡Œnumä»£è¡¨è¾“å…¥çš„å­¦å·ï¼Œpagenumä»£è¡¨é¡µæ•°ï¼Œæ€»å…±76æ¡æ•°æ®ï¼Œä¸€é¡µ30æ¡æ‰€ä»¥æ€»å…±æœ‰ä¸‰é¡µdef getScore(num, pagenum, i, j): score_healders = &#123;&apos;Connection&apos;: &apos;keep-alive&apos;, &apos;User - Agent&apos;: &apos;Mozilla/5.0 (Windows NT 6.1; WOW64) &apos; &apos;AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.82 Safari/537.36&apos;, &apos;Content - Type&apos;: &apos;application / x - www - form - urlencoded&apos;, &apos;Accept&apos;: &apos;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&apos;, &apos;Content - Length&apos;: &apos;69&apos;, &apos;Host&apos;: &apos;jwc.ecjtu.jx.cn&apos;, &apos;Referer&apos;: &apos;http: // jwc.ecjtu.jx.cn / mis_o / main.php&apos;, &apos;Upgrade - Insecure - Requests&apos;: &apos;1&apos;, &apos;Accept - Language&apos;: &apos;zh - CN, zh;q = 0.8&apos; &#125; score_url = &apos;http://jwc.ecjtu.jx.cn/mis_o/query.php?start=&apos; + str( pagenum) + &apos;&amp;job=see&amp;=&amp;Name=&amp;Course=&amp;ClassID=&amp;Term=&amp;StuID=&apos; + num score_data = &#123;&apos;Name&apos;: &apos;&apos;, &apos;StuID&apos;: num, &apos;Course&apos;: &apos;&apos;, &apos;Term&apos;: &apos;&apos;, &apos;ClassID&apos;: &apos;&apos;, &apos;Submit&apos;: &apos;%B2%E9%D1%AF&apos; &#125; score_response = sessions.post(score_url, data=score_data, headers=score_healders) # è¾“å‡ºåˆ°æ–‡æœ¬ with open(&apos;text.txt&apos;, &apos;wb&apos;) as f: f.write(score_response.content) content = score_response.content soup = BeautifulSoup(content, &apos;html.parser&apos;) target = soup.findAll(&apos;tr&apos;) try: for tag in target[1:]: tds = tag.findAll(&apos;td&apos;) j = 0 # å­¦æœŸ semester = str(tds[0].string) if semester == &apos;None&apos;: break else: print(semester.ljust(6) + &apos;\\t\\t\\t&apos;, end=&apos;&apos;) table.write(i, j, semester, set_style(&apos;Arial&apos;, 220)) # å­¦å· studentid = tds[1].string print(studentid.ljust(14) + &apos;\\t\\t\\t&apos;, end=&apos;&apos;) j += 1 table.write(i, j, studentid, set_style(&apos;Arial&apos;, 220)) table.col(i).width = 256 * 16 # å§“å name = tds[2].string print(name.ljust(3) + &apos;\\t\\t\\t&apos;, end=&apos;&apos;) j += 1 table.write(i, j, name, set_style(&apos;Arial&apos;, 220)) # è¯¾ç¨‹ course = tds[3].string print(course.ljust(20, &apos; &apos;) + &apos;\\t\\t\\t&apos;, end=&apos;&apos;) j += 1 table.write(i, j, course, set_style(&apos;Arial&apos;, 220)) # è¯¾ç¨‹è¦æ±‚ requirments = tds[4].string print(requirments.ljust(10, &apos; &apos;) + &apos;\\t\\t&apos;, end=&apos;&apos;) j += 1 table.write(i, j, requirments, set_style(&apos;Arial&apos;, 220)) # å­¦åˆ† scredit = tds[5].string print(scredit.ljust(2, &apos; &apos;) + &apos;\\t\\t&apos;, end=&apos;&apos;) j += 1 table.write(i, j, scredit, set_style(&apos;Arial&apos;, 220)) # æˆç»© achievement = tds[6].string print(achievement.ljust(2) + &apos;\\t\\t&apos;, end=&apos;&apos;) j += 1 table.write(i, j, achievement, set_style(&apos;Arial&apos;, 220)) # é‡è€ƒä¸€ reexaminef = tds[7].string print(reexaminef.ljust(2) + &apos;\\t\\t&apos;, end=&apos;&apos;) j += 1 table.write(i, j, reexaminef, set_style(&apos;Arial&apos;, 220)) # é‡è€ƒäºŒ reexamines = tds[8].string print(reexamines.ljust(2) + &apos;\\t\\t&apos;) j += 1 table.write(i, j, reexamines, set_style(&apos;Arial&apos;, 220)) i += 1 except: print(&apos;å‡ºäº†ä¸€ç‚¹å°Bug&apos;) file.save(&apos;demo.xls&apos;) åœ¨æ¨¡æ‹Ÿç™»é™†æ“ä½œåå¢åŠ ä¸€ä¸ªåˆ¤æ–­ï¼š 1234567891011# åˆ¤æ–­æ˜¯å¦ç™»é™†def isLogin(num): return_code = response.status_code if return_code == 200: if re.match(r&quot;^\\d&#123;14&#125;$&quot;, num): print(&apos;è¯·ç¨ç­‰&apos;) else: print(&apos;è¯·è¾“å…¥æ­£ç¡®çš„å­¦å·&apos;) return True else: return False æœ€ååœ¨__main__ä¸­è¿™ä¹ˆè°ƒç”¨ï¼š 123456if __name__ == &apos;__main__&apos;: num = input(&apos;è¯·è¾“å…¥ä½ çš„å­¦å·ï¼š&apos;) if isLogin(num): getScore(num, pagenum=0, i=0, j=0) getScore(num, pagenum=1, i=31, j=0) getScore(num, pagenum=2, i=61, j=0) åœ¨PyCharmä¸‹æŒ‰alt+shift+xå¿«æ·é”®è¿è¡Œç¨‹åºï¼š æ§åˆ¶å°ä¼šæœ‰å¦‚ä¸‹è¾“å‡º(è¿™é‡Œåªæˆªå–éƒ¨åˆ†ï¼Œä¸è¦åæ§½æ²¡æœ‰å¯¹é½ï¼Œè¿™é‡Œæˆ‘ä¹Ÿç”¨äº†æ ¼å¼åŒ–è¾“å‡ºè¿˜æ˜¯ä¸å¤ªè¡Œï¼Œä¸è¿‡æœ€èµ·ç å‡ºæ¥äº†ç»“æœï¼Œè€Œä¸”æˆ‘ä»¬çš„ç›®çš„æ˜¯è¾“å‡ºåˆ°Excelä¸­ä¸æ˜¯å—) ç„¶åå»ç¨‹åºæ ¹ç›®å½•æ‰¾çœ‹çœ‹æœ‰æ²¡æœ‰ç”Ÿæˆä¸€ä¸ªå«demo.xlsçš„æ–‡ä»¶ï¼Œæˆ‘çš„ç¨‹åºå°±æ”¾åœ¨æ¡Œé¢ï¼Œæ‰€ä»¥å»æ¡Œé¢æ‰¾ï¼š ç‚¹å¼€æŸ¥çœ‹æ˜¯å¦æˆåŠŸè·å–ï¼š è‡³æ­¤ï¼Œå¤§åŠŸå‘Šæˆ å°ç»“åˆšå¼€å§‹æ¥è§¦Pythonä¸€ä¸ªæ˜ŸæœŸçš„æ ·å­ï¼Œè¿™æ¬¡å†™äº†è¿™ä¹ˆä¸€ä¸ªç®€å•çš„ç½‘ç»œçˆ¬è™«æ£€éªŒä¸€ä¸‹å­¦ä¹ æˆæœï¼Œè™½ç„¶ç¨‹åºè¿˜æœ‰äº›è®¸Bugï¼Œä¸è¿‡æ€»å½’å¾—åˆ°äº†ä¸€å®šæ”¶è·ï¼Œå½“ç„¶ä¹Ÿä¸ºä¸‹ä¸€æ­¥å­¦ä¹ æ‰“ä¸‹äº†åŸºç¡€ï¼Œå—¯å“¼ï¼Œä¸ºäº†æ¥ä¸‹æ¥æ‰¹é‡è·å–ç½‘ç»œä¸Šç¾å¥³å›¾ç‰‡å¹¶åˆ†ç±»ä¿å­˜æˆ‘ä¼šç»§ç»­è‡ªå­¦Pythonï¼Œè†è½²åˆºç§¦ç‹~ æºç ","tags":[{"name":"Python","slug":"Python","permalink":"https://www.limuyang.cc/tags/Python/"},{"name":"çˆ¬è™«","slug":"çˆ¬è™«","permalink":"https://www.limuyang.cc/tags/çˆ¬è™«/"},{"name":"æ¨¡æ‹Ÿç™»é™†","slug":"æ¨¡æ‹Ÿç™»é™†","permalink":"https://www.limuyang.cc/tags/æ¨¡æ‹Ÿç™»é™†/"},{"name":"ä¿å­˜æ•°æ®","slug":"ä¿å­˜æ•°æ®","permalink":"https://www.limuyang.cc/tags/ä¿å­˜æ•°æ®/"}]},{"title":"Pythonç½‘ç»œç¼–ç¨‹åŸºç¡€","date":"2016-07-25T19:24:55.000Z","path":"2016/07/25/Pythonç½‘ç»œç¼–ç¨‹åŸºç¡€/","text":"åŸæ–‡è½¬è‡ªï¼šPythonæ•™ç¨‹ TCP/IPç®€ä»‹è™½ç„¶å¤§å®¶ç°åœ¨å¯¹äº’è”ç½‘å¾ˆç†Ÿæ‚‰ï¼Œä½†æ˜¯è®¡ç®—æœºç½‘ç»œçš„å‡ºç°æ¯”äº’è”ç½‘è¦æ—©å¾ˆå¤šã€‚ è®¡ç®—æœºä¸ºäº†è”ç½‘ï¼Œå°±å¿…é¡»è§„å®šé€šä¿¡åè®®ï¼Œæ—©æœŸçš„è®¡ç®—æœºç½‘ç»œï¼Œéƒ½æ˜¯ç”±å„å‚å•†è‡ªå·±è§„å®šä¸€å¥—åè®®ï¼ŒIBMã€Appleå’ŒMicrosoftéƒ½æœ‰å„è‡ªçš„ç½‘ç»œåè®®ï¼Œäº’ä¸å…¼å®¹ï¼Œè¿™å°±å¥½æ¯”ä¸€ç¾¤äººæœ‰çš„è¯´è‹±è¯­ï¼Œæœ‰çš„è¯´ä¸­æ–‡ï¼Œæœ‰çš„è¯´å¾·è¯­ï¼Œè¯´åŒä¸€ç§è¯­è¨€çš„äººå¯ä»¥äº¤æµï¼Œä¸åŒçš„è¯­è¨€ä¹‹é—´å°±ä¸è¡Œäº†ã€‚ ä¸ºäº†æŠŠå…¨ä¸–ç•Œçš„æ‰€æœ‰ä¸åŒç±»å‹çš„è®¡ç®—æœºéƒ½è¿æ¥èµ·æ¥ï¼Œå°±å¿…é¡»è§„å®šä¸€å¥—å…¨çƒé€šç”¨çš„åè®®ï¼Œä¸ºäº†å®ç°äº’è”ç½‘è¿™ä¸ªç›®æ ‡ï¼Œäº’è”ç½‘åè®®ç°‡ï¼ˆInternet Protocol Suiteï¼‰å°±æ˜¯é€šç”¨åè®®æ ‡å‡†ã€‚Internetæ˜¯ç”±interå’Œnetä¸¤ä¸ªå•è¯ç»„åˆèµ·æ¥çš„ï¼ŒåŸæ„å°±æ˜¯è¿æ¥â€ç½‘ç»œâ€çš„ç½‘ç»œï¼Œæœ‰äº†Internetï¼Œä»»ä½•ç§æœ‰ç½‘ç»œï¼Œåªè¦æ”¯æŒè¿™ä¸ªåè®®ï¼Œå°±å¯ä»¥è”å…¥äº’è”ç½‘ã€‚ å› ä¸ºäº’è”ç½‘åè®®åŒ…å«äº†ä¸Šç™¾ç§åè®®æ ‡å‡†ï¼Œä½†æ˜¯æœ€é‡è¦çš„ä¸¤ä¸ªåè®®æ˜¯TCPå’ŒIPåè®®ï¼Œæ‰€ä»¥ï¼Œå¤§å®¶æŠŠäº’è”ç½‘çš„åè®®ç®€ç§°TCP/IPåè®®ã€‚ é€šä¿¡çš„æ—¶å€™ï¼ŒåŒæ–¹å¿…é¡»çŸ¥é“å¯¹æ–¹çš„æ ‡è¯†ï¼Œå¥½æ¯”å‘é‚®ä»¶å¿…é¡»çŸ¥é“å¯¹æ–¹çš„é‚®ä»¶åœ°å€ã€‚äº’è”ç½‘ä¸Šæ¯ä¸ªè®¡ç®—æœºçš„å”¯ä¸€æ ‡è¯†å°±æ˜¯IPåœ°å€ï¼Œç±»ä¼¼123.123.123.123ã€‚å¦‚æœä¸€å°è®¡ç®—æœºåŒæ—¶æ¥å…¥åˆ°ä¸¤ä¸ªæˆ–æ›´å¤šçš„ç½‘ç»œï¼Œæ¯”å¦‚è·¯ç”±å™¨ï¼Œå®ƒå°±ä¼šæœ‰ä¸¤ä¸ªæˆ–å¤šä¸ªIPåœ°å€ï¼Œæ‰€ä»¥ï¼ŒIPåœ°å€å¯¹åº”çš„å®é™…ä¸Šæ˜¯è®¡ç®—æœºçš„ç½‘ç»œæ¥å£ï¼Œé€šå¸¸æ˜¯ç½‘å¡ã€‚ IPåè®®è´Ÿè´£æŠŠæ•°æ®ä»ä¸€å°è®¡ç®—æœºé€šè¿‡ç½‘ç»œå‘é€åˆ°å¦ä¸€å°è®¡ç®—æœºã€‚æ•°æ®è¢«åˆ†å‰²æˆä¸€å°å—ä¸€å°å—ï¼Œç„¶åé€šè¿‡IPåŒ…å‘é€å‡ºå»ã€‚ç”±äºäº’è”ç½‘é“¾è·¯å¤æ‚ï¼Œä¸¤å°è®¡ç®—æœºä¹‹é—´ç»å¸¸æœ‰å¤šæ¡çº¿è·¯ï¼Œå› æ­¤ï¼Œè·¯ç”±å™¨å°±è´Ÿè´£å†³å®šå¦‚ä½•æŠŠä¸€ä¸ªIPåŒ…è½¬å‘å‡ºå»ã€‚IPåŒ…çš„ç‰¹ç‚¹æ˜¯æŒ‰å—å‘é€ï¼Œé€”å¾„å¤šä¸ªè·¯ç”±ï¼Œä½†ä¸ä¿è¯èƒ½åˆ°è¾¾ï¼Œä¹Ÿä¸ä¿è¯é¡ºåºåˆ°è¾¾ã€‚ IPåœ°å€å®é™…ä¸Šæ˜¯ä¸€ä¸ª32ä½æ•´æ•°ï¼ˆç§°ä¸ºIPv4ï¼‰ï¼Œä»¥å­—ç¬¦ä¸²è¡¨ç¤ºçš„IPåœ°å€å¦‚192.168.0.1å®é™…ä¸Šæ˜¯æŠŠ32ä½æ•´æ•°æŒ‰8ä½åˆ†ç»„åçš„æ•°å­—è¡¨ç¤ºï¼Œç›®çš„æ˜¯ä¾¿äºé˜…è¯»ã€‚ IPv6åœ°å€å®é™…ä¸Šæ˜¯ä¸€ä¸ª128ä½æ•´æ•°ï¼Œå®ƒæ˜¯ç›®å‰ä½¿ç”¨çš„IPv4çš„å‡çº§ç‰ˆï¼Œä»¥å­—ç¬¦ä¸²è¡¨ç¤ºç±»ä¼¼äº2001:0db8:85a3:0042:1000:8a2e:0370:7334ã€‚ TCPåè®®åˆ™æ˜¯å»ºç«‹åœ¨IPåè®®ä¹‹ä¸Šçš„ã€‚TCPåè®®è´Ÿè´£åœ¨ä¸¤å°è®¡ç®—æœºä¹‹é—´å»ºç«‹å¯é è¿æ¥ï¼Œä¿è¯æ•°æ®åŒ…æŒ‰é¡ºåºåˆ°è¾¾ã€‚TCPåè®®ä¼šé€šè¿‡æ¡æ‰‹å»ºç«‹è¿æ¥ï¼Œç„¶åï¼Œå¯¹æ¯ä¸ªIPåŒ…ç¼–å·ï¼Œç¡®ä¿å¯¹æ–¹æŒ‰é¡ºåºæ”¶åˆ°ï¼Œå¦‚æœåŒ…ä¸¢æ‰äº†ï¼Œå°±è‡ªåŠ¨é‡å‘ã€‚ è®¸å¤šå¸¸ç”¨çš„æ›´é«˜çº§çš„åè®®éƒ½æ˜¯å»ºç«‹åœ¨TCPåè®®åŸºç¡€ä¸Šçš„ï¼Œæ¯”å¦‚ç”¨äºæµè§ˆå™¨çš„HTTPåè®®ã€å‘é€é‚®ä»¶çš„SMTPåè®®ç­‰ã€‚ ä¸€ä¸ªIPåŒ…é™¤äº†åŒ…å«è¦ä¼ è¾“çš„æ•°æ®å¤–ï¼Œè¿˜åŒ…å«æºIPåœ°å€å’Œç›®æ ‡IPåœ°å€ï¼Œæºç«¯å£å’Œç›®æ ‡ç«¯å£ã€‚ ç«¯å£æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿåœ¨ä¸¤å°è®¡ç®—æœºé€šä¿¡æ—¶ï¼Œåªå‘IPåœ°å€æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºåŒä¸€å°è®¡ç®—æœºä¸Šè·‘ç€å¤šä¸ªç½‘ç»œç¨‹åºã€‚ä¸€ä¸ªIPåŒ…æ¥äº†ä¹‹åï¼Œåˆ°åº•æ˜¯äº¤ç»™æµè§ˆå™¨è¿˜æ˜¯QQï¼Œå°±éœ€è¦ç«¯å£å·æ¥åŒºåˆ†ã€‚æ¯ä¸ªç½‘ç»œç¨‹åºéƒ½å‘æ“ä½œç³»ç»Ÿç”³è¯·å”¯ä¸€çš„ç«¯å£å·ï¼Œè¿™æ ·ï¼Œä¸¤ä¸ªè¿›ç¨‹åœ¨ä¸¤å°è®¡ç®—æœºä¹‹é—´å»ºç«‹ç½‘ç»œè¿æ¥å°±éœ€è¦å„è‡ªçš„IPåœ°å€å’Œå„è‡ªçš„ç«¯å£å·ã€‚ ä¸€ä¸ªè¿›ç¨‹ä¹Ÿå¯èƒ½åŒæ—¶ä¸å¤šä¸ªè®¡ç®—æœºå»ºç«‹é“¾æ¥ï¼Œå› æ­¤å®ƒä¼šç”³è¯·å¾ˆå¤šç«¯å£ã€‚ äº†è§£äº†TCP/IPåè®®çš„åŸºæœ¬æ¦‚å¿µï¼ŒIPåœ°å€å’Œç«¯å£çš„æ¦‚å¿µï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹è¿›è¡Œç½‘ç»œç¼–ç¨‹äº†ã€‚ TCPç¼–ç¨‹Socketæ˜¯ç½‘ç»œç¼–ç¨‹çš„ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µã€‚é€šå¸¸æˆ‘ä»¬ç”¨ä¸€ä¸ªSocketè¡¨ç¤ºâ€æ‰“å¼€äº†ä¸€ä¸ªç½‘ç»œé“¾æ¥â€ï¼Œè€Œæ‰“å¼€ä¸€ä¸ªSocketéœ€è¦çŸ¥é“ç›®æ ‡è®¡ç®—æœºçš„IPåœ°å€å’Œç«¯å£å·ï¼Œå†æŒ‡å®šåè®®ç±»å‹å³å¯ã€‚ å®¢æˆ·ç«¯ å¤§å¤šæ•°è¿æ¥éƒ½æ˜¯å¯é çš„TCPè¿æ¥ã€‚åˆ›å»ºTCPè¿æ¥æ—¶ï¼Œä¸»åŠ¨å‘èµ·è¿æ¥çš„å«å®¢æˆ·ç«¯ï¼Œè¢«åŠ¨å“åº”è¿æ¥çš„å«æœåŠ¡å™¨ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå½“æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­è®¿é—®æ–°æµªæ—¶ï¼Œæˆ‘ä»¬è‡ªå·±çš„è®¡ç®—æœºå°±æ˜¯å®¢æˆ·ç«¯ï¼Œæµè§ˆå™¨ä¼šä¸»åŠ¨å‘æ–°æµªçš„æœåŠ¡å™¨å‘èµ·è¿æ¥ã€‚å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œæ–°æµªçš„æœåŠ¡å™¨æ¥å—äº†æˆ‘ä»¬çš„è¿æ¥ï¼Œä¸€ä¸ªTCPè¿æ¥å°±å»ºç«‹èµ·æ¥çš„ï¼Œåé¢çš„é€šä¿¡å°±æ˜¯å‘é€ç½‘é¡µå†…å®¹äº†ã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªåŸºäºTCPè¿æ¥çš„Socketï¼Œå¯ä»¥è¿™æ ·åšï¼š 123456# å¯¼å…¥socketåº“:import socket# åˆ›å»ºä¸€ä¸ªsocket:s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)# å»ºç«‹è¿æ¥:s.connect(('www.sina.com.cn', 80)) åˆ›å»ºSocketæ—¶ï¼ŒAF_INETæŒ‡å®šä½¿ç”¨IPv4åè®®ï¼Œå¦‚æœè¦ç”¨æ›´å…ˆè¿›çš„IPv6ï¼Œå°±æŒ‡å®šä¸ºAF_INET6ã€‚SOCK_STREAMæŒ‡å®šä½¿ç”¨é¢å‘æµçš„TCPåè®®ï¼Œè¿™æ ·ï¼Œä¸€ä¸ªSocketå¯¹è±¡å°±åˆ›å»ºæˆåŠŸï¼Œä½†æ˜¯è¿˜æ²¡æœ‰å»ºç«‹è¿æ¥ã€‚ å®¢æˆ·ç«¯è¦ä¸»åŠ¨å‘èµ·TCPè¿æ¥ï¼Œå¿…é¡»çŸ¥é“æœåŠ¡å™¨çš„IPåœ°å€å’Œç«¯å£å·ã€‚æ–°æµªç½‘ç«™çš„IPåœ°å€å¯ä»¥ç”¨åŸŸåwww.sina.com.cnè‡ªåŠ¨è½¬æ¢åˆ°IPåœ°å€ï¼Œä½†æ˜¯æ€ä¹ˆçŸ¥é“æ–°æµªæœåŠ¡å™¨çš„ç«¯å£å·å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯ä½œä¸ºæœåŠ¡å™¨ï¼Œæä¾›ä»€ä¹ˆæ ·çš„æœåŠ¡ï¼Œç«¯å£å·å°±å¿…é¡»å›ºå®šä¸‹æ¥ã€‚ç”±äºæˆ‘ä»¬æƒ³è¦è®¿é—®ç½‘é¡µï¼Œå› æ­¤æ–°æµªæä¾›ç½‘é¡µæœåŠ¡çš„æœåŠ¡å™¨å¿…é¡»æŠŠç«¯å£å·å›ºå®šåœ¨80ç«¯å£ï¼Œå› ä¸º80ç«¯å£æ˜¯WebæœåŠ¡çš„æ ‡å‡†ç«¯å£ã€‚å…¶ä»–æœåŠ¡éƒ½æœ‰å¯¹åº”çš„æ ‡å‡†ç«¯å£å·ï¼Œä¾‹å¦‚SMTPæœåŠ¡æ˜¯25ç«¯å£ï¼ŒFTPæœåŠ¡æ˜¯21ç«¯å£ï¼Œç­‰ç­‰ã€‚ç«¯å£å·å°äº1024çš„æ˜¯Internetæ ‡å‡†æœåŠ¡çš„ç«¯å£ï¼Œç«¯å£å·å¤§äº1024çš„ï¼Œå¯ä»¥ä»»æ„ä½¿ç”¨ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬è¿æ¥æ–°æµªæœåŠ¡å™¨çš„ä»£ç å¦‚ä¸‹ï¼š 1s.connect(('www.sina.com.cn', 80)) æ³¨æ„å‚æ•°æ˜¯ä¸€ä¸ªtupleï¼ŒåŒ…å«åœ°å€å’Œç«¯å£å·ã€‚ å»ºç«‹TCPè¿æ¥åï¼Œæˆ‘ä»¬å°±å¯ä»¥å‘æ–°æµªæœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œè¦æ±‚è¿”å›é¦–é¡µçš„å†…å®¹ï¼š 12# å‘é€æ•°æ®:s.send(b'GET / HTTP/1.1\\r\\nHost: www.sina.com.cn\\r\\nConnection: close\\r\\n\\r\\n') TCPè¿æ¥åˆ›å»ºçš„æ˜¯åŒå‘é€šé“ï¼ŒåŒæ–¹éƒ½å¯ä»¥åŒæ—¶ç»™å¯¹æ–¹å‘æ•°æ®ã€‚ä½†æ˜¯è°å…ˆå‘è°åå‘ï¼Œæ€ä¹ˆåè°ƒï¼Œè¦æ ¹æ®å…·ä½“çš„åè®®æ¥å†³å®šã€‚ä¾‹å¦‚ï¼ŒHTTPåè®®è§„å®šå®¢æˆ·ç«¯å¿…é¡»å…ˆå‘è¯·æ±‚ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨æ”¶åˆ°åæ‰å‘æ•°æ®ç»™å®¢æˆ·ç«¯ã€‚ å‘é€çš„æ–‡æœ¬æ ¼å¼å¿…é¡»ç¬¦åˆHTTPæ ‡å‡†ï¼Œå¦‚æœæ ¼å¼æ²¡é—®é¢˜ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥æ¥æ”¶æ–°æµªæœåŠ¡å™¨è¿”å›çš„æ•°æ®äº†ï¼š 12345678910# æ¥æ”¶æ•°æ®:buffer = []while True: # æ¯æ¬¡æœ€å¤šæ¥æ”¶1kå­—èŠ‚: d = s.recv(1024) if d: buffer.append(d) else: breakdata = b''.join(buffer) æ¥æ”¶æ•°æ®æ—¶ï¼Œè°ƒç”¨recv(max)æ–¹æ³•ï¼Œä¸€æ¬¡æœ€å¤šæ¥æ”¶æŒ‡å®šçš„å­—èŠ‚æ•°ï¼Œå› æ­¤ï¼Œåœ¨ä¸€ä¸ªwhileå¾ªç¯ä¸­åå¤æ¥æ”¶ï¼Œç›´åˆ°recv()è¿”å›ç©ºæ•°æ®ï¼Œè¡¨ç¤ºæ¥æ”¶å®Œæ¯•ï¼Œé€€å‡ºå¾ªç¯ã€‚ å½“æˆ‘ä»¬æ¥æ”¶å®Œæ•°æ®åï¼Œè°ƒç”¨close()æ–¹æ³•å…³é—­Socketï¼Œè¿™æ ·ï¼Œä¸€æ¬¡å®Œæ•´çš„ç½‘ç»œé€šä¿¡å°±ç»“æŸäº†ï¼š 12# å…³é—­è¿æ¥:s.close() æ¥æ”¶åˆ°çš„æ•°æ®åŒ…æ‹¬HTTPå¤´å’Œç½‘é¡µæœ¬èº«ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠHTTPå¤´å’Œç½‘é¡µåˆ†ç¦»ä¸€ä¸‹ï¼ŒæŠŠHTTPå¤´æ‰“å°å‡ºæ¥ï¼Œç½‘é¡µå†…å®¹ä¿å­˜åˆ°æ–‡ä»¶ï¼š 12345header, html = data.split(b'\\r\\n\\r\\n', 1)print(header.decode('utf-8'))# æŠŠæ¥æ”¶çš„æ•°æ®å†™å…¥æ–‡ä»¶:with open('sina.html', 'wb') as f: f.write(html) ç°åœ¨ï¼Œåªéœ€è¦åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€è¿™ä¸ªsina.htmlæ–‡ä»¶ï¼Œå°±å¯ä»¥çœ‹åˆ°æ–°æµªçš„é¦–é¡µäº†ã€‚ æœåŠ¡å™¨ å’Œå®¢æˆ·ç«¯ç¼–ç¨‹ç›¸æ¯”ï¼ŒæœåŠ¡å™¨ç¼–ç¨‹å°±è¦å¤æ‚ä¸€äº›ã€‚ æœåŠ¡å™¨è¿›ç¨‹é¦–å…ˆè¦ç»‘å®šä¸€ä¸ªç«¯å£å¹¶ç›‘å¬æ¥è‡ªå…¶ä»–å®¢æˆ·ç«¯çš„è¿æ¥ã€‚å¦‚æœæŸä¸ªå®¢æˆ·ç«¯è¿æ¥è¿‡æ¥äº†ï¼ŒæœåŠ¡å™¨å°±ä¸è¯¥å®¢æˆ·ç«¯å»ºç«‹Socketè¿æ¥ï¼Œéšåçš„é€šä¿¡å°±é è¿™ä¸ªSocketè¿æ¥äº†ã€‚ æ‰€ä»¥ï¼ŒæœåŠ¡å™¨ä¼šæ‰“å¼€å›ºå®šç«¯å£ï¼ˆæ¯”å¦‚80ï¼‰ç›‘å¬ï¼Œæ¯æ¥ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥ï¼Œå°±åˆ›å»ºè¯¥Socketè¿æ¥ã€‚ç”±äºæœåŠ¡å™¨ä¼šæœ‰å¤§é‡æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥ï¼Œæ‰€ä»¥ï¼ŒæœåŠ¡å™¨è¦èƒ½å¤ŸåŒºåˆ†ä¸€ä¸ªSocketè¿æ¥æ˜¯å’Œå“ªä¸ªå®¢æˆ·ç«¯ç»‘å®šçš„ã€‚ä¸€ä¸ªSocketä¾èµ–4é¡¹ï¼šæœåŠ¡å™¨åœ°å€ã€æœåŠ¡å™¨ç«¯å£ã€å®¢æˆ·ç«¯åœ°å€ã€å®¢æˆ·ç«¯ç«¯å£æ¥å”¯ä¸€ç¡®å®šä¸€ä¸ªSocketã€‚ ä½†æ˜¯æœåŠ¡å™¨è¿˜éœ€è¦åŒæ—¶å“åº”å¤šä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œæ‰€ä»¥ï¼Œæ¯ä¸ªè¿æ¥éƒ½éœ€è¦ä¸€ä¸ªæ–°çš„è¿›ç¨‹æˆ–è€…æ–°çš„çº¿ç¨‹æ¥å¤„ç†ï¼Œå¦åˆ™ï¼ŒæœåŠ¡å™¨ä¸€æ¬¡å°±åªèƒ½æœåŠ¡ä¸€ä¸ªå®¢æˆ·ç«¯äº†ã€‚ æˆ‘ä»¬æ¥ç¼–å†™ä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ç¨‹åºï¼Œå®ƒæ¥æ”¶å®¢æˆ·ç«¯è¿æ¥ï¼ŒæŠŠå®¢æˆ·ç«¯å‘è¿‡æ¥çš„å­—ç¬¦ä¸²åŠ ä¸ŠHelloå†å‘å›å»ã€‚ é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªåŸºäºIPv4å’ŒTCPåè®®çš„Socketï¼š 1s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) ç„¶åï¼Œæˆ‘ä»¬è¦ç»‘å®šç›‘å¬çš„åœ°å€å’Œç«¯å£ã€‚æœåŠ¡å™¨å¯èƒ½æœ‰å¤šå—ç½‘å¡ï¼Œå¯ä»¥ç»‘å®šåˆ°æŸä¸€å—ç½‘å¡çš„IPåœ°å€ä¸Šï¼Œä¹Ÿå¯ä»¥ç”¨0.0.0.0ç»‘å®šåˆ°æ‰€æœ‰çš„ç½‘ç»œåœ°å€ï¼Œè¿˜å¯ä»¥ç”¨127.0.0.1ç»‘å®šåˆ°æœ¬æœºåœ°å€ã€‚127.0.0.1æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„IPåœ°å€ï¼Œè¡¨ç¤ºæœ¬æœºåœ°å€ï¼Œå¦‚æœç»‘å®šåˆ°è¿™ä¸ªåœ°å€ï¼Œå®¢æˆ·ç«¯å¿…é¡»åŒæ—¶åœ¨æœ¬æœºè¿è¡Œæ‰èƒ½è¿æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¤–éƒ¨çš„è®¡ç®—æœºæ— æ³•è¿æ¥è¿›æ¥ã€‚ ç«¯å£å·éœ€è¦é¢„å…ˆæŒ‡å®šã€‚å› ä¸ºæˆ‘ä»¬å†™çš„è¿™ä¸ªæœåŠ¡ä¸æ˜¯æ ‡å‡†æœåŠ¡ï¼Œæ‰€ä»¥ç”¨9999è¿™ä¸ªç«¯å£å·ã€‚è¯·æ³¨æ„ï¼Œå°äº1024çš„ç«¯å£å·å¿…é¡»è¦æœ‰ç®¡ç†å‘˜æƒé™æ‰èƒ½ç»‘å®šï¼š 12# ç›‘å¬ç«¯å£:s.bind(('127.0.0.1', 9999)) ç´§æ¥ç€ï¼Œè°ƒç”¨listen()æ–¹æ³•å¼€å§‹ç›‘å¬ç«¯å£ï¼Œä¼ å…¥çš„å‚æ•°æŒ‡å®šç­‰å¾…è¿æ¥çš„æœ€å¤§æ•°é‡ï¼š 12s.listen(5)print('Waiting for connection...') æ¥ä¸‹æ¥ï¼ŒæœåŠ¡å™¨ç¨‹åºé€šè¿‡ä¸€ä¸ªæ°¸ä¹…å¾ªç¯æ¥æ¥å—æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥ï¼Œaccept()ä¼šç­‰å¾…å¹¶è¿”å›ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¿æ¥: 123456while True: # æ¥å—ä¸€ä¸ªæ–°è¿æ¥: sock, addr = s.accept() # åˆ›å»ºæ–°çº¿ç¨‹æ¥å¤„ç†TCPè¿æ¥: t = threading.Thread(target=tcplink, args=(sock, addr)) t.start() æ¯ä¸ªè¿æ¥éƒ½å¿…é¡»åˆ›å»ºæ–°çº¿ç¨‹ï¼ˆæˆ–è¿›ç¨‹ï¼‰æ¥å¤„ç†ï¼Œå¦åˆ™ï¼Œå•çº¿ç¨‹åœ¨å¤„ç†è¿æ¥çš„è¿‡ç¨‹ä¸­ï¼Œæ— æ³•æ¥å—å…¶ä»–å®¢æˆ·ç«¯çš„è¿æ¥ï¼š 1234567891011def tcplink(sock, addr): print('Accept new connection from %s:%s...' % addr) sock.send(b'Welcome!') while True: data = sock.recv(1024) time.sleep(1) if not data or data.decode('utf-8') == 'exit': break sock.send(('Hello, %s!' % data.decode('utf-8')).encode('utf-8')) sock.close() print('Connection from %s:%s closed.' % addr) è¿æ¥å»ºç«‹åï¼ŒæœåŠ¡å™¨é¦–å…ˆå‘ä¸€æ¡æ¬¢è¿æ¶ˆæ¯ï¼Œç„¶åç­‰å¾…å®¢æˆ·ç«¯æ•°æ®ï¼Œå¹¶åŠ ä¸ŠHelloå†å‘é€ç»™å®¢æˆ·ç«¯ã€‚å¦‚æœå®¢æˆ·ç«¯å‘é€äº†exitå­—ç¬¦ä¸²ï¼Œå°±ç›´æ¥å…³é—­è¿æ¥ã€‚ è¦æµ‹è¯•è¿™ä¸ªæœåŠ¡å™¨ç¨‹åºï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç¼–å†™ä¸€ä¸ªå®¢æˆ·ç«¯ç¨‹åºï¼š 1234567891011s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)# å»ºç«‹è¿æ¥:s.connect((&apos;127.0.0.1&apos;, 9999))# æ¥æ”¶æ¬¢è¿æ¶ˆæ¯:print(s.recv(1024).decode(&apos;utf-8&apos;))for data in [b&apos;Michael&apos;, b&apos;Tracy&apos;, b&apos;Sarah&apos;]: # å‘é€æ•°æ®: s.send(data) print(s.recv(1024).decode(&apos;utf-8&apos;))s.send(b&apos;exit&apos;)s.close() æˆ‘ä»¬éœ€è¦æ‰“å¼€ä¸¤ä¸ªå‘½ä»¤è¡Œçª—å£ï¼Œä¸€ä¸ªè¿è¡ŒæœåŠ¡å™¨ç¨‹åºï¼Œå¦ä¸€ä¸ªè¿è¡Œå®¢æˆ·ç«¯ç¨‹åºï¼Œå°±å¯ä»¥çœ‹åˆ°æ•ˆæœäº†ï¼š éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®¢æˆ·ç«¯ç¨‹åºè¿è¡Œå®Œæ¯•å°±é€€å‡ºäº†ï¼Œè€ŒæœåŠ¡å™¨ç¨‹åºä¼šæ°¸è¿œè¿è¡Œä¸‹å»ï¼Œå¿…é¡»æŒ‰Ctrl+Cé€€å‡ºç¨‹åºã€‚ å°ç»“ ç”¨TCPåè®®è¿›è¡ŒSocketç¼–ç¨‹åœ¨Pythonä¸­ååˆ†ç®€å•ï¼Œå¯¹äºå®¢æˆ·ç«¯ï¼Œè¦ä¸»åŠ¨è¿æ¥æœåŠ¡å™¨çš„IPå’ŒæŒ‡å®šç«¯å£ï¼Œå¯¹äºæœåŠ¡å™¨ï¼Œè¦é¦–å…ˆç›‘å¬æŒ‡å®šç«¯å£ï¼Œç„¶åï¼Œå¯¹æ¯ä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹æ¥å¤„ç†ã€‚é€šå¸¸ï¼ŒæœåŠ¡å™¨ç¨‹åºä¼šæ— é™è¿è¡Œä¸‹å»ã€‚ åŒä¸€ä¸ªç«¯å£ï¼Œè¢«ä¸€ä¸ªSocketç»‘å®šäº†ä»¥åï¼Œå°±ä¸èƒ½è¢«åˆ«çš„Socketç»‘å®šäº†ã€‚ æºç ï¼š 1234567891011121314151617181920212223242526272829303132333435#!/usr/bin/env python3# -*- coding: utf-8 -*-import socket# åˆ›å»ºä¸€ä¸ªsocket:s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)# å»ºç«‹è¿æ¥:s.connect(('www.sina.com.cn', 80))# å‘é€æ•°æ®:s.send(b'GET / HTTP/1.1\\r\\nHost: www.sina.com.cn\\r\\nConnection: close\\r\\n\\r\\n')# æ¥æ”¶æ•°æ®:buffer = []while True: # æ¯æ¬¡æœ€å¤šæ¥æ”¶1kå­—èŠ‚: d = s.recv(1024) if d: buffer.append(d) else: breakdata = b''.join(buffer)# å…³é—­è¿æ¥:s.close()header, html = data.split(b'\\r\\n\\r\\n', 1)print(header.decode('utf-8'))# æŠŠæ¥æ”¶çš„æ•°æ®å†™å…¥æ–‡ä»¶:with open('sina.html', 'wb') as f: f.write(html) UDPç¼–ç¨‹TCPæ˜¯å»ºç«‹å¯é è¿æ¥ï¼Œå¹¶ä¸”é€šä¿¡åŒæ–¹éƒ½å¯ä»¥ä»¥æµçš„å½¢å¼å‘é€æ•°æ®ã€‚ç›¸å¯¹TCPï¼ŒUDPåˆ™æ˜¯é¢å‘æ— è¿æ¥çš„åè®®ã€‚ ä½¿ç”¨UDPåè®®æ—¶ï¼Œä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œåªéœ€è¦çŸ¥é“å¯¹æ–¹çš„IPåœ°å€å’Œç«¯å£å·ï¼Œå°±å¯ä»¥ç›´æ¥å‘æ•°æ®åŒ…ã€‚ä½†æ˜¯ï¼Œèƒ½ä¸èƒ½åˆ°è¾¾å°±ä¸çŸ¥é“äº†ã€‚ è™½ç„¶ç”¨UDPä¼ è¾“æ•°æ®ä¸å¯é ï¼Œä½†å®ƒçš„ä¼˜ç‚¹æ˜¯å’ŒTCPæ¯”ï¼Œé€Ÿåº¦å¿«ï¼Œå¯¹äºä¸è¦æ±‚å¯é åˆ°è¾¾çš„æ•°æ®ï¼Œå°±å¯ä»¥ä½¿ç”¨UDPåè®®ã€‚ æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•é€šè¿‡UDPåè®®ä¼ è¾“æ•°æ®ã€‚å’ŒTCPç±»ä¼¼ï¼Œä½¿ç”¨UDPçš„é€šä¿¡åŒæ–¹ä¹Ÿåˆ†ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ã€‚æœåŠ¡å™¨é¦–å…ˆéœ€è¦ç»‘å®šç«¯å£ï¼š 123s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)# ç»‘å®šç«¯å£:s.bind(('127.0.0.1', 9999)) åˆ›å»ºSocketæ—¶ï¼ŒSOCK_DGRAMæŒ‡å®šäº†è¿™ä¸ªSocketçš„ç±»å‹æ˜¯UDPã€‚ç»‘å®šç«¯å£å’ŒTCPä¸€æ ·ï¼Œä½†æ˜¯ä¸éœ€è¦è°ƒç”¨listen()æ–¹æ³•ï¼Œè€Œæ˜¯ç›´æ¥æ¥æ”¶æ¥è‡ªä»»ä½•å®¢æˆ·ç«¯çš„æ•°æ®ï¼š 123456print('Bind UDP on 9999...')while True: # æ¥æ”¶æ•°æ®: data, addr = s.recvfrom(1024) print('Received from %s:%s.' % addr) s.sendto(b'Hello, %s!' % data, addr) recvfrom()æ–¹æ³•è¿”å›æ•°æ®å’Œå®¢æˆ·ç«¯çš„åœ°å€ä¸ç«¯å£ï¼Œè¿™æ ·ï¼ŒæœåŠ¡å™¨æ”¶åˆ°æ•°æ®åï¼Œç›´æ¥è°ƒç”¨sendto()å°±å¯ä»¥æŠŠæ•°æ®ç”¨UDPå‘ç»™å®¢æˆ·ç«¯ã€‚ æ³¨æ„è¿™é‡Œçœæ‰äº†å¤šçº¿ç¨‹ï¼Œå› ä¸ºè¿™ä¸ªä¾‹å­å¾ˆç®€å•ã€‚ å®¢æˆ·ç«¯ä½¿ç”¨UDPæ—¶ï¼Œé¦–å…ˆä»ç„¶åˆ›å»ºåŸºäºUDPçš„Socketï¼Œç„¶åï¼Œä¸éœ€è¦è°ƒç”¨connect()ï¼Œç›´æ¥é€šè¿‡sendto()ç»™æœåŠ¡å™¨å‘æ•°æ®ï¼š 1234567s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)for data in [b'Michael', b'Tracy', b'Sarah']: # å‘é€æ•°æ®: s.sendto(data, ('127.0.0.1', 9999)) # æ¥æ”¶æ•°æ®: print(s.recv(1024).decode('utf-8'))s.close() ä»æœåŠ¡å™¨æ¥æ”¶æ•°æ®ä»ç„¶è°ƒç”¨recv()æ–¹æ³•ã€‚ ä»ç„¶ç”¨ä¸¤ä¸ªå‘½ä»¤è¡Œåˆ†åˆ«å¯åŠ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æµ‹è¯•ï¼Œç»“æœå¦‚ä¸‹ï¼š å°ç»“ UDPçš„ä½¿ç”¨ä¸TCPç±»ä¼¼ï¼Œä½†æ˜¯ä¸éœ€è¦å»ºç«‹è¿æ¥ã€‚æ­¤å¤–ï¼ŒæœåŠ¡å™¨ç»‘å®šUDPç«¯å£å’ŒTCPç«¯å£äº’ä¸å†²çªï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒUDPçš„9999ç«¯å£ä¸TCPçš„9999ç«¯å£å¯ä»¥å„è‡ªç»‘å®šã€‚ sever.py 123456789101112131415161718#!/usr/bin/env python3# -*- coding: utf-8 -*-import sockets = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)# ç»‘å®šç«¯å£:s.bind(('127.0.0.1', 9999))print('Bind UDP on 9999...')while True: # æ¥æ”¶æ•°æ®: data, addr = s.recvfrom(1024) print('Received from %s:%s.' % addr) reply = 'Hello, %s!' % data.decode('utf-8') s.sendto(reply.encode('utf-8'), addr) client.py 1234567891011121314#!/usr/bin/env python3# -*- coding: utf-8 -*-import sockets = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)for data in [b'Michael', b'Tracy', b'Sarah']: # å‘é€æ•°æ®: s.sendto(data, ('127.0.0.1', 9999)) # æ¥æ”¶æ•°æ®: print(s.recv(1024).decode('utf-8'))s.close()","tags":[{"name":"Python","slug":"Python","permalink":"https://www.limuyang.cc/tags/Python/"},{"name":"è®¡ç®—æœºç½‘ç»œ","slug":"è®¡ç®—æœºç½‘ç»œ","permalink":"https://www.limuyang.cc/tags/è®¡ç®—æœºç½‘ç»œ/"}]},{"title":"Android Design Support Library--FloatingActionButtonåŠå…¶Behaviorçš„ä½¿ç”¨","date":"2016-05-31T00:20:19.000Z","path":"2016/05/31/Android-Design-Support-Library-FloatingActionButtonåŠå…¶Behaviorçš„ä½¿ç”¨/","text":"å¼•è¨€å¦‚æœè¯´å‰é¢æåˆ°çš„TextInputLayoutã€SnackBarçš„åº”ç”¨è¿˜ä¸æ˜¯å¾ˆå¸¸è§çš„è¯ï¼Œé‚£ä¹ˆä»Šå¤©æåˆ°çš„FloatingActionButtonç»å¯¹æ˜¯ä¸€ä¸ªéšå¤„å¯è§çš„Material Designæ§ä»¶äº†ï¼Œæ— è®ºæ˜¯æˆ‘ä»¬å¸¸ç”¨çš„çŸ¥ä¹ã€å°è±¡ç¬”è®°æˆ–è€…æ˜¯å¯çˆ±çš„è°·æ­Œå…¨å®¶æ¡¶å¥—è£…éƒ½å¯ä»¥è§åˆ°FloatingActionButtonçš„èº«å½±ï¼Œä»Šå¤©å°±æ¥è¯´è¯´FloatingActionButtonã€‚ å…³äºä½¿ç”¨å…¶å®æˆ‘ç›¸ä¿¡å¾ˆå¤šäººéƒ½ç”¨è¿‡äº†Material Designæ§ä»¶äº†ï¼Œä½†æ˜¯è¿˜æ˜¯è¦è¯´ä¸€ä¸‹ï¼Œæ¯•ç«Ÿæœ‰äº›äººæ¥è§¦çš„æ™šä¸€äº›ï¼Œä¸€äº›äººæ¥è§¦çš„æ—©ä¸€äº›ï¼Œå…ˆä»æœ€ç®€å•çš„ä½¿ç”¨çœ‹èµ·ï¼š å±æ€§å€¼ ä½œç”¨ app:elevation è®¾ç½®FABæœªæŒ‰ä¸‹æ—¶çš„æ™¯æ·± app:pressedTranslationZ è®¾ç½®FABæŒ‰ä¸‹æ—¶çš„æ™¯æ·± app:fabSize è®¾ç½®FABçš„å¤§å°ï¼Œé»˜è®¤åªæœ‰normalå’Œminiä¸¤ç§é€‰é¡¹ app:borderWidth è®¾ç½®FABçš„è¾¹æ¡†å®½åº¦ android:src è®¾ç½®FABçš„drawaber app:rippleColor è®¾ç½®FABæŒ‰ä¸‹æ—¶çš„èƒŒæ™¯è‰² app:backgroundTint è®¾ç½®FABæœªæŒ‰ä¸‹æ—¶çš„èƒŒæ™¯è‰² app:layout_anchor è®¾ç½®FABçš„é”šç‚¹ app:layout_anchorGravity è®¾ç½®FABç›¸å¯¹äºé”šç‚¹çš„ä½ç½® app:layout_behavior è®¾ç½®FABçš„Behaviorè¡Œä¸ºå±æ€§ å¤§éƒ¨åˆ†çš„å±æ€§è¿˜æ˜¯å¾ˆå¥½ç†è§£çš„ï¼Œè¿™é‡Œè¦æä¸€ä¸‹å‡ ä¸ªæ³¨æ„çš„ç‚¹ app:borderWidth :è¿™ä¸ªä¸€èˆ¬è®¾ç½®ä¸º0dpï¼Œä¸ç„¶çš„è¯åœ¨4.1çš„sdkä¸ŠFABä¼šæ˜¾ç¤ºä¸ºæ­£æ–¹å½¢ï¼Œè€Œä¸”åœ¨5.0ä»¥åçš„sdkæ²¡æœ‰é˜´å½±æ•ˆæœ app:rippleColorï¼šå½“æˆ‘ä½¿ç”¨com.android.support:design:23.2.0 çš„æ—¶å€™è¿™ä¸ªå±æ€§ä¼šå¤±æ•ˆï¼Œå»ºè®®ä½¿ç”¨æœ€æ–°çš„ com.android.support:design:23.3.0&#39; æˆ–è€…é€‚å½“çš„é™ä½ç‰ˆæœ¬ android:layout_marginBottom :ç”±äºFAB æ”¯æŒåº“ä»ç„¶å­˜åœ¨ä¸€äº› bugï¼Œåœ¨ Kitkat å’Œ Lollipop ä¸­åˆ†åˆ«è¿è¡Œç¤ºä¾‹ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç»“æœï¼š Lollipop ä¸­çš„ FABï¼š Kitkat ä¸­çš„ FABï¼š å¾ˆå®¹æ˜“çœ‹å‡ºï¼ŒLollipop ä¸­å­˜åœ¨è¾¹ç¼˜æ˜¾ç¤ºçš„é—®é¢˜ã€‚ä¸ºäº†è§£å†³æ­¤é—®é¢˜ï¼ŒAPI21+ çš„ç‰ˆæœ¬ç»Ÿä¸€å®šä¹‰åº•éƒ¨ä¸å³è¾¹ç¼˜ç©ºç™½ä¸º 16dpï¼ŒLollipop ä»¥ä¸‹ç‰ˆæœ¬ç»Ÿä¸€è®¾ç½®ä¸º 0dp.è§£å†³åŠæ³•ï¼š values/dimens.xml12&lt;dimen name=\"fab_margin_right\"&gt;0dp&lt;/dimen&gt;&lt;dimen name=\"fab_margin_bottom\"&gt;0dp&lt;/dimen&gt; values-v21/dimens.xml 12&lt;dimen name=\"fab_margin_right\"&gt;16dp&lt;/dimen&gt;&lt;dimen name=\"fab_margin_bottom\"&gt;16dp&lt;/dimen&gt; å¸ƒå±€æ–‡ä»¶çš„ FAB ä¸­ï¼Œä¹Ÿè®¾ç½®ç›¸åº”çš„å€¼ï¼š 12345&lt;android.support.design.widget.FloatingActionButton ... ... android:layout_marginBottom=\"@dimen/fab_margin_bottom\" android:layout_marginRight=\"@dimen/fab_margin_right\"/&gt; ä»¥ä¸Šè¿™æ®µè¯å‡ºå¤„ app:layout_anchorï¼šå’Œapp:layout_anchorGravityå±æ€§ä¸€èµ·æ­é…ä½¿ç”¨ï¼Œå¯ä»¥åšå‡ºä¸åŒçš„æ•ˆæœï¼š æœ€ç®€å•çš„ä½¿ç”¨1234567&lt;android.support.design.widget.FloatingActionButton ... ... app:layout_anchor=\"@id/mRecycleView\" app:layout_anchorGravity=\"bottom|right|end\" ... /&gt; æ›´é…·ç‚«çš„æ•ˆæœ 123456&lt;android.support.design.widget.FloatingActionButton ... app:layout_anchor=&quot;@id/collapsingToolbarLayout&quot; app:layout_anchorGravity=&quot;bottom|center&quot; ... /&gt; è¿™å¼ å›¾ç‰‡å‡ºå¤„ å¯ä»¥çœ‹å‡ºæˆ‘ä»¬åªè¦ä½¿ç”¨app:layout_anchorå±æ€§è®¾ç½®ä¸€ä¸ªæ§ä»¶ä½œä¸ºFABçš„é”šï¼Œç„¶åé€šè¿‡app:layout_anchorGravity å±æ€§æ”¾ç½®FABåœ¨è¿™ä¸ªç›¸å¯¹çš„é”šçš„ä½ç½®ï¼Œå°±èƒ½åšå‡ºä½ æƒ³è¦çš„æ•ˆæœã€‚ app:layout_behaviorï¼šè¿™ä¸ªå±æ€§æ¥ä¸‹æ¥ä¼šé‡ç‚¹è®²ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªå±æ€§æˆå°±äº†Material Designçš„ä¼—å¤šåŠ¨ç”»äº¤äº’æ•ˆæœï¼Œæˆ‘ä»¬ç†ŸçŸ¥çš„SnackBaré…åˆFABå¯ä»¥ä¾§æ»‘ä»¥åŠAPPBarLayoutç­‰åŠ¨ç”»æ•ˆæœéƒ½æ˜¯é€šè¿‡Behavioråšå‡ºæ¥çš„ è‡ªå®šä¹‰Behaviorå¦‚æœä½ è¿˜è®°å¾—è¿™å¼ å›¾çš„è¯ï¼š æˆ–è€…è¯´ä½ è§è¿‡è¿™ç§äº¤äº’æ•ˆæœï¼š å…¶å®è¿™äº›éƒ½æ˜¯é€šè¿‡Behaviorè¿™ä¸ªç±»åšå‡ºæ¥çš„ï¼Œä»¥ä¸Šçš„ä¸¤ç§åŠ¨ç”»éƒ½æ˜¯é»˜è®¤è‡ªå¸¦çš„Behaviorï¼Œåœ¨CoordinatorLayout å†…éƒ¨æœ‰å¯¹Behaviorç±»çš„æè¿°ï¼š 123456789/** * Interaction behavior plugin for child views of &#123;@link CoordinatorLayout&#125;. * * &lt;p&gt;A Behavior implements one or more interactions that a user can take on a child view. * These interactions may include drags, swipes, flings, or any other gestures.&lt;/p&gt; * * @param &lt;V&gt; The View type that this Behavior operates on */ public static abstract class Behavior&lt;V extends View&gt; &#123; å¯ä»¥çœ‹åˆ°è¿™æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å„ä¸ªMaterial Designå»å®ç°è¿™ä¸ªç±»ï¼Œè¿™é‡Œæåˆ°FABï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾ä¸€ä¸‹FABä¸­çš„é»˜è®¤Behavioräº¤äº’çš„å®ç°ï¼š 123456789/** * Behavior designed for use with &#123;@link FloatingActionButton&#125; instances. It's main function * is to move &#123;@link FloatingActionButton&#125; views so that any displayed &#123;@link Snackbar&#125;s do * not cover them. */ public static class Behavior extends CoordinatorLayout.Behavior&lt;FloatingActionButton&gt; &#123; // We only support the FAB &lt;&gt; Snackbar shift movement on Honeycomb and above. This is // because we can use view translation properties which greatly simplifies the code. private static final boolean SNACKBAR_BEHAVIOR_ENABLED = Build.VERSION.SDK_INT &gt;= 11; è¿™é‡Œåªè´´å‡ºä¸€éƒ¨åˆ†ï¼Œå¦‚æœè‹±æ–‡ä¸å·®çš„è¯çœ‹å¾—æ‡‚æ³¨é‡Šçš„æ„æ€ï¼šå¤§è‡´å°±æ˜¯è¯´æˆ‘ä»¬è¿™é‡Œåªæä¾›API 11ä»¥ä¸Šçš„Snackbarå’ŒFABçš„è¿åŠ¨äº¤äº’æ•ˆæœï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢åŠ¨å›¾ä¸­çœ‹åˆ°çš„æ•ˆæœï¼šå½“å‡ºç°äº†ä¸€ä¸ªSnackBaræ—¶å€™ï¼ŒFABä¼šè‡ªåŠ¨å‘ä¸Šç§»åŠ¨ä¸€æ®µè·ç¦»ï¼Œå½“SnackBaræ¶ˆå¤±çš„æ—¶å€™FABä¼šå›åˆ°åŸæ¥ä½ç½®ï¼Œé‚£ä¹ˆå¦‚ä½•å®šä¹‰ä¸€ä¸ªå±äºæˆ‘ä»¬è‡ªå·±çš„Behaviorï¼Œå…ˆæ¥çœ‹çœ‹éœ€è¦ç”¨åˆ°çš„çŸ¥è¯†ï¼š å…¶å®ç»†åˆ†çš„è¯æœ‰ä¸¤ç§æƒ…å†µï¼š1ã€å½“ä¸€ä¸ªViewçš„å˜åŒ–ä¾èµ–äºå¦ä¸€ä¸ªViewçš„å°ºå¯¸ã€ä½ç½®ç­‰å˜åŒ–çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨ä»¥ä¸‹ä¸¤ç§æ–¹æ³•ï¼š 123456789* @param parent ç¬¬ä¸€ä¸ªå‚æ•°ä¸ç”¨è§£é‡Šå§* @param ä½ è¦ä¾èµ–åˆ«çš„Viewçš„é‚£ä¸ªView* @param dependency ä½ è¦ä¾èµ–çš„View* @return return å¦‚æœæ‰¾åˆ°äº†ä½ ä¾èµ–çš„é‚£ä¸ªViewå°±è¿”å›true * @see #onDependentViewChanged(CoordinatorLayout, android.view.View, android.view.View) */ public boolean layoutDependsOn(CoordinatorLayout parent, V child, View dependency) &#123; return false; &#125; 12345678* @param parent åŒä¸Šï¼Œä¸è§£é‡Š* @param child åŒä¸Š* @param dependency åŒä¸Š* @return å¦‚æœè¿™ä¸ªBehavioræ”¹å˜äº†childçš„ä½ç½®æˆ–è€…å°ºå¯¸å¤§å°å°±è¿”å›true */ public boolean onDependentViewChanged(CoordinatorLayout parent, V child, View dependency) &#123; return false; &#125; å…¶å®FABé‡Œé¢å°±æ˜¯å®ç°äº†è¿™ä¸¤ç§æ–¹æ³•æ¥ä¸SnackBaräº¤äº’çš„ï¼Œçœ‹ä¸€ä¸‹æ ‡å‡†å†™æ³•ï¼š 1234567891011121314151617181920@Override public boolean layoutDependsOn(CoordinatorLayout parent, FloatingActionButton child, View dependency) &#123; // We're dependent on all SnackbarLayouts (if enabled) return SNACKBAR_BEHAVIOR_ENABLED &amp;&amp; dependency instanceof Snackbar.SnackbarLayout; &#125; ... ... @Override public boolean onDependentViewChanged(CoordinatorLayout parent, FloatingActionButton child, View dependency) &#123; if (dependency instanceof Snackbar.SnackbarLayout) &#123; updateFabTranslationForSnackbar(parent, child, dependency); &#125; else if (dependency instanceof AppBarLayout) &#123; // If we're depending on an AppBarLayout we will show/hide it automatically // if the FAB is anchored to the AppBarLayout updateFabVisibility(parent, (AppBarLayout) dependency, child); &#125; return false; &#125; 2ã€å¦ä¸€ç§æƒ…å†µæ˜¯å½“ä¸€ä¸ªViewç›‘å¬CoordinatorLayoutå†…éƒ¨æ»‘åŠ¨çš„Viewè¿›è¡Œäº¤äº’æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨çš„æ–¹æ³•ç¨å¾®å¤šä¸€ç‚¹ï¼Œè¿™äº›æ–¹æ³•éƒ½å†™åœ¨äº†NestedScrollingParentæ¥å£é‡Œé¢ï¼Œè€Œä¸”CoordinatorLayoutå·²ç»å¯¹è¿™ä¸ªæ¥å£æœ‰äº†é»˜è®¤å®ç°ï¼š onStartNestedScroll1234567891011121314151617 * @param coordinatorLayout the CoordinatorLayout parent of the view this Behavior is * associated with * @param child the child view of the CoordinatorLayout this Behavior is associated with * @param directTargetChild the child view of the CoordinatorLayout that either is or * contains the target of the nested scroll operation * @param target the descendant view of the CoordinatorLayout initiating the nested scroll * @param nestedScrollAxes the axes that this nested scroll applies to. See * &#123;@link ViewCompat#SCROLL_AXIS_HORIZONTAL&#125;, * &#123;@link ViewCompat#SCROLL_AXIS_VERTICAL&#125; æ»‘åŠ¨æ—¶æ˜¯æ¨ªè½´å’Œçºµè½´ * @return true if the Behavior wishes to accept this nested scroll * * @see NestedScrollingParent#onStartNestedScroll(View, View, int) */public boolean onStartNestedScroll(CoordinatorLayout coordinatorLayout, V child, View directTargetChild, View target, int nestedScrollAxes) &#123; return false;&#125; onNestedPreScroll12345678910111213141516 * @param coordinatorLayout the CoordinatorLayout parent of the view this Behavior is * associated with * @param child the child view of the CoordinatorLayout this Behavior is associated with * @param target the descendant view of the CoordinatorLayout performing the nested scroll * @param dx the raw horizontal number of pixels that the user attempted to scroll * @param dy the raw vertical number of pixels that the user attempted to scroll * @param consumed out parameter. consumed[0] should be set to the distance of dx that * was consumed, consumed[1] should be set to the distance of dy that * was consumed * * @see NestedScrollingParent#onNestedPreScroll(View, int, int, int[]) */public void onNestedPreScroll(CoordinatorLayout coordinatorLayout, V child, View target, int dx, int dy, int[] consumed) &#123; // Do nothing&#125; onNestedFling123456789101112131415 * @param coordinatorLayout the CoordinatorLayout parent of the view this Behavior is * associated with * @param child the child view of the CoordinatorLayout this Behavior is associated with * @param target the descendant view of the CoordinatorLayout performing the nested scroll * @param velocityX horizontal velocity of the attempted fling * @param velocityY vertical velocity of the attempted fling * @param consumed true if the nested child view consumed the fling * @return true if the Behavior consumed the fling * * @see NestedScrollingParent#onNestedFling(View, float, float, boolean) */public boolean onNestedFling(CoordinatorLayout coordinatorLayout, V child, View target, float velocityX, float velocityY, boolean consumed) &#123; return false;&#125; onNestedScroll1234567891011121314151617 * @param coordinatorLayout the CoordinatorLayout parent of the view this Behavior is * associated with * @param child the child view of the CoordinatorLayout this Behavior is associated with * @param target the descendant view of the CoordinatorLayout performing the nested scroll * @param dxConsumed horizontal pixels consumed by the target's own scrolling operation * @param dyConsumed vertical pixels consumed by the target's own scrolling operation * @param dxUnconsumed horizontal pixels not consumed by the target's own scrolling * operation, but requested by the user * @param dyUnconsumed vertical pixels not consumed by the target's own scrolling operation, * but requested by the user * * @see NestedScrollingParent#onNestedScroll(View, int, int, int, int) */public void onNestedScroll(CoordinatorLayout coordinatorLayout, V child, View target, int dxConsumed, int dyConsumed, int dxUnconsumed, int dyUnconsumed) &#123; // Do nothing&#125; å¦‚æœæ˜¯ç å†œçš„è¯ä¸Šé¢çš„è‹±æ–‡æ³¨é‡Šåº”è¯¥ä¸éš¾å§ï¼Œè¿™å››ä¸ªæ–¹æ³•çš„åŒºåˆ«å¦‚ä¸‹ï¼š onStartNestedScroll ï¼šå½“ä½ æƒ³è¦åˆå§‹åŒ–ä¸€ä¸ªæ»‘åŠ¨çš„æ—¶å€™è°ƒç”¨ onNestedPreScroll å’ŒonNestedScrollï¼šå­˜åœ¨ç€ä¸¤ä¸ªæ–¹æ³•çš„åŸå› æ˜¯ä¸€äº›Behaviorsï¼ˆæ¯”å¦‚å’ŒAppBarLayoutä½¿ç”¨çš„ï¼‰å¯èƒ½ä¼šæ¶ˆè´¹æ‰éƒ¨åˆ†æ»šåŠ¨äº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨onNestedPreScrollæ–¹æ³•å†…éƒ¨è®¡ç®—éœ€è¦æ»šåŠ¨çš„è·ç¦»ï¼Œå…·ä½“çš„è¯è¯·çœ‹è¿™é‡Œ onNestedScrollï¼šå½“targetæ­£å°è¯•æ»‘åŠ¨æˆ–è€…å·²ç»æ»‘åŠ¨æ—¶å€™è°ƒç”¨è¿™ä¸ªæ–¹æ³• onNestedFlingï¼šçœ‹åˆ°Flingå°±æ˜ç™½æ˜¯è¿™æ˜¯Flingæƒ…å†µä¸‹è°ƒç”¨çš„æ–¹æ³•ï¼ŒFlingæœ€ç›´è§‚çš„ä½“ç°æ˜¯ä½ æ»‘åŠ¨ä¸€ä¸ªListViewæ—¶æ¾æ‰‹çš„æ—¶å€™ListViewè¿˜ä¼šå› ä¸ºæƒ¯æ€§è‡ªåŠ¨æ»‘åŠ¨ä¸€å°æ®µè·ç¦» è¿™ä¹ˆçœ‹å¯èƒ½å¤ªç¬¼ç»Ÿäº†ï¼Œçœ‹ä¸€ä¸‹è¿™ä¸€ç±»Behaviorçš„å®é™…ä½“ç°ï¼Œæˆ‘ä»¬è‡ªå·±è‡ªå®šä¹‰ä¸€ä¸ªBehaviorï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859public class FadeBehavior extends FloatingActionButton.Behavior &#123; /** * å› ä¸ºæ˜¯åœ¨XMLä¸­ä½¿ç”¨app:layout_behaviorå®šä¹‰é™æ€çš„è¿™ç§è¡Œä¸º, * å¿…é¡»å®ç°ä¸€ä¸ªæ„é€ å‡½æ•°ä½¿å¸ƒå±€çš„æ•ˆæœèƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚ * å¦åˆ™ Could not inflate Behavior subclass error messages. * @param context * @param attrs */ public FadeBehavior(Context context, AttributeSet attrs) &#123; super(); &#125; /** * å¤„ç†å‚ç›´æ–¹å‘ä¸Šçš„æ»šåŠ¨äº‹ä»¶ * * @param coordinatorLayout * @param child * @param directTargetChild * @param target * @param nestedScrollAxes * @return */ @Override public boolean onStartNestedScroll(CoordinatorLayout coordinatorLayout, FloatingActionButton child, View directTargetChild, View target, int nestedScrollAxes) &#123; // Ensure we react to vertical scrolling return nestedScrollAxes == ViewCompat.SCROLL_AXIS_VERTICAL || super.onStartNestedScroll(coordinatorLayout, child, directTargetChild, target, nestedScrollAxes); &#125; /** * æ£€æŸ¥Yçš„ä½ç½®ï¼Œå¹¶å†³å®šæŒ‰é’®æ˜¯å¦åŠ¨ç”»è¿›å…¥æˆ–é€€å‡º * @param coordinatorLayout * @param child * @param target * @param dxConsumed * @param dyConsumed * @param dxUnconsumed * @param dyUnconsumed */ @Override public void onNestedScroll(CoordinatorLayout coordinatorLayout, FloatingActionButton child, View target, int dxConsumed, int dyConsumed, int dxUnconsumed, int dyUnconsumed) &#123; super.onNestedScroll(coordinatorLayout, child, target, dxConsumed, dyConsumed, dxUnconsumed, dyUnconsumed); if (dyConsumed &gt; 0 &amp;&amp; child.getVisibility() == View.VISIBLE) &#123; // User scrolled down and the FAB is currently visible -&gt; hide the FAB child.hide(); &#125; else if (dyConsumed &lt; 0 &amp;&amp; child.getVisibility() != View.VISIBLE) &#123; // User scrolled up and the FAB is currently not visible -&gt; show the FAB child.show(); &#125; &#125;&#125; è¿™é‡Œç»§æ‰¿äº†FABçš„Behaviorå†™äº†ä¸€ä¸ªæˆ‘ä»¬è‡ªå·±çš„å®ç°ï¼Œæ³¨æ„å®ç°è‡ªå·±çš„Behaviorçš„æ—¶å€™ä¸€å®šè¦é‡å†™ä¸¤ä¸ªå‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œå› ä¸ºCoordinatorLayoutä¼šä»æˆ‘ä»¬åœ¨XMLä¸­å®šä¹‰çš„app:layout_behaviorå±æ€§å»æ‰¾è¿™ä¸ªBehaviorï¼Œäº†è§£è‡ªå®šä¹‰Viewçš„å¯¹è¿™ä¸ªåº”è¯¥ä¸ä¼šé™Œç”Ÿï¼Œä¸€èˆ¬çš„å†™æ³•æ˜¯ï¼š 1app:layout_behavior=\".FadeBehavior \" åœ¨æŸ¥èµ„æ–™çš„è¿‡ç¨‹ä¸­å‘ç°å¾ˆå¤šäººæŠŠè‡ªå®šä¹‰Behaviorç±»æ‰€åœ¨çš„åŒ…åä¹Ÿå†™è¿›å»äº†ï¼Œå…¶å®äº²æµ‹æ²¡å¿…è¦è¿™æ ·åšï¼Œè€Œä¸”CoordinatorLayouté‡Œé¢ä¹Ÿæœ‰ä¸“é—¨çš„æ–¹æ³•å»è§£æï¼š 1234567891011121314151617181920212223242526272829303132333435363738static Behavior parseBehavior(Context context, AttributeSet attrs, String name) &#123; if (TextUtils.isEmpty(name)) &#123; return null; &#125; final String fullName; if (name.startsWith(\".\")) &#123; // Relative to the app package. Prepend the app package name. fullName = context.getPackageName() + name; &#125; else if (name.indexOf('.') &gt;= 0) &#123; // Fully qualified package name. fullName = name; &#125; else &#123; // Assume stock behavior in this package (if we have one) fullName = !TextUtils.isEmpty(WIDGET_PACKAGE_NAME) ? (WIDGET_PACKAGE_NAME + '.' + name) : name; &#125; try &#123; Map&lt;String, Constructor&lt;Behavior&gt;&gt; constructors = sConstructors.get(); if (constructors == null) &#123; constructors = new HashMap&lt;&gt;(); sConstructors.set(constructors); &#125; Constructor&lt;Behavior&gt; c = constructors.get(fullName); if (c == null) &#123; final Class&lt;Behavior&gt; clazz = (Class&lt;Behavior&gt;) Class.forName(fullName, true, context.getClassLoader()); c = clazz.getConstructor(CONSTRUCTOR_PARAMS); c.setAccessible(true); constructors.put(fullName, c); &#125; return c.newInstance(context, attrs); &#125; catch (Exception e) &#123; throw new RuntimeException(\"Could not inflate Behavior subclass \" + fullName, e); &#125; &#125; å¯ä»¥çœ‹åˆ°ç”¨è¿™ç§æ–¹å¼çš„ç³»ç»Ÿä¼šè‡ªåŠ¨ç»™æˆ‘ä»¬åŠ ä¸ŠåŒ…åï¼Œå†™å¤ªå¤šåè€Œæ˜¾çš„ç´¯èµ˜ï¼Œè¿™ä¸ªè‡ªå®šä¹‰Behavioråº”è¯¥å¾ˆå¥½ç†è§£ï¼Œæ•ˆæœå°±æ˜¯éšç€RecycleViewçš„æ»‘åŠ¨FABä¼šéšè—/æ˜¾ç¤ºï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„æ•ˆæœï¼š åªè¦å‘ä¸Šæ»šåŠ¨FABå°±ä¼šæ¶ˆå¤±ï¼Œå‘ä¸‹æ»šåŠ¨FABå°±æ˜¯æ˜¾ç¤ºï¼Œè¿™é‡Œè¦æ³¨æ„çš„æ˜¯FABå¯ä»¥ä¸RecycleViewå½¢æˆè¿™ç§æ•ˆæœï¼Œä½†æ˜¯æš‚æ—¶å¹¶ä¸æ”¯æŒListViewï¼Œæ²¡å…³ç³»ï¼Œåæ­£RecycleViewå½“æˆListViewæ¥ç”¨å°±å¥½ï¼Œæ¥ä¸‹æ¥ä»¿ç…§å®ç°çŸ¥ä¹çš„FABæ•ˆæœçš„å®ç°ï¼Œå…ˆçœ‹ä¸€ä¸‹çŸ¥ä¹çš„æ•ˆæœï¼š å¯ä»¥å¾ˆæ¸…æ¥šçš„çœ‹åˆ°FABéšç€RecycleViewçš„æ»‘åŠ¨å‘ˆç°å‡ºæ»šåŠ¨æ¨å‡ºçš„æ•ˆæœï¼Œå¹¶ä¸”ç‚¹å‡»FABä¼šå‡ºç°æ—‹è½¬æ•ˆæœå¹¶ä¸”å¼¹å‡ºä¸€ä¸ªè’™ç‰ˆï¼Œæˆ‘ä»¬å¯ä»¥å…ˆè‡ªå®šä¹‰ä¸€ä¸ªç”¨äºæ‰§è¡ŒFABæ—‹è½¬çš„Behaviorï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡ŒFABæ˜¯é€†æ—¶é’ˆæ—‹è½¬135åº¦ï¼Œé‚£ä¹ˆä»£ç å°±å¯ä»¥è¿™ä¹ˆå†™ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344public class RotateBehavior extends CoordinatorLayout.Behavior&lt;FloatingActionButton&gt; &#123; private static final String TAG = RotateBehavior.class.getSimpleName(); public RotateBehavior() &#123; &#125; public RotateBehavior(Context context, AttributeSet attrs) &#123; super(context, attrs); &#125; @Override public boolean layoutDependsOn(CoordinatorLayout parent, FloatingActionButton child, View dependency) &#123; return dependency instanceof Snackbar.SnackbarLayout; &#125; @Override public boolean onDependentViewChanged(CoordinatorLayout parent, FloatingActionButton child, View dependency) &#123; float translationY = getFabTranslationYForSnackBar(parent, child); float percentComplete = -translationY / dependency.getHeight(); child.setRotation(-135 * percentComplete); child.setTranslationY(translationY); return true; &#125; private float getFabTranslationYForSnackBar(CoordinatorLayout parent, FloatingActionButton fab) &#123; float minOffset = 0; final List&lt;View&gt; dependencies = parent.getDependencies(fab); for (int i = 0, z = dependencies.size(); i &lt; z; i++) &#123; final View view = dependencies.get(i); if (view instanceof Snackbar.SnackbarLayout &amp;&amp; parent.doViewsOverlap(fab, view)) &#123; //view.getHeight()å›ºå®šä¸º144 //ViewCompat.getTranslationY(view)ä»144-0ï¼Œå†ä»0-144 minOffset = Math.min(minOffset, ViewCompat.getTranslationY(view) - view.getHeight()); Log.d(\"TranslationY\",ViewCompat.getTranslationY(view)+\"\"); Log.d(\"Height\",view.getHeight()+\"\"); &#125; &#125; return minOffset; &#125;&#125; è¿™é‡Œå¯èƒ½å°±è¿™æ®µä»£ç æ¯”è¾ƒéš¾ç†è§£ï¼š 12minOffset = Math.min(minOffset, ViewCompat.getTranslationY(view) - view.getHeight()); æˆ‘åœ¨ä¸Šé¢æ‰“äº†ä¸¤ä¸ªLogï¼Œåˆ†åˆ«å¾—å‡ºäº†ViewCompat.getTranslationY(view) å’Œview.getHeight() ï¼Œè¿™æ ·çœ‹ä»£ç å°±æ¯”è¾ƒå®¹æ˜“çœ‹æ‡‚ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆViewCompat.getTranslationY(view) æ˜¯æ­£æ•°å‘¢ï¼Œè¿™é‡Œçš„çš„Viewæˆ‘ä»¬éƒ½çŸ¥é“æŒ‡çš„æ˜¯SnackBarï¼Œæˆ‘ä»¬éƒ½çŸ¥é“å‘ä¸Šç§»åŠ¨çš„è¯getTranslationY åº”è¯¥æ˜¯è´Ÿæ•°å•Šï¼Œå…¶å®SnackBarçš„æºä»£ç ä¸­æœ‰ä¸€ä¸ªè¿™æ ·çš„åŠ¨ä½œï¼š 12345ViewCompat.setTranslationY(mView, mView.getHeight()); ViewCompat.animate(mView) .translationY(0f) .setInterpolator(FAST_OUT_SLOW_IN_INTERPOLATOR) .setDuration(ANIMATION_DURATION) ä¹Ÿå°±æ˜¯è¯´SnackBarä¸€å¼€å§‹å°±å‘ä¸‹ç§»åŠ¨äº†mView.getHeight()çš„é•¿åº¦ï¼Œå½“SnackBarå‡ºç°çš„æ—¶å€™åªæ˜¯å‘ç€å®ƒåŸæ¥çš„ä½ç½®ç§»åŠ¨ï¼Œæœ¬è´¨ä¸Šè¿˜æ˜¯ç›¸å½“äºä»å®ƒåŸæ¥çš„ä½ç½®ç§»åŠ¨äº†ä¸€æ®µè·ç¦»ï¼Œåªæ˜¯è¿™ä¸ªè·ç¦»éšç€SnackBarå‘ä¸Šæµ®åŠ¨çš„è¶Šæ¥è¶Šå¤šè€Œå˜å¾—è¶Šæ¥è¶Šå°ï¼Œç›´è‡³å›åˆ°åŸæ¥çš„ä½ç½®ï¼Œè¿™ä¹ˆè¯´åº”è¯¥å¯ä»¥ç†è§£äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åœ¨XMLæ–‡ä»¶ä¸­åŠ å…¥ä¸€ä¸ªTextViewä½œä¸ºè’™ç‰ˆï¼š 123456&lt;TextView android:id=&quot;@+id/hide&quot; android:layout_width=&quot;match_parent&quot; android:layout_height=&quot;match_parent&quot; android:background=&quot;#ffff&quot; android:visibility=&quot;gone&quot; /&gt; å› ä¸ºCoordinatorLayoutç›¸å½“äºå¸§å¸ƒå±€æ˜¯ä¸€å±‚ä¸€å±‚å åŠ çš„æ‰€ä»¥è¿™ä¸ªè’™ç‰ˆæ”¾åœ¨RecycleViewå’ŒFABä¸­é—´ï¼Œæ•´ä¸ªå¸ƒå±€ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;android.support.design.widget.CoordinatorLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot; android:id=&quot;@+id/coor&quot; android:layout_width=&quot;match_parent&quot; android:layout_height=&quot;match_parent&quot;&gt; &lt;android.support.v7.widget.RecyclerView android:id=&quot;@+id/mRecycleView&quot; android:layout_width=&quot;match_parent&quot; android:layout_height=&quot;match_parent&quot;&gt; &lt;/android.support.v7.widget.RecyclerView&gt; &lt;TextView android:id=&quot;@+id/hide&quot; android:layout_width=&quot;match_parent&quot; android:layout_height=&quot;match_parent&quot; android:background=&quot;#ffff&quot; android:visibility=&quot;gone&quot; /&gt; &lt;android.support.design.widget.FloatingActionButton android:id=&quot;@+id/fab&quot; android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot; android:layout_marginBottom=&quot;@dimen/fab_margin_bottom&quot; android:layout_marginEnd=&quot;@dimen/fab_margin_right&quot; android:src=&quot;@mipmap/plus&quot; app:backgroundTint=&quot;#0767C8&quot; app:borderWidth=&quot;0dp&quot; app:elevation=&quot;6dp&quot; app:fabSize=&quot;normal&quot; app:layout_anchor=&quot;@id/mRecycleView&quot; app:layout_anchorGravity=&quot;bottom|right|end&quot; app:layout_behavior=&quot;.FadeBehavior&quot; app:pressedTranslationZ=&quot;12dp&quot; app:rippleColor=&quot;#0767C8&quot; /&gt;&lt;/android.support.design.widget.CoordinatorLayout&gt; çœ‹çœ‹æ•ˆæœï¼š æ˜¯ä¸æ˜¯æœ‰ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„åœ°æ–¹ï¼ŒçŸ¥ä¹çš„FABå¹¶æ²¡æœ‰SnackBarå¼¹å‡ºå•Šï¼Œé‚£å°±è¯´æ˜ä¸€å¼€å§‹çš„æ€è·¯é”™äº†ï¼Œä½†æ˜¯ä¸€ä¸ªFABåªèƒ½è®¾ç½®ä¸€ä¸ªapp:layout_behavior ï¼Œå¦‚æœæˆ‘ä»¬æŠŠè¿™ä¸ªBehaviorç”¨ä½œFABçš„æ—‹è½¬æ•ˆæœé‚£ä¹ˆFABçš„æ»šåŠ¨ç§»å‡ºè§†å›¾çš„æ•ˆæœå°±æ²¡äº†ï¼Œæ‰€ä»¥æ¢ä¸€ç§æ€è·¯ï¼Œç”¨ObjectåŠ¨ç”»æ¥åšFABçš„æ—‹è½¬æ•ˆæœï¼š 123456789101112131415161718192021222324252627282930 //å¼€å§‹æ—‹è½¬ public void turnLeft(View v) &#123; ObjectAnimator objectAnimator = ObjectAnimator.ofFloat(v, \"rotation\", 0, -155, -135); objectAnimator.setDuration(300); objectAnimator.setInterpolator(new AccelerateDecelerateInterpolator()); objectAnimator.start(); hide.setVisibility(View.VISIBLE); AlphaAnimation alphaAnimation = new AlphaAnimation(0, 0.75f); alphaAnimation.setDuration(300); alphaAnimation.setFillAfter(true); hide.startAnimation(alphaAnimation); hide.setClickable(true); isOpen = true; &#125; //å›åˆ°èµ·å§‹ä½ç½® public void turnRight(View v) &#123; ObjectAnimator objectAnimator = ObjectAnimator.ofFloat(v, \"rotation\", -135, 20, 0); objectAnimator.setDuration(300); objectAnimator.setInterpolator(new AccelerateDecelerateInterpolator()); objectAnimator.start(); hide.setVisibility(View.GONE); AlphaAnimation alphaAnimation = new AlphaAnimation(0.75f, 0); alphaAnimation.setDuration(300); alphaAnimation.setFillAfter(true); hide.startAnimation(alphaAnimation); hide.setClickable(false); isOpen = false; &#125;//æ³¨:hideå°±æ˜¯TextViewæ§ä»¶(è’™ç‰ˆ) ç„¶åå®ç°FABçš„æ»šåŠ¨ç§»å‡ºè§†å›¾æ•ˆæœçš„Behaviorï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576public class ScrollAwareFABBehavior extends FloatingActionButton.Behavior &#123; //å…ˆæ…¢åå¿«å†æ…¢ private static final Interpolator INTERPOLATOR = new FastOutSlowInInterpolator(); private boolean mIsAnimatingOut = false; public ScrollAwareFABBehavior(Context context, AttributeSet attrs) &#123; super(); &#125; //åˆå§‹æ¡ä»¶ @Override public boolean onStartNestedScroll(final CoordinatorLayout coordinatorLayout, final FloatingActionButton child, final View directTargetChild, final View target, final int nestedScrollAxes) &#123; //å‚ç›´æ»šåŠ¨ return nestedScrollAxes == ViewCompat.SCROLL_AXIS_VERTICAL || super.onStartNestedScroll(coordinatorLayout, child, directTargetChild, target, nestedScrollAxes); &#125; @Override public void onNestedScroll(final CoordinatorLayout coordinatorLayout, final FloatingActionButton child, final View target, final int dxConsumed, final int dyConsumed, final int dxUnconsumed, final int dyUnconsumed) &#123; super.onNestedScroll(coordinatorLayout, child, target, dxConsumed, dyConsumed, dxUnconsumed, dyUnconsumed); if (dyConsumed &gt; 0 &amp;&amp; !this.mIsAnimatingOut &amp;&amp; child.getVisibility() == View.VISIBLE) &#123; // User scrolled down and the FAB is currently visible -&gt; hide the FAB animateOut(child); &#125; else if (dyConsumed &lt; 0 &amp;&amp; child.getVisibility() != View.VISIBLE) &#123; // User scrolled up and the FAB is currently not visible -&gt; show the FAB animateIn(child); &#125; &#125; // Same animation that FloatingActionButton.Behavior uses to hide the FAB when the AppBarLayout exits private void animateOut(final FloatingActionButton button) &#123; if (Build.VERSION.SDK_INT &gt;= 14) &#123; //withLayer()ä½¿åŠ¨ç”»ä¸­çš„æŸäº›æ“ä½œå˜å¾—æ›´é¡ºç•…,åŠ é€Ÿæ¸²æŸ“,API 14ä»¥å ViewCompat.animate(button).translationY(button.getHeight() + getMarginBottom(button)).setInterpolator(INTERPOLATOR).withLayer() .setListener(new ViewPropertyAnimatorListener() &#123; public void onAnimationStart(View view) &#123; ScrollAwareFABBehavior.this.mIsAnimatingOut = true; &#125; public void onAnimationCancel(View view) &#123; ScrollAwareFABBehavior.this.mIsAnimatingOut = false; &#125; public void onAnimationEnd(View view) &#123; ScrollAwareFABBehavior.this.mIsAnimatingOut = false; view.setVisibility(View.GONE); &#125; &#125;).start(); &#125; else &#123; &#125; &#125; // Same animation that FloatingActionButton.Behavior uses to show the FAB when the AppBarLayout enters private void animateIn(FloatingActionButton button) &#123; button.setVisibility(View.VISIBLE); if (Build.VERSION.SDK_INT &gt;= 14) &#123; ViewCompat.animate(button).translationY(0) .setInterpolator(INTERPOLATOR).withLayer().setListener(null) .start(); &#125; else &#123; &#125; &#125; private int getMarginBottom(View v) &#123; int marginBottom = 0; final ViewGroup.LayoutParams layoutParams = v.getLayoutParams(); if (layoutParams instanceof ViewGroup.MarginLayoutParams) &#123; marginBottom = ((ViewGroup.MarginLayoutParams) layoutParams).bottomMargin; &#125; return marginBottom; &#125; æœ€åå®ç°çš„æ•ˆæœï¼š è¿™é‡Œéƒ¨åˆ†å‚è€ƒäº†ä»¿çŸ¥ä¹FloatingActionButtonæµ®åŠ¨æŒ‰é’®åŠ¨ç”»æ•ˆæœå®ç° è‡³äºFABå¼¹å‡ºçš„InBoxè¿™é‡Œå°±ä¸å»å®ç°äº†ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œå¯ä»¥å‚è€ƒç¬¬ä¸‰æ–¹çš„å®ç°ï¼š FloatingActionButtonPlus å†™åœ¨æœ«å°¾ä¸»è¦å‚è€ƒï¼šæµ®åŠ¨æ“ä½œæŒ‰é’®çš„é€‰æ‹©FloatingActionButton.Behaviorcodepathæ•™ç¨‹ï¼šæµ®åŠ¨æ“ä½œæŒ‰é’®è¯¦è§£Design Support Library (II): Floating Action ButtonCoordinatorLayouté«˜çº§ç”¨æ³•-è‡ªå®šä¹‰Behavior é¡¹ç›®æºä»£ç GitHubåœ°å€ å†™æ–‡ç« ä¸å®¹æ˜“ï¼Œå¦‚æœå¯ä»¥çš„è¯è¯·ç»™ä¸ªèµ","tags":[{"name":"Material Design","slug":"Material-Design","permalink":"https://www.limuyang.cc/tags/Material-Design/"},{"name":"Google","slug":"Google","permalink":"https://www.limuyang.cc/tags/Google/"},{"name":"FloatingActionButton","slug":"FloatingActionButton","permalink":"https://www.limuyang.cc/tags/FloatingActionButton/"}]},{"title":"Android Design Support Library--ç®€çº¦è€Œä¸ç®€å•çš„SnackBar","date":"2016-05-07T20:15:16.000Z","path":"2016/05/07/Android-Design-Support-Library-ç®€çº¦è€Œä¸ç®€å•çš„SnackBar/","text":"å¼•è¨€åœ¨ä¹‹å‰æˆ‘æœ‰æåˆ°è¿™ä¸€ç¯‡Android Design Support Libraryç³»åˆ—æ–‡ç« æ˜¯å…³äºSnackBarçš„ï¼Œä½†æ˜¯ç”±äºè¦ç”¨åˆ°CoordinatorLayoutæ‰€ä»¥å…ˆç¿»è¯‘äº†ä¸€ç¯‡ç›¸å…³æ–‡ç« ï¼Œå¦‚æœè¿˜ä¸äº†è§£çš„å¯ä»¥å…ˆçœ‹ä¸€ä¸‹Android Design Support Libraryâ€“ä½¿ç”¨CoordinatorLayoutæ¥å¤„ç†æ»šåŠ¨ ï¼Œè¿™ä¸€ç¯‡æˆ‘ä»¬è®²SnackBarï¼ŒSnackBarå…¶å®å°±æ˜¯Toastçš„å‡çº§ç‰ˆï¼Œä»–ä»¬ä¹‹é—´æœ€å¤§çš„ä¸åŒå°±æ˜¯ï¼šSnackBarä¼šå¯¹æˆ‘ä»¬çš„æ“ä½œæä¾›ä¸€ä¸ªè½»é‡çº§çš„åé¦ˆï¼Œå¹¶ä¸”å¯ä»¥å¯¹ç‚¹å‡»äº‹ä»¶åšå‡ºå“åº”ï¼Œå¦‚æœæ˜¯åœ¨æ‰‹æœºä¸Šä½¿ç”¨ä¸€ä¸ªSnackBarçš„è¯ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°åœ¨å±å¹•åº•éƒ¨å‡ºç°ä¸€æ¡ç®€çŸ­çš„ä¿¡æ¯ï¼Œå¦‚æœæ˜¯åœ¨æ›´å¤§çš„å±å¹•ä¸Šè¿™æ¡ä¿¡æ¯åº”è¯¥ä¼šæ˜¾ç¤ºåœ¨å·¦ä¸‹è§’ï¼Œå¹¶ä¸”å½“ä¸€ä¸ªSnackBaræ˜¾ç¤ºçš„æ—¶å€™å®ƒæ˜¯å‡Œé©¾äºå½“å‰æ‰€æœ‰å±å¹•å…ƒç´ ä¹‹ä¸Šçš„ï¼Œæˆ‘ä»¬åœ¨å±å¹•ä¸Šä¸€æ¬¡åªèƒ½æ˜¾ç¤ºä¸€ä¸ªSnackBarï¼Œå¦‚æœè¿™ä¹ˆè®²ä¸æ˜¯å¾ˆæ¸…æ¥šçš„è¯ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªå°Demoï¼Œé€šè¿‡ä»£ç é©±åŠ¨ç†è§£æ˜¯æ¯”è¾ƒå¥½çš„æ–¹å¼ã€‚ ç¤ºä¾‹æ ¹æ®SnackBarçš„ç‰¹ç‚¹ï¼Œåœ¨å±å¹•ä¸Šæ˜¾ç¤ºå‡ºä¸åŒçš„SnackBarï¼Œæ•ˆæœå¦‚ä¸‹ï¼š å…ˆçœ‹ä¸€ä¸‹ç›¸å…³çš„APIæ–‡æ¡£ï¼š æ–¹æ³•ç±»å‹ æ–¹æ³• ä½œç”¨ void dismiss() ä½¿SnackBaræ¶ˆå¤± int getDuration() è¿”å›SnackBarçš„æŒç»­æ—¶é—´ View getView() è¿”å›å½“å‰SnackBarçš„View boolean isShown() åˆ¤æ–­è¯¥SnackBaræ˜¯å¦æ­£åœ¨æ˜¾ç¤º boolean isShownOrQueued() åˆ¤æ–­è¯¥SnackBaræ˜¯å¦æ­£åœ¨æ˜¾ç¤ºæˆ–è€…æ’é˜Ÿç­‰å¾…å³å°†è¦æ˜¾ç¤º static Snackbar make(View view, int resId, int duration) æ–°å»ºä¸€ä¸ªç”¨æ¥æ˜¾ç¤ºä¿¡æ¯çš„SnackBar static Snackbar make(View view, CharSequence text, int duration) åŒä¸Š Snackbar setAction(int resId, View.OnClickListener listener) è®¾ç½®è¿™ä¸ªå³å°†æ˜¾ç¤ºçš„SnackBarçš„åŠ¨ä½œ Snackbar setAction(CharSequence text, View.OnClickListener listener) åŒä¸Š Snackbar setActionTextColor(ColorStateList colors) è®¾ç½®actionçš„æ–‡å­—é¢œè‰²(å³è¾¹çš„) Snackbar setActionTextColor(int color) åŒä¸Š Snackbar setCallback(Snackbar.Callback callback) è®¾ç½®ä¸€ä¸ªå›è°ƒï¼Œå½“SnackBarçš„å¯è§æ€§æ”¹å˜çš„æ—¶å€™è°ƒç”¨ Snackbar setDuration(int duration) è®¾ç½®SnackBarä¿¡æ¯çš„æ˜¾ç¤ºæ—¶é—´ Snackbar setText(int resId) æ›´æ–°SnackBarä¸Šæ˜¾ç¤ºçš„æ–‡å­— Snackbar setText(CharSequence message) åŒä¸Š void show() æ˜¾ç¤ºSnackBarï¼Œæœ€åä¸€å®šè¦è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œä¸ç„¶SnackBarä¸æ˜¾ç¤ºï¼Œè”æƒ³Toast å¯ä»¥çœ‹åˆ°Demoä¸Šæ˜¾ç¤ºäº†ä¸‰ç§ä¸åŒçš„SnackBarï¼Œæˆ‘ä»¬éƒ½çŸ¥é“SnackBaræ˜¯Toastçš„å‡çº§ç‰ˆï¼Œä½†ä¹Ÿè¯´æ˜äº†ä¸€ä¸ªé—®é¢˜é‚£å°±æ˜¯SnackBaræ˜¯ç”¨æ¥æ˜¾ç¤ºæ¶ˆæ¯çš„ï¼ŒåŒæ—¶æ ¹æ®ä½ çš„éœ€æ±‚ä¸åŒå¯ä»¥å¯¹è¿™äº›æ¶ˆæ¯åšå‡ºä¸€å®šçš„å“åº”åŠ¨ä½œï¼Œä¸‹é¢åˆ†æä¸‰ç§æ˜¾ç¤ºæ¶ˆæ¯æ–¹å¼çš„ä¸åŒï¼š æ™®é€šçš„SnackBar ä¹Ÿè®¸æœ‰çš„äººå¹¶æ²¡æœ‰è¿‡å¤šçš„éœ€æ±‚ï¼Œåªæ˜¯å•çº¯åœ°æƒ³æŠŠSnackBarå½“ä½œä¸€ä¸ªæ˜¾ç¤ºæ¶ˆæ¯çš„æ§ä»¶è€Œå·²ï¼Œé‚£ä¹ˆå¯ä»¥å¾ˆç®€å•çš„åœ¨ä»£ç ä¸­è¿™ä¹ˆä½¿ç”¨ï¼š 1Snackbar.make(mCoor, R.string.normal, Snackbar.LENGTH_SHORT).show(); å¯¹æ¯”ä¸€ä¸‹æˆ‘ä»¬çš„Toastæ–¹å¼ï¼š 1Toast.makeText(MainActivity.this,R.string.normal,Toast.LENGTH_SHORT).show(); æ˜¯ä¸æ˜¯å¾ˆåƒï¼Œæ²¡é”™ç®€å•çš„ä½¿ç”¨çš„è¯SnackBarè·ŸToastå¹¶æ²¡æœ‰å¤šå¤§åŒºåˆ«ï¼Œä½†æ˜¯åŠ¨ç”»æ•ˆæœä¸Šæ˜¯æœ‰å·®å¼‚çš„ï¼Œå¦‚æœä½ æ³¨æ„åˆ°äº†è¿™ä¸€ç‚¹ï¼š çœ‹ï¼Œè¿™ä¸ªä¾§è¾¹æ»‘åŠ¨æ¶ˆå¤±çš„æ•ˆæœåªæœ‰å½“ä½ ä½¿ç”¨CoordinatorLayoutä½œä¸ºæ ¹å¸ƒå±€æ‰æœ‰ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨å†™SnackBarä¹‹å‰æˆ‘è¦å…ˆè¯´æ˜ä¸€ä¸‹CoordinatorLayoutçš„åŸå› ï¼Œå¦‚æœä½ ä½¿ç”¨æ™®é€šçš„LinearLayoutæˆ–è€…RelativeLayoutæ˜¯ä¸ä¼šæœ‰è¿™ç§åŠ¨ç”»äº¤äº’æ•ˆæœçš„ï¼Œå¦å¤–ï¼Œæ³¨æ„SnackBarçš„makeæ–¹æ³•æœ‰ä¸¤ç§é‡è½½æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯ï¼š 1make(View view, int resId, int duration) å’Œ 1make(View view, CharSequence text, int duration) è¿™é‡Œæœ‰ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°Viewè¡¨ç¤ºçš„æ„æ€æ˜¯æˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªViewï¼Œç„¶åSnackBarä¼šéå†æ•´ä¸ªView Treeæ¥æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„Viewæ‰¿è½½SnackBarçš„Viewï¼Œå¦‚æœä½ æƒ³è¦å®ç°ä¸Šé¢çš„åŠ¨ç”»äº¤äº’æ•ˆæœçš„è¯æœ€å¥½æ˜¯ä¼ å…¥CoordinatorLayoutå¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°çš„è¯æ˜¯ä¸¤ä¸ªé‡è½½æ–¹æ³•ä¸åŒçš„åœ°æ–¹ï¼Œæœ‰ä¸€ç§æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„ï¼š 1Snackbar.make(mCoor, \"æ™®é€šçš„SnackBar\", Snackbar.LENGTH_SHORT).show(); è¿˜æœ‰ä¸€ç§è¦æ±‚ä¼ å…¥ä¸€ä¸ªIDï¼Œæ³¨æ„è¿™ä¸ªIDå¹¶ä¸æ˜¯æŒ‡å…¶ä»–çš„ä»€ä¹ˆï¼Œå°±æ˜¯ä½ åœ¨string.xmlæ–‡ä»¶ä¸­å®šä¹‰çš„å­—ç¬¦ä¸²èµ„æºçš„IDï¼Œæ¯”å¦‚è¿™æ ·ï¼š 1Snackbar.make(mCoor, R.string.normal, Snackbar.LENGTH_SHORT).show(); ç„¶åç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯SnackBarçš„æŒç»­æ—¶é—´ï¼Œåªæœ‰ä¸‰ç§ï¼š 1231ã€Snackbar.LENGTH_INDEFINITE ä¸€ç›´æ˜¾ç¤ºç›´åˆ°å¦ä¸€ä¸ªSnackBarå‡ºç°æˆ–è€…ä¸»åŠ¨è°ƒç”¨äº†dismiss()æ–¹æ³•2ã€Snackbar.LENGTH_SHORT æ˜¾ç¤ºè¾ƒçŸ­çš„æ—¶é—´3ã€Snackbar.LENGTH_LONG æ˜¾ç¤ºè¾ƒé•¿çš„æ—¶é—´ ä½†æ˜¯å®˜æ–¹æ–‡æ¡£æ˜¯è¿™ä¹ˆæè¿°çš„ï¼š 1either be one of the predefined lengths: LENGTH_SHORT, LENGTH_LONG, or a custom duration in milliseconds. è¯´æ˜¯å¯ä»¥è‡ªå®šä¹‰æ˜¾ç¤ºæ—¶é—´ï¼Œä½†æ˜¯æˆ‘è‡ªå·±è¯•äº†ç¡®å®ä¸å¯ä»¥ï¼Œåº”è¯¥æ˜¯APIæ–‡æ¡£çš„ä¸€ä¸ªå°bugï¼Œå¦‚æœè°è¯•æˆåŠŸäº†èµ¶ç´§å‘Šè¯‰æˆ‘~~å¦‚æœä½¿ç”¨è¿‡Toastçš„è¯ä¸Šé¢çš„åº”è¯¥å¾ˆå¥½ç†è§£ï¼Œå¥½äº†ï¼Œå¦‚æœä½ çš„ä¸šåŠ¡ä¸­å¯¹SnackBarå¹¶æ²¡æœ‰æ›´å¤šçš„è¦æ±‚ï¼Œé‚£ä¹ˆæœ€æ™®é€šçš„SnackBaråº”è¯¥æ»¡è¶³äº†ï¼Œæ¥ä¸‹æ¥çœ‹ç¨å¾®é«˜çº§ä¸€ç‚¹çš„ï¼š å¸¦å›è°ƒçš„SnackBarï¼š å¦‚æœè¿˜ä¸å¤ªæ¸…æ¥šå›è°ƒçš„è¯å¯ä»¥çœ‹çœ‹è¿™ä¸ªAndroidå›è°ƒå‡½æ•°æœºåˆ¶é‚£ç‚¹äº‹ ï¼Œè®²è¿™ä¸ªä¹‹å‰å…ˆæä¸€ç‚¹ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æ›´åŠ çµæ´»çš„ä½¿ç”¨Snackbarçš„è¯æœ€å¥½æ˜¯å…ˆæŒæœ‰å®ƒçš„å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯ï¼š 1private Snackbar mSnackBar åŸå› å¾ˆç®€å•ï¼Œä½ ä¼šå‘ç°ä¸Šé¢æä¾›çš„å¸¸ç”¨APIä¸­å¾ˆå¤šæ–¹æ³•éƒ½æ˜¯éé™æ€æ–¹æ³•å¹¶ä¸æ˜¯é™æ€æ–¹æ³•ï¼Œä½ è¦è°ƒç”¨çš„è¯åªèƒ½é€šè¿‡SnackBarå¯¹è±¡å»è°ƒç”¨ã€‚ ç„¶åè¯´SnackBarå›è°ƒä¹‹å‰å…ˆè¯´ä¸€ä¸‹Actionï¼ŒSnackBaræä¾›äº†ä¸€ä¸ªsetActionæ–¹æ³•ï¼š 121ã€setAction(int resId, View.OnClickListener listener)2ã€setAction(CharSequence text, View.OnClickListener listener) åŒæ ·æ˜¯ä¸¤ä¸ªé‡è½½æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è·Ÿå‰é¢è§£é‡Šçš„ä¸€æ ·ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„å¯¹ç‚¹å‡»äº‹ä»¶çš„ç›‘å¬ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š 1234567Snackbar.make(mCoor,R.string.callback,Snackbar.LENGTH_SHORT) .setAction(R.string.UNDO, new View.OnClickListener() &#123; @Override public void onClick(View v) &#123; // do something &#125; &#125;).show(); çœ‹ä¸€ä¸‹æ•ˆæœï¼š å½“æˆ‘ä»¬è°ƒç”¨äº†setActionæ–¹æ³•å¹¶ä¸”ä¼ å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ä¹‹åï¼ŒSnackBarçš„å³ä¸‹è§’å°±ä¼šå‘ˆç°å‡ºæˆ‘ä»¬ä¼ å…¥çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”è¿™ä¸ªå­—ç¬¦ä¸²æ˜¯å¯ç‚¹å‡»çš„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç‚¹å‡»äº‹ä»¶é‡Œé¢åšå‡ºå“åº”ï¼Œæ¯”å¦‚è¯´è·³è½¬Activityæˆ–è€…å¼¹å‡ºä¸€ä¸ªToastç­‰ç­‰ï¼Œè¿™é‡Œé»˜è®¤ä½ ç‚¹å‡»äº†è¿™ä¸ªActionè¿™ä¸ªSnackBaræ˜¯ä¼šæ¶ˆå¤±çš„ã€‚ä¹Ÿå°±æ˜¯æ— è®ºä½ çš„durationå‚æ•°è®¾ç½®çš„æ˜¯ä¸€ç›´æ˜¾ç¤ºè¿˜æ˜¯æ˜¾ç¤ºå¤šé•¿æ—¶é—´éƒ½ä¼šæ¶ˆå¤±ã€‚ æœ‰äº›äººå¯èƒ½å¯¹å³ä¸‹è§’è¿™ä¸ªæ–‡å­—çš„é¢œè‰²ä¸æ»¡è¶³æƒ³è¦æ”¹å˜ï¼Œæ²¡é—®é¢˜ï¼Œä½ æƒ³åˆ°çš„Googleéƒ½ç»™ä½ æƒ³å¥½äº†ï¼ŒSnackBarä¸“é—¨æä¾›äº†æ–¹æ³•æ¥æ›´æ”¹Actionçš„æ–‡å­—é¢œè‰²: 121ã€setActionTextColor(ColorStateList colors)2ã€setActionTextColor(int color) è¿™é‡Œç¬¬ä¸€ç§æ–¹å¼ä¸å»ºè®®ç”¨ï¼Œå¤ªå¤æ‚ï¼Œä½ è¦æƒ³è¿™ä¹ˆç”¨ä¹Ÿè¡Œï¼š 123Resources resource = (Resources) getBaseContext().getResources(); ColorStateList csl = (ColorStateList) resource.getColorStateList(R.color.PeachPuff); mSnackBar.setActionTextColor(csl); è¿™æ˜¯ç½‘ä¸Šæ‰¾åˆ°çš„ä¸€ç§æ–¹å¼ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯æ¨èä½¿ç”¨ç¬¬äºŒç§æ–¹å¼æ¥æ›´æ”¹Actionçš„æ–‡å­—é¢œè‰²ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„ä¼ å…¥ä¸€ä¸ªintå‹çš„å€¼ï¼Œæˆ‘æä¾›å¦‚ä¸‹å‡ ç§æ–¹å¼æ›´æ”¹ï¼š 1231ã€mSnackBar.setActionTextColor(Color.rgb(232,44,123))2ã€mSnackBar.setActionTextColor(Color.BLUE)3ã€mSnackBar.setActionTextColor(Color.parseColor(&quot;#FFDAB9&quot;)); å¯¹äº†ï¼Œæˆ‘è¿˜å‘ç°ä¸€ç§é¢å¤–çš„æ–¹å¼ï¼Œæˆ‘ä»¬ç°åœ¨ä½¿ç”¨Android Studioåˆ›å»ºæ–°çš„Projectæ—¶å€™ç³»ç»Ÿéƒ½ä¼šé»˜è®¤åœ¨style.xmlæ–‡ä»¶å¤¹ä¸‹é¢ç”Ÿæˆè¿™ä¸ªï¼š 123456&lt;style name=\"AppTheme\" parent=\"Theme.AppCompat.Light.DarkActionBar\"&gt; &lt;!-- Customize your theme here. --&gt; &lt;item name=\"colorPrimary\"&gt;@color/colorPrimary&lt;/item&gt; &lt;item name=\"colorPrimaryDark\"&gt;@color/colorPrimaryDark&lt;/item&gt; &lt;item name=\"colorAccent\"&gt;@color/colorAccent&lt;/item&gt; &lt;/style&gt; è¿™é‡Œçš„ 1&lt;item name=&quot;colorAccent&quot;&gt;@color/colorAccent&lt;/item&gt; å…¶å®ä¹Ÿå¯ä»¥æ›´æ”¹Actionæ–‡å­—é¢œè‰²ï¼Œè€Œä¸”é»˜è®¤çš„Actionæ–‡å­—é¢œè‰²å°±æ˜¯è¿™é‡Œè®¾ç½®çš„é¢œè‰²ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªç¼ºç‚¹å°±æ˜¯å¦‚æœä½ æ”¹åŠ¨äº†è¿™é‡Œï¼Œé‚£ä¹ˆå¾ˆå¤šMaterial Designæ§ä»¶çš„ç›¸å…³é¢œè‰²éƒ½ä¼šæ”¹å˜ï¼Œå¦‚æœä½ çœ‹è¿‡æˆ‘ä¹‹å‰å†™çš„Android Design Support Libraryâ€“TextInputLayoutçš„ä½¿ç”¨ä½ ä¼šçŸ¥é“TextInputLayoutä¸‹åˆ’çº¿çš„é¢œè‰²ä¹Ÿæ˜¯é€šè¿‡è¿™ä¸ªå±æ€§æ¥æ›´æ”¹çš„ï¼Œæ‰€ä»¥ä¸ºäº†ç¨³å®šèµ·è§è¿˜æ˜¯ä½¿ç”¨å®˜æ–¹æä¾›çš„æ–¹æ³•å»æ›´æ”¹å§ï¼Œæˆ‘è¿™çº¯å±æŠ–ä¸ªæœºçµã€‚ é‚£ä¹ˆå›åˆ°æ­£é¢˜ï¼Œè®²è®²SnackBarçš„å›è°ƒï¼Œçœ¼å°–çš„æœ‹å‹å¯èƒ½å‘ç°äº†ï¼Œæˆ‘çš„Demoé‡Œé¢å¸¦å›è°ƒçš„SnackBaråœ¨å¼¹å‡ºå’Œæ¶ˆå¤±çš„æ—¶å€™éƒ½ä¼šæœ‰Toasté€šçŸ¥å‡ºç°ï¼Œå…¶å®å°±æ˜¯ä½¿ç”¨äº†SnackBarè‡ªå¸¦çš„ 1setCallback(Snackbar.Callback callback) æ–¹æ³•ï¼Œè¿™é‡Œéœ€è¦ä¼ å…¥ä¸€ä¸ªSnackbar.Callback callback å‚æ•°ï¼Œå…¶å®è¿™ä¸ªï¼Œè¿™ä¸ªCallback æ˜¯SnackBarå†…éƒ¨çš„ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒå†…éƒ¨æœ‰ä¸¤ä¸ªç©ºå®ç°çš„æ–¹æ³•ï¼š 123onDismissed(Snackbar snackbar, int event)onShown(Snackbar snackbar) é¡¾åæ€ä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥å¯ä»¥åˆ†åˆ«åœ¨è¿™ä¸¤ä¸ªæ–¹æ³•ä¸­å®šä¹‰å‡ºå½“SnackBaræ¶ˆå¤±å’Œäº§ç”Ÿæ—¶æˆ‘ä»¬éœ€è¦åšçš„äº‹ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•ä¼šåœ¨SnackBaræ¶ˆå¤±å’Œäº§ç”Ÿæ—¶è¢«å›è°ƒï¼Œæ‰“ä¸ªæ¯”æ–¹ï¼š 12345678910111213mSnackBar.setCallback(new Snackbar.Callback() &#123; @Override public void onDismissed(Snackbar snackbar, int event) &#123; super.onDismissed(snackbar, event); Toast.makeText(MainActivity.this,\"SnackBar Dismiss\",Toast.LENGTH_SHORT).show(); &#125; @Override public void onShown(Snackbar snackbar) &#123; super.onShown(snackbar); Toast.makeText(MainActivity.this,\"SnackBar Show\",Toast.LENGTH_SHORT).show(); &#125; &#125;); è¿™æ ·å°±å®ç°äº†åœ¨SnackBaræ¶ˆå¤±å’Œäº§ç”Ÿæ—¶å¼¹å‡ºToasté€šçŸ¥çš„åŠ¨ä½œï¼Œå…¶ä»–å…·ä½“çš„é€»è¾‘å¯ä»¥è‡ªå·±å»å®ç°ã€‚ å®Œå…¨è‡ªå®šä¹‰ä½ è‡ªå·±çš„SnackBarå¦‚æœä½ å¯¹ä¸Šè¿°ä½¿ç”¨è¿˜æ˜¯ä¸ç”šæ»¡æ„ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘æ•™ä½ æ€ä¹ˆè‡ªå®šä¹‰ä½ è‡ªå·±çš„SnackBarï¼Œè¯´å®è¯ç”¨åˆ°çš„åœºæ™¯å¹¶ä¸å¤šï¼Œä½†æ˜¯å­¦äº†å°±å­¦ä¸ªé€å½»ï¼Œè¿™ä¸€éƒ¨åˆ†çŸ¥è¯†çš„çµæ„Ÿæ¥è‡ªäºæ²¡æ—¶é—´è§£é‡Šäº†ï¼Œå¿«ä½¿ç”¨Snackbar! ï¼ŒSnackBarå¹¶æ²¡æœ‰æä¾›æ›´æ”¹èƒŒæ™¯æˆ–è€…å…¶ä»–æ ·å¼çš„æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹æºç æ¥è¯•è¯•å¯ä¸å¯ä»¥è‡ªå®šä¹‰è‡ªå·±æ ·å¼ï¼Œæˆ‘ä»¬æ‰¾åˆ°è¿™ä¹ˆä¸€æ®µä»£ç ï¼š 12345678910private Snackbar(ViewGroup parent) &#123; mTargetParent = parent; mContext = parent.getContext(); ThemeUtils.checkAppCompatTheme(mContext); LayoutInflater inflater = LayoutInflater.from(mContext); mView = (SnackbarLayout) inflater.inflate( R.layout.design_layout_snackbar, mTargetParent, false);&#125; æœ€åä¸€è¡Œçš„inflateæ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œæˆ‘ä»¬å¯ä¸å¯ä»¥è®¤ä¸ºSnackbarçš„å¸ƒå±€å°±æ˜¯è¿™ä¹ˆåŠ è½½çš„ï¼Œè¿™ä¸ªSnackBarLayoutæ˜¯åœ¨SnackBarå†…éƒ¨å®šä¹‰çš„ä¸€ä¸ªç»§æ‰¿è‡ªLinearLayoutçš„å†…éƒ¨ç±»ï¼š 123456public static class SnackbarLayout extends LinearLayout &#123; private TextView mMessageView; private Button mActionView; private int mMaxWidth; private int mMaxInlineActionWidth; çœ‹åˆ°è¿™å‡ ä¸ªå˜é‡çš„å®šä¹‰ï¼Œæˆ‘å·²ç»ç¡®å®šäº†ä¸Šé¢çš„æƒ³æ³•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ‰¾åˆ°ä¸Šé¢ä»£ç åŠ è½½çš„é‚£æ®µå¸ƒå±€ï¼š 12345678910111213141516171819202122232425262728293031&lt;merge xmlns:android=\"http://schemas.android.com/apk/res/android\"&gt;&lt;TextView android:id=\"@+id/snackbar_text\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:layout_weight=\"1\" android:paddingTop=\"14dp\" android:paddingBottom=\"14dp\" android:paddingLeft=\"12dp\" android:paddingRight=\"12dp\" android:textAppearance=\"@style/TextAppearance.Design.Snackbar.Message\" android:maxLines=\"2\" android:layout_gravity=\"center_vertical|left|start\" android:ellipsize=\"end\" android:textAlignment=\"viewStart\"/&gt;&lt;Button android:id=\"@+id/snackbar_action\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:layout_marginLeft=\"0dp\" android:layout_marginStart=\"0dp\" android:layout_gravity=\"center_vertical|right|end\" android:paddingTop=\"14dp\" android:paddingBottom=\"14dp\" android:paddingLeft=\"12dp\" android:paddingRight=\"12dp\" android:visibility=\"gone\" android:textColor=\"?attr/colorAccent\" style=\"?attr/borderlessButtonStyle\"/&gt;&lt;/merge&gt; çœ‹åˆ°è¿™ä¸¤ä¸ªæ§ä»¶çš„IDäº†ä¹ˆ 12android:id=\"@+id/snackbar_text\"android:id=\"@+id/snackbar_action\" é‚£ä¹ˆç¬¬ä¸€ä¸ªå°±æ˜¯SnackBarå·¦è¾¹æ˜¾ç¤ºçš„messageï¼Œç¬¬äºŒä¸ªå°±æ˜¯æˆ‘ä»¬è®¾ç½®äº†actionæ—¶å€™æ˜¾ç¤ºçš„Buttonå’¯ï¼Œè¿™å°±ç®€å•äº†ï¼Œå¦‚æœä½ ä»”ç»†çœ‹äº†ä¸Šé¢æä¾›çš„APIæ–‡æ¡£ä½ ä¼šå‘ç°æœ‰è¿™ä¹ˆä¸€ä¸ªæ–¹æ³•ï¼š 123public View getView ()Returns the Snackbar's view. è¿™ä¸ªæ–¹æ³•å¯ä»¥è¿”å›æˆ‘ä»¬SnackBarçš„Viewï¼Œé‚£ä¹ˆè¿™ä¸ªViewæ˜¯ä»€ä¹ˆï¼Œçœ‹æºç ï¼š 1234567/** * Returns the &#123;@link Snackbar&#125;'s view. */@NonNullpublic View getView() &#123; return mView;&#125; æ‰¾ä¸€ä¸‹mViewåœ¨å“ªé‡Œå®šä¹‰çš„ï¼š 123private final SnackbarLayout mView;mView = (SnackbarLayout) inflater.inflate( R.layout.design_layout_snackbar, mTargetParent, false); å¥½äº†ï¼Œè¿™ä¸‹ä¸€åˆ‡éƒ½æ¸…æ¥šäº†ï¼Œæ¥ä¸‹é‡Œç¤ºèŒƒä¸€ä¸‹æ€ä¹ˆè‡ªå®šä¹‰ä½ è‡ªå·±çš„SnackBarï¼š 12345678910111213141516171819private View view; ....çœç•¥ä¸­é—´ä»£ç  view = mCustomSnackBar.getView(); if (view != null) &#123; view.setBackgroundColor(Color.parseColor(\"#7B68EE\")); //è·å–Snackbarçš„messageæ§ä»¶ï¼Œä¿®æ”¹å­—ä½“é¢œè‰² ((TextView) view.findViewById(R.id.snackbar_text)).setTextColor(Color.parseColor(\"#FFDAB9\")); //æ·»åŠ å›¾æ ‡ Snackbar.SnackbarLayout snackbarLayout = (Snackbar.SnackbarLayout) view; //æ·»åŠ è‡ªå®šä¹‰å¸ƒå±€ï¼Œè¿™é‡Œå¸ƒå±€å°±åŒ…å«äº†ä¸€ä¸ªImageView //custom_layoutæ˜¯ä½ è‡ªå®šä¹‰çš„å¸ƒå±€ View add_view = LayoutInflater.from(view.getContext()).inflate(R.layout.custom_layout, null); LinearLayout.LayoutParams p = new LinearLayout.LayoutParams(LinearLayout.LayoutParams.WRAP_CONTENT, LinearLayout.LayoutParams.WRAP_CONTENT); p.gravity = Gravity.CENTER_VERTICAL; //æ•°å­—è¡¨ç¤ºæ–°åŠ çš„å¸ƒå±€åœ¨SnackBarä¸­çš„ä½ç½®ï¼Œä»0å¼€å§‹,å–å†³äºä½ SnackBaré‡Œé¢æœ‰å¤šå°‘ä¸ªå­View snackbarLayout.addView(add_view, 0, p); &#125; æœ€åä¸€è¡Œï¼ŒaddViewæ–¹æ³•ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæ–°åŠ çš„å¸ƒå±€åœ¨SnackBarä¸­çš„ä½ç½®ï¼Œæ³¨æ„ä¸è¦è¶…è¿‡æ€»çš„Viewçš„ä¸ªæ•°ä¸ç„¶ä¼šæŠ¥é”™ï¼Œmessageå’ŒAction textåˆ†åˆ«ç®—ä¸€ä¸ªViewï¼Œå…¶ä»–çš„è¯æ³¨é‡Šå·²ç»å†™å¾—å¾ˆæ¸…æ¥šå°±ä¸ä¸€ä¸€è§£é‡Šäº†ï¼Œè¿™ä¸ªä»£ç å‘ˆç°çš„æ•ˆæœå¦‚ä¸‹ï¼š ä¸ºäº†æ–¹ä¾¿è‡ªå®šä¹‰æ ·å¼ï¼Œå‘ç°è¿™ä¸€ç‰¹æ€§çš„ä½œè€…è¿˜ç»™æˆ‘ä»¬å°è£…äº†æˆä¸ºä¸€ä¸ªå·¥å…·ç±»ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160/** * Created by èµµæ™¨ç’ on 2016/5/1. */public class SnackbarUtil &#123;public static final int Info = 1;public static final int Confirm = 2;public static final int Warning = 3;public static final int Alert = 4;public static int red = 0xfff44336;public static int green = 0xff4caf50;public static int blue = 0xff2195f3;public static int orange = 0xffffc107;/** * çŸ­æ˜¾ç¤ºSnackbarï¼Œè‡ªå®šä¹‰é¢œè‰² * @param view * @param message * @param messageColor * @param backgroundColor * @return */public static Snackbar ShortSnackbar(View view, String message, int messageColor, int backgroundColor)&#123; Snackbar snackbar = Snackbar.make(view,message, Snackbar.LENGTH_SHORT); setSnackbarColor(snackbar,messageColor,backgroundColor); return snackbar;&#125;/** * é•¿æ˜¾ç¤ºSnackbarï¼Œè‡ªå®šä¹‰é¢œè‰² * @param view * @param message * @param messageColor * @param backgroundColor * @return */public static Snackbar LongSnackbar(View view, String message, int messageColor, int backgroundColor)&#123; Snackbar snackbar = Snackbar.make(view,message, Snackbar.LENGTH_LONG); setSnackbarColor(snackbar,messageColor,backgroundColor); return snackbar;&#125;/** * è‡ªå®šä¹‰æ—¶å¸¸æ˜¾ç¤ºSnackbarï¼Œè‡ªå®šä¹‰é¢œè‰² * @param view * @param message * @param messageColor * @param backgroundColor * @return */public static Snackbar IndefiniteSnackbar(View view, String message,int duration,int messageColor, int backgroundColor)&#123; Snackbar snackbar = Snackbar.make(view,message, Snackbar.LENGTH_INDEFINITE).setDuration(duration); setSnackbarColor(snackbar,messageColor,backgroundColor); return snackbar;&#125;/** * çŸ­æ˜¾ç¤ºSnackbarï¼Œå¯é€‰é¢„è®¾ç±»å‹ * @param view * @param message * @param type * @return */public static Snackbar ShortSnackbar(View view, String message, int type)&#123; Snackbar snackbar = Snackbar.make(view,message, Snackbar.LENGTH_SHORT); switchType(snackbar,type); return snackbar;&#125;/** * é•¿æ˜¾ç¤ºSnackbarï¼Œå¯é€‰é¢„è®¾ç±»å‹ * @param view * @param message * @param type * @return */public static Snackbar LongSnackbar(View view, String message,int type)&#123; Snackbar snackbar = Snackbar.make(view,message, Snackbar.LENGTH_LONG); switchType(snackbar,type); return snackbar;&#125;/** * è‡ªå®šä¹‰æ—¶å¸¸æ˜¾ç¤ºSnackbarï¼Œå¯é€‰é¢„è®¾ç±»å‹ * @param view * @param message * @param type * @return */public static Snackbar IndefiniteSnackbar(View view, String message,int duration,int type)&#123; Snackbar snackbar = Snackbar.make(view,message, Snackbar.LENGTH_INDEFINITE).setDuration(duration); switchType(snackbar,type); return snackbar;&#125;//é€‰æ‹©é¢„è®¾ç±»å‹private static void switchType(Snackbar snackbar,int type)&#123; switch (type)&#123; case Info: setSnackbarColor(snackbar,blue); break; case Confirm: setSnackbarColor(snackbar,green); break; case Warning: setSnackbarColor(snackbar,orange); break; case Alert: setSnackbarColor(snackbar,Color.YELLOW,red); break; &#125;&#125;/** * è®¾ç½®SnackbarèƒŒæ™¯é¢œè‰² * @param snackbar * @param backgroundColor */public static void setSnackbarColor(Snackbar snackbar, int backgroundColor) &#123; View view = snackbar.getView(); if(view!=null)&#123; view.setBackgroundColor(backgroundColor); &#125;&#125;/** * è®¾ç½®Snackbaræ–‡å­—å’ŒèƒŒæ™¯é¢œè‰² * @param snackbar * @param messageColor * @param backgroundColor */public static void setSnackbarColor(Snackbar snackbar, int messageColor, int backgroundColor) &#123; View view = snackbar.getView(); if(view!=null)&#123; view.setBackgroundColor(backgroundColor); ((TextView) view.findViewById(R.id.snackbar_text)).setTextColor(messageColor); &#125;&#125;/** * å‘Snackbarä¸­æ·»åŠ view * @param snackbar * @param layoutId * @param index æ–°åŠ å¸ƒå±€åœ¨Snackbarä¸­çš„ä½ç½® */public static void SnackbarAddView( Snackbar snackbar,int layoutId,int index) &#123; View snackbarview = snackbar.getView(); Snackbar.SnackbarLayout snackbarLayout=(Snackbar.SnackbarLayout)snackbarview; View add_view = LayoutInflater.from(snackbarview.getContext()).inflate(layoutId,null); LinearLayout.LayoutParams p = new LinearLayout.LayoutParams( LinearLayout.LayoutParams.WRAP_CONTENT,LinearLayout.LayoutParams.WRAP_CONTENT); p.gravity= Gravity.CENTER_VERTICAL; snackbarLayout.addView(add_view,index,p);&#125;&#125; ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š 1SnackbarUtil.ShortSnackbar(coordinator,\"å¦¹å­å‘ä½ å‘æ¥ä¸€æ¡æ¶ˆæ¯\",SnackbarUtil.Info).show(); åœ¨æ­¤è¦éå¸¸æ„Ÿè°¢ç®€å ç»™æˆ‘ä»¬æä¾›è¿™ä¹ˆå¥½çš„å·¥å…·ç±»ï¼Œé‚£ä¹ˆè¿˜æœ‰ä»€ä¹ˆä¸æ‡‚å¾—å¯ä»¥ç•™è¨€æ¢è®¨ï¼Œä¸‹é¢ä¸Šæ•´ä¸ªé¡¹ç›®çš„ä»£ç ï¼š MainActivity.java123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120package com.muyang.snackbardemo;import android.graphics.Color;import android.os.Bundle;import android.support.design.widget.CoordinatorLayout;import android.support.design.widget.Snackbar;import android.support.v7.app.AppCompatActivity;import android.view.Gravity;import android.view.LayoutInflater;import android.view.View;import android.widget.Button;import android.widget.LinearLayout;import android.widget.TextView;import android.widget.Toast;public class MainActivity extends AppCompatActivity implements View.OnClickListener &#123; private Button btn_normal, btn_callback, btn_custom; private CoordinatorLayout mCoor; private Snackbar mSnackBar, mCustomSnackBar; private View view; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); initWidget(); mSnackBar = Snackbar.make(mCoor, R.string.callback, Snackbar.LENGTH_SHORT) .setAction(R.string.UNDO, new View.OnClickListener() &#123; @Override public void onClick(View v) &#123; &#125; &#125;); //SnackBarå›è°ƒæ–¹æ³• mSnackBar.setCallback(new Snackbar.Callback() &#123; @Override public void onDismissed(Snackbar snackbar, int event) &#123; super.onDismissed(snackbar, event); Toast.makeText(MainActivity.this,\"SnackBar Dismiss\",Toast.LENGTH_SHORT).show(); &#125; @Override public void onShown(Snackbar snackbar) &#123; super.onShown(snackbar); Toast.makeText(MainActivity.this,\"SnackBar Show\",Toast.LENGTH_SHORT).show(); &#125; &#125;);// 1ã€Resources resource = (Resources) getBaseContext().getResources();// ColorStateList csl = (ColorStateList) resource.getColorStateList(R.color.PeachPuff);// mSnackBar.setActionTextColor(csl);// 2ã€mSnackBar.setActionTextColor(Color.rgb(232,44,123))// 3ã€mSnackBar.setActionTextColor(Color.BLUE) mSnackBar.setActionTextColor(Color.parseColor(\"#FFDAB9\")); //è‡ªå®šä¹‰SnackBaræ ·å¼ mCustomSnackBar = Snackbar.make(mCoor, R.string.custom, Snackbar.LENGTH_SHORT) .setAction(R.string.UNDO, new View.OnClickListener() &#123; @Override public void onClick(View v) &#123; &#125; &#125;); mCustomSnackBar.setActionTextColor(Color.parseColor(\"#FFDAB9\")); //è·å¾—SnackBarè¿™ä¸ªView view = mCustomSnackBar.getView(); if (view != null) &#123; view.setBackgroundColor(Color.parseColor(\"#7B68EE\")); //è·å–Snackbarçš„messageæ§ä»¶ï¼Œä¿®æ”¹å­—ä½“é¢œè‰² ((TextView) view.findViewById(R.id.snackbar_text)).setTextColor(Color.parseColor(\"#FFDAB9\")); //æ·»åŠ å›¾æ ‡ Snackbar.SnackbarLayout snackbarLayout = (Snackbar.SnackbarLayout) view; //custom_layoutæ˜¯ä½ è‡ªå®šä¹‰çš„å¸ƒå±€ View add_view = LayoutInflater.from(view.getContext()).inflate(R.layout.custom_layout, null); LinearLayout.LayoutParams p = new LinearLayout.LayoutParams(LinearLayout.LayoutParams.WRAP_CONTENT, LinearLayout.LayoutParams.WRAP_CONTENT); p.gravity = Gravity.CENTER_VERTICAL; //æ•°å­—è¡¨ç¤ºæ–°åŠ çš„å¸ƒå±€åœ¨SnackBarä¸­çš„ä½ç½®ï¼Œä»0å¼€å§‹,å–å†³äºä½ SnackBaré‡Œé¢æœ‰å¤šå°‘ä¸ªå­View snackbarLayout.addView(add_view, 0, p); &#125; &#125; private void initWidget() &#123; btn_normal = (Button) findViewById(R.id.btn_normal); btn_normal.setOnClickListener(this); btn_callback = (Button) findViewById(R.id.btn_callback); btn_callback.setOnClickListener(this); btn_custom = (Button) findViewById(R.id.btn_custom); btn_custom.setOnClickListener(this); mCoor = (CoordinatorLayout) findViewById(R.id.coordinatorLayout); &#125; @Override public void onClick(View v) &#123; switch (v.getId()) &#123; case R.id.btn_normal: Snackbar.make(mCoor, R.string.normal, Snackbar.LENGTH_SHORT).show(); break; case R.id.btn_callback:// Snackbar.make(mCoor,R.string.callback,Snackbar.LENGTH_SHORT)// .setAction(R.string.UNDO, new View.OnClickListener() &#123;// @Override// public void onClick(View v) &#123;//// &#125;// &#125;).show(); mSnackBar.show(); break; case R.id.btn_custom: mCustomSnackBar.show();// if (mSnackBar.isShown()) &#123;// mSnackBar.dismiss();// &#125; break; &#125; &#125;&#125; activity_main.xml 123456789101112131415161718192021222324252627282930313233343536373839404142434445&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;android.support.design.widget.CoordinatorLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" android:id=\"@+id/coordinatorLayout\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\"&gt; &lt;RelativeLayout android:layout_width=\"match_parent\" android:layout_height=\"match_parent\"&gt; &lt;Button android:id=\"@+id/btn_normal\" android:layout_width=\"150dp\" android:layout_height=\"wrap_content\" android:layout_alignParentTop=\"true\" android:layout_centerHorizontal=\"true\" android:layout_marginTop=\"80dp\" android:background=\"@drawable/btn_bg\" android:text=\"@string/normal\" android:textSize=\"15sp\" /&gt; &lt;Button android:id=\"@+id/btn_callback\" android:layout_width=\"150dp\" android:layout_height=\"wrap_content\" android:layout_alignStart=\"@+id/btn_normal\" android:layout_below=\"@+id/btn_normal\" android:layout_marginTop=\"38dp\" android:background=\"@drawable/btn_bg\" android:text=\"@string/callback\" android:textSize=\"15sp\" /&gt; &lt;Button android:id=\"@+id/btn_custom\" android:layout_width=\"150dp\" android:layout_height=\"wrap_content\" android:layout_alignStart=\"@+id/btn_callback\" android:layout_below=\"@+id/btn_callback\" android:layout_marginTop=\"45dp\" android:background=\"@drawable/btn_bg\" android:text=\"@string/custom\" android:textSize=\"15sp\" /&gt; &lt;/RelativeLayout&gt;&lt;/android.support.design.widget.CoordinatorLayout&gt; custom_layout.xml 123456789101112&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot; android:layout_gravity=&quot;center_vertical&quot; &gt; &lt;ImageView android:layout_width=&quot;35dp&quot; android:layout_height=&quot;35dp&quot; android:layout_gravity=&quot;center_vertical&quot; android:src=&quot;@drawable/header&quot;/&gt;&lt;/LinearLayout&gt; å½©è›‹SnackBaræºç  é¡¹ç›®æºç é¡¹ç›®GitHubåœ°å€ å‚è€ƒæ²¡æ—¶é—´è§£é‡Šäº†ï¼Œå¿«ä½¿ç”¨Snackbar!Android Material Design Snackbar Example å–œæ¬¢Android Design Support Libraryç³»åˆ—çš„æœ‹å‹æ¬¢è¿å…³æ³¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·æœªå¤®è¿›åŒ–è®ºï¼Œç¬¬ä¸€æ—¶é—´é€šçŸ¥åšå®¢æ›´æ–°ï¼Œè†è½²åˆºç§¦ç‹(ï¼¾ï¼ï¼¾)","tags":[{"name":"Material Design","slug":"Material-Design","permalink":"https://www.limuyang.cc/tags/Material-Design/"},{"name":"Google","slug":"Google","permalink":"https://www.limuyang.cc/tags/Google/"},{"name":"Android","slug":"Android","permalink":"https://www.limuyang.cc/tags/Android/"}]},{"title":"Android Design Support Library--TextInputLayoutçš„ä½¿ç”¨","date":"2016-04-30T00:20:19.000Z","path":"2016/04/30/Android-Design-Support-Library-TextInputLayoutçš„ä½¿ç”¨/","text":"å¼•è¨€Googleåœ¨2015çš„IOå¤§ä¼šä¸Šï¼Œç»™æˆ‘ä»¬å¸¦æ¥äº†æ›´åŠ è¯¦ç»†çš„Material Designè®¾è®¡è§„èŒƒï¼ŒåŒæ—¶ï¼Œä¹Ÿç»™æˆ‘ä»¬å¸¦æ¥äº†å…¨æ–°çš„Android Design Support Libraryï¼ŒAndroid Design Support Libraryçš„å…¼å®¹æ€§æ›´å¹¿ï¼Œç›´æ¥å¯ä»¥å‘ä¸‹å…¼å®¹åˆ°Android 2.2ï¼Œæˆ‘å‡†å¤‡ä»æœ€ç®€å•çš„æ§ä»¶å¼€å§‹ï¼Œé€æ¸å»¶ä¼¸ï¼ŒæŠŠæ–°æ§ä»¶éƒ½ç»™ç†Ÿæ‚‰ä¸€éã€‚å…ˆä»çœ‹èµ·æ¥æœ€ç®€å•çš„æ§ä»¶å¼€å§‹ï¼Œä¹Ÿå°±æ˜¯TextInputLayoutï¼Œè¯´å®è¯TextInputLayout æˆ‘æ‰€è§åˆ°çš„å¹³å¸¸ç”¨çš„å¹¶ä¸å¤šï¼Œå®ƒçš„å¤§ä½“ä½œç”¨æ˜¯åœ¨æˆ‘ä»¬æ­£å¸¸çš„EditTextå·¦ä¸Šè§’æ˜¾ç¤ºå‡ºä¸€ä¸ªæµ®åŠ¨æ ‡ç­¾ï¼Œè¿™ä¸ªæ ‡ç­¾çš„å†…å®¹å°±æ˜¯æˆ‘ä»¬è®¾ç½®çš„android:hint å±æ€§çš„å€¼ã€‚å…ˆæ¥çœ‹ä¸€ä¸‹å®ƒçš„ç»§æ‰¿ç»“æ„ï¼š å¯ä»¥å¾ˆæ¸…æ™°çš„çœ‹åˆ°æˆ‘ä»¬çš„TextInputLayout ç»§æ‰¿äºLinearLayout ï¼Œé‚£ä¹ˆå¾ˆæ˜æ˜¾è¿™æ˜¯ä¸€ä¸ªå¸ƒå±€ï¼Œéœ€è¦é…åˆå®ƒçš„å­æ§ä»¶æ¥æ˜¾ç¤ºå‡ºæƒ³è¦çš„æ•ˆæœï¼Œè¿™é‡Œè°·æ­ŒæŠŠå®ƒä¸“é—¨è®¾è®¡ç”¨æ¥åŒ…è£¹EditText(æˆ–è€…EditTextçš„å­ç±»)ï¼Œç„¶åå½“ç”¨æˆ·è¿›è¡Œè¾“å…¥åŠ¨ä½œçš„æ—¶å€™æˆ‘ä»¬è®¾ç½®çš„android:hint æç¤ºå°±ä¼šä»¥åŠ¨ç”»çš„å½¢å¼è¿åŠ¨åˆ°å·¦ä¸Šè§’ï¼Œè°·æ­Œå®˜æ–¹æä¾›çš„æœ€ç®€å•çš„ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š 12345678910&lt;android.support.design.widget.TextInputLayout android:layout_width=\"match_parent\" android:layout_height=\"wrap_content\"&gt; &lt;android.support.design.widget.TextInputEditText android:layout_width=\"match_parent\" android:layout_height=\"wrap_content\" android:hint=\"@string/form_username\"/&gt;&lt;/android.support.design.widget.TextInputLayout&gt; æœ‰äº›äººå¯èƒ½ä¼šå¥‡æ€ªï¼Œä¹‹å‰è¯´å¥½çš„TextInputLayout æ˜¯ç”¨æ¥åŒ…è£¹EditText çš„ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œå‡ºç°äº†TextInputEditText ï¼Œå…ˆåˆ«æ€¥ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹è°·æ­Œå®˜æ–¹å¯¹è¿™ä¸ªæ§ä»¶çš„æè¿°ï¼š 123A special sub-class of EditText designed for use as a child of TextInputLayout.Using this class allows us to display a hint in the IME when in 'extract' mode. å¤§æ„æ˜¯è¯´ï¼Œè¿™åªæ˜¯ä¸€ç§ç‰¹æ®Šçš„EditText çš„å­ç±»ï¼Œç”¨æ¥åœ¨&#39;extract&#39; mode ä¸‹åœ¨è¾“å…¥æ³•ç¼–è¾‘å™¨ä¸­æ˜¾ç¤ºæˆ‘ä»¬çš„hintæç¤ºä¿¡æ¯ï¼Œè¿™é‡Œçš„&#39;extract&#39; mode å…¶å®å°±æ˜¯å…¨å±æ¨¡å¼ï¼Œè°·æ­Œå®˜æ–¹å¯¹å®ƒçš„è§£é‡Šæ˜¯æœ‰æ—¶å€™ä½ çš„è¾“å…¥æ¡†çš„UIç•Œé¢å¾ˆå¤§ï¼Œå¤§çš„ä¸èƒ½ä¸ä½ è‡ªå·±çš„åº”ç”¨ç¨‹åºçš„UIç»“åˆèµ·æ¥ï¼Œè¿™æ—¶å€™å°±å¯ä»¥åˆ‡æ¢åˆ°å…¨å±æ¨¡å¼æ¥è¾“å…¥ï¼Œè¿™ä¹ˆè¯´å¯èƒ½ä¸å¤ªæ˜ç™½ï¼Œä¸Šå›¾ï¼šæ¯”å¦‚è¯´ï¼Œä¸‹é¢è¿™ç§æƒ…å†µä½¿ç”¨çš„æ˜¯EditTextï¼š æˆ‘ä»¬çœ‹åˆ°ä¸‹é¢é‚£é‡Œè¾“å…¥æ¡†å·²ç»å¾ˆå¤§äº†ï¼Œç„¶åä½ ç‚¹å‡»è¾“å…¥æ¡†è¿›è¡Œè¾“å…¥ï¼Œä¼šå‘ç°è¿™ä¸ªç°è±¡ï¼š ä½ è¿›å…¥åˆ°äº†å…¨å±æ¨¡å¼è¾“å…¥ï¼Œä½†æ˜¯ç•Œé¢ä¸Šç©ºç©ºå¦‚ä¹Ÿï¼Œå¯¹æ¯”ä¸€ä¸‹ä½¿ç”¨TextInputEditText çš„æƒ…å†µï¼š çœ‹åˆ°å·¦ä¸Šè§’çš„æ–‡å­—äº†å˜›ï¼Œè¿™æ˜¯æˆ‘ä»¬åœ¨ä¹‹å‰è®¾ç½®çš„android:hint å±æ€§çš„å€¼ï¼Œè¿™ä¹ˆä¸€çœ‹è¿™ä¸¤è€…çš„åŒºåˆ«çš„å°±ä¸€ç›®äº†ç„¶äº†ï¼Œä½†æ˜¯è¯´å®è¯TextInputEditText ç”¨åˆ°çš„åœ°æ–¹è¿˜æ˜¯å¾ˆæœ‰é™çš„ï¼Œæ‰€ä»¥æ—¥å¸¸å¼€å‘æˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨TextInputLayout å»åŒ…è£¹EditText æ¥å®ç°æµ®åŠ¨æ ‡ç­¾çš„åŠŸèƒ½ã€‚ ä»¥ä¸Šå›¾ç‰‡å‡ºå¤„ æ„Ÿè°¢ä¸‡èƒ½çš„stackoverflow å¸¸ç”¨æ–¹æ³•å› ä¸ºå®ƒæ˜¯ç»§æ‰¿è‡ªLinearLayoutçš„æ‰€ä»¥ç†è®ºä¸ŠLinearLayout æœ‰çš„å±æ€§å®ƒå…¨éƒ½æœ‰ï¼Œè¿™é‡Œæˆ‘ä»¬åªçœ‹æœ‰å…³å®ƒæœ¬èº«çš„å±æ€§ï¼š å±æ€§å ç›¸å…³æ–¹æ³• æè¿° app:counterEnabled setCounterEnabled(boolean) è®¾ç½®æ˜¯å¦æ˜¾ç¤ºä¸€ä¸ªè®¡æ•°å™¨ï¼Œå¸ƒå°”å€¼ app:counterMaxLength setCounterMaxLength(int) è®¾ç½®è®¡æ•°å™¨çš„æœ€å¤§è®¡æ•°æ•°å€¼ï¼Œæ•´å‹ app:errorEnabled setErrorEnabled(boolean) è®¾ç½®æ˜¯å¦æ˜¾ç¤ºä¸€ä¸ªé”™è¯¯ä¿¡æ¯ï¼Œå¸ƒå°”å€¼ app:hintAnimationEnabled setHintAnimationEnabled(boolean) è®¾ç½®æ˜¯å¦è¦æ˜¾ç¤ºè¾“å…¥çŠ¶æ€æ—¶å€™çš„åŠ¨ç”»æ•ˆæœï¼Œå¸ƒå°”å€¼ app:hintEnabled setHintEnabled(boolean) è®¾ç½®æ˜¯å¦è¦ç”¨è¿™ä¸ªæµ®åŠ¨æ ‡ç­¾çš„åŠŸèƒ½ï¼Œå¸ƒå°”å€¼ app:hintTextAppearance setHintTextAppearance(int) è®¾ç½®æç¤ºæ–‡å­—çš„æ ·å¼(æ³¨æ„è¿™é‡Œæ˜¯è¿è¡Œäº†åŠ¨ç”»æ•ˆæœä¹‹åçš„æ ·å¼) è¿™é‡Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„Demoæ¥äº†è§£ä»¥ä¸Šè¿™äº›å±æ€§ï¼Œç®€å•èµ·è§æˆ‘ä»¬å°±åšä¸€ä¸ªç™»å½•ç•Œé¢ï¼Œè¿™ä¸ªç•Œé¢é•¿è¿™æ ·ï¼š å…ˆä¸Šå¸ƒå±€æ–‡ä»¶ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;RelativeLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" xmlns:app=\"http://schemas.android.com/apk/res-auto\" xmlns:tools=\"http://schemas.android.com/tools\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\" android:paddingLeft=\"@dimen/activity_horizontal_margin\" android:paddingRight=\"@dimen/activity_horizontal_margin\" tools:context=\"com.test.textinputlayoutdemo.MainActivity\"&gt; &lt;LinearLayout android:layout_width=\"match_parent\" android:layout_height=\"match_parent\" android:layout_marginTop=\"65dp\" android:orientation=\"vertical\"&gt; &lt;android.support.design.widget.TextInputLayout android:id=\"@+id/layout_name\" android:layout_width=\"match_parent\" android:layout_height=\"wrap_content\" app:counterEnabled=\"true\" app:counterMaxLength=\"5\" app:counterOverflowTextAppearance=\"@style/MyOverflowText\" app:errorTextAppearance=\"@style/MyErrorStyle\"&gt; &lt;EditText android:id=\"@+id/input_name\" android:layout_width=\"match_parent\" android:layout_height=\"wrap_content\" android:hint=\"@string/EnterName\" android:singleLine=\"true\" /&gt; &lt;/android.support.design.widget.TextInputLayout&gt; &lt;android.support.design.widget.TextInputLayout android:id=\"@+id/layout_password\" android:layout_width=\"match_parent\" android:layout_height=\"wrap_content\" app:counterEnabled=\"true\" app:counterMaxLength=\"11\" app:counterOverflowTextAppearance=\"@style/MyOverflowText\" app:errorTextAppearance=\"@style/MyErrorStyle\"&gt; &lt;EditText android:id=\"@+id/input_password\" android:layout_width=\"match_parent\" android:layout_height=\"wrap_content\" android:hint=\"@string/EnterPassWord\" android:inputType=\"textPassword\" android:singleLine=\"true\" /&gt; &lt;/android.support.design.widget.TextInputLayout&gt; &lt;android.support.design.widget.TextInputLayout android:id=\"@+id/layout_email\" android:layout_width=\"match_parent\" android:layout_height=\"wrap_content\" app:counterOverflowTextAppearance=\"@style/MyOverflowText\" app:errorTextAppearance=\"@style/MyErrorStyle\"&gt; &lt;EditText android:id=\"@+id/input_email\" android:layout_width=\"match_parent\" android:layout_height=\"wrap_content\" android:hint=\"@string/EnterEmail\" android:inputType=\"textEmailAddress\" /&gt; &lt;/android.support.design.widget.TextInputLayout&gt; &lt;Button android:id=\"@+id/login\" android:layout_width=\"match_parent\" android:layout_height=\"wrap_content\" android:layout_marginTop=\"50dp\" android:background=\"@color/colorPrimary\" android:text=\"@string/login\" android:textColor=\"#ffffff\" android:textSize=\"20sp\" android:textStyle=\"bold\" /&gt; &lt;/LinearLayout&gt;&lt;/RelativeLayout&gt; ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134public class MainActivity extends AppCompatActivity implements View.OnClickListener &#123; private EditText input_name, input_password, input_email; private TextInputLayout layout_name, layout_password, layout_email; private Button btn_login; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); initWidget(); &#125; private void initWidget() &#123; input_name = (EditText) findViewById(R.id.input_name); input_password = (EditText) findViewById(R.id.input_password); input_email = (EditText) findViewById(R.id.input_email); layout_name = (TextInputLayout) findViewById(R.id.layout_name); layout_password = (TextInputLayout) findViewById(R.id.layout_password); layout_email = (TextInputLayout) findViewById(R.id.layout_email); btn_login = (Button) findViewById(R.id.login); btn_login.setOnClickListener(this); //æ·»åŠ ç›‘å¬ input_name.addTextChangedListener(new MyTextWatcher(input_name)); input_password.addTextChangedListener(new MyTextWatcher(input_password)); input_email.addTextChangedListener(new MyTextWatcher(input_email)); &#125; @Override public void onClick(View v) &#123; switch (v.getId()) &#123; case R.id.login: canLogin(); break; default: break; &#125; &#125; /** * åˆ¤æ–­æ˜¯å¦å¯ä»¥ç™»å½•çš„æ–¹æ³• */ private void canLogin() &#123; if (!isNameValid()) &#123; Toast.makeText(this, getString(R.string.check), Toast.LENGTH_SHORT).show(); return; &#125; if (!isPasswordValid()) &#123; Toast.makeText(this, getString(R.string.check), Toast.LENGTH_SHORT).show(); return; &#125; if (!isEmailValid()) &#123; Toast.makeText(this, getString(R.string.check), Toast.LENGTH_SHORT).show(); return; &#125; Toast.makeText(this, getString(R.string.login_success), Toast.LENGTH_SHORT).show(); &#125; public boolean isNameValid() &#123; if (input_name.getText().toString().trim().equals(\"\") || input_name.getText().toString().trim().isEmpty()) &#123; layout_name.setError(getString(R.string.error_name)); input_name.requestFocus(); return false; &#125; layout_name.setErrorEnabled(false); return true; &#125; public boolean isPasswordValid() &#123; if (input_password.getText().toString().trim().equals(\"\") || input_password.getText().toString().trim().isEmpty()) &#123; layout_password.setErrorEnabled(true); layout_password.setError(getResources().getString(R.string.error_password)); input_password.requestFocus(); return false; &#125; layout_password.setErrorEnabled(false); return true; &#125; public boolean isEmailValid() &#123; String email = input_email.getText().toString().trim(); if (TextUtils.isEmpty(email) || !android.util.Patterns.EMAIL_ADDRESS.matcher(email).matches()) &#123; layout_email.setErrorEnabled(true); layout_email.setError(getString(R.string.error_email)); layout_email.requestFocus(); return false; &#125; layout_email.setErrorEnabled(false); return true; &#125; //åŠ¨æ€ç›‘å¬è¾“å…¥è¿‡ç¨‹ private class MyTextWatcher implements TextWatcher &#123; private View view; private MyTextWatcher(View view) &#123; this.view = view; &#125; @Override public void beforeTextChanged(CharSequence s, int start, int count, int after) &#123; &#125; @Override public void onTextChanged(CharSequence s, int start, int before, int count) &#123; &#125; @Override public void afterTextChanged(Editable s) &#123; switch (view.getId()) &#123; case R.id.input_name: isNameValid(); break; case R.id.input_password: isPasswordValid(); break; case R.id.input_email: isEmailValid(); break; &#125; &#125; &#125;&#125; å…ˆæ¥çœ‹ä¸€ä¸‹æœ€ç»ˆçš„å®ç°æ•ˆæœï¼š å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬åŒæ—¶è®¾ç½®äº†app:counterEnabled å’Œapp:counterMaxLength å±æ€§æ—¶ï¼Œæˆ‘ä»¬è¾“å…¥çš„EditText å³ä¸‹è§’ä¼šå‡ºç°ä¸€ä¸ªè®¡æ•°å™¨è¿˜æœ‰ä¸€ä¸ªæœ€å¤§è¾“å…¥å­—ç¬¦æ•°çš„æ•°å­—æ˜¾ç¤ºï¼Œæˆ‘ä»¬åœ¨è¾“å…¥åå­—è¿™ä¸€æ è®¾ç½®æœ€å¤§è¾“å…¥ä¸º5ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥å½“è¶…è¿‡äº†5ä¸ªå­—ç¬¦çš„æ—¶å€™ï¼ŒEditText çš„æ•´ä¸ªæ ·å¼çš„é¢œè‰²éƒ½ä¼šæ”¹å˜ä»¥ç¤ºè­¦å‘Šï¼Œå¦‚æœæˆ‘ä»¬åªè®¾ç½®äº†app:counterEnabled å±æ€§çš„è¯EditText å³ä¸‹è§’ä¸€å¼€å§‹ä¼šå‡ºç°ä¸€ä¸ª0ï¼Œéšç€è¾“å…¥å­—ç¬¦çš„å¢å¤šè€Œé€æ­¥è¿›è¡Œè®¡æ•°ï¼Œæ³¨æ„å¦‚æœè®¾ç½®äº†æ•´ä¸ªå±æ€§æˆ‘ä»¬EditText å¸ƒå±€çš„é«˜åº¦ä¼šæœ‰ä¸€å®šçš„å¢å¤§ï¼Œå…·ä½“çš„å¯ä»¥è‡ªå·±å®è·µä¸€ä¸‹ã€‚ å¦å¤–ï¼Œæˆ‘ä»¬åœ¨ä»£ç ä¸­è®¾ç½®äº†ä¸åŒçš„é¥¿è¾“å…¥ç±»å‹ï¼Œå¦‚æœè¾“å…¥ç±»å‹é”™è¯¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è®¾ç½®app:errorEnabled æ¥å¼€å¯é”™è¯¯æ˜¾ç¤ºï¼Œæ­¤æ—¶éœ€è¦é€šè¿‡åœ¨ä»£ç ä¸­è°ƒç”¨ setError(string) æ–¹æ³•æ¥è®¾ç½®æ˜¾ç¤ºçš„é”™è¯¯æç¤ºæ–‡å­—ï¼Œå½“ä¸éœ€è¦çš„æ—¶å€™è®°å¾—è®¾ç½®app:errorEnabled(false) æ¥å–æ¶ˆé”™è¯¯æç¤ºï¼Œä¸ç„¶é”™è¯¯æç¤ºä¼šä¸€ç›´å­˜åœ¨ã€‚ æ³¨æ„ï¼š å½“æˆ‘ä»¬ä½¿ç”¨app:counterMaxLength è¿™ä¸ªå±æ€§çš„æ—¶å€™ï¼Œä¸€å®šè¦è®¾ç½® app:counterOverflowTextAppearance å±æ€§ï¼Œä¸ç„¶çš„è¯ç¨‹åºè¿è¡Œä¼šæŠ¥é”™ï¼Œè¿™ä¸ªå±æ€§æ˜¯è®¾ç½®å½“æˆ‘ä»¬è¾“å…¥å­—ç¬¦è¶…è¿‡é™å®šçš„ä¸ªæ•°æ—¶å€™EditTextæ§ä»¶æ•´ä½“æ˜¾ç¤ºçš„æ ·å¼ï¼Œéœ€è¦åœ¨style.xmlæ–‡ä»¶é‡Œé¢å®šä¹‰ä¸€ä¸ªè‡ªå·±çš„styleï¼Œæ³¨æ„æˆ‘ä»¬è‡ªå®šä¹‰çš„styleçš„parentæ˜¯TextAppearance.AppCompat.Small ï¼Œæ‹¿æˆ‘ä¸Šé¢çš„ç¨‹åºä¸¾ä¾‹ï¼š 123&lt;style name=\"MyOverflowText\" parent=\"TextAppearance.AppCompat.Small\"&gt; &lt;item name=\"android:textColor\"&gt;#f3672b&lt;/item&gt;&lt;/style&gt; è¿™æ ·å®šä¹‰å¥½åå†åœ¨app:counterOverflowTextAppearance é‡Œé¢è®¾ç½®è¿™ä¸ªstyleå°±è¡Œ å…³äºè‡ªå®šä¹‰æ ·å¼æœ‰äº›äººå¯èƒ½ä¸å–œæ¬¢å®˜æ–¹æä¾›çš„é»˜è®¤æ ·å¼æƒ³è¦è‡ªå·±å®šä¹‰ï¼Œä¸‹é¢è¯´ä¸€ä¸‹è‡ªå®šä¹‰å‡ ç§æ ·å¼çš„æ–¹æ³•ï¼š å¦‚æœä½ æƒ³æ›´æ”¹ä¸‹åˆ’çº¿çš„é¢œè‰²ï¼Œåªè¦åœ¨style.xmlæ–‡ä»¶é‡Œé¢æ‰¾åˆ°AppThemeï¼š 123456&lt;style name=\"AppTheme\" parent=\"Theme.AppCompat.Light.DarkActionBar\"&gt; &lt;!-- Customize your theme here. --&gt; &lt;item name=\"colorPrimary\"&gt;@color/colorPrimary&lt;/item&gt; &lt;item name=\"colorPrimaryDark\"&gt;@color/colorPrimaryDark&lt;/item&gt; &lt;item name=\"colorAccent\"&gt;@color/colorAccent&lt;/item&gt; &lt;/style&gt; æ›´æ”¹é‡Œé¢çš„colorAccentå±æ€§å°±è¡Œäº† å¦‚æœä½ æƒ³æ›´æ”¹é”™è¯¯æç¤ºçš„æ ·å¼çš„è¯ï¼Œä¹Ÿæ˜¯åœ¨style.xmlæ–‡ä»¶é‡Œé¢ï¼Œè‡ªå®šä¹‰ä¸€ä¸ªstyleï¼ŒåŒæ ·æ‹¿ä¸Šé¢çš„ç¨‹åºä¸¾ä¾‹ï¼š 123&lt;style name=\"MyErrorStyle\"&gt; &lt;item name=\"android:textColor\"&gt;#ec4722&lt;/item&gt; &lt;/style&gt; ç„¶ååœ¨xmlæ–‡ä»¶TextInputLayoutæ§ä»¶é‡Œé¢è¿™ä¹ˆè®¾ç½®ä¸€ä¸‹å°±è¡Œäº†ï¼š 1app:errorTextAppearance=&quot;@style/MyErrorStyle&quot; åŒ…æ‹¬å‰é¢æåˆ°çš„è®¾ç½®å½“è¾“å…¥å­—ç¬¦å¤§äºæˆ‘ä»¬é™å®šä¸ªæ•°å­—ç¬¦æ—¶çš„æ ·å¼ï¼ŒåŸºæœ¬ä¸Šæˆ‘ä»¬å¯ä»¥å¾ˆå¥½åœ°è‡ªå®šä¹‰å‡ºè‡ªå·±æƒ³è¦çš„styleäº†ï¼Œä»¥ä¸Šä¸¤ç§ä¸æä¾›æ¼”ç¤ºï¼Œéƒ½å¾ˆç®€å•ï¼Œå¯ä»¥è‡ªå·±å»å°è¯•ã€‚ æœ€åä¸‹ä¸€æ¬¡å‡†å¤‡åˆ†æSnackBaræ§ä»¶ï¼Œå¾ˆå¤šä¸œè¥¿è¯´ç®€å•ä¹Ÿç®€å•ï¼Œè¯´ä¸ç®€å•ä¹Ÿä¸ç®€å•ï¼Œå°±åƒåšè¿™ä¸ªDemoæˆ‘ä¹‹å‰å…‰çœ‹å®˜æ–¹æ–‡æ¡£æ ¹æœ¬æ²¡æœ‰å‘Šè¯‰æœ‰app:counterOverflowTextAppearance è¿™ä¸ªå±æ€§çš„å­˜åœ¨ï¼Œä¹Ÿæ˜¯ä¸€ç›´æŸ¥èµ„æ–™ï¼Œè¿˜æ˜¯è¦äº²è‡ªå»å°è¯•ä¸€ä¸‹æ‰å¥½ï¼Œä¸‹é¢ä¸Šæºç (æ³¨æ„æ˜¯ASæ–‡ä»¶) å‚è€ƒï¼šAndroid Material Design Floating Labels for EditText é¡¹ç›®GitHubåœ°å€ æœ€åæ¥ä¸ªå°æç¤ºï¼Œå½“æˆ‘ä»¬åœ¨Android Studioä¸­å¯¼å…¥support designå¼€å‘åŒ…çš„æ—¶å€™ï¼Œç‰ˆæœ¬å·æœ€å¥½å’Œv7åŒ…çš„ç‰ˆæœ¬å·ä¸€è‡´ï¼Œä¸ç„¶æœ‰äº›æ—¶å€™ä¼šå‡ºç°è«åå…¶å¦™çš„é”™è¯¯ï¼š 123compile fileTree(dir: 'libs', include: ['*.jar'])compile 'com.android.support:appcompat-v7:23.0.1'compile 'com.android.support:design:23.0.1' æœ‰ä»»ä½•é—®é¢˜æ¬¢è¿ç•™è¨€æ¢è®¨~","tags":[{"name":"Material Design","slug":"Material-Design","permalink":"https://www.limuyang.cc/tags/Material-Design/"},{"name":"Google","slug":"Google","permalink":"https://www.limuyang.cc/tags/Google/"},{"name":"TextInputLayout","slug":"TextInputLayout","permalink":"https://www.limuyang.cc/tags/TextInputLayout/"}]},{"title":"ViewGroupçš„äº‹ä»¶åˆ†å‘æœºåˆ¶","date":"2016-04-04T21:08:19.000Z","path":"2016/04/04/ViewGroupçš„äº‹ä»¶åˆ†å‘æœºåˆ¶/","text":"å¼•è¨€ä¸Šä¸€æ¬¡æˆ‘åœ¨Viewçš„äº‹ä»¶åˆ†å‘æœºåˆ¶é‡Œå®Œæ•´çš„åˆ†æäº†Viewå¯¹äºè§¦å±ç‚¹å‡»äº‹ä»¶çš„åˆ†å‘è¿‡ç¨‹ï¼Œæ¥ä¸‹æ¥ç»§ç»­æ¢ç´¢ä¹‹æ—…ï¼Œç´§æ¥ç€åˆ†æViewGroupçš„äº‹ä»¶åˆ†å‘æœºåˆ¶ï¼ŒViewGroupå…¶å®å°±æ˜¯ä¸€ç»„Viewçš„é›†åˆï¼Œå®ƒä¹Ÿæ˜¯ç»§æ‰¿äºViewçš„ï¼Œå®ƒæœ¬èº«ä¹Ÿå¯ä»¥åŒ…å«Viewå’ŒViewGroupï¼Œæ–¹ä¾¿èµ·è§æˆ‘ä»¬è¿˜æ˜¯å»¶ç”¨ä¸Šä¸€æ¬¡çš„å¸ƒå±€ï¼Œä¸è¿‡è¿™ä¸€æ¬¡æˆ‘ä»¬ç»™æ ¹å¸ƒå±€ä¹Ÿè®¾ç½®äº†ç‚¹å‡»äº‹ä»¶å’Œè§¦æ‘¸äº‹ä»¶ï¼š 1234567891011121314151617181920212223242526public class MainActivity extends Activity implements OnClickListener,OnTouchListener&#123; private RelativeLayout re_Layout; private Button btn; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); btn=(Button) findViewById(R.id.btn); re_Layout=(RelativeLayout) findViewById(R.id.re_layout); btn.setOnClickListener(this); btn.setOnTouchListener(this); re_Layout.setOnClickListener(this); re_Layout.setOnTouchListener(this); &#125; @Override public void onClick(View v) &#123; Log.d(&quot;TAG&quot;, &quot;OnClick--&quot;+v); &#125; @Override public boolean onTouch(View v, MotionEvent event) &#123; Log.d(&quot;TAG&quot;, &quot;onTouch--&quot;+event.getAction()+&quot;--&quot;+v); return false; &#125;&#125; æ•ˆæœå›¾ä¹Ÿä¾æ—§æ²¡æœ‰å˜ï¼Œç°åœ¨æˆ‘ä»¬å…ˆç‚¹å‡»ä¸€ä¸‹Button,æŸ¥çœ‹Logè¾“å‡ºï¼š å¯ä»¥å¾ˆæ¸…æ¥šçš„çœ‹åˆ°è¿™é‡Œå’Œä¸Šä¸€èŠ‚åˆ†æå¾—æƒ…å†µä¸€æ ·ï¼šå½“ç‚¹å‡»äº‹ä»¶å‘ç”Ÿæ—¶onTouch()æ–¹æ³•æ˜¯ä¼˜å…ˆäºonClick()æ–¹æ³•æ‰§è¡Œçš„ï¼Œå¹¶ä¸”å¦‚æœonTouch()è¿”å›Falseæ—¢ä¸æ¶ˆè€—ç‚¹å‡»äº‹ä»¶é‚£ä¹ˆå¦‚æœæ§ä»¶è®¾ç½®äº†setOnClickListeneræœ€ç»ˆæ˜¯ä¼šæ‰§è¡Œåˆ°onClick()æ–¹æ³•çš„ï¼Œå¯æ˜¯æˆ‘å¾ˆå¥½å¥‡ViewGroupçš„ç‚¹å‡»äº‹ä»¶å’ŒViewçš„åˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œç‚¹å‡»äº‹ä»¶äº‹ä»¶çš„åˆ†å‘åˆ°åº•æ˜¯ä»ViewGroupå¼€å§‹è¿˜æ˜¯ä»Viewå¼€å§‹çš„å‘¢ï¼Œäºæ˜¯æˆ‘ç‚¹å‡»äº†Buttonä»¥å¤–çš„ç©ºç™½åŒºåŸŸï¼Œæ•æ‰åˆ°å¦‚ä¸‹ä¿¡æ¯(æ³¨:æˆ‘çš„æ ¹å¸ƒå±€å°±æ˜¯RelativeLayout)ï¼š è¯´æ˜æ ¹å¸ƒå±€ä¹Ÿå°±æ˜¯Viewroupä¹Ÿæ˜¯å¯ä»¥å“åº”ç‚¹å‡»äº‹ä»¶çš„ï¼Œä½†æ˜¯æˆ‘ä»¬ç‚¹å‡»Viewçš„æ—¶å€™ä¸ºä»€ä¹ˆæ²¡æœ‰ViewGroupçš„Logè¾“å‡ºï¼Œè¿™æ˜¯ä¸æ˜¯è¯´æ˜androidäº‹ä»¶åˆ†å‘æ˜¯å…ˆä¼ åˆ°Viewçš„ï¼Œå½“Viewæ¶ˆè€—çš„è¿™ä¸ªäº‹ä»¶å®ƒçš„ViewGroupå°±æ— æ³•æ¥æ”¶è¿™ä¸ªäº‹ä»¶äº†å‘¢ï¼Œä¸ºäº†å½»åº•çš„è°ˆæ¸…æ¥šåŸå› ï¼Œæˆ‘ä»¬å…ˆé‡å†™ä¸€ä¸ªViewGroupï¼Œç„¶åé‡å†™è¿™ä¸ªViewGroupé‡Œé¢çš„onInterceptTouchEvent(MotionEvent ev)ã€dispatchTouchEvent(MotionEvent event)è¿˜æœ‰onTouchEvent(MotionEvent event)è¿™ä¸‰ä¸ªæ–¹æ³•é€šè¿‡Logè¾“å‡ºä¿¡æ¯æ¥åˆ¤æ–­ï¼š 123456789101112131415161718192021public class MyLayout extends RelativeLayout&#123; public MyLayout(Context context,AttributeSet attrs) &#123; super(context,attrs); &#125; @Override public boolean onInterceptTouchEvent(MotionEvent ev) &#123; Log.d(&quot;TAG&quot;, ev.getAction()+&quot; action&quot;+&quot;MyLayout onInterceptTouchEvent&quot;); return super.onInterceptTouchEvent(ev); &#125; @Override public boolean onTouchEvent(MotionEvent event) &#123; Log.d(&quot;TAG&quot;, event.getAction()+&quot; action&quot;+&quot;MyLayout onTouchEvent&quot;); return super.onTouchEvent(event); &#125; @Override public boolean dispatchTouchEvent(MotionEvent ev) &#123; Log.d(&quot;TAG&quot;, ev.getAction()+&quot; action&quot;+&quot;MyLayout dispatchTouchEvent&quot;); return super.dispatchTouchEvent(ev); &#125; åŒç†æˆ‘ä»¬è¿˜éœ€è¦é‡å†™ä¸€ä¸ªButtonï¼š 123456789101112131415public class MyButton extends Button&#123; public MyButton(Context context,AttributeSet attrs)&#123; super(context,attrs); &#125; @Override public boolean onTouchEvent(MotionEvent event) &#123; Log.d(&quot;TAG&quot;, event.getAction()+&quot; action&quot;+&quot;MyButton onTouchEvent&quot;); return super.onTouchEvent(event); &#125; @Override public boolean dispatchTouchEvent(MotionEvent ev) &#123; Log.d(&quot;TAG&quot;, ev.getAction()+&quot; action&quot;+&quot;MyButton dispatchTouchEvent&quot;); return super.dispatchTouchEvent(ev); &#125; //è¿™é‡Œæ³¨æ„Viewæ˜¯æ²¡æœ‰onInterceptTouchEventæ–¹æ³•çš„ æ•ˆæœå›¾æ˜¯ä¸€æ ·çš„è¿™é‡Œå°±ä¸å†è´´äº†ï¼Œä¸ºäº†éªŒè¯åˆšæ‰çš„æƒ³æ³•æˆ‘ä»¬ç›´æ¥ç‚¹å‡»ä¸€ä¸‹ç•Œé¢ä¸Šçš„Buttonï¼ŒLogè¾“å‡ºå¦‚ä¸‹ï¼š å‘ç°äº†ä»€ä¹ˆï¼Œæˆ‘ä»¬ç‚¹å‡»çš„æ˜¯Button,ç„¶è€Œè¿™ä¸ªäº‹ä»¶æœ€å¼€å§‹æ˜¯ä¼ åˆ°äº†æˆ‘ä»¬çš„æ ¹å¸ƒå±€MyLayoutï¼Œå¹¶ä¸”è¿˜æŒ‰ç…§ï¼šdispatchTouchEventã€onInterceptTouchEventã€dispatchTouchEventçš„é¡ºåºæ‰§è¡Œï¼Œç´§æ¥ç€æ‰§è¡ŒViewçš„onTouch()å’ŒonTouchEvent()æ–¹æ³•ï¼Œè¿˜æœ‰ä¸€ç‚¹å¾ˆå¥‡æ€ªçš„äº‹åªæœ‰æœ€å¼€å§‹ACTION_DOWNçš„æ—¶å€™è°ƒç”¨äº†ViewGroupçš„onInterceptTouchEventæ–¹æ³•ï¼Œåœ¨åé¢çš„ACTION_UPäº‹ä»¶æ´¾å‘è¿‡ç¨‹ä¸­å´æ²¡æœ‰è°ƒç”¨ï¼Œè¿™é‡Œç»™å‡ºä¸€ä¸ªåˆç†çš„çŒœæƒ³ï¼šä¸€æ—¦ä¸€ä¸ªViewå¼€å§‹å¤„ç†è¿™ä¸ªè§¦æ‘¸äº‹ä»¶ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„ACTION_MOVEå’ŒACTION_UPäº‹ä»¶éƒ½ä¼šäº¤ç»™å®ƒå»å¤„ç†ï¼Œå°±å¥½æ¯”ä½ åœ¨å…¬å¸é‡Œé¢åšäº‹ï¼Œåˆ†åˆ°ä½ åšçš„äº‹ä½ å·²ç»åšäº†ä¸€äº›ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„äº‹ä½ çš„å®Œå®Œæ•´æ•´çš„åšå¥½ï¼Œé‚£ä¹ˆå¦‚æœåšåˆ°ä¸€åŠä¸åšäº†ä¼šæ€ä¹ˆæ ·(å³Viewä¸æ¶ˆè€—ACTION_DOWNäº‹ä»¶)ï¼Ÿæˆ‘ä»¬å¯ä»¥å¤§èƒ†çš„å‡è®¾å¦‚æœä¸Šçº§äº¤ç»™ä½ åšçš„äº‹æ²¡æœ‰åšå¥½ï¼Œé‚£ä¹ˆä¸Šçº§_åœ¨çŸ­æœŸå†…è‚¯å®šä¸æ•¢äº¤ä»£äº‹æƒ…ç»™ä½ åšäº†(åç»­çš„ACTION_MOVEã€ACTION_DOWNäº‹ä»¶è¿™ä¸ªViewéƒ½æ¥æ”¶ä¸åˆ°äº†)ï¼Œé‚£ä¹ˆç©¶ç«Ÿå¦‚ä½•æˆ‘ä»¬è¿˜æ˜¯ä»æºç çœ‹èµ·ã€‚ å¯¹æºç çš„åˆ†ææˆ‘ä»¬å·²ç»çŸ¥é“å½“ä¸€ä¸ªç‚¹å‡»æ“ä½œå‘ç”Ÿæ—¶äº‹ä»¶æ˜¯å…ˆä¼ ç»™ViewGroupå¤„ç†çš„å¹¶ä¸”é¦–å…ˆæ‰§è¡Œçš„æ˜¯ViewGroupçš„dispatchTouchEvent,é‚£ä¹ˆæˆ‘ä»¬å°±å…ˆæ¥çœ‹çœ‹å®ƒçš„æºç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218/** * &#123;@inheritDoc&#125; */ @Override public boolean dispatchTouchEvent(MotionEvent ev) &#123; if (mInputEventConsistencyVerifier != null) &#123; mInputEventConsistencyVerifier.onTouchEvent(ev, 1); &#125; // If the event targets the accessibility focused view and this is it, start // normal event dispatch. Maybe a descendant is what will handle the click. if (ev.isTargetAccessibilityFocus() &amp;&amp; isAccessibilityFocusedViewOrHost()) &#123; ev.setTargetAccessibilityFocus(false); &#125; boolean handled = false; if (onFilterTouchEventForSecurity(ev)) &#123; final int action = ev.getAction(); final int actionMasked = action &amp; MotionEvent.ACTION_MASK; // Handle an initial down. if (actionMasked == MotionEvent.ACTION_DOWN) &#123; // Throw away all previous state when starting a new touch gesture. // The framework may have dropped the up or cancel event for the previous gesture // due to an app switch, ANR, or some other state change. cancelAndClearTouchTargets(ev); resetTouchState(); &#125; // Check for interception. final boolean intercepted; if (actionMasked == MotionEvent.ACTION_DOWN || mFirstTouchTarget != null) &#123; final boolean disallowIntercept = (mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT) != 0; if (!disallowIntercept) &#123; intercepted = onInterceptTouchEvent(ev); ev.setAction(action); // restore action in case it was changed &#125; else &#123; intercepted = false; &#125; &#125; else &#123; // There are no touch targets and this action is not an initial down // so this view group continues to intercept touches. intercepted = true; &#125; // If intercepted, start normal event dispatch. Also if there is already // a view that is handling the gesture, do normal event dispatch. if (intercepted || mFirstTouchTarget != null) &#123; ev.setTargetAccessibilityFocus(false); &#125; // Check for cancelation. final boolean canceled = resetCancelNextUpFlag(this) || actionMasked == MotionEvent.ACTION_CANCEL; // Update list of touch targets for pointer down, if needed. final boolean split = (mGroupFlags &amp; FLAG_SPLIT_MOTION_EVENTS) != 0; TouchTarget newTouchTarget = null; boolean alreadyDispatchedToNewTouchTarget = false; if (!canceled &amp;&amp; !intercepted) &#123; // If the event is targeting accessiiblity focus we give it to the // view that has accessibility focus and if it does not handle it // we clear the flag and dispatch the event to all children as usual. // We are looking up the accessibility focused host to avoid keeping // state since these events are very rare. View childWithAccessibilityFocus = ev.isTargetAccessibilityFocus() ? findChildWithAccessibilityFocus() : null; if (actionMasked == MotionEvent.ACTION_DOWN || (split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_DOWN) || actionMasked == MotionEvent.ACTION_HOVER_MOVE) &#123; final int actionIndex = ev.getActionIndex(); // always 0 for down final int idBitsToAssign = split ? 1 &lt;&lt; ev.getPointerId(actionIndex) : TouchTarget.ALL_POINTER_IDS; // Clean up earlier touch targets for this pointer id in case they // have become out of sync. removePointersFromTouchTargets(idBitsToAssign); final int childrenCount = mChildrenCount; if (newTouchTarget == null &amp;&amp; childrenCount != 0) &#123; final float x = ev.getX(actionIndex); final float y = ev.getY(actionIndex); // Find a child that can receive the event. // Scan children from front to back. final ArrayList&lt;View&gt; preorderedList = buildOrderedChildList(); final boolean customOrder = preorderedList == null &amp;&amp; isChildrenDrawingOrderEnabled(); final View[] children = mChildren; for (int i = childrenCount - 1; i &gt;= 0; i--) &#123; final int childIndex = customOrder ? getChildDrawingOrder(childrenCount, i) : i; final View child = (preorderedList == null) ? children[childIndex] : preorderedList.get(childIndex); // If there is a view that has accessibility focus we want it // to get the event first and if not handled we will perform a // normal dispatch. We may do a double iteration but this is // safer given the timeframe. if (childWithAccessibilityFocus != null) &#123; if (childWithAccessibilityFocus != child) &#123; continue; &#125; childWithAccessibilityFocus = null; i = childrenCount - 1; &#125; if (!canViewReceivePointerEvents(child) || !isTransformedTouchPointInView(x, y, child, null)) &#123; ev.setTargetAccessibilityFocus(false); continue; &#125; newTouchTarget = getTouchTarget(child); if (newTouchTarget != null) &#123; // Child is already receiving touch within its bounds. // Give it the new pointer in addition to the ones it is handling. newTouchTarget.pointerIdBits |= idBitsToAssign; break; &#125; resetCancelNextUpFlag(child); if (dispatchTransformedTouchEvent(ev, false, child, idBitsToAssign)) &#123; // Child wants to receive touch within its bounds. mLastTouchDownTime = ev.getDownTime(); if (preorderedList != null) &#123; // childIndex points into presorted list, find original index for (int j = 0; j &lt; childrenCount; j++) &#123; if (children[childIndex] == mChildren[j]) &#123; mLastTouchDownIndex = j; break; &#125; &#125; &#125; else &#123; mLastTouchDownIndex = childIndex; &#125; mLastTouchDownX = ev.getX(); mLastTouchDownY = ev.getY(); newTouchTarget = addTouchTarget(child, idBitsToAssign); alreadyDispatchedToNewTouchTarget = true; break; &#125; // The accessibility focus didn&apos;t handle the event, so clear // the flag and do a normal dispatch to all children. ev.setTargetAccessibilityFocus(false); &#125; if (preorderedList != null) preorderedList.clear(); &#125; if (newTouchTarget == null &amp;&amp; mFirstTouchTarget != null) &#123; // Did not find a child to receive the event. // Assign the pointer to the least recently added target. newTouchTarget = mFirstTouchTarget; while (newTouchTarget.next != null) &#123; newTouchTarget = newTouchTarget.next; &#125; newTouchTarget.pointerIdBits |= idBitsToAssign; &#125; &#125; &#125; // Dispatch to touch targets. if (mFirstTouchTarget == null) &#123; // No touch targets so treat this as an ordinary view. handled = dispatchTransformedTouchEvent(ev, canceled, null, TouchTarget.ALL_POINTER_IDS); &#125; else &#123; // Dispatch to touch targets, excluding the new touch target if we already // dispatched to it. Cancel touch targets if necessary. TouchTarget predecessor = null; TouchTarget target = mFirstTouchTarget; while (target != null) &#123; final TouchTarget next = target.next; if (alreadyDispatchedToNewTouchTarget &amp;&amp; target == newTouchTarget) &#123; handled = true; &#125; else &#123; final boolean cancelChild = resetCancelNextUpFlag(target.child) || intercepted; if (dispatchTransformedTouchEvent(ev, cancelChild, target.child, target.pointerIdBits)) &#123; handled = true; &#125; if (cancelChild) &#123; if (predecessor == null) &#123; mFirstTouchTarget = next; &#125; else &#123; predecessor.next = next; &#125; target.recycle(); target = next; continue; &#125; &#125; predecessor = target; target = next; &#125; &#125; // Update list of touch targets for pointer up or cancel, if needed. if (canceled || actionMasked == MotionEvent.ACTION_UP || actionMasked == MotionEvent.ACTION_HOVER_MOVE) &#123; resetTouchState(); &#125; else if (split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_UP) &#123; final int actionIndex = ev.getActionIndex(); final int idBitsToRemove = 1 &lt;&lt; ev.getPointerId(actionIndex); removePointersFromTouchTargets(idBitsToRemove); &#125; &#125; if (!handled &amp;&amp; mInputEventConsistencyVerifier != null) &#123; mInputEventConsistencyVerifier.onUnhandledEvent(ev, 1); &#125; return handled; &#125; ç›¸å½“é•¿ï¼Œè¿˜æ˜¯ä¸€ç‚¹ç‚¹æ¥çœ‹ï¼Œæºç è¿™ç§ä¸œè¥¿çœ‹ä¸æ‡‚è‚¯å®šä¼šè§‰å¾—å¾ˆæ¯ç‡¥ï¼Œæ‰€ä»¥èƒ½å¼„æ‡‚çš„å°½é‡å¼„æ‡‚ï¼Œæœ€å¼€å§‹åªæ˜¯ä¸€äº›å¯¹Viewæ˜¯å¦å¯ä»¥è·å¾—ç„¦ç‚¹çš„åˆ¤æ–­ã€è®¾ç½®æ ‡å¿—ä½ä»¥åŠåˆå§‹åŒ–ä¸€äº›å¸ƒå°”å€¼ï¼Œå¹¶ä¸”åœ¨ACTION_DOWNäº‹ä»¶äº§ç”Ÿçš„æ—¶å€™æ¸…æ¥šä»¥å¤–çš„çŠ¶æ€å¹¶ä¸”å‡†å¤‡å¼€å§‹æ–°ä¸€è½®çš„æ‰‹åŠ¿æ“ä½œï¼Œä¸é‡è¦ï¼š 1234567891011121314151617181920212223if (mInputEventConsistencyVerifier != null) &#123; mInputEventConsistencyVerifier.onTouchEvent(ev, 1); &#125; // If the event targets the accessibility focused view and this is it, start // normal event dispatch. Maybe a descendant is what will handle the click. if (ev.isTargetAccessibilityFocus() &amp;&amp; isAccessibilityFocusedViewOrHost()) &#123; ev.setTargetAccessibilityFocus(false); &#125; boolean handled = false; if (onFilterTouchEventForSecurity(ev)) &#123; final int action = ev.getAction(); final int actionMasked = action &amp; MotionEvent.ACTION_MASK; // Handle an initial down. if (actionMasked == MotionEvent.ACTION_DOWN) &#123; // Throw away all previous state when starting a new touch gesture. // The framework may have dropped the up or cancel event for the previous gesture // due to an app switch, ANR, or some other state change. cancelAndClearTouchTargets(ev); resetTouchState(); &#125; å…ˆçœ‹è¿™ä¸€æ®µï¼š 12345678910111213141516// Check for interception. final boolean intercepted; if (actionMasked == MotionEvent.ACTION_DOWN || mFirstTouchTarget != null) &#123; final boolean disallowIntercept = (mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT) != 0; if (!disallowIntercept) &#123; intercepted = onInterceptTouchEvent(ev); ev.setAction(action); // restore action in case it was changed &#125; else &#123; intercepted = false; &#125; &#125; else &#123; // There are no touch targets and this action is not an initial down // so this view group continues to intercept touches. intercepted = true; &#125; è¿™é‡Œé¦–å…ˆè®¾ç«‹äº†ä¸€ä¸ªå¸ƒå°”å€¼interceptionå»åˆ¤æ–­å½“å‰ViewGroupæ˜¯å¦è¦æ‹¦æˆªViewçš„ç‚¹å‡»äº‹ä»¶ï¼Œifæ¡ä»¶è¯­å¥ä¸­çš„å†…å®¹æ˜¯å½“äº§ç”ŸACTION_DOWNæŒ‰ä¸‹äº‹ä»¶æˆ–è€…mFirstTouchTarget != nullçš„æ—¶å€™å»åˆ¤æ–­æ˜¯å¦è¦æ‹¦æˆªå½“å‰äº‹ä»¶ï¼Œè¿™é‡Œä¸»è¦å…³æ³¨mFirstTouchTarget != nullè¿™ä¸ªç‚¹ï¼Œæˆ‘ä»¬æ‰¾ä¸€æ‰¾å“ªä¸ªæ–¹æ³•è·Ÿè¿™ä¸ªmFirstTouchTargetå˜é‡æœ‰å…³ï¼Œè¿˜çœŸç»™æˆ‘æ‰¾åˆ°äº†ï¼Œçœ‹ä¸‹é¢ï¼š1234567891011private void clearTouchTargets() &#123; TouchTarget target = mFirstTouchTarget; if (target != null) &#123; do &#123; TouchTarget next = target.next; target.recycle(); target = next; &#125; while (target != null); mFirstTouchTarget = null; &#125; &#125; 12345678910111213141516171819202122232425/** * Cancels and clears all touch targets. */ private void cancelAndClearTouchTargets(MotionEvent event) &#123; if (mFirstTouchTarget != null) &#123; boolean syntheticEvent = false; if (event == null) &#123; final long now = SystemClock.uptimeMillis(); event = MotionEvent.obtain(now, now, MotionEvent.ACTION_CANCEL, 0.0f, 0.0f, 0); event.setSource(InputDevice.SOURCE_TOUCHSCREEN); syntheticEvent = true; &#125; for (TouchTarget target = mFirstTouchTarget; target != null; target = target.next) &#123; resetCancelNextUpFlag(target.child); dispatchTransformedTouchEvent(event, true, target.child, target.pointerIdBits); &#125; clearTouchTargets(); if (syntheticEvent) &#123; event.recycle(); &#125; &#125; &#125; è¿™ä¸¤æ®µä»£ç ç»“åˆèµ·æ¥ï¼Œåœ¨åŠ ä¸Šåœ¨ACTION_DOWNåˆå§‹æ—¶å€™æ˜¯è°ƒç”¨äº†cancelAndClearTouchTargets(MotionEvent event)è¿™ä¸ªæ–¹æ³•çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ¨èèµ·åˆè¿™ä¸ªmFirstTouchTarget çš„å€¼æ˜¯nullçš„ï¼Œé‚£ä¹ˆmFirstTouchTargetæ˜¯åœ¨å“ªé‡Œèµ‹å€¼çš„å‘¢ï¼Œæˆ‘ä»¬åœ¨dispatchTouchEvent(MotionEvent ev)æ¥ç€å¾€ä¸‹çœ‹ï¼š 1newTouchTarget = addTouchTarget(child, idBitsToAssign); æˆ‘ä»¬çœ‹åˆ°newTouchTargetæ˜¯åœ¨è¿™é‡Œèµ‹å€¼çš„ï¼Œçœ‹ä¸€ä¸‹addTouchTargetæ–¹æ³•ï¼š 12345678910/** * Adds a touch target for specified child to the beginning of the list. * Assumes the target child is not already present. */ private TouchTarget addTouchTarget(View child, int pointerIdBits) &#123; TouchTarget target = TouchTarget.obtain(child, pointerIdBits); target.next = mFirstTouchTarget; mFirstTouchTarget = target; return target; &#125; ä»è¯¥æ–¹æ³•çš„å†…éƒ¨ç»“æ„å¯ä»¥çœ‹å‡ºï¼ŒmFirstTouchTargetå…¶å®æ˜¯ä¸€ä¸­å•é“¾è¡¨ç»“æ„ï¼Œå¦‚æœæ‰¾åˆ°äº†å¤„ç†è¯¥ç‚¹å‡»äº‹ä»¶çš„å­Viewé‚£ä¹ˆmFirstTouchTargetå°±ä¼šè¢«èµ‹å€¼å¹¶ä¸”ä¼šæŒ‡å‘å­å…ƒç´ ã€‚è¿™ä¸€ä¸‹å¼„æ¸…æ¥šäº†å›åˆ°åˆšæ‰çš„é‚£æ®µä»£ç ï¼š 123456789101112131415final boolean intercepted; if (actionMasked == MotionEvent.ACTION_DOWN || mFirstTouchTarget != null) &#123; final boolean disallowIntercept = (mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT) != 0; if (!disallowIntercept) &#123; intercepted = onInterceptTouchEvent(ev); ev.setAction(action); // restore action in case it was changed &#125; else &#123; intercepted = false; &#125; &#125; else &#123; // There are no touch targets and this action is not an initial down // so this view group continues to intercept touches. intercepted = true; &#125; 1final boolean disallowIntercept = (mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT) != 0; è¿™ä¸ªå¸ƒå°”å€¼æ˜¯åˆ¤æ–­å­å…ƒç´ æ˜¯å¦è°ƒç”¨äº†requestDisallowInterceptTouchEventè¿™ä¸ªæ–¹æ³•ï¼Œå¦‚æœè°ƒç”¨äº†è¿™ä¸ªå¸ƒå°”å€¼å°±ä¸ºTrueï¼Œè¿™é‡Œçœ‹ä¸€çœ¼è¿™ä¸ªæ–¹æ³•çš„ä»£ç ï¼š 123456789101112131415161718192021/** * &#123;@inheritDoc&#125; */ public void requestDisallowInterceptTouchEvent(boolean disallowIntercept) &#123; if (disallowIntercept == ((mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT) != 0)) &#123; // We&apos;re already in this state, assume our ancestors are too return; &#125; if (disallowIntercept) &#123; mGroupFlags |= FLAG_DISALLOW_INTERCEPT; &#125; else &#123; mGroupFlags &amp;= ~FLAG_DISALLOW_INTERCEPT; &#125; // Pass it up to our parent if (mParent != null) &#123; mParent.requestDisallowInterceptTouchEvent(disallowIntercept); &#125; &#125; ä½ å¯ä»¥åœ¨å­Viewä¸­è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ¥è®©ViewGroupä¸æ‹¦æˆªé™¤äº†ACTION_DOWNä»¥å¤–çš„ç‚¹å‡»äº‹ä»¶ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆè¯´æ˜¯ACTION_DOWNä»¥å¤–å‘¢ï¼Œå› ä¸ºViewGroupåœ¨åˆ†å‘äº‹ä»¶çš„æ—¶å€™æœ€å¼€å§‹æ˜¯ä¼šé‡ç½®FLAG_DISALLOW_INTERCEPTè¿™ä¸ªæ ‡å¿—ä½çš„ï¼Œæ‰€ä»¥æ— è®ºä½ æœ‰æ²¡æœ‰åœ¨å­Viewä¸­è®¾ç½®requestDisallowInterceptTouchEventæ–¹æ³•éƒ½ä¸ä¼šå½±å“åˆ°ViewGroupå»æ‹¦æˆªACTION_DOWNäº‹ä»¶çš„ï¼Œæ¥ç€å¾€ä¸‹çœ‹ï¼š 1234567891011if (!disallowIntercept) &#123; intercepted = onInterceptTouchEvent(ev); ev.setAction(action); // restore action in case it was changed &#125; else &#123; intercepted = false; &#125; &#125; else &#123; // There are no touch targets and this action is not an initial down // so this view group continues to intercept touches. intercepted = true; &#125; å¦‚æœå­Viewæ²¡æœ‰è®¾ç½®requestDisallowInterceptTouchEventæ–¹æ³•é‚£ä¹ˆå°±è°ƒç”¨ViewGroupçš„onInterceptTouchEvent(ev)æ–¹æ³•ï¼Œæˆ‘ä»¬æ‰¾åˆ°è¿™ä¸ªæ–¹æ³•ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940/** * Implement this method to intercept all touch screen motion events. This * allows you to watch events as they are dispatched to your children, and * take ownership of the current gesture at any point. * * &lt;p&gt;Using this function takes some care, as it has a fairly complicated * interaction with &#123;@link View#onTouchEvent(MotionEvent) * View.onTouchEvent(MotionEvent)&#125;, and using it requires implementing * that method as well as this one in the correct way. Events will be * received in the following order: * * &lt;ol&gt; * &lt;li&gt; You will receive the down event here. * &lt;li&gt; The down event will be handled either by a child of this view * group, or given to your own onTouchEvent() method to handle; this means * you should implement onTouchEvent() to return true, so you will * continue to see the rest of the gesture (instead of looking for * a parent view to handle it). Also, by returning true from * onTouchEvent(), you will not receive any following * events in onInterceptTouchEvent() and all touch processing must * happen in onTouchEvent() like normal. * &lt;li&gt; For as long as you return false from this function, each following * event (up to and including the final up) will be delivered first here * and then to the target&apos;s onTouchEvent(). * &lt;li&gt; If you return true from here, you will not receive any * following events: the target view will receive the same event but * with the action &#123;@link MotionEvent#ACTION_CANCEL&#125;, and all further * events will be delivered to your onTouchEvent() method and no longer * appear here. * &lt;/ol&gt; * * @param ev The motion event being dispatched down the hierarchy. * @return Return true to steal motion events from the children and have * them dispatched to this ViewGroup through onTouchEvent(). * The current target will receive an ACTION_CANCEL event, and no further * messages will be delivered here. */ public boolean onInterceptTouchEvent(MotionEvent ev) &#123; return false; &#125; å””ï¼Œæ³¨é‡Šç›¸å½“é•¿ï¼Œä½†æ˜¯æœ‰ç”¨çš„å°±ä¸€ä¸ªè¿”å›å€¼ï¼Œè¿™é‡Œè¿”å›Falseï¼Œè¯´æ˜ViewGrupä¸æ‹¦æˆªç‚¹å‡»äº‹ä»¶ï¼Œäº‹ä»¶å¯ä»¥ç»§ç»­å¾€ä¸‹ä¼ é€’ï¼Œè¿™ä¸ªæ–¹æ³•çš„æœ€åï¼Œå¦‚æœå½“å‰ç•Œé¢é™¤äº†ä¸€ä¸ªViewGroupæ²¡æœ‰ä»»ä½•å­Viewï¼Œé‚£ä¹ˆæ­¤æ—¶ViewGroupä¹Ÿä¼šæ‹¦æˆªç‚¹å‡»äº‹ä»¶ï¼Œå°±å¥½æ¯”ä¸€ä¸ªå…¬å¸äººæ‰‹ä¸å¤Ÿï¼Œå…¬å¸é¢†å¯¼éœ€è¦äº²åŠ›äº²ä¸ºä¸€æ ·ã€‚æ¥ç€ï¼š 12345// If intercepted, start normal event dispatch. Also if there is already // a view that is handling the gesture, do normal event dispatch. if (intercepted || mFirstTouchTarget != null) &#123; ev.setTargetAccessibilityFocus(false); &#125; å¦‚æœç¡®å®šæ‹¦æˆªæˆ–è€…å·²ç»æœ‰å­Viewç€æ‰‹å¤„ç†è¿™ä¸ªç‚¹å‡»äº‹ä»¶ï¼Œé‚£ä¹ˆå°±å¼€å§‹æ­£å¸¸çš„äº‹ä»¶åˆ†å‘æµç¨‹ã€‚ 12final boolean canceled = resetCancelNextUpFlag(this) || actionMasked == MotionEvent.ACTION_CANCEL; è¿™é‡Œæ˜¯é€šè¿‡æ ‡å¿—ä½å’ŒACTION_CANCLEæ¥æ£€æŸ¥æ˜¯å¦cancleï¼Œå†ä¸‹å»ï¼š 1final boolean split = (mGroupFlags &amp; FLAG_SPLIT_MOTION_EVENTS) != 0; é¦–å…ˆå¯ä»¥çœ‹è§è·å–ä¸€ä¸ªbooleanå˜é‡æ ‡è®°splitæ¥æ ‡è®°ï¼Œé»˜è®¤æ˜¯trueï¼Œä½œç”¨æ˜¯æ˜¯å¦æŠŠäº‹ä»¶åˆ†å‘ç»™å¤šä¸ªå­Viewï¼Œè¿™ä¸ªåŒæ ·åœ¨ViewGroupä¸­æä¾›äº†publicçš„æ–¹æ³•è®¾ç½®ï¼Œå¦‚ä¸‹ï¼š 12345678910public void setMotionEventSplittingEnabled(boolean split) &#123; // TODO Applications really shouldn&apos;t change this setting mid-touch event, // but perhaps this should handle that case and send ACTION_CANCELs to any child views // with gestures in progress when this is changed. if (split) &#123; mGroupFlags |= FLAG_SPLIT_MOTION_EVENTS; &#125; else &#123; mGroupFlags &amp;= ~FLAG_SPLIT_MOTION_EVENTS; &#125; &#125; è¿™ä¸€æ®µæ‘˜è‡ªï¼šAndroidè§¦æ‘¸å±äº‹ä»¶æ´¾å‘æœºåˆ¶è¯¦è§£ä¸æºç åˆ†æäºŒ(ViewGroupç¯‡) 1if (!canceled &amp;&amp; !intercepted) &#123; å¦‚æœæ²¡æœ‰å–æ¶ˆå½“å‰åŠ¨ä½œå¹¶ä¸”ViewGroupæœªæ‹¦æˆªäº‹ä»¶é‚£ä¹ˆäº‹ä»¶å°±ä¼ é€’åˆ°æ¥æ”¶äº†è¯¥ç‚¹å‡»äº‹ä»¶çš„Viewï¼Œæ¥ä¸‹æ¥æ˜¯ä¸€å¤§æ®µä»£ç é¢„è­¦ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182// If the event is targeting accessiiblity focus we give it to the // view that has accessibility focus and if it does not handle it // we clear the flag and dispatch the event to all children as usual. // We are looking up the accessibility focused host to avoid keeping // state since these events are very rare. View childWithAccessibilityFocus = ev.isTargetAccessibilityFocus() ? findChildWithAccessibilityFocus() : null; if (actionMasked == MotionEvent.ACTION_DOWN || (split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_DOWN) || actionMasked == MotionEvent.ACTION_HOVER_MOVE) &#123; final int actionIndex = ev.getActionIndex(); // always 0 for down final int idBitsToAssign = split ? 1 &lt;&lt; ev.getPointerId(actionIndex) : TouchTarget.ALL_POINTER_IDS; // Clean up earlier touch targets for this pointer id in case they // have become out of sync. removePointersFromTouchTargets(idBitsToAssign); final int childrenCount = mChildrenCount; if (newTouchTarget == null &amp;&amp; childrenCount != 0) &#123; final float x = ev.getX(actionIndex); final float y = ev.getY(actionIndex); // Find a child that can receive the event. // Scan children from front to back. final ArrayList&lt;View&gt; preorderedList = buildOrderedChildList(); final boolean customOrder = preorderedList == null &amp;&amp; isChildrenDrawingOrderEnabled(); final View[] children = mChildren; for (int i = childrenCount - 1; i &gt;= 0; i--) &#123; final int childIndex = customOrder ? getChildDrawingOrder(childrenCount, i) : i; final View child = (preorderedList == null) ? children[childIndex] : preorderedList.get(childIndex); // If there is a view that has accessibility focus we want it // to get the event first and if not handled we will perform a // normal dispatch. We may do a double iteration but this is // safer given the timeframe. if (childWithAccessibilityFocus != null) &#123; if (childWithAccessibilityFocus != child) &#123; continue; &#125; childWithAccessibilityFocus = null; i = childrenCount - 1; &#125; if (!canViewReceivePointerEvents(child) || !isTransformedTouchPointInView(x, y, child, null)) &#123; ev.setTargetAccessibilityFocus(false); continue; &#125; newTouchTarget = getTouchTarget(child); if (newTouchTarget != null) &#123; // Child is already receiving touch within its bounds. // Give it the new pointer in addition to the ones it is handling. newTouchTarget.pointerIdBits |= idBitsToAssign; break; &#125; resetCancelNextUpFlag(child); if (dispatchTransformedTouchEvent(ev, false, child, idBitsToAssign)) &#123; // Child wants to receive touch within its bounds. mLastTouchDownTime = ev.getDownTime(); if (preorderedList != null) &#123; // childIndex points into presorted list, find original index for (int j = 0; j &lt; childrenCount; j++) &#123; if (children[childIndex] == mChildren[j]) &#123; mLastTouchDownIndex = j; break; &#125; &#125; &#125; else &#123; mLastTouchDownIndex = childIndex; &#125; mLastTouchDownX = ev.getX(); mLastTouchDownY = ev.getY(); newTouchTarget = addTouchTarget(child, idBitsToAssign); alreadyDispatchedToNewTouchTarget = true; break; &#125; å—¯ï¼Œè¿™æ®µä»£ç çš„é€»è¾‘æ¯”è¾ƒæ¸…æ™°ï¼Œå¤§ä½“ä¸Šå°±æ˜¯éå†ViewGroupçš„æ‰€æœ‰å­å…ƒç´ ï¼Œç„¶ååˆ¤æ–­å­å…ƒç´ æ˜¯å¦èƒ½å¤Ÿæ¥æ”¶åˆ°ç‚¹å‡»äº‹ä»¶ï¼Œæ¥æ”¶çš„ä¾æ®æœ‰ä¸¤ç§ï¼šç¬¬ä¸€ç§æ˜¯åˆ¤æ–­å­å…ƒç´ æ˜¯å¦åœ¨æ’­æ”¾åŠ¨ç”»ï¼Œç¬¬äºŒç§æ˜¯åˆ¤æ–­ç‚¹å‡»äº‹ä»¶çš„åæ ‡æ˜¯å¦è½åœ¨å­å…ƒç´ çš„åŒºåŸŸå†…ï¼Œä»è¿™é‡Œå¯ä»¥çœ‹å‡ºæ¥ï¼š 12345678910111213if (!canViewReceivePointerEvents(child) || !isTransformedTouchPointInView(x, y, child, null)) &#123; ev.setTargetAccessibilityFocus(false); continue; &#125; newTouchTarget = getTouchTarget(child); if (newTouchTarget != null) &#123; // Child is already receiving touch within its bounds. // Give it the new pointer in addition to the ones it is handling. newTouchTarget.pointerIdBits |= idBitsToAssign; break; &#125; å¦‚æœå­å…ƒç´ æ»¡è¶³äº†è¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œç‚¹å‡»äº‹ä»¶å°±ä¼šäº¤ç»™å®ƒå¤„ç†ï¼Œæ¥ä¸‹æ¥è¿™æ®µä»£ç é‡Œé¢æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„æ–¹æ³•ï¼š 1234567891011121314151617181920if (dispatchTransformedTouchEvent(ev, false, child, idBitsToAssign)) &#123; // Child wants to receive touch within its bounds. mLastTouchDownTime = ev.getDownTime(); if (preorderedList != null) &#123; // childIndex points into presorted list, find original index for (int j = 0; j &lt; childrenCount; j++) &#123; if (children[childIndex] == mChildren[j]) &#123; mLastTouchDownIndex = j; break; &#125; &#125; &#125; else &#123; mLastTouchDownIndex = childIndex; &#125; mLastTouchDownX = ev.getX(); mLastTouchDownY = ev.getY(); newTouchTarget = addTouchTarget(child, idBitsToAssign); alreadyDispatchedToNewTouchTarget = true; break; &#125; è¿™é‡Œifåˆ¤æ–­é‡Œé¢è¿™ä¸ªdispatchTransformedTouchEventæ˜¯å°†Touchäº‹ä»¶ä¼ é€’ç»™ç‰¹å®šçš„å­Viewï¼Œå®ƒå®é™…ä¸Šåœ¨å†…éƒ¨æ˜¯è°ƒç”¨äº†å­å…ƒç´ çš„disPatchTouchEventæ–¹æ³•ï¼Œæ‰¾ä¸€ä¸‹å®ƒçš„æºç ï¼š 1234567891011121314151617181920212223242526272829303132/** * Transforms a motion event into the coordinate space of a particular child view, * filters out irrelevant pointer ids, and overrides its action if necessary. * If child is null, assumes the MotionEvent will be sent to this ViewGroup instead. */private boolean dispatchTransformedTouchEvent(MotionEvent event, boolean cancel, View child, int desiredPointerIdBits) &#123; final boolean handled; // Canceling motions is a special case. We don&apos;t need to perform any transformations // or filtering. The important part is the action, not the contents. final int oldAction = event.getAction(); if (cancel || oldAction == MotionEvent.ACTION_CANCEL) &#123; event.setAction(MotionEvent.ACTION_CANCEL); if (child == null) &#123; handled = super.dispatchTouchEvent(event); &#125; else &#123; handled = child.dispatchTouchEvent(event); &#125; event.setAction(oldAction); return handled; &#125; // Calculate the number of pointers to deliver. final int oldPointerIdBits = event.getPointerIdBits(); final int newPointerIdBits = oldPointerIdBits &amp; desiredPointerIdBits; // If for some reason we ended up in an inconsistent state where it looks like we // might produce a motion event with no pointers in it, then drop the event. if (newPointerIdBits == 0) &#123; return false; &#125; çœ‹è¿™ä¸€æ®µå†…å®¹ï¼š 12345if (child == null) &#123; handled = super.dispatchTouchEvent(event); &#125; else &#123; handled = child.dispatchTouchEvent(event); &#125; å¦‚æœä¼ é€’çš„childä¸ºnullå°±è°ƒç”¨çˆ¶ç±»çš„dispatchTouchEventå¦åˆ™å°±è°ƒç”¨å­ç±»çš„dispatchTouchEventï¼Œè€Œä¸Šé¢çš„ä»£ç ä¸­childä¸ä¸ºnullï¼Œæ‰€ä»¥æ‰§è¡Œå­å…ƒç´ çš„dispatchTouchEventï¼Œå¦‚æœå­å…ƒç´ çš„dispatchTouchEventè¿”å›çš„æ˜¯Trueï¼Œé‚£ä¹ˆå«æœ‰dispatchTransformedTouchEventè¿™ä¸ªæ–¹æ³•å†…éƒ¨çš„forå¾ªç¯å°±ä¸ä¼šç»§ç»­ä¸‹å»ï¼Œç›´æ¥è·³åˆ°è¿™é‡Œï¼š 12345mLastTouchDownX = ev.getX(); mLastTouchDownY = ev.getY(); newTouchTarget = addTouchTarget(child, idBitsToAssign); alreadyDispatchedToNewTouchTarget = true; break; è¿™ä¸ªåœ°æ–¹å‰é¢è¯´è¿‡æ˜¯ç»™mFirstTouchTargetèµ‹å€¼çš„åœ°æ–¹ï¼Œå¦‚æœæƒ…å†µæ”¹å˜ï¼Œå‰é¢é‚£ä¸ªdispatchTransformedTouchEventæ–¹æ³•ä¸­childè¿”å›çš„æ˜¯Falseï¼Œé‚£ä¹ˆå¦‚æœå½“å‰ViewGroupä¼šæŠŠç‚¹å‡»äº‹ä»¶ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå­å…ƒç´ è¿›è¡Œå¤„ç†ï¼Œæ‰§è¡Œforå¾ªç¯æŸ¥æ‰¾ä¸‹ä¸€ä¸ªå­å…ƒç´ ï¼Œæ­¤æ—¶mFirstTouchTargetä¾ç„¶æœªè¢«èµ‹å€¼ä¸ºnullï¼Œé‚£ä¹ˆè¿™æ—¶å€™ç»§ç»­æŸ¥çœ‹æ¥ä¸‹æ¥çš„ä»£ç ï¼š 123456789if (newTouchTarget == null &amp;&amp; mFirstTouchTarget != null) &#123; // Did not find a child to receive the event. // Assign the pointer to the least recently added target. newTouchTarget = mFirstTouchTarget; while (newTouchTarget.next != null) &#123; newTouchTarget = newTouchTarget.next; &#125; newTouchTarget.pointerIdBits |= idBitsToAssign; &#125; è¿™ä¸€æ®µä»£ç è¡¨ç¤ºå½“å‰æ²¡æœ‰æ‰¾åˆ°å¯ä»¥æ¥æ”¶ç‚¹å‡»äº‹ä»¶çš„Viewå¹¶ä¸”æˆ‘ä»¬çš„mFirstTouchTarget!=nullé‚£ä¹ˆå°±æŠŠæœ€å¼€å§‹çš„TouchTargetèµ‹å€¼ç»™newTouchTargetï¼Œæœ€åï¼š 12345// Dispatch to touch targets. if (mFirstTouchTarget == null) &#123; // No touch targets so treat this as an ordinary view. handled = dispatchTransformedTouchEvent(ev, canceled, null, TouchTarget.ALL_POINTER_IDS); æ‰§è¡Œåˆ°è¿™é‡Œçš„è¯æœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯ViewGroupé‡Œé¢æ²¡æœ‰æ‰¾åˆ°å­Viewï¼Œå¦ä¸€ç§å°±æ˜¯æ‰¾åˆ°äº†å¤„ç†è¿™æ¬¡ç‚¹å‡»äº‹ä»¶çš„å­Viewä½†æ˜¯è¿™ä¸ªå­Viewçš„disPatchTouchEventè¿”å›äº†Falseï¼Œæˆ‘ä»¬é€šè¿‡å‰é¢çš„åˆ†æçŸ¥é“disPatchTouchEventä¸­æ˜¯å…ˆæ‰§è¡ŒonTouch()æ–¹æ³•çš„ï¼Œè€Œä¸€èˆ¬onTouch()æ–¹æ³•è¿”å›çš„æ˜¯Falseï¼Œæ­¤æ—¶disPatchTouchEventæ–¹æ³•çš„è¿”å›å€¼ç”±onTouchEventæ–¹æ³•å†³å®šï¼Œå‡ºç°è¿™ç§æƒ…å†µè¯´æ˜onTouchEventè¿”å›äº†Falseï¼Œåœ¨ä»¥ä¸Šä¸¤ç§æƒ…å†µä¸‹ï¼ŒViewGroupä¼šè‡ªå·±å¤„ç†è¿™ä¸ªç‚¹å‡»äº‹ä»¶ï¼Œæ³¨æ„è¿™é‡Œè¿™ä¸ªæ–¹æ³•é‡Œçš„childä¼ å…¥çš„æ˜¯nullï¼Œæˆ‘ä»¬å‰é¢å°±çŸ¥é“äº†ä¼ å…¥nullä¼šæ‰§è¡Œhandled = super.dispatchTouchEvent(event);ä¹Ÿå°±æ˜¯è¯´æ­¤æ—¶äº¤ç”±ViewGroupå¤„ç†è¿™ä¸ªäº‹ä»¶ã€‚è€ŒViewGroupä¹Ÿæ˜¯Viewçš„å­ç±»ï¼Œå®ƒé‡Œé¢æ˜¯æ²¡æœ‰é‡å†™Viewçš„onTouchEventæ–¹æ³•çš„ï¼Œæ‰€ä»¥å®ƒè‡ªèº«å¤„ç†ç‚¹å‡»äº‹ä»¶çš„æµç¨‹å’Œæˆ‘ä»¬åœ¨Viewçš„äº‹ä»¶åˆ†å‘æœºåˆ¶è§£æé‡Œé¢åˆ†æå¾—æ˜¯ä¸€æ ·çš„ï¼Œè‡³æ­¤ViewGroupçš„åˆ†å‘äº‹ä»¶åˆ†æå®Œæ¯•ã€‚ æ€»ç»“è¿™æ¬¡æˆ‘ä»¬åªåˆ†æäº†ç‚¹å‡»Buttonæ—¶çš„Logè¾“å‡ºï¼Œä¸‹é¢ç»™å‡ºç‚¹å‡»ç©ºç™½å¤„çš„Logè¾“å‡ºï¼Œå¯ä»¥è‡ªå·±æ£€éªŒä¸€ä¸‹åˆ†ææˆæœï¼š ä¸€äº›ç»“è®º ViewGroupé»˜è®¤ä¸æ‹¦æˆªä»»ä½•äº‹ä»¶ï¼ŒAndroidæºç ä¸­ViewGroupçš„onInterceptTouchEventæ–¹æ³•é»˜è®¤è¿”å›false Viewçš„onTouchEventé»˜è®¤éƒ½ä¼šæ¶ˆè€—äº‹ä»¶(è¿”å›true)ï¼Œé™¤éæ˜¯ä¸å¯ç‚¹å‡»çš„(clickableå’ŒlongClicjableåŒæ—¶ä¸ºfalse)ï¼ŒViewçš„longClickableå±æ€§é»˜è®¤æ˜¯falseçš„ Viewçš„enableå±æ€§ä¸ä¼šå½±å“onTouchEventçš„è¿”å›å€¼ï¼Œå“ªæ€•è¯¥Viewä¸ºdisableçš„ï¼Œåªè¦å®ƒçš„clickableå’ŒlongClickableå…¶ä¸­ä¸€ä¸ªä¸ºtrueï¼Œé‚£ä¹ˆå®ƒçš„onTouchEventå°±è¿”å›true äº‹ä»¶ä¼ é€’è¿‡ç¨‹æ˜¯ç”±å¤–å‘å†…çš„ï¼Œå³äº‹ä»¶æ€»æ˜¯å…ˆä¼ ç»™çˆ¶å…ƒç´ ï¼Œç„¶åå†ç”±çˆ¶å…ƒç´ åˆ†å‘ç»™å­VIew,å­Viewå¯ä»¥é€šè¿‡requestDisallowInterceptTouchEventæ¥å¹²é¢„çˆ¶å…ƒç´ çš„åˆ†å‘è¿‡ç¨‹ï¼Œä½†æ˜¯å½±å“ä¸åˆ°ACTION_DOWNäº‹ä»¶ å‚è€ƒï¼šAndroidè§¦æ‘¸å±äº‹ä»¶æ´¾å‘æœºåˆ¶è¯¦è§£ä¸æºç åˆ†æäºŒ(ViewGroupç¯‡) Androidäº‹ä»¶åˆ†å‘æœºåˆ¶å®Œå…¨è§£æï¼Œå¸¦ä½ ä»æºç çš„è§’åº¦å½»åº•ç†è§£(ä¸‹)","tags":[{"name":"äº‹ä»¶åˆ†å‘","slug":"äº‹ä»¶åˆ†å‘","permalink":"https://www.limuyang.cc/tags/äº‹ä»¶åˆ†å‘/"},{"name":"å›è°ƒ","slug":"å›è°ƒ","permalink":"https://www.limuyang.cc/tags/å›è°ƒ/"},{"name":"ViewGroup","slug":"ViewGroup","permalink":"https://www.limuyang.cc/tags/ViewGroup/"}]},{"title":"Viewçš„äº‹ä»¶åˆ†å‘æœºåˆ¶è§£æ","date":"2016-04-03T22:41:55.000Z","path":"2016/04/03/Viewçš„äº‹ä»¶åˆ†å‘æœºåˆ¶è§£æ/","text":"å¼•è¨€ Androidäº‹ä»¶æ„æˆåœ¨Androidä¸­ï¼Œäº‹ä»¶ä¸»è¦åŒ…æ‹¬ç‚¹æŒ‰ã€é•¿æŒ‰ã€æ‹–æ‹½ã€æ»‘åŠ¨ç­‰ï¼Œç‚¹æŒ‰åˆåŒ…æ‹¬å•å‡»å’ŒåŒå‡»ï¼Œå¦å¤–è¿˜åŒ…æ‹¬å•æŒ‡æ“ä½œå’Œå¤šæŒ‡æ“ä½œã€‚æ‰€æœ‰è¿™äº›éƒ½æ„æˆäº†Androidä¸­çš„äº‹ä»¶å“åº”ã€‚æ€»çš„æ¥è¯´ï¼Œæ‰€æœ‰çš„äº‹ä»¶éƒ½ç”±å¦‚ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ä½œä¸ºåŸºç¡€ï¼š æŒ‰ä¸‹(ACTION_DOWN) ç§»åŠ¨(ACTION_MOVE) æŠ¬èµ·(ACTION_UP) æ‰€æœ‰çš„æ“ä½œäº‹ä»¶é¦–å…ˆå¿…é¡»æ‰§è¡Œçš„æ˜¯æŒ‰ä¸‹æ“ä½œï¼ˆACTION_DOWNï¼‰ï¼Œä¹‹åæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯ä»¥æŒ‰ä¸‹æ“ä½œä½œä¸ºå‰æï¼Œå½“æŒ‰ä¸‹æ“ä½œå®Œæˆåï¼Œæ¥ä¸‹æ¥å¯èƒ½æ˜¯ä¸€æ®µç§»åŠ¨ï¼ˆACTION_MOVEï¼‰ç„¶åæŠ¬èµ·ï¼ˆACTION_UPï¼‰ï¼Œæˆ–è€…æ˜¯æŒ‰ä¸‹æ“ä½œæ‰§è¡Œå®Œæˆåæ²¡æœ‰ç§»åŠ¨å°±ç›´æ¥æŠ¬èµ·ã€‚è¿™ä¸€ç³»åˆ—çš„åŠ¨ä½œåœ¨Androidä¸­éƒ½å¯ä»¥è¿›è¡Œæ§åˆ¶ã€‚ è¿™äº›æ“ä½œäº‹ä»¶éƒ½å‘ç”Ÿåœ¨æˆ‘ä»¬æ‰‹æœºçš„è§¦æ‘¸å±ä¸Šé¢ï¼Œè€Œæˆ‘ä»¬æ‰‹æœºä¸Šå“åº”æˆ‘ä»¬å„ç§æ“ä½œäº‹ä»¶çš„å°±æ˜¯å„ç§å„æ ·çš„è§†å›¾ç»„ä»¶ä¹Ÿå°±æ˜¯Viewï¼Œåœ¨Androidä¸­ï¼Œæ‰€æœ‰çš„è§†å›¾éƒ½ç»§æ‰¿äºViewï¼Œå¦å¤–é€šè¿‡å„ç§å¸ƒå±€ç»„ä»¶ï¼ˆViewGroupï¼‰æ¥å¯¹Viewè¿›è¡Œå¸ƒå±€ï¼ŒViewGroupä¹Ÿç»§æ‰¿äºViewã€‚æ‰€æœ‰çš„UIæ§ä»¶ä¾‹å¦‚Buttonã€TextViewéƒ½æ˜¯ç»§æ‰¿äºViewï¼Œè€Œæ‰€æœ‰çš„å¸ƒå±€æ§ä»¶ä¾‹å¦‚RelativeLayoutã€å®¹å™¨æ§ä»¶ä¾‹å¦‚ListViewéƒ½æ˜¯ç»§æ‰¿äºViewGroupã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬çš„äº‹ä»¶æ“ä½œä¸»è¦å°±æ˜¯å‘ç”Ÿåœ¨Viewå’ŒViewGroupä¹‹é—´ã€‚ äº‹ä»¶åˆ†å‘çš„æ¦‚å¿µæ‰€è°“ç‚¹å‡»äº‹ä»¶çš„äº‹ä»¶åˆ†å‘ï¼Œå°±æ˜¯å½“ä¸€ä¸ªMotionEventäº§ç”Ÿäº†ä»¥åï¼Œç³»ç»Ÿéœ€è¦æŠŠè¿™ä¸ªäº‹ä»¶ä¼ é€’ç»™ä¸€ä¸ªå…·ä½“çš„View(ViewGroupä¹Ÿç»§æ‰¿äºView),è¿™ä¸ªä¼ é€’çš„è¿‡ç¨‹å°±å«åšåˆ†å‘è¿‡ç¨‹ï¼Œè¿™ä¸ªç‚¹å‡»äº‹ä»¶çš„åˆ†å‘è¿‡ç¨‹éœ€è¦ä¸‰ä¸ªå¾ˆé‡è¦çš„æ–¹æ³•æ¥å…±åŒå®Œæˆï¼šdisPatchTouchEventã€onInterceptTouchEventã€å’ŒonTouchEventã€‚ public boolean disPatchTouchEvent(MotionEvent ev) ç”¨æ¥è¿›è¡Œäº‹ä»¶çš„åˆ†å‘ï¼Œå¦‚æœäº‹ä»¶èƒ½å¤Ÿä¼ é€’ç»™å½“å‰çš„View,é‚£ä¹ˆæ­¤æ–¹æ³•ä¸€å®šä¼šè¢«è°ƒç”¨ï¼ŒAndroidä¸­æ‰€æœ‰çš„ç‚¹å‡»äº‹ä»¶éƒ½å¿…é¡»ç»è¿‡è¿™ä¸ªæ–¹æ³•çš„åˆ†å‘ï¼Œç„¶åå†³å®šæ˜¯è‡ªèº«æ¶ˆè´¹å½“å‰äº‹ä»¶è¿˜æ˜¯ç»§ç»­å¾€ä¸‹åˆ†å‘ç»™å­æ§ä»¶å¤„ç†ã€‚è¿”å›trueè¡¨ç¤ºä¸ç»§ç»­åˆ†å‘ï¼Œäº‹ä»¶å·²è¢«æ¶ˆè´¹,è¿”å›falseåˆ™ç»§ç»­å¾€ä¸‹åˆ†å‘ï¼Œå¦‚æœæ˜¯ViewGroupåˆ™åˆ†å‘ç»™onInterceptTouchEventè¿›è¡Œåˆ¤æ–­æ˜¯å¦æ‹¦æˆªè¯¥äº‹ä»¶ï¼Œè¿™ä¸ªæ–¹æ³•çš„è¿”å›ç»“æœå—åˆ°å½“å‰Viewçš„onTouchEventå’Œä¸‹çº§Viewçš„disPatchTouchEventæ–¹æ³•çš„å½±å“ï¼Œè¿”å›ç»“æœè¡¨ç¤ºæ˜¯å¦æ¶ˆè€—å½“å‰äº‹ä»¶ã€‚ public boolean onTouchEvent(MotionEvent ev) åœ¨diaPatchTouchEventæ–¹æ³•ä¸­è°ƒç”¨ï¼Œç”¨æ¥å¤„ç†ç‚¹å‡»äº‹ä»¶ï¼Œè¿”å›ç»“æœè¡¨ç¤ºæ˜¯å¦æ¶ˆè€—å½“å‰äº‹ä»¶ï¼Œå¦‚æœä¸æ¶ˆè€—ï¼Œåˆ™åœ¨åŒä¸€ä¸ªäº‹ä»¶åºåˆ—å½“ä¸­ï¼Œå½“å‰Viewæ— æ³•å†æ¬¡æ¥æ”¶åˆ°äº‹ä»¶ã€‚ public boolean onInterceptTouchEvent(MotionEvent ev) æ˜¯ViewGroupä¸­æ‰æœ‰çš„æ–¹æ³•ï¼ŒViewä¸­æ²¡æœ‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯è´Ÿè´£äº‹ä»¶çš„æ‹¦æˆªï¼Œè¿”å›trueçš„æ—¶å€™è¡¨ç¤ºæ‹¦æˆªå½“å‰äº‹ä»¶ï¼Œä¸ç»§ç»­å¾€ä¸‹åˆ†å‘ï¼Œäº¤ç»™è‡ªèº«çš„onTouchEventè¿›è¡Œå¤„ç†ã€‚è¿”å›falseåˆ™ä¸æ‹¦æˆªï¼Œç»§ç»­å¾€ä¸‹ä¼ ã€‚è¿™æ˜¯ViewGroupç‰¹æœ‰çš„æ–¹æ³•ï¼Œå› ä¸ºViewGroupä¸­å¯èƒ½è¿˜æœ‰å­Viewï¼Œè€Œåœ¨Androidä¸­Viewä¸­æ˜¯ä¸èƒ½å†åŒ…å«å­Viewçš„(IOSå¯ä»¥)ï¼Œåœ¨ä¸Šè¿°æ–¹æ³•å†…éƒ¨è¢«è°ƒç”¨ï¼Œå¦‚æœå½“å‰Viewæ‹¦æˆªäº†æŸä¸ªäº‹ä»¶ï¼Œé‚£ä¹ˆåŒä¸€ä¸ªäº‹ä»¶åºåˆ—ä¸­(æŒ‡ä»æ‰‹æŒ‡æ¥è§¦å±å¹•çš„é‚£ä¸€åˆ»èµ·ï¼Œåˆ°æ‰‹æŒ‡ç¦»å¼€å±å¹•çš„é‚£ä¸€åˆ»ç»“æŸï¼Œä¸­é—´å«æœ‰ä¸å®šçš„ACTION_MOVEäº‹ä»¶ï¼Œæœ€ç»ˆä»¥ACTION_UPäº‹ä»¶ç»“æŸ)æ­¤æ–¹æ³•ä¸ä¼šè¢«å†æ¬¡è°ƒç”¨ï¼Œè¿”å›ç»“æœè¡¨ç¤ºæ˜¯å¦æ‹¦æˆªå½“å‰äº‹ä»¶ã€‚ è¿™ä¸‰ä¸ªæ–¹æ³•å¯ä»¥ç”¨å¦‚ä¸‹ä¼ªä»£ç è¡¨ç¤ºï¼š 123456789101112public boolean disPathchTouchEvent(MotionEvent ev)&#123;//consumeæŒ‡ä»£ç‚¹å‡»äº‹ä»¶æ˜¯å¦è¢«æ¶ˆè€— boolean consume=false; //è¡¨ç¤ºå½“å‰çˆ¶å¸ƒå±€è¦æ‹¦æˆªè¯¥äº‹ä»¶ if(onInterceptTouchEvent(MotionEvent ev))&#123; consume=onTouchEvent(ev); &#125;else&#123; //ä¼ é€’ç»™å­å…ƒç´ å»å¤„ç† child.disPatchTouchEvent(ev); &#125; return consume;&#125; åˆ†æViewçš„äº‹ä»¶åˆ†å‘æœºåˆ¶ ä¸ºäº†ç®€å•èµ·è§æˆ‘ä»¬å…ˆä»Viewçš„äº‹ä»¶åˆ†å‘æœºåˆ¶å¼€å§‹åˆ†æï¼Œç„¶ååœ¨åˆ†æViewGroupçš„ï¼Œé¦–å…ˆæˆ‘ä»¬å»ºä¸€ä¸ªç®€å•çš„é¡¹ç›®ï¼Œè¿™ä¸ªé¡¹ç›®é‡Œåªæœ‰ä¸€ä¸ªButtonï¼Œå¹¶ä¸”æˆ‘ä»¬ç»™è¿™ä¸ªButtonè®¾ç½®ç‚¹å‡»äº‹ä»¶ï¼š 12345678910111213141516&lt;RelativeLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" xmlns:tools=\"http://schemas.android.com/tools\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\" &gt; &lt;Button android:id=\"@+id/btn\" android:layout_width=\"match_parent\" android:layout_height=\"wrap_content\" android:layout_alignParentTop=\"true\" android:layout_centerHorizontal=\"true\" android:layout_marginTop=\"100dp\" android:text=\"Click me\" /&gt;&lt;/RelativeLayout&gt; 123456789101112131415161718192021222324252627282930313233343536package com.example.testbtn;import android.app.Activity;import android.os.Bundle;import android.util.Log;import android.view.Menu;import android.view.MenuItem;import android.view.MotionEvent;import android.view.View;import android.view.View.OnClickListener;import android.view.View.OnTouchListener;import android.widget.Button;public class MainActivity extends Activity implements OnClickListener,OnTouchListener&#123; private Button btn; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); btn=(Button) findViewById(R.id.btn); btn.setOnClickListener(this); btn.setOnTouchListener(this); &#125; @Override public void onClick(View v) &#123; Log.d(\"TAG\", \"OnClick\"); &#125; @Override public boolean onTouch(View v, MotionEvent event) &#123; Log.d(\"TAG\", \"onTouch\"+event.getAction()); return false; &#125;&#125; ç•Œé¢æ˜¯è¿™æ ·çš„ï¼š è¿è¡Œè¿™ä¸ªç¨‹åºï¼Œç‚¹å‡»Buttonï¼ŒæŸ¥çœ‹Logæ‰“å°è¾“å‡ºçš„ä¿¡æ¯ï¼š (è¿™é‡ŒonTouch0ä»£è¡¨çš„æ˜¯ACTION_DOWNï¼ŒonTouch1ä»£è¡¨çš„æ˜¯ACTION_UPï¼ŒonTouch2è¡¨ç¤ºACTION_MOVEï¼Œå› ä¸ºæˆ‘ä»¬åªæ˜¯ç¨³ç¨³çš„ç‚¹å‡»äº†ä¸€ä¸‹Buttonæ‰€ä»¥ä¸ä¼šæœ‰ACTION_MOVEçš„Logä¿¡æ¯å‡ºç°) è¿™æ ·æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ªåˆæ­¥çš„ç»“è®ºï¼šonTouch()æ–¹æ³•æ˜¯ä¼˜å…ˆäºonClick()æ‰§è¡Œçš„ï¼Œç„¶åæˆ‘ä»¬ä¼šå‘ç°onTouch()æ–¹æ³•æœ‰ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„å’ŒonClick()æ–¹æ³•ä¸åŒçš„åœ°æ–¹çš„ï¼Œé‚£å°±æ˜¯å®ƒæœ‰ä¸€ä¸ªBooleanç±»å‹çš„è¿”å›å€¼ï¼Œå¦‚æœæˆ‘ä»¬æŠŠè¿™ä¸ªé»˜è®¤ä¸ºFalseçš„è¿”å›å€¼æ”¹ä¸ºTrueä¼šæ€ä¹ˆæ ·å‘¢ï¼š å‘ç°äº†ä»€ä¹ˆï¼šonClick()æ–¹æ³•æ²¡æœ‰è¢«æ‰§è¡Œï¼Œè¿™é‡Œæˆ‘ä»¬æŠŠè¿™ç§ç°è±¡å«åšç‚¹å‡»äº‹ä»¶è¢«onTouch()æ¶ˆè´¹æ‰äº†ï¼Œäº‹ä»¶ä¸ä¼šåœ¨ç»§ç»­å‘onClick()æ–¹æ³•ä¼ é€’äº†ï¼Œé‚£ä¹ˆäº‹ä»¶åˆ†å‘æœºåˆ¶æœ€åŸºæœ¬çš„å‡ æ¡æˆ‘ä»¬å·²ç»äº†è§£äº†ï¼Œä¸‹é¢æˆ‘ä»¬æ¥åˆ†æäº§ç”Ÿè¿™ç§æœºåˆ¶çš„æ ¹æœ¬åŸå› ã€‚ Viewå¯¹ç‚¹å‡»äº‹ä»¶çš„å¤„ç†è¿‡ç¨‹é¦–å…ˆæˆ‘ä»¬ç»™å‡ºä¸€ä¸ªç»“è®ºï¼šAndroidä¸­æ‰€æœ‰çš„äº‹ä»¶éƒ½å¿…é¡»ç»è¿‡disPatchTouchEvent(MotionEvent ev)è¿™ä¸ªæ–¹æ³•çš„åˆ†å‘ï¼Œç„¶åå†³å®šæ˜¯è‡ªèº«æ¶ˆè´¹å½“å‰äº‹ä»¶è¿˜æ˜¯ç»§ç»­å¾€ä¸‹åˆ†å‘ç»™å­æ§ä»¶å¤„ç†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ¥çœ‹çœ‹è¿™ä¸ªdisPatchTouchEvent(MotionEvent ev)åˆ°åº•å¹²äº†ä»€ä¹ˆã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152public boolean dispatchTouchEvent(MotionEvent event) &#123; // If the event should be handled by accessibility focus first. if (event.isTargetAccessibilityFocus()) &#123; // We don't have focus or no virtual descendant has it, do not handle the event. if (!isAccessibilityFocusedViewOrHost()) &#123; return false; &#125; // We have focus and got the event, then use normal event dispatch. event.setTargetAccessibilityFocus(false); &#125; boolean result = false; if (mInputEventConsistencyVerifier != null) &#123; mInputEventConsistencyVerifier.onTouchEvent(event, 0); &#125; final int actionMasked = event.getActionMasked(); if (actionMasked == MotionEvent.ACTION_DOWN) &#123; // Defensive cleanup for new gesture stopNestedScroll(); &#125; if (onFilterTouchEventForSecurity(event)) &#123; //noinspection SimplifiableIfStatement ListenerInfo li = mListenerInfo; if (li != null &amp;&amp; li.mOnTouchListener != null &amp;&amp; (mViewFlags &amp; ENABLED_MASK) == ENABLED &amp;&amp; li.mOnTouchListener.onTouch(this, event)) &#123; result = true; &#125; if (!result &amp;&amp; onTouchEvent(event)) &#123; result = true; &#125; &#125; if (!result &amp;&amp; mInputEventConsistencyVerifier != null) &#123; mInputEventConsistencyVerifier.onUnhandledEvent(event, 0); &#125; // Clean up after nested scrolls if this is the end of a gesture; // also cancel it if we tried an ACTION_DOWN but we didn't want the rest // of the gesture. if (actionMasked == MotionEvent.ACTION_UP || actionMasked == MotionEvent.ACTION_CANCEL || (actionMasked == MotionEvent.ACTION_DOWN &amp;&amp; !result)) &#123; stopNestedScroll(); &#125; return result; &#125; ä»£ç æœ‰ç‚¹å¤šï¼Œæˆ‘ä»¬ä¸€æ­¥æ­¥æ¥çœ‹ï¼š 123456789// If the event should be handled by accessibility focus first. if (event.isTargetAccessibilityFocus()) &#123; // We don't have focus or no virtual descendant has it, do not handle the event. if (!isAccessibilityFocusedViewOrHost()) &#123; return false; &#125; // We have focus and got the event, then use normal event dispatch. event.setTargetAccessibilityFocus(false); &#125; æœ€å‰é¢è¿™ä¸€æ®µå°±æ˜¯åˆ¤æ–­å½“å‰äº‹ä»¶æ˜¯å¦èƒ½è·å¾—ç„¦ç‚¹ï¼Œå¦‚æœä¸èƒ½è·å¾—ç„¦ç‚¹æˆ–è€…ä¸å­˜åœ¨ä¸€ä¸ªViewé‚£æˆ‘ä»¬å°±ç›´æ¥è¿”å›Falseè·³å‡ºå¾ªç¯ï¼Œæ¥ä¸‹æ¥ï¼š 123456789if (mInputEventConsistencyVerifier != null) &#123; mInputEventConsistencyVerifier.onTouchEvent(event, 0); &#125; final int actionMasked = event.getActionMasked(); if (actionMasked == MotionEvent.ACTION_DOWN) &#123; // Defensive cleanup for new gesture stopNestedScroll(); &#125; è®¾ç½®ä¸€äº›æ ‡è®°å’Œå¤„ç†inputä¸æ‰‹åŠ¿ç­‰ä¼ é€’ï¼Œä¸ç”¨ç®¡ï¼Œåˆ°è¿™é‡Œï¼š 12345678910111213if (onFilterTouchEventForSecurity(event)) &#123; //noinspection SimplifiableIfStatement ListenerInfo li = mListenerInfo; if (li != null &amp;&amp; li.mOnTouchListener != null &amp;&amp; (mViewFlags &amp; ENABLED_MASK) == ENABLED &amp;&amp; li.mOnTouchListener.onTouch(this, event)) &#123; result = true; &#125; if (!result &amp;&amp; onTouchEvent(event)) &#123; result = true; &#125; &#125; è¿™é‡Œif (onFilterTouchEventForSecurity(event))æ˜¯ç”¨æ¥åˆ¤æ–­Viewæ˜¯å¦è¢«é®ä½ç­‰ï¼ŒListenerInfoæ˜¯Viewçš„é™æ€å†…éƒ¨ç±»ï¼Œä¸“é—¨ç”¨æ¥å®šä¹‰ä¸€äº›XXXListenerç­‰æ–¹æ³•çš„ï¼Œåˆ°äº†é‡ç‚¹ï¼š 12345if (li != null &amp;&amp; li.mOnTouchListener != null &amp;&amp; (mViewFlags &amp; ENABLED_MASK) == ENABLED &amp;&amp; li.mOnTouchListener.onTouch(this, event)) &#123; result = true; &#125; å¾ˆé•¿çš„ä¸€ä¸ªåˆ¤æ–­ï¼Œä¸€ä¸ªä¸ªæ¥è§£é‡Šï¼šç¬¬ä¸€ä¸ªliè‚¯å®šä¸ä¸ºç©ºï¼Œå› ä¸ºåœ¨è¿™ä¸ªIfåˆ¤æ–­è¯­å¥ä¹‹å‰å°±newäº†ä¸€ä¸ªliï¼Œç¬¬äºŒä¸ªæ¡ä»¶li.mOnTouchListener != nullï¼Œæ€ä¹ˆç¡®å®šè¿™ä¸ªmOnTouchListenerä¸ä¸ºç©ºå‘¢ï¼Ÿæˆ‘ä»¬åœ¨Viewç±»é‡Œé¢å‘ç°äº†å¦‚ä¸‹æ–¹æ³•ï¼š 1234567/** * Register a callback to be invoked when a touch event is sent to this view. * @param l the touch listener to attach to this view */ public void setOnTouchListener(OnTouchListener l) &#123; getListenerInfo().mOnTouchListener = l; &#125; æ„å‘³ç€åªè¦ç»™æ§ä»¶æ³¨å†Œäº†onTouchäº‹ä»¶è¿™ä¸ªmOnTouchListenerå°±ä¸€å®šä¼šè¢«èµ‹å€¼,æ¥ä¸‹æ¥(mViewFlags &amp; ENABLED_MASK) == ENABLEDæ˜¯é€šè¿‡ä½ä¸è¿ç®—æ¥åˆ¤æ–­è¿™ä¸ªViewæ˜¯å¦æ˜¯ENABLEDçš„ï¼Œæˆ‘ä»¬é»˜è®¤æ§ä»¶éƒ½æ˜¯ENABLEDçš„æ‰€ä»¥è¿™ä¸€æ¡ä¹Ÿæˆç«‹ï¼Œæœ€åä¸€æ¡li.mOnTouchListener.onTouch(this, event)æ˜¯åˆ¤æ–­onTouch()çš„è¿”å›å€¼æ˜¯å¦ä¸ºTrueï¼Œæˆ‘ä»¬åé¢æŠŠé»˜è®¤ä¸ºFalseçš„è¿”å›å€¼æ”¹æˆäº†Trueï¼Œæ‰€ä»¥è¿™ä¸€æ•´ç³»åˆ—çš„åˆ¤æ–­éƒ½æ˜¯Trueï¼Œé‚£ä¹ˆè¿™ä¸ªdisPatchTouchEvent(MotionEvent ev)æ–¹æ³•ç›´æ¥å°±è¿”å›äº†True,é‚£ä¹ˆæ¥ä¸‹æ¥çš„ä»£ç éƒ½ä¸ä¼šè¢«æ‰§è¡Œï¼Œæˆ‘ä»¬ä¸‹é¢æœ‰è¿™ä¹ˆä¸€æ®µä»£ç ï¼š 123if (!result &amp;&amp; onTouchEvent(event)) &#123; result = true; &#125; æœ€å¼€å§‹æˆ‘ä»¬onTouch()æ–¹æ³•çš„è¿”å›å€¼æ˜¯Falseçš„ï¼Œé‚£ä¹ˆ 12345if (li != null &amp;&amp; li.mOnTouchListener != null &amp;&amp; (mViewFlags &amp; ENABLED_MASK) == ENABLED &amp;&amp; li.mOnTouchListener.onTouch(this, event)) &#123; result = true; &#125; è¿™é‡Œé¢çš„åˆ¤æ–­å°±ä¸æˆç«‹ï¼Œresultæœ€å¼€å§‹çš„é»˜è®¤å€¼ä¹Ÿæ˜¯falseï¼Œé‚£ä¹ˆæ­¤æ—¶å¦‚æœ 1onTouchEvent(event) è¿”å›å€¼ä¹Ÿæ˜¯Trueï¼Œé‚£ä¹ˆif (!result &amp;&amp; onTouchEvent(event))è¿™ä¸ªæ–¹æ³•åˆ¤æ–­æ¡ä»¶æˆç«‹ï¼ŒdisPatchTouchEvent(MotionEvent ev)è¿”å›Trueï¼Œå¦åˆ™è¿”å›Falseã€‚ è¿™é‡Œæˆ‘ä»¬å¾—åˆ°ä¸¤ä¸ªç»“è®ºï¼š OnTouchListenerçš„ä¼˜å…ˆçº§æ¯”onTouchEventè¦é«˜ï¼Œè”æƒ³åˆ°åˆšæ‰çš„å°Demoä¹Ÿå¯ä»¥å¾—å‡ºonTouchæ–¹æ³•ä¼˜å…ˆäºonClick()æ–¹æ³•æ‰§è¡Œ(onClick()æ˜¯åœ¨onTouchEvent(event)æ–¹æ³•ä¸­è¢«æ‰§è¡Œçš„è¿™ä¸ªå¾…ä¼šä¼šè¯´åˆ°) å¦‚æœæ§ä»¶ï¼ˆViewï¼‰çš„onTouchè¿”å›Falseæˆ–è€…mOnTouchListenerä¸ºnullï¼ˆæ§ä»¶æ²¡æœ‰è®¾ç½®setOnTouchListeneræ–¹æ³•ï¼‰æˆ–è€…æ§ä»¶ä¸æ˜¯ENABLEçš„æƒ…å†µä¸‹ä¼šè°ƒç”¨onTouchEventæ–¹æ³•ï¼Œæ­¤æ—¶dispatchTouchEventæ–¹æ³•çš„è¿”å›å€¼ä¸onTouchEventçš„è¿”å›å€¼ä¸€æ ·ã€‚ é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±åˆ†ædispatchTouchEventæ–¹æ³•é‡Œé¢onTouchEventçš„å®ç°,ç»™å‡ºonTouchEventçš„æºç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155/** * Implement this method to handle touch screen motion events. * &lt;p&gt; * If this method is used to detect click actions, it is recommended that * the actions be performed by implementing and calling * &#123;@link #performClick()&#125;. This will ensure consistent system behavior, * including: * &lt;ul&gt; * &lt;li&gt;obeying click sound preferences * &lt;li&gt;dispatching OnClickListener calls * &lt;li&gt;handling &#123;@link AccessibilityNodeInfo#ACTION_CLICK ACTION_CLICK&#125; when * accessibility features are enabled * &lt;/ul&gt; * * @param event The motion event. * @return True if the event was handled, false otherwise. */ public boolean onTouchEvent(MotionEvent event) &#123; final float x = event.getX(); final float y = event.getY(); final int viewFlags = mViewFlags; final int action = event.getAction(); if ((viewFlags &amp; ENABLED_MASK) == DISABLED) &#123; if (action == MotionEvent.ACTION_UP &amp;&amp; (mPrivateFlags &amp; PFLAG_PRESSED) != 0) &#123; setPressed(false); &#125; // A disabled view that is clickable still consumes the touch // events, it just doesn't respond to them. return (((viewFlags &amp; CLICKABLE) == CLICKABLE || (viewFlags &amp; LONG_CLICKABLE) == LONG_CLICKABLE) || (viewFlags &amp; CONTEXT_CLICKABLE) == CONTEXT_CLICKABLE); &#125; if (mTouchDelegate != null) &#123; if (mTouchDelegate.onTouchEvent(event)) &#123; return true; &#125; &#125; if (((viewFlags &amp; CLICKABLE) == CLICKABLE || (viewFlags &amp; LONG_CLICKABLE) == LONG_CLICKABLE) || (viewFlags &amp; CONTEXT_CLICKABLE) == CONTEXT_CLICKABLE) &#123; switch (action) &#123; case MotionEvent.ACTION_UP: boolean prepressed = (mPrivateFlags &amp; PFLAG_PREPRESSED) != 0; if ((mPrivateFlags &amp; PFLAG_PRESSED) != 0 || prepressed) &#123; // take focus if we don't have it already and we should in // touch mode. boolean focusTaken = false; if (isFocusable() &amp;&amp; isFocusableInTouchMode() &amp;&amp; !isFocused()) &#123; focusTaken = requestFocus(); &#125; if (prepressed) &#123; // The button is being released before we actually // showed it as pressed. Make it show the pressed // state now (before scheduling the click) to ensure // the user sees it. setPressed(true, x, y); &#125; if (!mHasPerformedLongPress &amp;&amp; !mIgnoreNextUpEvent) &#123; // This is a tap, so remove the longpress check removeLongPressCallback(); // Only perform take click actions if we were in the pressed state if (!focusTaken) &#123; // Use a Runnable and post this rather than calling // performClick directly. This lets other visual state // of the view update before click actions start. if (mPerformClick == null) &#123; mPerformClick = new PerformClick(); &#125; if (!post(mPerformClick)) &#123; performClick(); &#125; &#125; &#125; if (mUnsetPressedState == null) &#123; mUnsetPressedState = new UnsetPressedState(); &#125; if (prepressed) &#123; postDelayed(mUnsetPressedState, ViewConfiguration.getPressedStateDuration()); &#125; else if (!post(mUnsetPressedState)) &#123; // If the post failed, unpress right now mUnsetPressedState.run(); &#125; removeTapCallback(); &#125; mIgnoreNextUpEvent = false; break; case MotionEvent.ACTION_DOWN: mHasPerformedLongPress = false; if (performButtonActionOnTouchDown(event)) &#123; break; &#125; // Walk up the hierarchy to determine if we're inside a scrolling container. boolean isInScrollingContainer = isInScrollingContainer(); // For views inside a scrolling container, delay the pressed feedback for // a short period in case this is a scroll. if (isInScrollingContainer) &#123; mPrivateFlags |= PFLAG_PREPRESSED; if (mPendingCheckForTap == null) &#123; mPendingCheckForTap = new CheckForTap(); &#125; mPendingCheckForTap.x = event.getX(); mPendingCheckForTap.y = event.getY(); postDelayed(mPendingCheckForTap, ViewConfiguration.getTapTimeout()); &#125; else &#123; // Not inside a scrolling container, so show the feedback right away setPressed(true, x, y); checkForLongClick(0); &#125; break; case MotionEvent.ACTION_CANCEL: setPressed(false); removeTapCallback(); removeLongPressCallback(); mInContextButtonPress = false; mHasPerformedLongPress = false; mIgnoreNextUpEvent = false; break; case MotionEvent.ACTION_MOVE: drawableHotspotChanged(x, y); // Be lenient about moving outside of buttons if (!pointInView(x, y, mTouchSlop)) &#123; // Outside button removeTapCallback(); if ((mPrivateFlags &amp; PFLAG_PRESSED) != 0) &#123; // Remove any future long press/tap checks removeLongPressCallback(); setPressed(false); &#125; &#125; break; &#125; return true; &#125; return false; &#125; ä»£ç è¿˜æ˜¯å¾ˆå¤šï¼Œæˆ‘ä»¬ä¾ç„¶ä¸€æ®µä¸€æ®µæ¥åˆ†æï¼Œæœ€å‰é¢çš„ä¸€æ®µä»£ç ï¼š 12345678910if ((viewFlags &amp; ENABLED_MASK) == DISABLED) &#123; if (action == MotionEvent.ACTION_UP &amp;&amp; (mPrivateFlags &amp; PFLAG_PRESSED) != 0) &#123; setPressed(false); &#125; // A disabled view that is clickable still consumes the touch // events, it just doesn't respond to them. return (((viewFlags &amp; CLICKABLE) == CLICKABLE || (viewFlags &amp; LONG_CLICKABLE) == LONG_CLICKABLE) || (viewFlags &amp; CONTEXT_CLICKABLE) == CONTEXT_CLICKABLE); &#125; æ ¹æ®å‰é¢çš„åˆ†ææˆ‘ä»¬çŸ¥é“è¿™ä¸€æ®µä»£ç æ˜¯å¯¹å½“å‰Viewå¤„äºä¸å¯ç”¨çŠ¶æ€çš„æƒ…å†µä¸‹çš„åˆ†æï¼Œé€šè¿‡æ³¨é‡Šæˆ‘ä»¬çŸ¥é“å³ä½¿æ˜¯ä¸€ä¸ªä¸å¯ç”¨çŠ¶æ€ä¸‹çš„Viewä¾ç„¶ä¼šæ¶ˆè€—ç‚¹å‡»äº‹ä»¶ï¼Œåªæ˜¯ä¸ä¼šå¯¹è¿™ä¸ªç‚¹å‡»äº‹ä»¶ä½œå‡ºå“åº”ç½¢äº†ï¼Œå¦å¤–é€šè¿‡è§‚å¯Ÿè¿™ä¸ªreturnè¿”å›å€¼ï¼Œåªè¦è¿™ä¸ªViewçš„CLICKABLEå’ŒLONG_CLICKABLEæˆ–è€…CONTEXT_CLICKABLEæœ‰ä¸€ä¸ªä¸ºTrueï¼Œé‚£ä¹ˆè¿”å›å€¼å°±æ˜¯Trueï¼ŒonTouchEventæ–¹æ³•ä¼šæ¶ˆè€—å½“å‰äº‹ä»¶ã€‚ çœ‹ä¸‹ä¸€æ®µä»£ç ï¼š 12345if (mTouchDelegate != null) &#123; if (mTouchDelegate.onTouchEvent(event)) &#123; return true; &#125; &#125; è¿™æ®µä»£ç çš„æ„æ€æ˜¯å¦‚æœViewè®¾ç½®æœ‰ä»£ç†ï¼Œé‚£ä¹ˆè¿˜ä¼šæ‰§è¡ŒTouchDelegateçš„onTouchEvent(event)æ–¹æ³•ï¼Œè¿™ä¸ªonTouchEvent(event)çš„å·¥ä½œæœºåˆ¶çœ‹èµ·æ¥å’ŒOnTouchListenerç±»ä¼¼ï¼Œè¿™é‡Œä¸æ·±å…¥ç ”ç©¶ã€‚ â€“ã€ŠAndroidå¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹ ä¸‹é¢çœ‹ä¸€ä¸‹onTouchEventä¸­å¯¹ç‚¹å‡»äº‹ä»¶çš„å…·ä½“å¤„ç†æµç¨‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115if (((viewFlags &amp; CLICKABLE) == CLICKABLE || (viewFlags &amp; LONG_CLICKABLE) == LONG_CLICKABLE) || (viewFlags &amp; CONTEXT_CLICKABLE) == CONTEXT_CLICKABLE) &#123; switch (action) &#123; case MotionEvent.ACTION_UP: boolean prepressed = (mPrivateFlags &amp; PFLAG_PREPRESSED) != 0; if ((mPrivateFlags &amp; PFLAG_PRESSED) != 0 || prepressed) &#123; // take focus if we don't have it already and we should in // touch mode. boolean focusTaken = false; if (isFocusable() &amp;&amp; isFocusableInTouchMode() &amp;&amp; !isFocused()) &#123; focusTaken = requestFocus(); &#125; if (prepressed) &#123; // The button is being released before we actually // showed it as pressed. Make it show the pressed // state now (before scheduling the click) to ensure // the user sees it. setPressed(true, x, y); &#125; if (!mHasPerformedLongPress &amp;&amp; !mIgnoreNextUpEvent) &#123; // This is a tap, so remove the longpress check removeLongPressCallback(); // Only perform take click actions if we were in the pressed state if (!focusTaken) &#123; // Use a Runnable and post this rather than calling // performClick directly. This lets other visual state // of the view update before click actions start. if (mPerformClick == null) &#123; mPerformClick = new PerformClick(); &#125; if (!post(mPerformClick)) &#123; performClick(); &#125; &#125; &#125; if (mUnsetPressedState == null) &#123; mUnsetPressedState = new UnsetPressedState(); &#125; if (prepressed) &#123; postDelayed(mUnsetPressedState, ViewConfiguration.getPressedStateDuration()); &#125; else if (!post(mUnsetPressedState)) &#123; // If the post failed, unpress right now mUnsetPressedState.run(); &#125; removeTapCallback(); &#125; mIgnoreNextUpEvent = false; break; case MotionEvent.ACTION_DOWN: mHasPerformedLongPress = false; if (performButtonActionOnTouchDown(event)) &#123; break; &#125; // Walk up the hierarchy to determine if we're inside a scrolling container. boolean isInScrollingContainer = isInScrollingContainer(); // For views inside a scrolling container, delay the pressed feedback for // a short period in case this is a scroll. if (isInScrollingContainer) &#123; mPrivateFlags |= PFLAG_PREPRESSED; if (mPendingCheckForTap == null) &#123; mPendingCheckForTap = new CheckForTap(); &#125; mPendingCheckForTap.x = event.getX(); mPendingCheckForTap.y = event.getY(); postDelayed(mPendingCheckForTap, ViewConfiguration.getTapTimeout()); &#125; else &#123; // Not inside a scrolling container, so show the feedback right away setPressed(true, x, y); checkForLongClick(0); &#125; break; case MotionEvent.ACTION_CANCEL: setPressed(false); removeTapCallback(); removeLongPressCallback(); mInContextButtonPress = false; mHasPerformedLongPress = false; mIgnoreNextUpEvent = false; break; case MotionEvent.ACTION_MOVE: drawableHotspotChanged(x, y); // Be lenient about moving outside of buttons if (!pointInView(x, y, mTouchSlop)) &#123; // Outside button removeTapCallback(); if ((mPrivateFlags &amp; PFLAG_PRESSED) != 0) &#123; // Remove any future long press/tap checks removeLongPressCallback(); setPressed(false); &#125; &#125; break; &#125; return true; &#125; return false; &#125; æˆ‘ä»¬è¿˜æ˜¯ä¸€è¡Œè¡Œæ¥åˆ†è§£ï¼š 12345678if (((viewFlags &amp; CLICKABLE) == CLICKABLE || (viewFlags &amp; LONG_CLICKABLE) == LONG_CLICKABLE) || (viewFlags &amp; CONTEXT_CLICKABLE) == CONTEXT_CLICKABLE) &#123; switch (action) &#123; //çœç•¥ &#125; return false; &#125; è¿™ä¸ªåˆ¤æ–­ä¹‹å‰æè¿°è¿‡ä¸å†èµ˜è¿°ï¼Œå¦‚æœè¿™ä¸ªåˆ¤æ–­ä¸æˆç«‹ç›´æ¥è·³åˆ°æ–¹æ³•å°¾éƒ¨è¿”å›Falseï¼Œå¦‚æœåˆ¤æ–­æˆç«‹åˆ™ç»§ç»­è¿›å…¥æ–¹æ³•å†…éƒ¨è¿›è¡Œä¸€ä¸ªswitch(event)çš„åˆ¤æ–­ï¼Œè¿™é‡ŒACTION_DOWNå’ŒACTION_MOVEéƒ½åªæ˜¯è¿›è¡Œä¸€äº›å¿…è¦çš„è®¾ç½®ä¸ç½®ä½ï¼Œæˆ‘ä»¬ä¸»è¦çœ‹ACTION_UPï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051case MotionEvent.ACTION_UP: boolean prepressed = (mPrivateFlags &amp; PFLAG_PREPRESSED) != 0; if ((mPrivateFlags &amp; PFLAG_PRESSED) != 0 || prepressed) &#123; // take focus if we don't have it already and we should in // touch mode. boolean focusTaken = false; if (isFocusable() &amp;&amp; isFocusableInTouchMode() &amp;&amp; !isFocused()) &#123; focusTaken = requestFocus(); &#125; if (prepressed) &#123; // The button is being released before we actually // showed it as pressed. Make it show the pressed // state now (before scheduling the click) to ensure // the user sees it. setPressed(true, x, y); &#125; if (!mHasPerformedLongPress &amp;&amp; !mIgnoreNextUpEvent) &#123; // This is a tap, so remove the longpress check removeLongPressCallback(); // Only perform take click actions if we were in the pressed state if (!focusTaken) &#123; // Use a Runnable and post this rather than calling // performClick directly. This lets other visual state // of the view update before click actions start. if (mPerformClick == null) &#123; mPerformClick = new PerformClick(); &#125; if (!post(mPerformClick)) &#123; performClick(); &#125; &#125; &#125; if (mUnsetPressedState == null) &#123; mUnsetPressedState = new UnsetPressedState(); &#125; if (prepressed) &#123; postDelayed(mUnsetPressedState, ViewConfiguration.getPressedStateDuration()); &#125; else if (!post(mUnsetPressedState)) &#123; // If the post failed, unpress right now mUnsetPressedState.run(); &#125; removeTapCallback(); &#125; mIgnoreNextUpEvent = false; é¦–å…ˆåˆ¤æ–­äº†æ˜¯å¦è¢«æŒ‰ä¸‹ boolean prepressed = (mPrivateFlags &amp; PFLAG_PREPRESSED) != 0;æ¥ä¸‹æ¥åˆ¤æ–­æ˜¯ä¸æ˜¯å¯ä»¥è·å¾—ç„¦ç‚¹ï¼ŒåŒæ—¶å°è¯•å»è·å–ç„¦ç‚¹ï¼š 1234boolean focusTaken = false; if (isFocusable() &amp;&amp; isFocusableInTouchMode() &amp;&amp; !isFocused()) &#123; focusTaken = requestFocus(); &#125; ç»è¿‡ç§ç§åˆ¤æ–­åæˆ‘ä»¬çœ‹åˆ°è¿™ä¸€è¡Œï¼š 123if (!post(mPerformClick)) &#123; performClick(); &#125; è¿™æ˜¯åˆ¤æ–­å¦‚æœä¸æ˜¯longPressedåˆ™é€šè¿‡poståœ¨UI Threadä¸­æ‰§è¡Œä¸€ä¸ªPerformClickçš„Runnableï¼Œä¹Ÿå°±æ˜¯performClickæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„æºç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122/** * Call this view's OnClickListener, if it is defined. Performs all normal * actions associated with clicking: reporting accessibility event, playing * a sound, etc. * * @return True there was an assigned OnClickListener that was called, false * otherwise is returned. */ public boolean performClick() &#123; final boolean result; final ListenerInfo li = mListenerInfo; if (li != null &amp;&amp; li.mOnClickListener != null) &#123; playSoundEffect(SoundEffectConstants.CLICK); li.mOnClickListener.onClick(this); result = true; &#125; else &#123; result = false; &#125; sendAccessibilityEvent(AccessibilityEvent.TYPE_VIEW_CLICKED); return result; &#125; æˆ‘ä»¬å‘ç°äº†ä»€ä¹ˆï¼Œé‚£å°±æ˜¯å½“ACTION_UPäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä¼šè§¦å‘performClick()æ–¹æ³•ï¼Œå¦‚æœè¿™ä¸ªViewè®¾ç½®äº†OnClickListeneré‚£ä¹ˆæœ€ç»ˆä¼šæ‰§è¡Œåˆ°OnClickListenerçš„å›è°ƒæ–¹æ³•onClick(),è¿™ä¹Ÿå°±éªŒè¯äº†åˆšæ‰æ‰€è¯´çš„ï¼šonClick()æ–¹æ³•æ˜¯åœ¨onTouchEventå†…éƒ¨è¢«è°ƒç”¨çš„ã€‚ åŒæˆ‘ä»¬å‰é¢æ‰¾åˆ°mOnTouchListeneråœ¨å“ªé‡Œèµ‹å€¼çš„ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰¾åˆ°mOnClickListeneråœ¨å“ªé‡Œèµ‹å€¼çš„ï¼š 1234567891011121314/** * Register a callback to be invoked when this view is clicked. If this view is not * clickable, it becomes clickable. * * @param l The callback that will run * * @see #setClickable(boolean) */ public void setOnClickListener(@Nullable OnClickListener l) &#123; if (!isClickable()) &#123; setClickable(true); &#125; getListenerInfo().mOnClickListener = l; &#125; æˆ‘ä»¬çŸ¥é“Viewçš„LONG_CLICKABLEå±æ€§é»˜è®¤æ˜¯Falseçš„ï¼Œéœ€è¦çš„è¯æˆ‘ä»¬å¯ä»¥è‡ªå·±åœ¨xmlæˆ–è€…javaæ–‡ä»¶ä¸­å»è®¾ç½®ï¼Œä½†æ˜¯CLICKABLEçš„Falseä¸Trueæ˜¯å’Œå…·ä½“çš„Viewæœ‰å…³çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬çŸ¥é“Buttonæ˜¯å¯ç‚¹å‡»çš„ï¼Œä½†æ˜¯TextViewé»˜è®¤æ˜¯ä¸å¯ç‚¹å‡»çš„ï¼Œä½†æ˜¯å¦‚æœç»™TextViewè®¾ç½®äº†ç‚¹å‡»äº‹ä»¶ï¼Œé‚£ä¹ˆæ ¹æ® 123if (!isClickable()) &#123; setClickable(true); &#125; è¿™å‡ è¡Œä»£ç TextViewä¹Ÿä¼šè¢«è®¾ç½®ä¸ºå¯ç‚¹å‡»çš„ï¼ŒåŒç†è¿˜æœ‰setOnLongClickListenerä¹Ÿæœ‰è¿™ç§ä½œç”¨ï¼š 1234567891011121314/** * Register a callback to be invoked when this view is clicked and held. If this view is not * long clickable, it becomes long clickable. * * @param l The callback that will run * * @see #setLongClickable(boolean) */ public void setOnLongClickListener(@Nullable OnLongClickListener l) &#123; if (!isLongClickable()) &#123; setLongClickable(true); &#125; getListenerInfo().mOnLongClickListener = l; &#125; æ€»ç»“åˆ°æ­¤ï¼ŒViewçš„äº‹ä»¶åˆ†å‘æœºåˆ¶å·²ç»åˆ†æå®Œäº†ï¼Œæ•´ä¸ªè¿‡ç¨‹æŸ¥äº†è®¸å¤šèµ„æ–™ï¼Œæœ€ä¸»è¦çš„æ˜¯è·Ÿç€ä»»ç‰åˆšè€å¸ˆçš„ã€ŠAndroidå¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹å­¦ä¹ ï¼Œæœ€åæŠŠè¿™ä¸ªå­¦ä¹ çš„è¿‡ç¨‹è®°å½•ä¸‹æ¥å°±æ˜¯è¿™ç¯‡åšå®¢äº†ï¼Œç­‰æœ‰æ—¶é—´çš„æ—¶å€™æŠŠViewGroupçš„äº‹ä»¶åˆ†å‘æœºåˆ¶ä¹Ÿåˆ†æä¸€éã€‚ ä¸»è¦å‚è€ƒ Androidè§¦æ‘¸å±äº‹ä»¶æ´¾å‘æœºåˆ¶è¯¦è§£ä¸æºç åˆ†æä¸€(Viewç¯‡) Androidäº‹ä»¶ä¼ é€’æœºåˆ¶ è¯·çœ‹åç»­ ViewGroupçš„äº‹ä»¶åˆ†å‘æœºåˆ¶","tags":[{"name":"äº‹ä»¶åˆ†å‘","slug":"äº‹ä»¶åˆ†å‘","permalink":"https://www.limuyang.cc/tags/äº‹ä»¶åˆ†å‘/"},{"name":"å›è°ƒ","slug":"å›è°ƒ","permalink":"https://www.limuyang.cc/tags/å›è°ƒ/"}]},{"title":"å›è°ƒå‡½æ•°æœºåˆ¶","date":"2016-04-01T23:12:01.000Z","path":"2016/04/01/å›è°ƒå‡½æ•°æœºåˆ¶/","text":"å¼•è¨€ åœ¨Androidçš„å­¦ä¹ è¿‡ç¨‹ä¸­ç»å¸¸ä¼šå¬åˆ°æˆ–è€…è§åˆ°â€œå›è°ƒâ€è¿™ä¸ªè¯ï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯å›è°ƒå‘¢ï¼Ÿæ‰€è°“çš„å›è°ƒå‡½æ•°å°±æ˜¯ï¼šåœ¨Aç±»ä¸­å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸­ç”¨åˆ°äº†ä¸€ä¸ªæ¥å£å’Œè¯¥æ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³•ï¼Œä½†æ˜¯æŠ½è±¡æ–¹æ³•æ²¡æœ‰å…·ä½“çš„å®ç°ï¼Œéœ€è¦Bç±»å»å®ç°ï¼ŒBç±»å®ç°è¯¥æ–¹æ³•åï¼Œå®ƒæœ¬èº«ä¸ä¼šå»è°ƒç”¨è¯¥æ–¹æ³•ï¼Œè€Œæ˜¯ä¼ é€’ç»™Aç±»ï¼Œä¾›Aç±»å»è°ƒç”¨ï¼Œè¿™ç§æœºåˆ¶å°±ç§°ä¸ºå›è°ƒã€‚ è¿™ä¹ˆè¯´å¯èƒ½è¿˜æ˜¯æœ‰äº›æ¨¡æ¨¡ç³Šç³Šï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç”¨ç±»æ¯”çš„æ–¹æ³•ä¸€æ­¥æ­¥æ¥çœ‹åˆ°åº•è¯¥æ€ä¹ˆå†™ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå› ä¸ºandroidå›è°ƒä¸­æœ€å¸¸è§çš„æ˜¯Buttonçš„ç‚¹å‡»äº‹ä»¶çš„å›è°ƒï¼Œè¿™é‡Œä»¥æ­¤ä¸ºå‚ç…§ï¼š 1ã€åœ¨Aç±»ä¸­å®šä¹‰ä¸€ä¸ªæ¥å£ï¼šéœ€è¦æˆ‘ä»¬åœ¨ç±»ä¸­å®šä¹‰å‡ºä¸€ä¸ªæ¥å£ï¼Œå¹¶ä¸”ç»™è¿™ä¸ªæ¥å£å®šä¹‰å‡ºä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š 123public interface CallBack&#123; public abstract void work() &#125; ä»¥ä¸‹æ˜¯View.javaç±»ä¸­å®šä¹‰çš„å“åº”ç‚¹å‡»äº‹ä»¶çš„æ¥å£ï¼š 1234567891011/** * Interface definition for a callback to be invoked when a view is clicked. */ public interface OnClickListener &#123; /** * Called when a view has been clicked. * * @param v The view that was clicked. */ void onClick(View v); &#125; 2ã€åœ¨Aç±»ä¸­å®šä¹‰å‡ºè¯¥æ¥å£çš„ä¸€ä¸ªæˆå‘˜å˜é‡ï¼š 1public CallBack mCallBack ä»¥ä¸‹æ˜¯View.javaç±»ä¸­è·å–ç‚¹å‡»äº‹ä»¶æ¥å£æˆå‘˜å˜é‡çš„æºç ï¼š123456/** * Listener used to dispatch click events. * This field should be made private, so it is hidden from the SDK. * &#123;@hide&#125; */ public OnClickListener mOnClickListener; 3ã€åœ¨Aç±»ä¸­å®šä¹‰å‡ºä¸€ä¸ªå…¬å…±æ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥è®¾ç½®è¿™ä¸ªæ¥å£çš„å¯¹è±¡ï¼Œè°ƒç”¨è¯¥æ–¹æ³•å¯ä»¥ç»™æ¥å£å¯¹è±¡å˜é‡èµ‹å€¼ï¼š 123public void setCallBack(CallBack callBack) &#123; this.mCallBack = callBack; &#125; è¿™é‡Œçœ‹è‹±æ–‡æ³¨é‡Šä¹Ÿçœ‹å¾—å‡ºæ¥æ˜¯ä»€ä¹ˆæ„æ€ï¼Œæ˜¯ä¸æ˜¯æƒ³åˆ°äº†æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨setOnClickListener(OnClickListener l)çš„æ—¶å€™å‘¢:1234567891011121314/** * Register a callback to be invoked when this view is clicked. If this view is not * clickable, it becomes clickable. * * @param l The callback that will run * * @see #setClickable(boolean) */ public void setOnClickListener(@Nullable OnClickListener l) &#123; if (!isClickable()) &#123; setClickable(true); &#125; getListenerInfo().mOnClickListener = l; &#125; æœ€åä¸€æ­¥ï¼Œå¦‚æœè¯´å‰é¢çš„éƒ½æ²¡é—®é¢˜ï¼Œä½†è¿™ä¸€æ­¥å¯èƒ½æ›´ä¸å¥½ç†è§£äº†ï¼Œä¸è¿‡æ²¡å…³ç³»ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ 4ã€åœ¨Aç±»ä¸­è°ƒç”¨æ¥å£å¯¹è±¡ä¸­çš„æ–¹æ³•ï¼š 123public void doWork()&#123; mCallBack.work();&#125; åœ¨View.javaä¸­çš„ä½“ç°ï¼š 123456789101112131415161718/** * Call this view's OnClickListener, if it is defined. Performs all normal * actions associated with clicking: reporting accessibility event, playing * a sound, etc. * * @return True there was an assigned OnClickListener that was called, false * otherwise is returned. */ public boolean performClick() &#123; final boolean result; final ListenerInfo li = mListenerInfo; if (li != null &amp;&amp; li.mOnClickListener != null) &#123; playSoundEffect(SoundEffectConstants.CLICK); li.mOnClickListener.onClick(this);//å°±æ˜¯è¿™é‡Œ result = true; &#125; else &#123; result = false; &#125; è¿™é‡Œé™„ä¸Šæ•´ä¸ªé¡¹ç›®çš„ä»£ç ï¼Œè¿™é‡ŒAç±»æ˜ å°„åˆ°å®é™…ä¸­ä½¿ç”¨Employee è¿™ä¸ªç±»æ¥ä»£è¡¨ï¼š 123456789101112131415161718192021222324public class Employee &#123; /* * å®šä¹‰å›è°ƒæ¥å£çš„æˆå‘˜å˜é‡ */ private CallBack mCallBack; /* * å£°æ˜å›è°ƒæ¥å£ */ public interface CallBack&#123; public abstract void work(); &#125; /* * è®¾ç½®å›è°ƒæ¥å£å¯¹è±¡æˆå‘˜å˜é‡ */ public void setCallBack(CallBack callBack) &#123; this.mCallBack = callBack; &#125; /* * è°ƒç”¨å›è°ƒæ¥å£å¯¹è±¡ä¸­çš„æ–¹æ³• */ public void doWork() &#123; mCallback.work(); &#125; &#125; æˆ‘ä»¬åœ¨å®šä¹‰å‡ºä¸€ä¸ªBç±»ï¼Œå°±ç”¨Bossç±»å§ï¼š 123456789101112public class Boss &#123; private Employee employee; /* * ä¸ºEmployeeè®¾ç½®å›è°ƒå‡½æ•°, åœ¨è¿™é‡Œå®šä¹‰å…·ä½“çš„å›è°ƒæ–¹æ³• */ employee.setCallback(new Employee.Callback() &#123; @Override public void work() &#123; System.out.println(\"work\"); &#125; &#125;); &#125; å¦‚æœç¬¬ä¸€çœ¼çœ‹ä¸æ˜ç™½ï¼Œæˆ‘ä»¬é™„ä¸Šæˆ‘ä»¬æœ€å¸¸ç”¨çš„Buttonç‚¹å‡»äº‹ä»¶çš„å¤„ç†çš„ä»£ç ï¼Œè¿™é‡ŒEmployee ç±»ç±»æ¯”ä¸€ä¸‹å°±æ˜¯Viewç±»ï¼š 123456789101112public class TestCallBack&#123; private Button button; button.setOnClickListener(new OnClickListener() &#123; @Override public void onClick(View v) &#123; //åšä¸€äº›æ“ä½œ doWork(); &#125; &#125;); &#125; è¿™æ—¶å€™æˆ‘ä»¬åœ¨å†å›å¤´å…³äºå›è°ƒçš„å®šä¹‰ï¼š åœ¨Aç±»ä¸­å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸­ç”¨åˆ°äº†ä¸€ä¸ªæ¥å£å’Œè¯¥æ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³•ï¼Œä½†æ˜¯æŠ½è±¡æ–¹æ³•æ²¡æœ‰å…·ä½“çš„å®ç°ï¼Œéœ€è¦Bç±»å»å®ç°ï¼ŒBç±»å®ç°è¯¥æ–¹æ³•åï¼Œå®ƒæœ¬èº«ä¸ä¼šå»è°ƒç”¨è¯¥æ–¹æ³•ï¼Œè€Œæ˜¯ä¼ é€’ç»™Aç±»ï¼Œä¾›Aç±»å»è°ƒç”¨ è¿™é‡Œå›åˆ°æˆ‘ä»¬çš„ä»£ç ä¸­å°±æ˜¯ï¼šæˆ‘ä»¬åœ¨Employee(View)ç±»ä¸­å®šä¹‰äº†ä¸€ä¸ªæ¥å£ï¼Œæ¥å£å½“ä¸­è¿˜å«æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œè¿™ä¸ªæŠ½è±¡æ–¹æ³•æ²¡æœ‰å…·ä½“çš„å®ç°ï¼Œå½“æˆ‘ä»¬éœ€è¦æ—¶å€™è‡ªå·±å»å®ç°è¿™ä¸ªæ–¹æ³•ï¼Œæ¯”å¦‚è¿™é‡Œçš„Boss (Button)ç±»ï¼Œè¿™å¥è¯å¯èƒ½éš¾ä»¥ç†è§£ï¼šBç±»å®ç°è¯¥æ–¹æ³•åï¼Œå®ƒæœ¬èº«ä¸ä¼šå»è°ƒç”¨è¯¥æ–¹æ³•ï¼Œè€Œæ˜¯ä¼ é€’ç»™Aç±»ï¼Œä¾›Aç±»å»è°ƒç”¨ï¼Œæœ‰äº›äººä¼šæƒ³ï¼Œè¯¶ï¼Œåœ¨onClick()æ–¹æ³•ä¸­æˆ‘ä¸æ˜¯å†™äº†å…·ä½“çš„å®ç°å˜›ï¼Œå…¶å®çœŸçš„æ˜¯è¿™æ ·å—ï¼Œæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹ï¼Œæˆ‘ä»¬å°±æ¥å¥½å¥½çš„åˆ†æä¸€ä¸‹è¿™ä¸ªButtonç‚¹å‡»äº‹ä»¶ã€‚åˆ†æé¦–å…ˆï¼Œåœ¨Viewç±»ä¸­æˆ‘ä»¬èƒ½æ‰¾åˆ°setOnClickListener(OnClickListener l)æ–¹æ³•ï¼š 123456public void setOnClickListener(@Nullable OnClickListener l) &#123; if (!isClickable()) &#123; setClickable(true); &#125; getListenerInfo().mOnClickListener = l; &#125; è¿™é‡Œå°†OnClickListenerèµ‹å€¼ç»™äº†mOnClickListenerï¼Œæˆ‘ä»¬æƒ³è¦æ‰¾åˆ°onClick()æ–¹æ³•æ˜¯ç”±Viewå›è°ƒè€Œä¸æ˜¯Buttonè‡ªå·±å›è°ƒçš„è¯æ®ï¼Œå°±åœ¨è¿™é‡Œï¼š 12345678910public boolean performClick() &#123; sendAccessibilityEvent(AccessibilityEvent.TYPE_VIEW_CLICKED); ListenerInfo li = mListenerInfo; if (li != null &amp;&amp; li.mOnClickListener != null) &#123; playSoundEffect(SoundEffectConstants.CLICK); li.mOnClickListener.onClick(this); return true; &#125; return false; &#125; å¯¹æ­¤æˆ‘ä»¬çš„è§£é‡Šæ˜¯ï¼šåœ¨çˆ¶ç±»ä¸­æˆ‘ä»¬è¦ç”¨åˆ°onClick()æ–¹æ³•ï¼Œä½†æ˜¯çˆ¶ç±»å´æ²¡æœ‰å»å®ç°è¯¥æ–¹æ³•ï¼Œè€Œæ˜¯å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•setOnClickListener(OnClickListener l)ï¼Œå¦‚æœå­ç±»æƒ³è¦è‡ªå·±èƒ½å¤Ÿå“åº”ç‚¹å‡»äº‹ä»¶ï¼Œåˆ™å®ƒå°±å¿…é¡»é‡å†™çˆ¶ç±»çš„è¯¥æ–¹æ³•ï¼Œå®ç°OnClickListeneræ¥å£å’Œå®ƒçš„onClick()æ–¹æ³•ã€‚åœ¨å­ç±»å®ç°è¯¥æ¥å£å’Œæ–¹æ³•åï¼Œå°†å…¶é€šè¿‡å‚æ•°ä¼ é€’ç»™çˆ¶ç±»ï¼Œåœ¨çˆ¶ç±»ä¸­æ‰§è¡ŒonClick()æ–¹æ³•ã€‚é‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦‚ä½•è¿è¡Œåˆ°è¿™ä¸ªOnClick()å‡½æ•°çš„å‘¢ï¼Œè¿™é‡Œç”±äºæ¶‰åŠåˆ°Viewçš„äº‹ä»¶åˆ†å‘æœºåˆ¶ä¸ç»†è¯´ï¼Œæƒ³äº†è§£çš„è¯ç½‘ä¸Šæœ‰å¾ˆå¤šèµ„æ–™ï¼Œè¿™é‡Œåªç»™å‡ºç»“è®ºï¼Œå› ä¸ºæˆ‘ä»¬åœ¨TestCallBackè¿™ä¸ªç±»ä¸­æ²¡æœ‰å®ç°OnTouchListenerè¿™ä¸ªæ¥å£ï¼Œé‚£ä¹ˆå½“ç‚¹å‡»äº‹ä»¶å‘çš„æ—¶å€™å¿…ç„¶ä¼šè¿è¡Œåˆ°onTouchEvent()è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•ï¼š 12345678910111213141516171819202122232425262728293031public boolean onTouchEvent(MotionEvent event) &#123; // ç•¥å»æ— ç”¨ä»£ç ... if (((viewFlags &amp; CLICKABLE) == CLICKABLE || (viewFlags &amp; LONG_CLICKABLE) == LONG_CLICKABLE)) &#123; switch (event.getAction()) &#123; case MotionEvent.ACTION_UP: // ç•¥å»æ— ç”¨ä»£ç ... if (!mHasPerformedLongPress) &#123; // This is a tap, so remove the longpress check removeLongPressCallback(); // Only perform take click actions if we were in the pressed state if (!focusTaken) &#123; // Use a Runnable and post this rather than calling // performClick directly. This lets other visual state // of the view update before click actions start. if (mPerformClick == null) &#123; mPerformClick = new PerformClick(); &#125; if (!post(mPerformClick)) &#123; performClick(); //é‡ç‚¹åœ¨è¿™ &#125; &#125; &#125; //ç•¥å»æ— ç”¨ä»£ç .. break; &#125; return true; &#125; return false; &#125; è¿˜è®°å¾—å‰é¢æˆ‘ä»¬åœ¨performClick();ç±»é‡Œé¢æ‰¾åˆ°çš„å…³äºView.javaç±»ä¸­å¯¹äºå›è°ƒæ–¹æ³•onClickçš„è°ƒç”¨ä¹ˆ 1li.mOnClickListener.onClick(this);//å°±æ˜¯è¿™é‡Œ è¿™æ ·æˆ‘ä»¬å°±å®Œæ•´çš„äº†è§£äº†æ•´ä¸ªOnClickListener()æ¥å£ä¸­ä½“ç°å‡ºæ¥çš„å›è°ƒæœºåˆ¶æ€»ç»“ä¸€ä¸‹ä¸ºäº†å®ç°ä¸€ä¸ªå›è°ƒæ–¹æ³•ï¼Œé¦–å…ˆè¦å…ˆå®šä¹‰ä¸€ä¸ªåŒ…å«äº†æ¥å£çš„ç±»ï¼Œå¹¶ä¸”è¿™ä¸ªæ¥å£ä¸­è¦æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œè¿™ä¸ªæŠ½è±¡æ–¹æ³•çš„å…·ä½“å®ç°ç”±å…¶ä»–ç±»æ¥å®Œæˆ(æ¯”å¦‚æˆ‘ä»¬å“åº”Buttonçš„ç‚¹å‡»äº‹ä»¶ï¼ŒonClick()æ–¹æ³•é‡Œå†™ä¸Šå½“ç‚¹å‡»äº‹ä»¶äº§ç”Ÿå¹¶ä¸”è¯¥æ–¹æ³•è¢«è°ƒç”¨æ—¶å€™éœ€è¦åšçš„æ“ä½œï¼Œæ¯”å¦‚æ˜¾ç¤ºä¸€äº›æ–‡æœ¬ä¿¡æ¯ç­‰ç­‰)ï¼Œæœ€åè¯¥æ–¹æ³•çš„å›è°ƒæ˜¯ä¹‹å‰çš„åŒ…å«æœ‰æŠ½è±¡æ–¹æ³•çš„é‚£ä¸ªæ¥å£æ‰€åœ¨çš„ç±»å»è°ƒç”¨çš„ï¼Œæ¯”å¦‚è¯´onClick()æ–¹æ³•æ˜¯å½“ç‚¹å‡»äº‹ä»¶äº§ç”Ÿä¹‹åç»è¿‡ä¸€ç³»åˆ—çš„äº‹ä»¶åˆ†å‘åœ¨Viewç±»ä¸­è¢«è°ƒç”¨çš„ã€‚è¿™å…¶ä¸­çš„å¥¥ç§˜å°±æ˜¯ï¼š å›è°ƒå…¶å®æ˜¯ä¸€ç§åŒå‘è°ƒç”¨æ¨¡å¼ï¼Œä¹Ÿå°±è¯´è°ƒç”¨æ–¹åœ¨æ¥å£è¢«è°ƒç”¨æ—¶ä¹Ÿä¼šè°ƒç”¨å¯¹æ–¹çš„æ¥å£ï¼Œå®ç°æ–¹æ³•äº¤è¿˜ç»™æä¾›æ¥å£çš„çˆ¶ç±»å¤„ç†ï¼ ä¸ºä»€ä¹ˆè¦ç”¨å›è°ƒ æˆ‘ä»¬éƒ½çŸ¥é“Javaæ˜¯ä¸€é—¨é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œæœ‰ä¸€å¥å¾ˆè‘—åçš„è¯å°±æ˜¯â€ä¸‡äº‹ä¸‡ç‰©çš†ä¸ºå¯¹è±¡â€ï¼Œæˆ‘ä»¬æŠŠæ™®é€šäº‹ç‰©çš„å…±æ€§æŠ½å–å‡ºæ¥ï¼Œè€Œè¿™äº›å…±æ€§ä¹‹ä¸­åˆå……æ–¥ç€ç‰¹æ€§ï¼Œæ¯ä¸ªä¸åŒçš„ç‰¹æ€§å°±éœ€è¦äº¤ç»™ç‰¹å®šçš„æƒ…å†µå¤„ç†ï¼Œé€šè¿‡æš´éœ²æ¥å£æ–¹æ³•å¯ä»¥å‡å°‘å¾ˆå¤šé‡å¤ï¼Œä»£ç æ›´åŠ ä¼˜é›…ã€‚ æ‰“ä¸ªæ¯”æ–¹ï¼ŒButtonã€ImageButtonç­‰éƒ½å…·æœ‰å¯è¢«ç‚¹å‡»çš„å…±æ€§ï¼Œä½†æ˜¯è¢«ç‚¹å‡»ä¹‹åç›¸å…³äº‹ä»¶çš„å¤„ç†æ˜¯ä¸åŒçš„ï¼Œæ¯”å¦‚è¯´æˆ‘æƒ³æˆ‘è¦ç‚¹å‡»çš„è¿™ä¸ªButtonå¼¹å‡ºä¸€ä¸ªæ¶ˆæ¯æç¤ºï¼Œç„¶è€Œæˆ‘å¸Œæœ›æˆ‘çš„ImageButtonç‚¹å‡»ä¹‹åå¯ä»¥å¼¹å‡ºä¸€ä¸ªNotifactioné€šçŸ¥ï¼Œè¿™ä¸ªæ—¶å€™å›è°ƒæ–¹æ³•çš„å¥½å¤„å°±ä½“ç°å‡ºæ¥äº†ï¼Œå› ä¸ºandroidå¯¹å¤–æš´éœ²çš„OnClickListener()æ¥å£ä¸­å«æœ‰ä¸€ä¸ªOnClick()æ–¹æ³•ï¼Œä½ éœ€è¦æ€æ ·çš„å…·ä½“å®ç°éƒ½ç”±ä½ è‡ªå·±å®šä¹‰ï¼Œè€Œè¿™ä¸ªå›è°ƒæ–¹æ³•çš„æ‰€åœ¨ç±»Viewä¸ä¼šç®¡ä½ æ€ä¹ˆå®ç°çš„ï¼Œå®ƒåªè´Ÿè´£è°ƒç”¨è¿™ä¸ªå›è°ƒæ–¹æ³•ï¼Œè¿™å°±æ˜¯ä½¿ç”¨å›è°ƒçš„å¥½å¤„ã€‚ä¸»è¦å‚è€ƒ androidä¸­çš„å›è°ƒAndroidä¸­å›è°ƒå‡½æ•°æœºåˆ¶è§£æ","tags":[{"name":"å›è°ƒ","slug":"å›è°ƒ","permalink":"https://www.limuyang.cc/tags/å›è°ƒ/"},{"name":"åˆ†æ","slug":"åˆ†æ","permalink":"https://www.limuyang.cc/tags/åˆ†æ/"}]},{"title":"APPå¯åŠ¨é¡µçš„æ­£ç¡®é…ç½®æ–¹å¼","date":"2016-03-01T20:23:31.000Z","path":"2016/03/01/APPå¯åŠ¨é¡µçš„æ­£ç¡®é…ç½®æ–¹å¼/","text":"åœ¨APPçš„å¯åŠ¨é¡µé¢(Splash Screen)å¥½å¤šéƒ½æ˜¯ç­‰å¾…3ç§’ï¼Œå¥½ä¸€ç‚¹çš„è¿˜å¯ä»¥è·³è¿‡ï¼Œä½†æ˜¯æœ‰çš„è·³è¿‡ä¹Ÿæ˜¯å‡çš„æŒ‰é’®ã€‚å½“ç„¶åƒä¸€äº›å¤§å‚çš„APPï¼Œåƒç½‘æ˜“æ–°é—»ç­‰å¯åŠ¨é¡µé¢éƒ½æ˜¯å¹¿å‘Šï¼Œäººå®¶è¦æ”¶å¹¿å‘Šè´¹çš„ã€‚ä½†æ˜¯ï¼Œå¯¹äºä¸€äº›æ™®é€šçš„APPï¼Œæœ‰çš„ä¹Ÿå‡ºç°ç­‰å¾…ä¸‰ç§’çš„å¯åŠ¨ç”»é¢ï¼Œå‡ºç°ä¸€ä¸ªå¤§å¤§çš„logo,å¥½åƒå‘Šè¯‰ç”¨æˆ·ä»–æ‰“å¼€çš„æ˜¯ä»€ä¹ˆåº”ç”¨ï¼ŒåŠ æ·±ç”¨æˆ·çš„æ˜ åƒï¼Œè¿™å®Œå…¨æ˜¯æµªè´¹ç”¨æˆ·çš„æ—¶é—´ï¼Œç»™ç”¨æˆ·å¾ˆå·®çš„ä½“éªŒï¼å…¶å®æˆ‘åªæƒ³å¿«ç‚¹è¿›å…¥APPå•Šï¼ï¼ï¼è€Œä¸”æœ‰äº›APPå¯åŠ¨æ—¶å€™éƒ½ä¼šå‡ºç°ä¸€ä¸ªçŸ­æš‚çš„ç©ºç™½ç•Œé¢ï¼Œç°åœ¨æˆ‘ä»¬å°±æ¥é¿å…è¿™äº›å·²çŸ¥çš„é—®é¢˜ã€‚ ä½ çœ‹åˆ°åœ¨è¿™ä¸ªAPPçš„å¯åŠ¨é¡µé¢æ‰€èŠ±è´¹çš„æ—¶é—´æ­£æ˜¯APPæ‰€åˆå§‹åŒ–é…ç½®è‡ªå·±çš„æ—¶é—´ï¼Œç¬¬ä¸€æ¬¡å¯åŠ¨ä¹Ÿæ˜¯è¿™æ ·çš„ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡æ˜¯æœ€æ…¢çš„ï¼Œä½†æ˜¯å¦‚æœæœ‰ç¼“å­˜äº†ï¼Œé‚£ä¹ˆæ¯æ¬¡å†æ‰“å¼€åº”è¯¥æ˜¯ç«‹å³æ‰“å¼€äº†å§ å®ç°ä¸€ä¸ªå¯åŠ¨é¡µé¢(Splash Screen) å®ç°ä¸€ä¸ªå¯åŠ¨é¡µé¢å¯èƒ½å’Œä½ æƒ³è±¡çš„æœ‰ç‚¹ä¸ä¸€æ ·ã€‚è¿™ä¸ªå¯åŠ¨çš„é¡µé¢å¿…é¡»æ˜¯ç«‹å³å‡†å¤‡å¥½çš„é¡µé¢ï¼Œå³ä½¿æ˜¯åœ¨Activityä¸­åŠ è½½ä¸€ä¸ªxmlé¡µé¢ä¹Ÿè¦æ˜¯ç«‹åˆ»åŠ è½½å¥½çš„ã€‚ æ‰€ä»¥ï¼Œä¸€èˆ¬ä¸ä¼šç”¨layoutæ¥å½“å¯åŠ¨é¡µé¢ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ç”¨ä¸€ä¸ªé¢œè‰²ä½œä¸ºä½ çš„Activityçš„ä¸»é¢˜èƒŒæ™¯ï¼Œæ¥ä¸‹æ¥ï¼Œåœ¨ä½ çš„res/drawableæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ªXMLçš„drawableã€‚ 12345678910111213&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;layer-list xmlns:android=\"http://schemas.android.com/apk/res/android\"&gt; &lt;item android:drawable=\"@color/gray\"/&gt; &lt;item&gt; &lt;bitmap android:gravity=\"center\" android:src=\"@mipmap/ic_launcher\"/&gt; &lt;/item&gt;&lt;/layer-list&gt; è¿™é‡Œï¼Œæˆ‘è®¾ç½®äº†èƒŒæ™¯é¢œè‰²å’Œä¸€å¼ å±…ä¸­çš„å›¾ç‰‡ã€‚ ç„¶åï¼Œåœ¨ä¸»é¢˜ä¸­ï¼Œå°†è¿™ä¸ªè®¾ç½®ä¸ºActivityçš„èƒŒæ™¯ã€‚æ‰“å¼€ä½ çš„styles.xmlç„¶åä¸ºä½ çš„Activityæ·»åŠ ä¸€ä¸ªæ–°çš„ä¸»é¢˜ã€‚ 12345678910 &lt;!-- Base application theme. --&gt; &lt;style name=\"AppTheme\" parent=\"Theme.AppCompat.Light.DarkActionBar\"&gt; &lt;!-- Customize your theme here. --&gt; &lt;/style&gt; &lt;style name=\"SplashTheme\" parent=\"Theme.AppCompat.NoActionBar\"&gt; &lt;item name=\"android:windowBackground\"&gt;@drawable/background_splash&lt;/item&gt; &lt;/style&gt;&lt;/resources&gt; åœ¨ä½ æ–°çš„SplashThemeä¸­ï¼Œè®¾ç½®çª—å£èƒŒæ™¯å±æ€§ä¸ºæˆ‘ä»¬ä¹‹å‰å†™çš„XMLçš„drawableï¼Œå°±æ˜¯layer-listçš„xmlã€‚ç„¶ååœ¨ä½ çš„AndroidManifest.xmlä¸­é…ç½®ä¸€ä¸‹å°±å¥½äº†ã€‚ 123456789&lt;activity android:name=\".SplashActivity\" android:theme=\"@style/SplashTheme\"&gt; &lt;intent-filter&gt; &lt;action android:name=\"android.intent.action.MAIN\" /&gt; &lt;category android:name=\"android.intent.category.LAUNCHER\" /&gt; &lt;/intent-filter&gt;&lt;/activity&gt; æœ€åï¼Œåœ¨ä½ çš„SplashActivity.classæ–‡ä»¶ä¸­ï¼Œç¼–ç ç›´æ¥è¿›å…¥ä¸»é¡µé¢å°±è¡Œäº†ã€‚ 1234567891011public class SplashActivity extends AppCompatActivity &#123; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); Intent intent = new Intent(this, MainActivity.class); startActivity(intent); finish(); &#125;&#125; è¿™é‡Œå‘ç°ä½ å¹¶æ²¡æœ‰ä¸ºActivityè®¾ç½®layoutè§†å›¾ï¼Œè§†å›¾æ¥è‡ªäºä¸»é¢˜ï¼æ‰€ä»¥ï¼Œè¿™åº”è¯¥æ˜¯æœ€å¿«çš„æ–¹æ³•å¯åŠ¨é¡µé¢äº†ï¼ˆç›¸æ¯”è¾ƒåŠ è½½layoutè§†å›¾ï¼‰ã€‚å¦‚æœä½ ä¸€å®šè¦é€šè¿‡åŠ è½½layoutæ¥æ˜¾ç¤ºé¡µé¢ï¼Œå¯èƒ½ä½ åˆå§‹åŒ–å®Œäº†æ‰è·³å‡ºé¡µé¢ï¼Œè¿™æ—¶å·²ç»æœ‰ç‚¹è¿Ÿäº†ï¼Œæ‰€ä»¥ï¼Œä½ åº”è¯¥è€ƒè™‘ç”¨æçŸ­çš„æ—¶é—´æ¥æ˜¾ç¤ºåŠ è½½layoutè§†å›¾. æ­£ç¡®çš„æ‰“å¼€å®ƒ å½“ä½ å®Œæˆè¿™äº›æ­¥éª¤ï¼Œä½ å°±æ­£ç¡®çš„å®Œæˆäº†å¯åŠ¨é¡µé¢ã€‚","tags":[{"name":"å†·çƒ­å¯åŠ¨","slug":"å†·çƒ­å¯åŠ¨","permalink":"https://www.limuyang.cc/tags/å†·çƒ­å¯åŠ¨/"},{"name":"app","slug":"app","permalink":"https://www.limuyang.cc/tags/app/"}]},{"title":"AsyncTaskåˆæ­¥è§£æ","date":"2015-12-18T20:26:43.000Z","path":"2015/12/18/AsyncTaskåˆæ­¥è§£æ/","text":"AsyncTask â€“ ç›´æ¥ç»§æ‰¿ä¸Objectç±» åœ¨API-3ä¸­å¼€å§‹å°±è¢«å®šä¹‰ ä¸€ã€AsyncTaskåˆæ­¥ä»‹ç» åœ¨Androidç¨‹åºå¼€å§‹è¿è¡Œçš„æ—¶å€™ä¼šå•ç‹¬å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ï¼Œé»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰è¿™ä¸ªç¨‹åºæ“ä½œéƒ½åœ¨è¿™ä¸ªè¿›ç¨‹ä¸­è¿›è¡Œã€‚ä¸€ä¸ªAndroidç¨‹åºé»˜è®¤æƒ…å†µä¸‹åªæœ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œä½†æ˜¯ä¸€ä¸ªè¿›ç¨‹å´æ˜¯å¯ä»¥æœ‰è®¸çº¿ç¨‹çš„ã€‚ åœ¨è¿™äº›çº¿ç¨‹ä¸­ï¼Œæœ‰ä¸€ä¸ªçº¿ç¨‹å«åšUIçº¿ç¨‹ï¼Œä¹Ÿå«åšMain Threadï¼Œé™¤äº†Main Threadä¹‹å¤–çš„çº¿ç¨‹éƒ½å¯ç§°ä¸ºWorker Threadã€‚Main Threadä¸»è¦è´Ÿè´£æ§åˆ¶UIé¡µé¢çš„æ˜¾ç¤ºã€æ›´æ–°ã€äº¤äº’ç­‰ã€‚ å› æ­¤æ‰€æœ‰åœ¨UIçº¿ç¨‹ä¸­çš„æ“ä½œè¦æ±‚è¶ŠçŸ­è¶Šå¥½ï¼Œåªæœ‰è¿™æ ·ç”¨æˆ·æ‰ä¼šè§‰å¾—æ“ä½œæ¯”è¾ƒæµç•…ã€‚ä¸€ä¸ªæ¯”è¾ƒå¥½çš„åšæ³•æ˜¯æŠŠä¸€äº›æ¯”è¾ƒè€—æ—¶çš„æ“ä½œï¼Œä¾‹å¦‚ç½‘ç»œè¯·æ±‚ã€æ•°æ®åº“æ“ä½œã€ å¤æ‚è®¡ç®—ç­‰é€»è¾‘éƒ½å°è£…åˆ°å•ç‹¬çš„çº¿ç¨‹ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼Œè¿™ä¸ªæ—¶å€™å°±ç”¨åˆ°äº†å¼‚æ­¥ä»»åŠ¡ç±»AsyncTaskã€‚ AsyncTask æ˜¯ä¸€ä¸ªç»¼åˆThread å’Œ Handlerçš„è¾…åŠ©ç±»ï¼Œå¹¶ä¸æ˜¯é€šç”¨çº¿ç¨‹æ¡†æ¶çš„ä¸€éƒ¨åˆ†ã€‚AsyncTask æ˜¯çŸ­æœŸåå°æ“ä½œçš„ç†æƒ³é€‰æ‹©ï¼ˆæœ€å¤šå‡ ç§’é’Ÿï¼‰ï¼Œå¦‚æœä½ éœ€è¦çº¿ç¨‹é•¿æ—¶é—´çš„ä¿æŒè¿è¡Œï¼Œå¼ºçƒˆå»ºè®®ä½ ä½¿ç”¨ java.util.concurrent åŒ…æä¾›çš„å„ç§APIä»¥æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œæ¯”å¦‚ï¼šExecutor, ThreadPoolExecutor and FutureTask.è¿™é‡Œæˆ‘ä»¬åªè®¨è®ºAsyncTaskçš„åˆæ­¥ä½¿ç”¨ã€‚ äºŒã€AsyncTaskçš„å†…éƒ¨æœºåˆ¶ é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹AsyncTaskçš„æ–¹æ³•å®šä¹‰ï¼š 1public abstract class AsyncTask&lt;Params, Progress, Result&gt; &#123; æˆ‘ä»¬å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹åˆ°è¿™é‡Œæœ‰ä¸‰ä¸ªæ³›å‹å‚æ•°ï¼Œå½“æˆ‘ä»¬è¦åˆ©ç”¨AsyncTaskç±»çš„æ—¶å€™å¿…é¡»ä¼ å…¥å¦‚ä¸‹ä¸‰ä¸ªå‚æ•°ï¼š Parmsï¼šå¯åŠ¨è¯¥å¼‚æ­¥ä»»åŠ¡çš„æ—¶å€™ä¼ å…¥çš„å‚æ•°ç±»å‹ Progressï¼šå½“å¼‚æ­¥ä»»åŠ¡åœ¨åå°æ‰§è¡Œæ—¶è¿”å›çš„è¿›åº¦å•ä½ï¼Œä¹Ÿå¯ä»¥ç®€å•çš„ç†è§£ä¸ºåå°ä»»åŠ¡æ‰§è¡Œçš„è¿›åº¦ Resultï¼šåå°ä»»åŠ¡æ‰§è¡Œç»“æŸæ—¶è¿”å›çš„ç»“æœç±»å‹Android Developerè¿˜å‘ŠçŸ¥æˆ‘ä»¬ï¼šåœ¨æŸäº›æƒ…å†µæœ‰äº›æ³›å‹ä¸éœ€è¦è¢«æŒ‡å®šï¼Œè¿™æ—¶æˆ‘ä»¬ä¸ºäº†ç®€ä¾¿å¯ä»¥ä¼ å…¥ä¸€ä¸ªç©ºç±»å‹çš„å‚æ•°ï¼š 1private class MyTask extends AsyncTask&lt;Void, Void, Void&gt; &#123; ... &#125; æ¥ä¸‹æ¥ï¼Œä¸ºäº†æ‰§è¡Œä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡æˆ‘ä»¬è¿˜éœ€è¦æ‰§è¡Œå¦‚ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š onPreExecute()ï¼šåœ¨UIçº¿ç¨‹ä¸­è¢«æ‰§è¡Œï¼Œé€šå¸¸æ˜¯ç”¨æ¥åšä»»åŠ¡æ‰§è¡Œå‰çš„å‡†å¤‡å·¥ä½œï¼Œä¾‹å¦‚åŠ è½½ä¸€ä¸ªè¿›åº¦æ¡æˆ–è€…åœ¨UIç•Œé¢ä¸Šæ˜¾ç¤ºä¸€ä¸ªæ–‡æœ¬ç­‰ doInBackground(Paramsâ€¦)ï¼šåœ¨onPreExecute()æ–¹æ³•å®Œæˆä¹‹åç«‹å³è¢«åå°è¿›ç¨‹è°ƒç”¨ï¼Œç”¨äºæ‰§è¡Œä¸€äº›è€—æ—¶æ“ä½œï¼Œå¯åŠ¨å¼‚æ­¥ä»»åŠ¡æ—¶æ‰§è¡Œçš„Parmså‚æ•°ä¹Ÿä¼šè¢«ä¼ é€’åˆ°è¯¥æ–¹æ³•ï¼Œåœ¨è¿™ä¸€æ–¹æ³•ä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨publishProgress(Progressâ€¦)æ–¹æ³•æ¥æ›´æ–°è¿›åº¦ä¿¡æ¯ï¼Œå¹¶ä¸”åœ¨è¯¥æ–¹æ³•å†…ä¸å¯ä»¥æ›´æ–°UIä¿¡æ¯ onProgressUpdate(Progressâ€¦)ï¼šåœ¨UIçº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå¦‚æœæˆ‘ä»¬åœ¨doInBackground(Paramsâ€¦)æ–¹æ³•ä¸­ä½¿ç”¨äº†publishProgress(Progressâ€¦)é‚£ä¹ˆè¿›åº¦ä¿¡æ¯å°†å¯ä»¥ä»¥è¿›åº¦æ¡æˆ–è€…Logçš„å½¢å¼æ˜¾ç¤ºåœ¨UIç»„ä»¶ä¸Š onPostExecute(Result)ï¼šåœ¨UIçº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå½“åå°ä»»åŠ¡æ“ä½œç»“æŸä¹‹åè¯¥æ–¹æ³•ä¼šè¢«æ‰§è¡Œï¼ŒdoInBackground(Paramsâ€¦)æ–¹æ³•è®¡ç®—å¾—åˆ°çš„ç»“æœå°†ä½œä¸ºè¯¥æ–¹æ³•çš„è¾“å…¥å‚æ•°æ¥è¿›è¡Œä¸€äº›UIæ›´æ–°çš„æ“ä½œ å–æ¶ˆAsyncTaskä»»åŠ¡æ“ä½œ æˆ‘ä»¬å¯ä»¥åœ¨å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œçš„ä»»ä½•æ—¶å€™é€šè¿‡è°ƒç”¨cancel(boolean )æ–¹æ³•æ¥å–æ¶ˆï¼›æˆ‘ä»¬åœ¨cancel(boolean)æ–¹æ³•ä¸­ä¼ å…¥trueå‚æ•°åˆ™è¡¨æ˜å–æ¶ˆæ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¦‚æœè°ƒç”¨æˆåŠŸï¼Œé‚£ä¹ˆä¹‹åæˆ‘ä»¬ä½¿ç”¨isCancelled()æ–¹æ³•æ¥åˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¢«å–æ¶ˆçš„æ—¶å€™éƒ½ä¼šè¿”å›trueï¼Œå–æ¶ˆä¹‹ååœ¨æ‰§è¡Œå®ŒdoInBackground(Object[])åonCancelled(Object)æ–¹æ³•ä¼šä»£æ›¿onPostExecute(Object)æ–¹æ³•è¢«æ‰§è¡Œã€‚ä¸ºäº†ç¡®ä¿èƒ½å¤Ÿå°½å¿«çš„å–æ¶ˆä¸€ä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨doInBackground(Object[])é‡Œé¢å‘¨æœŸæ€§çš„æ£€æŸ¥isCancelled()çš„è¿”å›å€¼(ä¾‹å¦‚åœ¨ä¸€ä¸ªå¾ªç¯é‡Œé¢) æ³¨æ„äº‹é¡¹ AsyncTask ç±»å¿…é¡»åœ¨UIä¸»çº¿ç¨‹ä¸­è¢«åŠ è½½,ä»Android4.1å¼€å§‹ç³»ç»Ÿä¸Šå·²ç»å¸®æˆ‘ä»¬è‡ªåŠ¨å®Œæˆè¿™ä¸€ç‚¹ AsyncTaskç±»çš„å®ä¾‹å¿…é¡»åœ¨UIçº¿ç¨‹ä¸­è¿›è¡Œåˆ›å»º execute(Paramsâ€¦) å¿…é¡»åœ¨UIä¸»çº¿ç¨‹ä¸­è¢«è°ƒç”¨ ä¸è¦æ‰‹åŠ¨çš„å»è°ƒç”¨ onPreExecute(), onPostExecute(Result), doInBackground(Paramsâ€¦), onProgressUpdate(Progressâ€¦)è¿™äº›æ–¹æ³• ä»»åŠ¡åªèƒ½è¢«æ‰§è¡Œä¸€æ¬¡(å¦‚æœæ‰§è¡Œç¬¬äºŒæ¬¡åˆ™æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸) ä¸‰ã€AsyncTaskçš„ä½¿ç”¨ ä¸‹é¢ç»™å‡ºä¸€ä¸ªå…³äºAsyncTaskçš„ä½¿ç”¨çš„Demoï¼Œå¸ƒå±€åªæœ‰ä¸¤ä¸ªButtonã€ä¸€ä¸ªTextViewå’Œä¸€ä¸ªProgressBarï¼Œä»£ç å¦‚ä¸‹ï¼š1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556&lt;RelativeLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" xmlns:tools=\"http://schemas.android.com/tools\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\" &gt; &lt;ProgressBar android:id=\"@+id/progressBar\" android:layout_width=\"match_parent\" android:layout_height=\"25dp\" android:layout_centerInParent=\"true\" android:layout_margin=\"5dip\" android:layout_marginTop=\"60dp\" android:background=\"@drawable/btn_style\" android:indeterminate=\"false\" android:indeterminateOnly=\"false\" android:max=\"100\" android:progress=\"0\" android:progressDrawable=\"@drawable/bakground_progress\" /&gt; &lt;Button android:id=\"@+id/Cancle\" android:layout_width=\"100dp\" android:layout_height=\"wrap_content\" android:layout_alignRight=\"@+id/progressBar\" android:layout_below=\"@+id/progressBar\" android:layout_marginRight=\"24dp\" android:background=\"@drawable/btn_style\" android:text=\"Cancle\" android:textColor=\"#ffffff\" android:textStyle=\"bold\" /&gt; &lt;Button android:id=\"@+id/Execute\" android:layout_width=\"100dp\" android:layout_height=\"wrap_content\" android:layout_alignLeft=\"@+id/progressBar\" android:layout_below=\"@+id/progressBar\" android:layout_marginLeft=\"42dp\" android:background=\"@drawable/btn_style\" android:text=\"Excuse\" android:textColor=\"#ffffff\" android:textStyle=\"bold\" /&gt; &lt;TextView android:id=\"@+id/tv\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:layout_above=\"@+id/progressBar\" android:layout_centerHorizontal=\"true\" android:layout_marginBottom=\"31dp\" android:text=\"AsyncTaskæµ‹è¯•\" android:textSize=\"20sp\" android:textColor=\"#000000\" android:textStyle=\"bold\" /&gt;&lt;/RelativeLayout&gt; ç»“æ„ç›¸å¯¹ç®€å•ï¼Œæ¥ä¸‹é‡Œè®©æˆ‘ä»¬çœ‹çœ‹TestAsyncTask.javaçš„ä»£ç ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114package com.example.testasynctask;import android.app.Activity;import android.os.AsyncTask;import android.os.Bundle;import android.view.View;import android.widget.Button;import android.widget.ProgressBar;import android.widget.TextView;import android.widget.Toast;public class TestAsyncTask extends Activity &#123; private Button execute, cancle; private ProgressBar progressBar; private TextView tv; private TestAsyncTaskProgressBar testAsyncTaskProgressBar; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); execute = (Button) findViewById(R.id.Execute); tv = (TextView) findViewById(R.id.tv); progressBar = (ProgressBar) findViewById(R.id.progressBar); execute.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View v) &#123; /** * è¿™é‡Œæ³¨æ„æ–°å»ºçš„ä»»åŠ¡åªèƒ½æ‰§è¡Œä¸€æ¬¡ï¼Œå¦åˆ™ä¼šå‡ºç°å¼‚å¸¸ */ testAsyncTaskProgressBar = new TestAsyncTaskProgressBar(); testAsyncTaskProgressBar.execute(); execute.setEnabled(false); cancle.setEnabled(true); &#125; &#125;); cancle = (Button) findViewById(R.id.Cancle); cancle.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View v) &#123; /** * ä½¿ç”¨è¯¥æ–¹æ³•å¯ä»¥å°è¯•å–æ¶ˆæ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ */ testAsyncTaskProgressBar.cancel(true); &#125; &#125;); &#125; /** * è¦ä½¿ç”¨AsyncTaskå¿…é¡»åˆ›å»ºå®ƒçš„å­ç±»ï¼Œå¹¶ä¸”è¯¥å­ç±»è‡³å°‘éœ€è¦è¦†ç›–doInBackground(Params...)æ–¹æ³• */ class TestAsyncTaskProgressBar extends AsyncTask&lt;Void, Integer, Void&gt; &#123; /** * å½“onPreExecute()æ–¹æ³•ç»“æŸæ‰§è¡Œæ—¶è¯¥æ–¹æ³•ç«‹å³åœ¨åå°æ‰§è¡Œï¼Œç”¨äºè¿›è¡Œä¸€äº›è€—æ—¶çš„æ“ä½œï¼Œå¹¶ä¸”åœ¨æ‰§è¡Œåå°æ“ä½œçš„åŒæ—¶ * è¿˜å¯ä»¥é€šè¿‡publishProgress * (Progress...)å°†æ‰§è¡Œè¿›åº¦å®æ—¶ä¼ é€åˆ°UIçº¿ç¨‹ï¼Œåˆ©ç”¨onProgressUpdate(Progress...)æ–¹æ³• * å¯ä»¥è¿›è¡ŒåŠ¨æ€å±•ç¤ºï¼Œè€Œä¸”åœ¨è¯¥æ–¹æ³•å†…ä¸å…è®¸ä¿®æ”¹UI */ @Override protected Void doInBackground(Void... params) &#123; while (!isCancelled() &amp;&amp; progressBar.getProgress() &lt; 100) &#123; publishProgress(new Integer(5)); try &#123; Thread.sleep(500); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; return null; &#125; /** * è¯¥æ–¹æ³•åœ¨UIçº¿ç¨‹ä¸­è¢«æ‰§è¡Œï¼Œä¸»è¦ç”¨åœ¨æ‰§è¡Œåå°æ“ä½œä¹‹å‰åšä¸€äº›UIæ“ä½œè­¬å¦‚æ˜¾ç¤ºä¸€ä¸ªè¿›åº¦æ¡ */ @Override protected void onPreExecute() &#123; super.onPreExecute(); tv.setText(\"å¼€å§‹æ‰§è¡Œ\"); &#125; /** * åå°ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¹‹åè¯¥æ–¹æ³•ç«‹å³æ‰§è¡Œï¼Œåå°ä»»åŠ¡æ‰§è¡Œç»“æœçš„å‚æ•°ä¼šè¢«ä¼ é€’åˆ°è¯¥æ–¹æ³•ä¸­ */ @Override protected void onPostExecute(Void result) &#123; super.onPostExecute(result); tv.setText(\"æ‰§è¡Œå®Œæ¯•\"); &#125; /** * å½“publishProgress(Progress...)æ–¹æ³•è¢«æ‰§è¡Œçš„æ—¶å€™è¢«è°ƒç”¨ï¼Œå¹¶ä¸”æ¥å—ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•° */ @Override protected void onProgressUpdate(Integer... values) &#123; super.onProgressUpdate(values); progressBar.setProgress(progressBar.getProgress() + values[0]); &#125; /** * cancel(boolean)æ–¹æ³•è¢«è°ƒç”¨å¹¶ä¸”doInBackground(Object[])æ–¹æ³•æ‰§è¡Œå®Œæ¯•æ—¶æ‰§è¡Œ */ @Override protected void onCancelled() &#123; super.onCancelled(); tv.setText(\"æ‰§è¡Œä¸­æ–­\"); progressBar.setProgress(0); execute.setEnabled(true); cancle.setEnabled(false); &#125; &#125;&#125; æ€»ä½“æ‰§è¡Œæ•ˆæœå¦‚ä¸‹ï¼šAsyncTask Demoæºç  å‚è€ƒé“¾æ¥ï¼š http://blog.csdn.net/ahuier/article/details/16953793 http://blog.csdn.net/liuhe688/article/details/6532519","tags":[{"name":"å¼‚æ­¥IO","slug":"å¼‚æ­¥IO","permalink":"https://www.limuyang.cc/tags/å¼‚æ­¥IO/"},{"name":"AsyncTask","slug":"AsyncTask","permalink":"https://www.limuyang.cc/tags/AsyncTask/"}]}]